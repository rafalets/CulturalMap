import{a as N}from"./chunk-VACZNAP3.js";import{a as P}from"./chunk-F7VRLFCB.js";import{d as C,t as A}from"./chunk-C7INQGWT.js";import{H as M,I as q,j as I,q as S}from"./chunk-WMHJC7XF.js";import{b as T}from"./chunk-NJEWDTYF.js";import{h as r}from"./chunk-FNXQZPHT.js";import{a as O}from"./chunk-D2LVMNOU.js";import{a as b}from"./chunk-QGVBCWUY.js";import{b as B}from"./chunk-HHDFN2GK.js";import{i as L}from"./chunk-VTHXE323.js";var n;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(n||(n={}));function j(e){return(t,s)=>{t[s]=e}}var p,R=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}},w=class{constructor(t,s,i,o,c){this.target=t,this.added=s,this.removed=i,this.start=o,this.deleteCount=c}},u=new q(R,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1});function z(e){e&&typeof e=="object"&&"destroy"in e&&typeof e.destroy=="function"&&e.destroy()}function D(e){return e?e instanceof d?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function x(e){if(e?.length)return e[0]}function $(e,t,s,i){let o=Math.min(e.length-s,t.length-i),c=0;for(;c<o&&e[s+c]===t[i+c];)c++;return c}function k(e,t,s,i){t&&t.forEach((o,c,_)=>{e.push(o),k(e,s.call(i,o,c,_),s,i)})}var v=new Set,y=new Set,E=new Set,V=new Map,H=0,d=p=class extends N.EventedAccessor{static isCollection(e){return e!=null&&e instanceof p}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new P,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:H++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof p?{items:e}:e:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*L(this.items)}get items(){return r(this._observable),this._items}set items(e){this._emitBeforeChanges(n.ADD)||(this._splice(0,this.length,D(e)),this._emitAfterChanges(n.ADD))}hasEventListener(e){return!this.destroyed&&(e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e))}on(e,t){if(this.destroyed)return O();if(e==="change"){let s=this._chgListeners,i={removed:!1,callback:t};return s.push(i),this._notifications&&this._notifications.push({listeners:s.slice(),items:this._items.slice(),changes:[]}),O(()=>{i.removed=!0,s.splice(s.indexOf(i),1)})}return this._emitter.on(e,t)}once(e,t){let s="deref"in t?()=>t.deref():()=>t,i=this.on(e,o=>{s()?.call(null,o),i.remove()});return i}add(e,t){if(r(this._observable),this._emitBeforeChanges(n.ADD))return this;let s=this.getNextIndex(t??null);return this._splice(s,0,[e]),this._emitAfterChanges(n.ADD),this}addMany(e,t=this._items.length){if(r(this._observable),!e?.length)return this;if(this._emitBeforeChanges(n.ADD))return this;let s=this.getNextIndex(t);return this._splice(s,0,D(e)),this._emitAfterChanges(n.ADD),this}at(e){if(r(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(r(this._observable),!this.length||this._emitBeforeChanges(n.REMOVE))return[];let e=this._removeAllRaw();return this._emitAfterChanges(n.REMOVE),e}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return r(this._observable),this._createNewInstance({items:this._items.map(B)})}concat(...e){r(this._observable);let t=e.map(D);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(r(this._observable),!this.length||this._emitBeforeChanges(n.REMOVE))return;let s=this._splice(0,this.length),i=s.length;for(let o=0;o<i;o++)e.call(t,s[o],o,s);this._emitAfterChanges(n.REMOVE)}destroyAll(){this.drain(z)}destroyMany(e){let t=this.removeMany(e);return t.forEach(z),t}every(e,t){return r(this._observable),this._items.every(e,t)}filter(e,t){r(this._observable);let s=arguments.length===2?this._items.filter(e,t):this._items.filter(e);return this._createNewInstance({items:s})}find(e,t){return r(this._observable),this._items.find(e,t)}findIndex(e,t){return r(this._observable),this._items.findIndex(e,t)}flatten(e,t){r(this._observable);let s=[];return k(s,this,e,t),new p(s)}forEach(e,t){return r(this._observable),this._items.forEach(e,t)}getItemAt(e){return r(this._observable),this._items[e]}getNextIndex(e){r(this._observable);let t=this.length;return(e=e??t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return r(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return r(this._observable),this._items.indexOf(e,t)}join(e=","){return r(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return r(this._observable),this._items.lastIndexOf(e,t)}map(e,t){r(this._observable);let s=this._items.map(e,t);return new p({items:s})}reorder(e,t=this.length-1){r(this._observable);let s=this.indexOf(e);if(s!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),s!==t){if(this._emitBeforeChanges(n.MOVE))return e;this._splice(s,1),this._splice(t,0,[e]),this._emitAfterChanges(n.MOVE)}return e}}pop(){if(r(this._observable),!this.length||this._emitBeforeChanges(n.REMOVE))return;let e=x(this._splice(this.length-1,1));return this._emitAfterChanges(n.REMOVE),e}push(...e){return r(this._observable),this._emitBeforeChanges(n.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(n.ADD)),this.length}reduce(e,t){r(this._observable);let s=this._items;return arguments.length===2?s.reduce(e,t):s.reduce(e)}reduceRight(e,t){r(this._observable);let s=this._items;return arguments.length===2?s.reduceRight(e,t):s.reduceRight(e)}remove(e){return r(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(r(this._observable),e<0||e>=this.length||this._emitBeforeChanges(n.REMOVE))return;let t=x(this._splice(e,1));return this._emitAfterChanges(n.REMOVE),t}removeMany(e){if(r(this._observable),!e?.length||this._emitBeforeChanges(n.REMOVE))return[];let t=e instanceof p?e.toArray():e,s=this._items,i=[],o=t.length;for(let c=0;c<o;c++){let _=t[c],l=s.indexOf(_);if(l>-1){let a=1+$(t,s,c+1,l+1),f=this._splice(l,a);f&&f.length>0&&i.push.apply(i,f),c+=a-1}}return this._emitAfterChanges(n.REMOVE),i}reverse(){if(r(this._observable),this._emitBeforeChanges(n.MOVE))return this;let e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(n.MOVE),this}shift(){if(r(this._observable),!this.length||this._emitBeforeChanges(n.REMOVE))return;let e=x(this._splice(0,1));return this._emitAfterChanges(n.REMOVE),e}slice(e=0,t=this.length){return r(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return r(this._observable),this._items.some(e,t)}sort(e){if(r(this._observable),!this.length||this._emitBeforeChanges(n.MOVE)||!this._requiresSort(e))return this;let t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(n.MOVE),this}_requiresSort(e=(t,s)=>t===s?0:t<s?-1:1){let t=this.length-1;for(let s=0;s<t;s++)if(e(this.items[s],this.items[s+1])>0)return!0;return!1}splice(e,t,...s){r(this._observable);let i=(t?n.REMOVE:0)|(s.length?n.ADD:0);if(this._emitBeforeChanges(i))return[];let o=this._splice(e,t,s)||[];return this._emitAfterChanges(i),o}toArray(){return r(this._observable),this._items.slice()}toJSON(){return r(this._observable),this.toArray()}toLocaleString(){return r(this._observable),this._items.toLocaleString()}toString(){return r(this._observable),this._items.toString()}unshift(...e){return r(this._observable),!e.length||this._emitBeforeChanges(n.ADD)||(this._splice(0,0,e),this._emitAfterChanges(n.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,s){let i=this._items,o=this.itemType,c,_;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=T(()=>this._dispatchChange())),e<0&&(e+=this.length),t){if(_=i.splice(e,t),this.hasEventListener("before-remove")){let l=u.acquire();l.target=this,l.cancellable=!0;for(let a=0,f=_.length;a<f;a++)c=_[a],l.reset(c),this.emit("before-remove",l),l.defaultPrevented&&(_.splice(a,1),i.splice(e,0,c),e+=1,a-=1,f-=1);u.release(l)}if(this.length=this._items.length,this.hasEventListener("after-remove")){let l=u.acquire();l.target=this,l.cancellable=!1;let a=_.length;for(let f=0;f<a;f++)l.reset(_[f]),this.emit("after-remove",l);u.release(l)}}if(s?.length){if(o){let h=[];for(let m of s){let g=o.ensureType(m);g==null&&m!=null||h.push(g)}s=h}let l=this.hasEventListener("before-add"),a=this.hasEventListener("after-add"),f=e===this.length;if(l||a){let h=u.acquire();h.target=this,h.cancellable=!0;let m=u.acquire();m.target=this,m.cancellable=!1;for(let g of s)l?(h.reset(g),this.emit("before-add",h),h.defaultPrevented||(f?i.push(g):i.splice(e++,0,g),this._set("length",i.length),a&&(m.reset(g),this.emit("after-add",m)))):(f?i.push(g):i.splice(e++,0,g),this._set("length",i.length),m.reset(g),this.emit("after-add",m));u.release(m),u.release(h)}else{if(f)for(let h of s)i.push(h);else i.splice(e,0,...s);this._set("length",i.length)}}if((s?.length||_?.length)&&this._notifyChangeEvent(s,_),this.hasEventListener("after-splice")){let l=new w(this,s,_,e,t);this.emit("after-splice",l)}return _}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){let s=u.acquire();s.target=this,s.cancellable=!0,s.type=e,this.emit("before-changes",s),t=s.defaultPrevented,u.release(s)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){let t=u.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),u.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;let e=this._notifications;this._notifications=null;for(let t of e){let s=t.changes;v.clear(),y.clear(),E.clear();for(let{added:a,removed:f}of s){if(a)if(E.size===0&&y.size===0)for(let h of a)v.add(h);else for(let h of a)y.has(h)?(E.add(h),y.delete(h)):E.has(h)||v.add(h);if(f)if(E.size===0&&v.size===0)for(let h of f)y.add(h);else for(let h of f)v.has(h)?v.delete(h):(E.delete(h),y.add(h))}let i=A.acquire();v.forEach(a=>{i.push(a)});let o=A.acquire();y.forEach(a=>{o.push(a)});let c=this._items,_=t.items,l=A.acquire();if(E.forEach(a=>{_.indexOf(a)!==c.indexOf(a)&&l.push(a)}),t.listeners&&(i.length||o.length||l.length)){let a={target:this,added:i,removed:o,moved:l},f=t.listeners.length;for(let h=0;h<f;h++){let m=t.listeners[h];m.removed||m.callback.call(this,a)}}A.release(i),A.release(o),A.release(l)}v.clear(),y.clear(),E.clear()}};d.ofType=e=>{if(!e)return p;if(V.has(e))return V.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(let i in e.typeMap){let o=e.typeMap[i].prototype.declaredClass;t?t+=` | ${o}`:t=o}let s=class extends p{};return b([j({Type:e,ensureType:typeof e=="function"?I(e):S(e)})],s.prototype,"itemType",void 0),s=b([M(`esri.core.Collection<${t}>`)],s),V.set(e,s),s},b([C()],d.prototype,"_updating",void 0),b([C()],d.prototype,"length",void 0),b([C()],d.prototype,"items",null),b([C({readOnly:!0})],d.prototype,"updating",null),d=p=b([M("esri.core.Collection")],d);var he=d;export{j as a,he as b};
