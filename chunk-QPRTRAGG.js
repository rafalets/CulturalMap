import{e as T}from"./chunk-F6A6XWW4.js";import{f as O}from"./chunk-7EG726PT.js";import{d as S}from"./chunk-C7INQGWT.js";import{H as E,t as x}from"./chunk-WMHJC7XF.js";import{a as w}from"./chunk-QGVBCWUY.js";import{b as R}from"./chunk-HHDFN2GK.js";import{t as P}from"./chunk-47GHT6OF.js";import{a as M,b as V}from"./chunk-VTHXE323.js";var G="Raster.",g="Raster.Dim.",C=".Max",y={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},Y=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function N(e,n){return new T({name:e,alias:n,domain:null,editable:!1,length:50,type:"string"})}function F(e,n){return new T({name:e,alias:n,domain:null,editable:!1,type:"double"})}function H(e,n){return new T({name:e,alias:n,domain:null,editable:!1,type:"date"})}function se(e){return N(y.servicePixelValue,e??"Service Pixel Value")}function re(e){return N(y.rawServicePixelValue,e??"Raw Service Pixel Value")}function le(){return N(y.itemPixelValue,"Item Pixel Value")}function oe(e){return N(`${y.servicePixelValue}.${e}`,e)}function ue(e){return F(`${y.magnitude}`,"Magnitude"+(e?` (${e})`:""))}function me(){return F(`${y.direction}`,"Direction (\xB0)")}function ce(e){return e.fields.filter(n=>n.type!=="oid"&&n.name.toLowerCase()!=="value").map(n=>{let i=n.clone();return i.name=`${G}${n.name}`,i})}function de(e){let n=new Set,i=new Set,s=new Map;return e.variables.forEach(({dimensions:a})=>{a.forEach(t=>{if(t.recurring)s.set(t.name,t.unit);else{let r=t.unit?.trim()==="ISO8601"?n:i;r.add(t.name),t.hasRanges&&r.add(`${t.name}${C}`)}})}),[N(y.variable,"Variable"),...[...n].map(a=>H(`${g}${a}`,I(a))),...[...i].map(a=>F(`${g}${a}`,I(a))),...[...s].map(([a,t])=>F(`${g}${a}`,K(a,t)))]}function K(e,n){return n=n?.toLowerCase(),n&&Y.has(n)?Y.get(n):I(e)}function I(e){let n=e.endsWith(C),i=n?e.slice(0,-4):e,s=i==="StdTime"?"Standard Time":i==="StdZ"?"Standard Z":i;return n?`${s} Max`:s}function A(e,n){return n?new Date(e):e}function fe(e,n,i){i?.length&&(n[y.variable]=i[0].variableName,i.forEach(({dimensionName:s,values:a})=>{if(s&&a?.length){let t=`${g}${s}`,r=e.find(({name:u})=>u===t);if(!r)return;let l=r.type==="date",o=a[0];if(Array.isArray(o)){if(n[`${g}${s}`]=A(o[0],l),o[1]!=null){let u=`${g}${s}${C}`;if(e.some(({name:m})=>m===u)){let m=A(o[1],l);n[u]=m}}}else n[`${g}${s}`]=A(o,l)}}))}function he(e,n){if(n.pixelType.startsWith("f")&&e.forEach(({format:i,fieldName:s})=>{i&&s&&/^raster\.(item|service)pixelvalue/i.test(s)&&(i.places=2)}),n.multidimensionalInfo){let i=n.multidimensionalInfo.variables.flatMap(({dimensions:s})=>s);e.forEach(({format:s,fieldName:a})=>{if(s&&a?.startsWith(g)){let t=a.slice(g.length),r=`${t}${C}`;i.find(({name:o})=>o===t||o===r)?.values?.every(o=>Number.isInteger(o))&&(s.places=0)}})}}var U,D=U=class extends O{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new U({variableName:this.variableName,dimensionName:this.dimensionName,values:R(this.values),isSlice:this.isSlice})}};w([S({type:String,json:{write:!0}})],D.prototype,"variableName",void 0),w([S({type:String,json:{write:!0}})],D.prototype,"dimensionName",void 0),w([S({type:x.array(x.oneOf([x.native(Number),x.array(x.native(Number))])),json:{write:!0}})],D.prototype,"values",void 0),w([S({type:Boolean,json:{write:!0}})],D.prototype,"isSlice",void 0),D=U=w([E("esri.layers.support.DimensionalDefinition")],D);var $=D;function W(e,n,i){let s=n.shift();if(i.length===0){let t=[];i.push({sliceId:-1,multidimensionalDefinition:t})}let a=i.length;for(let t=0;t<a;t++){let r=i.shift().multidimensionalDefinition;s.values?.forEach(l=>{i.push({sliceId:-1,multidimensionalDefinition:[...r,{variableName:e,dimensionName:s.name,values:[l]}]})})}n.length&&W(e,n,i)}function Te(e,n){let i=[],s=0;return(n?e.variables.filter(a=>a.name.toLowerCase()===n.toLowerCase()):[...e.variables].sort((a,t)=>a.name>t.name?1:-1)).forEach(a=>{let t=[],r=[...a.dimensions].sort((l,o)=>l.name>o.name?-1:1);W(a.name,r,t),t.forEach(l=>{i.push(V(M({},l),{sliceId:s++}))})}),i}function Fe(e,n,i){let s=e;if(n&&(n=[...n].sort((a,t)=>a.dimensionName<t.dimensionName?-1:1)).forEach(({dimensionName:a,values:t,isSlice:r})=>{t.length&&(s=s.filter(l=>{let o=l.multidimensionalDefinition.find(m=>m.dimensionName===a);if(o==null)return!1;let u=o.values[0];return typeof u=="number"?typeof t[0]=="number"?t.includes(u):t.some(m=>m[0]<=u&&m[1]>=u):typeof t[0]=="number"?t.some(m=>u[0]<=m&&u[1]>=m):r?t.some(m=>m[0]===u[0]&&m[0]===u[1]):t.some(m=>m[0]>=u[0]&&m[0]<=u[1]||m[1]>=u[0]&&m[1]<=u[1]||m[0]<u[0]&&m[1]>u[1])}))}),s.length&&i?.start!=null&&i.end!=null){let a=i.start.getTime(),t=i.end.getTime(),r=s[0].multidimensionalDefinition.findIndex(l=>l.dimensionName==="StdTime");r>-1&&(s=s.filter(l=>{let o=l.multidimensionalDefinition[r].values[0];return a<=o&&t>=o}))}return s.map(a=>a.sliceId)}function Z(e,n){return Array.isArray(e)?n[0]===n[1]?e[0]===n[0]||e[1]===n[0]:e[0]>=n[0]&&e[0]<=n[1]&&e[1]>=n[0]&&e[1]<=n[1]:e>=n[0]&&e<=n[1]}function X(e,n){return e[0]<=n[0]&&e[1]>=n[0]||e[0]<=n[1]&&e[1]>=n[1]||e[0]>=n[0]&&e[1]<=n[1]}function q(e){return e.length===1?[e[0],e[0]]:[e[0],e[e.length-1]]}function z(e,n,i){if(!n?.subsetDefinitions?.length)return e;let s;if(i){let{variables:r}=n;if(r.length&&!r.includes(i))return null;let l=n.subsetDefinitions.find(o=>o.dimensionName===e.name&&o.variableName===i);if(!l?.values?.length)return e;s=q(l.values)}else s=n.dimensions.find(({name:l})=>l===e.name)?.extent;let a=s;if(!a?.length)return e;let t=e.values.filter(r=>Z(r,a));return V(M({},e),{extent:[...a],values:t})}function k(e,n,i){if(!n?.subsetDefinitions?.length)return!1;let{variables:s}=n;if(s.length&&e.some(({variableName:a})=>a&&!s.includes(a)))return!0;for(let a=0;a<e.length;a++){let t=e[a],r=n.subsetDefinitions.find(l=>(t.variableName===""||l.variableName===t.variableName)&&l.dimensionName===t.dimensionName);if(r?.values.length){let l=q(r.values);if(!t.isSlice&&t.values.length===2&&!Array.isArray(t.values[0])&&t.values[0]!==t.values[1]&&i){if(!X(t.values,l))return!0}else if(t.values.some(o=>!Z(o,l)))return!0}}return!1}function Ce(e,n){if(e==null)return{isOutside:!1};let{geometry:i,timeExtent:s,multidimensionalDefinition:a}=n,t=null;if(s!=null&&(t=ee(e,s),t==null))return{isOutside:!0};let{areaOfInterest:r}=e;if(r&&i){let l=i.type==="point"?i:i.type==="extent"?i.center:i.type==="polygon"?i.centroid:null;if(l&&!r.contains(l))return{isOutside:!0}}return a!=null&&a.length&&k(a,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:i,timeExtent:t,multidimensionalDefinition:a}}}function ee(e,n){let i=e.dimensions.find(({name:r})=>r==="StdTime");if(i==null||n.start==null&&n.end==null)return n;n=n.clone();let{start:s,end:a}=n.toJSON(),t=s===a?[s]:s!=null&&a!=null?[s,a]:[s??a];return t.length===2&&i?.extent.length&&(t[0]=Math.max(t[0],i.extent[0]),t[1]=Math.min(t[1],i.extent[1]??i.extent[0]),t[1]<t[0])||k([new $({variableName:"",dimensionName:"StdTime",isSlice:t.length===1,values:t})],e,!0)?null:(n.start=new Date(t[0]),n.end=new Date(t[1]??t[0]),n)}function $e(e){let{rasterInfo:n,multidimensionalSubset:i}=e,{multidimensionalInfo:s}=n;if(s==null)return null;let a=e.multidimensionalDefinition?.length?e.multidimensionalDefinition:L(n,{multidimensionalSubset:i});if(!a?.length)return null;if(a.some(r=>!r.dimensionName)){let{variableName:r}=a[0],l=L(n,{multidimensionalSubset:i,variableName:r});l?.forEach(o=>{let u=a?.find(({dimensionName:m})=>m===o.dimensionName);u?.values?.length&&(o.values=u.values,o.isSlice=u.isSlice)}),a=l}let{timeExtent:t}=e;if(a!=null&&t!=null&&(t.start!=null||t.end!=null)){a=a.map(h=>h.clone());let r=s.variables.find(({name:h})=>h===a[0].variableName)?.dimensions?.find(({name:h})=>h==="StdTime"),l=a.find(({dimensionName:h})=>h==="StdTime");if(!r||!l)return null;let{start:o,end:u}=t,m=o==null?null:o.getTime(),v=u==null?null:u.getTime(),c=m??v,f=v??m;if(r.values!=null){let h=r.values.filter(d=>{if(Array.isArray(d)){if(c===f)return d[0]<=c&&d[1]>=c;let b=d[0]<=c&&d[1]>c||d[0]<f&&d[1]>=f,p=d[0]>=c&&d[1]<=f||d[0]<c&&d[1]>f;return b||p}return c===f?d===c:d>=c&&d<=f});if(h.length){let d=h.sort((b,p)=>{let B=Array.isArray(b)?b[0]:b,J=Array.isArray(b)?b[1]:b,Q=Array.isArray(p)?p[0]:p,_=Array.isArray(p)?p[1]:p;return c===f?B-Q:Math.abs(J-f)-Math.abs(_-f)})[0];l.values=[d]}else a=null}else if(r.hasRegularIntervals&&r.extent){let[h,d]=r.extent;c>d||f<h?a=null:l.values=c===f?[c]:[Math.max(h,c),Math.min(d,f)]}}return a!=null&&k(a,i)?null:a}function ne(e,n={}){let{multidimensionalInfo:i,keyProperties:s}=e;if(i==null)return null;let{variableName:a,multidimensionalSubset:t,multidimensionalDefinition:r}=n,l=r!=null?r[0]?.variableName:null,o=a||l||s?.DefaultVariable,{variables:u}=i;return t?.variables?.length&&(u=u.filter(({name:m})=>t.variables.includes(m))),o?u.find(({name:m})=>m===o)??u[0]:u[0]}function L(e,n={}){let i=ne(e,n);if(!i)return null;let s=[],{dimensions:a,name:t}=i;if(a.length===0)return[new $({variableName:t,dimensionName:"",values:[],isSlice:!0})];for(let r=0;r<a.length;r++){let l=z(a[r],n.multidimensionalSubset,t);if(!l)return null;let{values:o,extent:u}=l,m=o?.[0]??u?.[0];l.name.toLowerCase()==="stdz"&&!l.hasRanges&&u&&Math.abs(u[1])<=Math.abs(u[0])&&(m=o?.length?o[o.length-1]:u[1]),s.push(new $({variableName:t,dimensionName:l.name,values:[m],isSlice:!n.useRangeForRangedDimensionInfo||!!l.hasRanges}))}return s}function Ve(e){return!!e?.length&&e.some(n=>{if(n.values==null)return!0;let i=n.values.length;return i===0||i>1||!n.isSlice&&Array.isArray(n.values[0])})}function Ae(e,n){if(n==null||e==null)return null;let i=n.variables.map(s=>M({},s));return e?.variables?.length&&(i=i.filter(({name:s})=>e.variables.includes(s)),i.forEach(s=>{s.dimensions=s.dimensions.map(a=>z(a,e,s.name)).filter(P)})),i}function te(e,n){let{values:i}=n;if(i?.length){let l=Array.isArray(i[0]),o=Array.isArray(e);return l!==o?-1:l&&o?i.findIndex(u=>u[0]===e[0]&&u[1]===e[1]):i.indexOf(e)}let{extent:s}=n;if(Array.isArray(e)||!s||e<s[0]||e>s[1])return-1;let a=n.interval||1;if(n.unit!=="ISO8601")return Math.round((e-s[0])/a);let t=s[0],r=-1;switch(n.intervalUnit?.toLowerCase()||"days"){case"seconds":r=Math.round((e-t)/1e3/a);break;case"minutes":r=Math.round((e-t)/6e4/a);break;case"hours":r=Math.round((e-t)/36e5/a);break;case"days":r=Math.round((e-t)/864e5/a);break;case"months":{let l=new Date(e).getUTCFullYear()-new Date(t).getUTCFullYear(),o=new Date(t).getUTCMonth(),u=new Date(e).getUTCMonth();r=l===0?u-o:u+11-o+12*(l-1)}break;case"years":r=Math.round((new Date(e).getUTCFullYear()-new Date(t).getUTCFullYear())/a);break;case"decades":r=Math.round((new Date(e).getUTCFullYear()-new Date(t).getUTCFullYear())/10/a)}return r}function j(e){let n=e.values?.length;if(n)return n;let{extent:i,unit:s}=e,a=e.interval||1,t=i?i[1]-i[0]:0;if(s!=="ISO8601")return Math.round(t/a);switch(e.intervalUnit?.toLowerCase()??"seconds"){case"seconds":n=Math.round(t/1e3/a);break;case"minutes":n=Math.round(t/6e4/a);break;case"hours":n=Math.round(t/36e5/a);break;case"days":n=Math.round(t/864e5/a);break;case"months":if(i){let r=new Date(i[1]).getUTCFullYear()-new Date(i[0]).getUTCFullYear(),l=new Date(i[0]).getUTCMonth(),o=new Date(i[1]).getUTCMonth();n=r===0?o-l+1:o+11-l+12*(r-1)+1}else n=0;break;case"years":n=i?Math.round((new Date(i[1]).getUTCFullYear()-new Date(i[0]).getUTCFullYear())/a):0;break;case"decades":n=i?Math.round((new Date(i[1]).getUTCFullYear()-new Date(i[0]).getUTCFullYear())/10/a):0;break;default:n=0}return n}function Ie(e){if(e.extent?.length!==2||!e.interval)return[];let{extent:[n,i],interval:s}=e;if(e.unit==="ISO8601"){let t=e.intervalUnit?.toLowerCase()??"days";return["decades","years","months","days","hours","minutes","seconds"].includes(t)?ie(n,i,s,t):[]}let a=Math.round((i-n)/s);return Array.from({length:a},(t,r)=>r===a-1?i:n+r*s)}function ie(e,n,i,s){let a=[],t=e,r=new Date(e);for(;t<=n;)switch(a.push(t),s){case"decades":r.setUTCFullYear(r.getUTCFullYear()+10*i),t=r.getTime();break;case"years":r.setUTCFullYear(r.getUTCFullYear()+i),t=r.getTime();break;case"months":r.setUTCMonth(r.getUTCMonth()+i),t=r.getTime();break;case"days":t+=864e5*i;break;case"hours":t+=36e5*i;break;case"minutes":t+=6e4*i;break;case"seconds":t+=1e3*i}return a.length===1?a[1]=n:a[a.length-1]=n,a}function Ue(e,n){let i=0,s=e[0].variableName,a=[...n.variables].sort((t,r)=>t.name>r.name?1:-1);for(let t=0;t<a.length;t++){let r=a[t],l=[...r.dimensions].sort((m,v)=>m.name>v.name?-1:1);if(r.name!==s){i+=l.map(m=>j(m)).reduce((m,v)=>m*v);continue}let o=l.map(m=>j(m)),u=l.length;for(let m=0;m<u;m++){let v=e.find(f=>f.dimensionName===l[m].name);if(v==null)return null;let c=te(v.values[0],l[m]);if(c===-1)return null;o.shift(),i+=m===u-1?c:c*o.reduce((f,h)=>f*h)}break}return i}function ke(e){return Math.round(24*(e-25569)*3600*1e3)}export{$ as a,G as b,g as c,y as d,se as e,re as f,le as g,oe as h,ue as i,me as j,ce as k,de as l,fe as m,he as n,Te as o,Fe as p,k as q,Ce as r,$e as s,ne as t,L as u,Ve as v,Ae as w,Ie as x,Ue as y,ke as z};
