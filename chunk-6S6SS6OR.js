import{a as kt}from"./chunk-LKFMQH27.js";import{a as Dt}from"./chunk-MPOY6ROL.js";import"./chunk-CXXPTNKB.js";import"./chunk-PUEA2FRR.js";import"./chunk-GBK27SC6.js";import"./chunk-TVN7IBCP.js";import"./chunk-WHD5RQHG.js";import"./chunk-ZEE52UAO.js";import{b as Pt,c as Ct,d as xt,e as $t,f as Mt,g as Rt,h as Et,i as It,j as Tt}from"./chunk-BXUPDT4D.js";import"./chunk-J5F2KYSA.js";import"./chunk-B6OGPRTQ.js";import"./chunk-4OC4J3KU.js";import"./chunk-GOLGIJPD.js";import"./chunk-3K4PPROZ.js";import{a as wt,b as _t,c as St}from"./chunk-FOE67LNX.js";import"./chunk-MIOOILW6.js";import"./chunk-G6C3YEMS.js";import{a as mt}from"./chunk-LVYFLVM5.js";import"./chunk-XSALJEMC.js";import"./chunk-NRQSFK4P.js";import"./chunk-Y34QJIHM.js";import"./chunk-PSIELDY2.js";import"./chunk-HBZAOVHW.js";import"./chunk-EDAGF7R6.js";import"./chunk-IDLNQPT7.js";import"./chunk-VRPEURU5.js";import"./chunk-JAPGPEA6.js";import"./chunk-UFTHBQFR.js";import"./chunk-VU5W7W6Y.js";import{a as F,b as Gt,c as M}from"./chunk-5PZVB26A.js";import{b as Lt}from"./chunk-QZT7QMTB.js";import"./chunk-E6JHCD7G.js";import"./chunk-DIWV6SBV.js";import"./chunk-EG4FJL5O.js";import"./chunk-NSDBF4VB.js";import"./chunk-IL63CQ3W.js";import"./chunk-LK4L5XN7.js";import"./chunk-BYX5KLGZ.js";import"./chunk-5IRLA4AM.js";import"./chunk-AVLSWJCG.js";import"./chunk-FKL22O54.js";import{m as V}from"./chunk-IOI3V6WL.js";import"./chunk-IAM754TS.js";import"./chunk-DLMQHZTF.js";import"./chunk-2XQT24NO.js";import"./chunk-PUWPAT3A.js";import"./chunk-Y4OUS3AZ.js";import"./chunk-CCGZQUKC.js";import"./chunk-5K5ZHVX6.js";import"./chunk-SNPAQLOL.js";import{b as yt}from"./chunk-AA5W2OSC.js";import"./chunk-RXT2WPNA.js";import{a as B}from"./chunk-FHBFWDFD.js";import"./chunk-WBPLJNRU.js";import"./chunk-E2J2V7JN.js";import"./chunk-7X55A7Q6.js";import"./chunk-NFWLUI2Z.js";import"./chunk-WRYEUJBQ.js";import"./chunk-ELQ6TEDY.js";import"./chunk-JMMCRVVF.js";import"./chunk-XPXAET6Q.js";import"./chunk-VC7OIMIK.js";import{a as j}from"./chunk-NIYDRLW4.js";import"./chunk-WTJO2NGM.js";import"./chunk-3Q427ME6.js";import"./chunk-3BZAI7HK.js";import"./chunk-LNYBTIG7.js";import"./chunk-EXXSZWI5.js";import"./chunk-YW3L7OMP.js";import{b as ft}from"./chunk-KCSRPDMA.js";import"./chunk-6T37AWU6.js";import"./chunk-EOLWCIYR.js";import"./chunk-4AIH3WFI.js";import"./chunk-JOGV3DWE.js";import"./chunk-SKMO433W.js";import"./chunk-2FO7ARYZ.js";import"./chunk-VLECDDLP.js";import"./chunk-HE4N5PN6.js";import"./chunk-NOQEJXLK.js";import"./chunk-DJW5LMRG.js";import"./chunk-QXXXCEV5.js";import"./chunk-QMKRRCM3.js";import"./chunk-TCGGI7DC.js";import"./chunk-ALWV3RJ2.js";import"./chunk-7C6Z24SS.js";import"./chunk-5WKDXHVH.js";import"./chunk-B5LBE5HD.js";import"./chunk-F6A6XWW4.js";import"./chunk-AESEF3B2.js";import"./chunk-74LTYPBC.js";import"./chunk-3BDL2KTL.js";import"./chunk-TGPGCQ44.js";import"./chunk-PWU2QHPV.js";import"./chunk-WUJRCGDY.js";import"./chunk-QPGCDGIN.js";import"./chunk-JH4RD366.js";import"./chunk-7Y6S2GNA.js";import"./chunk-VOB6IBIW.js";import"./chunk-63B3IOWG.js";import"./chunk-PTZYZULI.js";import"./chunk-KZKWOEFD.js";import"./chunk-LNVVFNTC.js";import"./chunk-5TMYC5PF.js";import"./chunk-RCDSCJMH.js";import"./chunk-QJADLTFR.js";import"./chunk-IWPCZHB6.js";import"./chunk-FXCL7YYQ.js";import"./chunk-HX2BGUTP.js";import"./chunk-XSTBHERR.js";import"./chunk-KWZIB4M6.js";import"./chunk-YQPWWSMJ.js";import"./chunk-JEIB6WNP.js";import"./chunk-6JJCXUHW.js";import"./chunk-CVRJ6GOM.js";import"./chunk-X7QUUHRV.js";import"./chunk-7B2UKJ5N.js";import"./chunk-RSDQHAJX.js";import"./chunk-K27GONOJ.js";import"./chunk-6KRFVLII.js";import"./chunk-JR22Z7I2.js";import"./chunk-3QNSJ5HY.js";import"./chunk-UNVICPIE.js";import"./chunk-BGICKEJR.js";import"./chunk-TRZXSDYA.js";import"./chunk-OGS2SUK5.js";import"./chunk-TVHRLNTK.js";import"./chunk-JA3EMS2I.js";import"./chunk-HKHTIKVW.js";import"./chunk-XFESK2YB.js";import"./chunk-IJBTA53P.js";import"./chunk-ZHUXSQTN.js";import{b as bt}from"./chunk-YLZWDFCJ.js";import{d as U}from"./chunk-TLMADEUL.js";import{a as ht}from"./chunk-WNSGKHQ6.js";import{a as u}from"./chunk-J5MXC6AL.js";import"./chunk-OLOKUDVI.js";import"./chunk-RJWOVI3M.js";import"./chunk-R6GE4XRP.js";import"./chunk-AZS4Q4RE.js";import"./chunk-QEBUS3TL.js";import{c as gt,e as vt,h as k}from"./chunk-IB2IUO7T.js";import"./chunk-MS3KE2OO.js";import"./chunk-NHSDW26F.js";import"./chunk-NMAGYK3Q.js";import"./chunk-GWBRHLNH.js";import"./chunk-WKJJQIBC.js";import"./chunk-VDADRLEF.js";import"./chunk-J372WZPB.js";import"./chunk-6XFS4U2F.js";import"./chunk-XPRVY6JT.js";import"./chunk-7N3ZKWML.js";import"./chunk-E62WHYYG.js";import"./chunk-QDTU3MWT.js";import"./chunk-BCREO4Q5.js";import"./chunk-3SDSCSDJ.js";import"./chunk-I4M2OT5W.js";import{g as ut,n as C}from"./chunk-NTVLK3P2.js";import{a as $}from"./chunk-WMQNRNIU.js";import"./chunk-HD52PWPC.js";import"./chunk-EIPVFA6F.js";import{g as it,s as Y}from"./chunk-VOFKUGRY.js";import{U as N,p as pt}from"./chunk-IG66NQHW.js";import"./chunk-ARRCN5K3.js";import"./chunk-MDSLION2.js";import{c as ct,d as dt,e as W}from"./chunk-7ZYPJJID.js";import{g as o}from"./chunk-UAKHZRKN.js";import{e as lt}from"./chunk-HAHX77IL.js";import{a as st}from"./chunk-IXCTZWTQ.js";import"./chunk-6PN3I333.js";import"./chunk-ZTJLFKGG.js";import"./chunk-5TW726OD.js";import"./chunk-VGD3XLDH.js";import{a as x,b as at,h as ot}from"./chunk-LB5YQINJ.js";import"./chunk-EKMHQEJY.js";import{a as nt}from"./chunk-VACZNAP3.js";import"./chunk-JKNCWG7E.js";import"./chunk-SLAWDKDA.js";import"./chunk-KTE5HCNJ.js";import"./chunk-F7VRLFCB.js";import"./chunk-7IPIJKWU.js";import"./chunk-7R33MKVL.js";import"./chunk-ISSJ3A6Y.js";import"./chunk-VDKRSX77.js";import"./chunk-WUA6PW3I.js";import"./chunk-E57FTRWF.js";import"./chunk-U4J5SECU.js";import{f as rt}from"./chunk-7EG726PT.js";import{L,d as s}from"./chunk-C7INQGWT.js";import{H as S}from"./chunk-WMHJC7XF.js";import"./chunk-NJEWDTYF.js";import"./chunk-N3SDOFND.js";import"./chunk-OVHPPCBL.js";import"./chunk-FNXQZPHT.js";import"./chunk-3TQOUBNU.js";import{i as D}from"./chunk-D2LVMNOU.js";import"./chunk-SNFOAZZQ.js";import{a as n}from"./chunk-QGVBCWUY.js";import{r as et,t as T}from"./chunk-HHDFN2GK.js";import"./chunk-47GHT6OF.js";import"./chunk-5RWLLGQU.js";import{f as P}from"./chunk-VTHXE323.js";var m=class extends rt{constructor(t){super(t),this.center=new C,this.dynamicScaling=!0,this.majorLineColor=u.fromArray([115,115,115,1]),this.majorLineInterval=10,this.minorLineColor=u.fromArray([165,165,165,1]),this.rotateWithMap=!1,this.rotation=0,this.spacing=1,this.type="measured",this.units="miles"}};n([s()],m.prototype,"center",void 0),n([s()],m.prototype,"dynamicScaling",void 0),n([s()],m.prototype,"majorLineColor",void 0),n([s()],m.prototype,"majorLineInterval",void 0),n([s()],m.prototype,"minorLineColor",void 0),n([s()],m.prototype,"rotateWithMap",void 0),n([s()],m.prototype,"rotation",void 0),n([s()],m.prototype,"spacing",void 0),n([ht({measured:"measured"})],m.prototype,"type",void 0),n([s()],m.prototype,"units",void 0),m=n([S("esri.grids.MeasuredGrid")],m);var Ot={readOnly:!0,get(){return Tt(this.view)}};var b=class extends L{constructor(t){super(t),this.color=new u([255,127,0,1]),this.isDecoration=!0,this.length=34,this.rotation=0,this.thickness=2,this.visible=!0}get _strokeStyle(){return this.color.toCss(!0)}render(){let{x:t,y:e,length:i,thickness:r,rotation:a}=this,c=i/2,d=`0 0 ${i} ${i}`,p=`M${c} 0 V${i} M0 ${c} H${i}`;return o("div",{classes:{"esri-box-overlay-item":!0},dir:"ltr",styles:{left:`${(t??0)-c}px`,top:`${(e??0)-c}px`,width:`${i}px`,height:`${i}px`,transform:`rotate(${a}deg)`,visibility:this.visible?"visible":"hidden"}},o("svg",{styles:{overflow:"visible"},viewbox:d},o("path",{d:p,stroke:this._strokeStyle,"stroke-width":r})))}renderCanvas(){}};n([s()],b.prototype,"color",void 0),n([s()],b.prototype,"isDecoration",void 0),n([s()],b.prototype,"length",void 0),n([s()],b.prototype,"rotation",void 0),n([s()],b.prototype,"thickness",void 0),n([s()],b.prototype,"visible",void 0),n([s()],b.prototype,"x",void 0),n([s()],b.prototype,"y",void 0),n([s({readOnly:!0})],b.prototype,"_strokeStyle",null),b=n([S("esri.views.overlay.CrosshairOverlayItem")],b);var At=b;function zt(t,e){let i=z(e);return[t[0].toFixed(i),t[1].toFixed(i)]}function z(t){return t>=500?6:t<500&&t>=50?7:t<50&&t>=5?8:9}function Xt(t,e){let i=t.includes(",")?",":" ",[r,a,c]=t.split(i).map(p=>{let h=p.trim();return h?Number(h):null});if(!G(r)||!G(a))return null;let d=new C({x:r,y:a,spatialReference:e||$.WGS84});return c&&(d.z=c,d.hasZ=!0),d}function G(t){return typeof t=="number"&&isFinite(t)}function q(t){return!!t&&G(t.x)&&G(t.y)}function H(t,e){if(t.spatialReference.isGeographic&&e){let[i,r]=zt([t.x,t.y],e);return`${i}, ${r}`}return`${t.x.toFixed(3)}, ${t.y.toFixed(3)}`}var g=class extends L{constructor(t){super(t),this.conversionInfo=null,this.coordinateSegments=null,this._currentPattern=void 0,this.defaultPattern=null,this.name=null,this.viewModel=null}get currentPattern(){return(this._currentPattern||this.defaultPattern)??""}set currentPattern(t){this._currentPattern=t}get label(){return this.name??""}set label(t){this._overrideIfSome("label",t)}get hasDisplayProperties(){return!(!this.defaultPattern||!this.coordinateSegments)}get spatialReference(){return this.name==="basemap"?this._viewSpatialReference:this.conversionInfo?.spatialReference??$.WGS84}set spatialReference(t){this._overrideIfSome("spatialReference",t)}get _viewSpatialReference(){return this.viewModel?.view?.spatialReference??$.WGS84}get _additionalCharactersPattern(){let t=this.coordinateSegments;if(!t)return null;let e=t.map(r=>r.alias),i=this.currentPattern.replaceAll(new RegExp(`["nsew${e.join()}]`,"gi"),"").replaceAll(" ","");return new RegExp(`[${i}]`,"g")}get test(){}convert(t){return P(this,null,function*(){if(!q(t))throw new T("format:invalid-point","Could not convert invalid point.",{point:t});let e=this.conversionInfo?.convert;if(e)return Promise.resolve().then(()=>e(t));let i=yield this._project(t,this.spatialReference);return{location:i,coordinate:yield this._getCoordinate(i)}})}getConversionStrategy(){let t=this._viewSpatialReference;return this.conversionInfo?.convert||this.viewModel?.formatterAvailable||this.name==="xy"&&(t.isWebMercator||t.isWGS84)||this.name==="basemap"?"client":"server"}getDisplayCoordinate(t){if(!t)return null;if(!this.coordinateSegments||!this.currentPattern)return t;let e=this.currentPattern,i=this._getSegmentMatches(t,!1);for(let r=this.coordinateSegments.length-1;r>=0;r--){let a=this.coordinateSegments[r];e=e.replace(a.alias,i[r])}return e}_parseUserInput(t){let{defaultPattern:e,_additionalCharactersPattern:i,coordinateSegments:r}=this;if(!e||!i)return"";let a=e.replace(i,"");t=t.replace(i,"");let c=this._getSegmentMatches(t,!0);if(r)for(let d=r.length-1;d>=0;d--){let p=r[d];a=a.replace(p.alias,c[d])}return a}_getSegmentMatches(t,e){let i=new Array,{coordinateSegments:r}=this;if(!r)return i;for(let a=0;a<r.length;a++){let c=r[a],d=t.match(c.searchPattern);if(!d){i.push("");continue}let p=d[0];if(t=t.replace(p,"").trim(),c.substitution){let h=e?c.substitution.input(p):c.substitution.output(p);h&&(p=`${h}`)}i.push(p)}return i}reverseConvert(t){return P(this,null,function*(){let e=this._parseUserInput(t),i=this.conversionInfo?.reverseConvert,r;if(i)r=i(e);else if(this.name==="xy"||this.name==="basemap")r=Xt(e,this.spatialReference);else if(this.viewModel?.formatterAvailable)switch(this.name){case"dd":case"ddm":case"dms":r=Pt(e,this.spatialReference);break;case"mgrs":{r=Ct(e,this.spatialReference,"automatic");break}case"utm":{r=$t(e,this.spatialReference,"latitude-band-indicators");break}case"usng":r=xt(e,this.spatialReference);break;default:r=null}if(!r)throw new T("format:invalid-input","Could not parse input into point.",{userInput:t});return this._project(r,this._viewSpatialReference)})}_getCoordinate(t){return P(this,null,function*(){let e=this.viewModel?.view?.scale??0;if(!q(t))throw new T("format:invalid-point","Could not transform invalid point into coordinate.",{point:t});if(this.viewModel?.formatterAvailable||this.name==="basemap"||this.name==="xy")switch(this.name){case"dd":case"ddm":case"dms":{let i=z(e);return Mt(t,this.name,i)}case"mgrs":return Rt(t,"automatic",5,!1);case"usng":return Et(t,5,!1);case"utm":return It(t,"latitude-band-indicators",!0);default:return H(t,e)}return H(t,e)})}_project(t,e){return P(this,null,function*(){if(pt(t.spatialReference,e)||!e)return t;if(this.viewModel?.formatterAvailable&&gt())return k(t,e);if(!this.viewModel?.formatterAvailable){let i=ut(t,e);if(i!=null)return i}return null})}};n([s()],g.prototype,"conversionInfo",void 0),n([s()],g.prototype,"coordinateSegments",void 0),n([s()],g.prototype,"currentPattern",null),n([s()],g.prototype,"_currentPattern",void 0),n([s()],g.prototype,"label",null),n([s()],g.prototype,"defaultPattern",void 0),n([s({readOnly:!0})],g.prototype,"hasDisplayProperties",null),n([s()],g.prototype,"name",void 0),n([s({type:$})],g.prototype,"spatialReference",null),n([s()],g.prototype,"viewModel",void 0),n([s({readOnly:!0})],g.prototype,"_viewSpatialReference",null),n([s({readOnly:!0})],g.prototype,"_additionalCharactersPattern",null),g=n([S("esri.widgets.CoordinateConversion.support.Format")],g);var qt=mt().decimal;var Yt="\xB0\u200E",Ke=new RegExp(`-?\\d+[\\.|\\${qt}]?\\d*`);var O=t=>{if(t==null||isNaN(t))return 0;let e=t+180;return Math.trunc(Y(e,360))},Wt=t=>{let e=t;return e==null?0:(typeof e=="string"&&(e=parseInt(e,10)),isNaN(e)?0:Y(Math.trunc(e),360)-180)},Z=(t,e)=>{if(!t||e.length<3)return;let[i,r,a,c]=e,[d,p]=c===void 0?[1,.25]:[c,.25*c];t.majorLineColor=u.fromArray([i,r,a,d]),t.minorLineColor=u.fromArray([i,r,a,p])};var Nt=Symbol("grid-interactivity"),l=class extends nt.EventedAccessor{constructor(t){super(t),this._drawGraphicTool=null,this._crosshairLabel=null,this._crosshairItem=null,this.snappingManager=null,this.snappingOptions=null,this.view=null,this.placementDisabled=!1,this._mostRecentlyShownGrid=null,this._sketchedVertexCount=0}initialize(){this.addHandles([at(()=>!this.displayEnabled,()=>{this.interactivePlacementState=null}),x(()=>this.view?.viewpoint,()=>{this._renderOverlays()}),x(()=>this.snappingOptions?.gridEnabled,t=>{t!=null&&this.trySetDisplayEnabled(t)}),x(()=>this.view?.grid,(t,e)=>{this._mostRecentlyShownGrid=!t&&e?e:null})])}destroy(){this._resetGridPlacementState(),this._crosshairItem&&(this.view?.overlay?.removeItem(this._crosshairItem),this._crosshairItem=D(this._crosshairItem)),this._crosshairLabel&&(this.view?.overlay?.removeItem(this._crosshairLabel),this._crosshairLabel=D(this._crosshairLabel))}get displayEnabled(){return!!this.view?.grid}get dynamicScaling(){return this.grid?.dynamicScaling??!1}set dynamicScaling(t){this.grid&&(this.grid.dynamicScaling=t)}get grid(){return this.view?.grid??this._mostRecentlyShownGrid}set gridColor(t){this._set("gridColor",t);let[e,i,r,a]=t.toArray();Z(this.grid,[e,i,r,a/255])}get gridControlsEnabled(){return this.displayEnabled&&!this.interactivePlacementState}set interactivePlacementState(t){this._set("interactivePlacementState",t),this._resetGridPlacementState(),t&&this._startGridManipulation(t)}get majorLineInterval(){return this.grid?.majorLineInterval??10}set majorLineInterval(t){this.grid&&(this.grid.majorLineInterval=t<1?1:t>15?15:t)}get rotateWithMap(){return this.grid?.rotateWithMap??!1}set rotateWithMap(t){this.grid&&(this.grid.rotateWithMap=t)}get rotation(){return this.grid?.rotation??-180}set rotation(t){this.grid&&(this.grid.rotation=t)}get snappingEnabled(){return(this.grid&&this.snappingOptions?.gridEnabled)??!1}set snappingEnabled(t){let{snappingOptions:e}=this;e&&(e.gridEnabled=t)}get spacing(){return this.grid?.spacing??1}set spacing(t){this.grid&&t>0&&(this.grid.spacing=t)}get unit(){return this.grid?.units}set unit(t){this.grid&&(this.grid.units=t)}get gridOutOfScale(){return!this.dynamicScaling&&this._pixelsPerStride!=null&&this._pixelsPerStride<5}get effectiveSpacingAfterDynamicScaling(){return this.majorLineInterval<1||!this.dynamicScaling||!this.view||this._pixelsPerStride==null||!this.grid?.spacing?null:this.grid.spacing*wt(this.majorLineInterval,this._pixelsPerStride,this.dynamicScaling)}get numericSpacingInputShouldBeVisible(){return!!this.view?.spatialReference&&_t(this.view.spatialReference)}get _metersPerSRUnit(){if(!(this.view&&this.displayEnabled&&this.grid&&vt(this.grid.center.spatialReference,this.view.spatialReference)))return null;let t=k(this.grid.center,this.view.spatialReference);return St(t)}get _pixelsPerStride(){if(!this.view?.scale||!this.displayEnabled||!this.grid||this._metersPerSRUnit==null)return null;let t=this.grid,{scale:e,spatialReference:i}=this.view;return N(t.spacing,t.units,"meters")/(this._metersPerSRUnit*ft(e,i))}get _isPlacing(){if(!this._drawGraphicTool)return!1;let t=this.interactivePlacementState;return t==="place"||t==="interactive"&&this._sketchedVertexCount===0}get _isRotating(){if(!this._drawGraphicTool)return!1;let t=this.interactivePlacementState;return t==="rotate"||t==="interactive"&&this._sketchedVertexCount===1}get _isScaling(){return this._drawGraphicTool?this.interactivePlacementState==="interactive"&&this._sketchedVertexCount===1:!1}togglePlacementState(t){this.interactivePlacementState=this.interactivePlacementState===t?null:t}trySetDisplayEnabled(t){let{view:e}=this;if(e?.ready)if(!e.grid&&t)if(this._mostRecentlyShownGrid)e.grid=this._mostRecentlyShownGrid;else{let i=this.defaultUnit==="imperial"?"feet":"meters";e.grid=new m({units:i,center:e.center??new C,rotateWithMap:!0}),Z(this.grid,[115,115,115])}else t||(e.grid=null);else et.getLogger(this).warn("Attempting to enable grid display while view is not ready")}startPlacement(t){let{view:e,snappingManager:i}=this;if(!e)return;this._set("interactivePlacementState",t),this._sketchedVertexCount=0;let r=new Dt({view:e,graphicProperties:{attributes:{[V]:V}},sketchOptions:{tooltips:{enabled:!0,visibleElements:{direction:!1,rotation:!1,totalLength:!1,elevation:!1,distance:!1,area:!1}}},geometryType:"polyline",mode:"click",snapToScene:!1,snappingManager:i,forceUniformSize:!0,centered:!1,cursor:this.interactivePlacementState==="interactive"||this.interactivePlacementState==="place"?"none":null,regularVerticesSymbol:void 0,activeVertexSymbol:Zt,activeLineSymbol:Ut,graphicSymbol:Ut});this._drawGraphicTool=r,e.addAndActivateTool(r),this._renderOverlays(),this.addHandles([r.on("cursor-update",a=>this._onCursorUpdate(a)),r.on("complete",()=>this._onDrawComplete()),r.on("vertex-add",a=>this._onVertexAdd(a,t))],Nt)}_startGridManipulation(t){return P(this,null,function*(){let{view:e}=this;if(!e)return void(this.interactivePlacementState=null);let i=new CustomEvent("before-placement",{cancelable:!0});this.emit("before-placement",i),i.defaultPrevented||this.startPlacement(t)})}_onCursorUpdate(t){try{if(this._isPlacing){let e=t.vertices[0].coordinates;return void this._handlePlace(e)}if(this._drawGraphicTool.cursor=null,this._isRotating&&this._handleRotate(t.vertices[0].coordinates),this._isScaling){let e=this._drawGraphicTool?.drawOperation.cursorVertex;this._handleScale(e)}}finally{this._renderOverlays()}}_onDrawComplete(){this._drawGraphicTool.cursor=null,this.interactivePlacementState=null}_onVertexAdd(t,e){let i=t.vertices[0].coordinates;this._isPlacing&&this._handlePlace(i),this._isRotating&&this._sketchedVertexCount>0&&this._handleRotate(i),this._isScaling&&this._sketchedVertexCount>0&&this._handleScale(j(i[0],i[1],void 0,this.view.spatialReference)),this._sketchedVertexCount++,this._drawGraphicTool.cursor=null,this._sketchedVertexCount!==2&&e==="interactive"||(this.interactivePlacementState=null),this._renderOverlays()}_handlePlace(t){let{grid:e,view:i}=this;e&&i&&(e.center=new C({x:t[0],y:t[1],spatialReference:i.spatialReference}))}_handleRotate(t){let{grid:e,view:i}=this;if(!e||!i)return;this._drawGraphicTool?.sketchOptions.tooltips.set("enabled",!1);let{x:r,y:a}=e.center,[c,d]=t,p=i.toScreen(e.center,{pickClosestTarget:!0}),h=p&&i.toMap(p),w=i.toScreen(j(c,d,void 0,i.spatialReference),{pickClosestTarget:!0}),_=w&&i.toMap(w),E=h?h.x:r,X=h?h.y:a,I=E-(_?_.x:c),Q=X-(_?_.y:d);if(I===0&&Q===0)return;let jt=Math.atan2(Q,I),tt=it(jt),Bt=e.rotateWithMap,Vt=i.viewpoint.rotation??0,Ft=Bt?tt:tt-Vt;e.rotation=Math.fround(Ft)%360}_handleScale(t){let{view:e,grid:i,_drawGraphicTool:r,interactivePlacementState:a,_metersPerSRUnit:c}=this;if(!(t&&e&&i&&r&&c))return;r.sketchOptions.tooltips.enabled=!1;let d=a==="interactive"?i.center:r.drawOperation.firstVertex;if(!d||!t)return;let p=e?.toScreen(d),h=p&&e.toMap(p),w=e?.toScreen(t),_=h??d,E=(w&&e.toMap(w))??t,X=Math.sqrt((_.x-E.x)**2+(_.y-E.y)**2),I=N(X*c,"meters",i.units);this.spacing=I}_renderOverlays(){this._renderCrosshairOverlay(),this._renderTextOverlay()}_renderTextOverlay(){let{grid:t,view:e,_drawGraphicTool:i}=this,r=this._getCrosshairLabel();if(!(t&&e?.overlay&&i&&r))return;let a=e.toScreen(t.center,{pickClosestTarget:!0});a&&(r.position=[a.x+12,a.y+12]),this._isRotating?(r.text=`${O(t.rotation)}${Yt}`,r.visible=!0):r.visible=!1}_renderCrosshairOverlay(){let{grid:t,view:e,_drawGraphicTool:i}=this;if(!t||!e?.overlay||!i)return;let r=this._getCrosshair();if(!r)return;let a=e.toScreen(t.center);a&&(r.x=a.x,r.y=a.y,r.rotation=t.rotateWithMap?e.viewpoint.rotation-t.rotation:-t.rotation,r.visible=!!i)}_getCrosshairLabel(){if(this._crosshairLabel)return this._crosshairLabel;let{grid:t,view:e,_drawGraphicTool:i}=this;if(!t||!e?.overlay||!i)return null;let r=new kt({anchor:"top-left",fontSize:10,textColor:new u([21,21,21]),backgroundColor:new u([248,248,248]),padding:8,borderRadius:20});return e.overlay.addItem(r),this._crosshairLabel=r,r}_getCrosshair(){let{_crosshairItem:t,view:e}=this;return e?.overlay?t&&e.overlay.items.includes(t)?t:(this._crosshairItem=new At({color:e.effectiveTheme.accentColor,thickness:4,length:36,visible:!0}),e.overlay?.addItem(this._crosshairItem),this._crosshairItem):null}_resetGridPlacementState(){this.removeHandles(Nt),this._crosshairItem&&(this._crosshairItem.visible=!1),this._crosshairLabel&&(this._crosshairLabel.visible=!1),this._drawGraphicTool&&(this.view?.activeTool===this._drawGraphicTool&&(this.view.activeTool=null),this.view?.tools.remove(this._drawGraphicTool)),this._drawGraphicTool=D(this._drawGraphicTool)}};n([s(Ot)],l.prototype,"defaultUnit",void 0),n([s({readOnly:!0})],l.prototype,"displayEnabled",null),n([s()],l.prototype,"dynamicScaling",null),n([s()],l.prototype,"grid",null),n([s({type:u})],l.prototype,"gridColor",null),n([s({readOnly:!0})],l.prototype,"gridControlsEnabled",null),n([s()],l.prototype,"interactivePlacementState",null),n([s()],l.prototype,"majorLineInterval",null),n([s()],l.prototype,"rotateWithMap",null),n([s()],l.prototype,"rotation",null),n([s()],l.prototype,"snappingEnabled",null),n([s()],l.prototype,"snappingManager",void 0),n([s({type:Lt})],l.prototype,"snappingOptions",void 0),n([s()],l.prototype,"spacing",null),n([s()],l.prototype,"unit",null),n([s()],l.prototype,"view",void 0),n([s({readOnly:!0})],l.prototype,"gridOutOfScale",null),n([s({readOnly:!0})],l.prototype,"effectiveSpacingAfterDynamicScaling",null),n([s({readOnly:!0})],l.prototype,"numericSpacingInputShouldBeVisible",null),n([s()],l.prototype,"placementDisabled",void 0),n([s()],l.prototype,"_metersPerSRUnit",null),n([s()],l.prototype,"_pixelsPerStride",null),n([s()],l.prototype,"_isPlacing",null),n([s()],l.prototype,"_isRotating",null),n([s()],l.prototype,"_isScaling",null),n([s()],l.prototype,"_mostRecentlyShownGrid",void 0),n([s()],l.prototype,"_sketchedVertexCount",void 0),l=n([S("esri.widgets.support.GridControls.GridControlsViewModel")],l);var K=l,Ut=new U({width:0}),Zt=new bt({color:u.fromArray([0,0,0,0]),outline:new U({color:u.fromArray([0,0,0,0])})});var f="esri-grid-controls",y={base:f,borderedSwitch:`${f}__switch--bordered`,container:`${f}__container`,numericInputsContainer:`${f}__numeric-inputs__container`,tilegroup:`${f}__tilegroup`,tile:`${f}__tile`,tileDisabled:`${f}__tile--disabled`,tileContent:`${f}__tile__content`,suffixedInputContainer:`${f}__input-with-suffix__container`,inputSuffix:`${f}__input-with-suffix__suffix-part`,inlineIcon:`${f}__inline-icon`},R={widgetIcon:"grid-unit",gridTheme:{light:"circle",dark:"circle-area",custom:"palette"},placementState:{interactive:"maximum-territory-distance",place:"move",rotate:"rotate"},warning:"exclamation-mark-triangle"},A=u.fromArray([115,115,115]),J=u.fromArray([200,200,200]),Kt=["interactive","place","rotate"],v=class extends dt{constructor(t,e){super(t,e),this.customColor=null,this.messages=null,this.messagesUnits=null,this.viewModel=new K,this.visibleElements=new F}initialize(){this.addHandles([x(()=>this.view?.grid?.majorLineColor,t=>{!t||A.equals(t)||J.equals(t)||(this.customColor=t)},ot)])}loadDependencies(){return Promise.all([ct({action:()=>import("./chunk-CXZZQXIM.js"),"action-bar":()=>import("./chunk-J5KVU72X.js"),label:()=>import("./chunk-H4FMBFSZ.js"),icon:()=>import("./chunk-QXDSJABL.js"),popover:()=>import("./chunk-QY326AOF.js"),tooltip:()=>import("./chunk-65CNKD3K.js"),"color-picker":()=>import("./chunk-XQVPT6TQ.js"),"input-number":()=>import("./chunk-PVXNJD2V.js")}),Gt()])}get icon(){return R.widgetIcon}set icon(t){this._overrideIfSome("icon",t)}get label(){return this.messages.widgetLabel}set label(t){this._overrideIfSome("label",t)}get snappingManager(){return this.viewModel.snappingManager}set snappingManager(t){this.viewModel.snappingManager=t}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(t){this.viewModel.snappingOptions=t}get theme(){let t=this.viewModel.grid?.majorLineColor;return t?A.equals(t)?"dark":J.equals(t)?"light":"custom":null}set theme(t){let{viewModel:e,customColor:i,view:r}=this;switch(t){case"light":e.gridColor=J;break;case"dark":e.gridColor=A;break;case"custom":e.gridColor=i??r?.effectiveTheme.accentColor??A}}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){return o("div",{"aria-label":this.label,class:this.classes(y.base,B.widget,B.panel)},o("div",{class:y.container},this._renderContent()))}_renderContent(){let{visibleElements:t}=this;return[t.gridEnabledToggle?this._renderEnabledToggle():null,t.placementButtons?this._renderGridPlacementButtons():null,t.numericInputs?this._renderNumericInputs():null,t.lineIntervalInput?this._renderIntervalInput():null,t.gridSnapEnabledToggle&&this.viewModel.snappingOptions?this._renderSnappingToggle():null,t.dynamicScaleToggle?this._renderDynamicScaleToggle():null,t.rotateWithMapToggle?this._renderRotateToggle():null,t.colorSelection?this._renderColorSelection():null]}_renderGridPlacementButtons(){let{interactivePlacementState:t,placementDisabled:e,gridControlsEnabled:i}=this.viewModel,r=e||!i;return o("calcite-label",{key:"grid-placement-buttons",scale:"s"},this.messages.placementOptions,o("calcite-action-bar",{expandDisabled:!0,layout:"horizontal"},Kt.map(a=>this._renderPlacementModeButton(a,r,t))))}_renderPlacementModeButton(t,e,i){let r=this.messages.placementState[t],a=`__placement-action-${t}`;return o("div",null,o("calcite-action",{active:i===t,alignment:"center",disabled:e,icon:R.placementState[t],id:a,onclick:()=>this.viewModel.togglePlacementState(t),text:r}),o("calcite-tooltip",{overlayPositioning:"fixed",placement:"top",referenceElement:a},r))}_renderNumericInputs(){let{rotation:t,spacing:e,effectiveSpacingAfterDynamicScaling:i,numericSpacingInputShouldBeVisible:r,unit:a="meters"}=this.viewModel,c=this.messagesUnits.units[a].abbr,d=this.viewModel.gridControlsEnabled,p=i!=null&&i!==this.viewModel.spacing,h=`__spacing_input_scaled-${this.id}`;return o("div",{class:this.classes(y.numericInputsContainer)},[r?o("calcite-label",{key:"spacing-label",scale:"s"},o("span",null,this.messages.inputLabel.spacing,p?o("calcite-icon",{class:this.classes(y.inlineIcon),icon:R.warning,id:h,scale:"s",tabIndex:0}):void 0),o("div",{class:y.suffixedInputContainer},o("calcite-input-number",{disabled:!d,numberButtonType:"none",suffixText:c,value:`${e?.toFixed(2)}`,onCalciteInputNumberChange:({currentTarget:w})=>{let _=parseFloat(w.value);this.viewModel.spacing=_,_!==this.viewModel.spacing&&(w.value=`${this.viewModel.spacing}`)}}),p?o("calcite-tooltip",{overlayPositioning:"fixed",placement:"leading",referenceElement:h},st(this.messages.warnings.dynamicSpacing,{actualSpacingIncludingUnit:yt(this.messagesUnits,i,a,2,"plural")})):void 0)):void 0,o("calcite-label",{key:"angle-label",scale:"s"},this.messages.inputLabel.angle,o("calcite-input-number",{disabled:!d,integer:!0,numberButtonType:"none",suffixText:this.messagesUnits.units.degrees.abbr,value:`${O(t)}`,onCalciteInputNumberChange:({currentTarget:w})=>this.viewModel.rotation=Wt(w.value)}))])}_renderIntervalInput(){let{majorLineInterval:t,gridControlsEnabled:e}=this.viewModel;return o("div",{class:this.classes(y.numericInputsContainer)},o("calcite-label",{scale:"s"},this.messages.inputLabel.interval,o("calcite-input-number",{disabled:!e,integer:!0,max:15,min:1,numberButtonType:"vertical",value:`${t}`,onCalciteInputNumberChange:({currentTarget:i})=>{let r=Number.parseInt(i.value,10);this.viewModel.majorLineInterval=r,r!==this.viewModel.majorLineInterval&&(i.value=`${this.viewModel.majorLineInterval}`)}})))}_renderSnappingToggle(){let{snappingOptions:t,gridControlsEnabled:e}=this.viewModel;return o(M,{checked:!!(t?.gridEnabled??!1),disabled:!(e&&t),key:"grid-snap-enabled-toggle",label:this.messages.switchLabel.snap,onChange:i=>this.viewModel.snappingOptions?.set("gridEnabled",i)})}_renderDynamicScaleToggle(){let{viewModel:t,messages:e}=this,i=this.visibleElements.outOfScaleWarning&&t.gridOutOfScale;return o(M,{checked:t.dynamicScaling,disabled:!t.gridControlsEnabled,hint:i?e.warnings.outOfScale:void 0,hintIcon:R.warning,hintKind:"warning",key:`grid-dynamic-scale-toggle-${this.id}`,label:e.switchLabel.scaling,onChange:r=>t.dynamicScaling=r})}_renderRotateToggle(){let{gridControlsEnabled:t,rotateWithMap:e}=this.viewModel;return o(M,{checked:e,disabled:!t,key:"grid-rotate-map-toggle",label:this.messages.switchLabel.rotateWithMap,onChange:i=>this.viewModel.rotateWithMap=i})}_renderEnabledToggle(){return o("div",{class:y.borderedSwitch},o(M,{checked:this.viewModel.displayEnabled,disabled:!!this.viewModel.interactivePlacementState,key:"grid-enabled-toggle",label:this.messages.switchLabel.display,onChange:t=>this.viewModel.trySetDisplayEnabled(t)}))}_renderColorSelection(){let{customColor:t}=this,e=`${this.id}--custom-grid-color-button`;return o("calcite-label",{scale:"s"},this.messages.inputLabel.theme,o("div",{class:y.tilegroup},[this._renderThemeTile({value:"dark"}),this._renderThemeTile({value:"light"}),this._renderThemeTile({value:"custom",id:e}),o("calcite-popover",{autoClose:!0,label:this.messages.gridLineColorPopoverLabel,overlayPositioning:"fixed",referenceElement:e},o("calcite-color-picker",{alphaChannel:!0,savedDisabled:!0,value:t?.toHex({digits:8})??"#000000ff",onCalciteColorPickerChange:i=>{let r=u.fromHex(i.currentTarget.value);r&&(this.customColor=r,this.theme="custom")}}))]))}_renderThemeTile(t){let{theme:e}=this,{value:i}=t,r=this.messages.gridTheme[i],a=`${this.id}--theme_tile_${i}`,c=`${a}__label`,d=R.gridTheme[i],p=this.viewModel.gridControlsEnabled;return o("div",{class:lt({[y.tile]:!0,[y.tileDisabled]:!p}),id:t.id,role:"button"},o("input",{"aria-labelledby":c,checked:e===i,disabled:!p,id:a,name:`${this.id}--theme`,onchange:h=>{this.theme=i,h.target?.focus()},tabIndex:0,type:"radio"}),o("div",{class:y.tileContent},o("calcite-icon",{icon:d,scale:"l"}),o("calcite-label",{for:a,id:c},r)))}};n([s({type:u})],v.prototype,"customColor",void 0),n([s()],v.prototype,"icon",null),n([s()],v.prototype,"label",null),n([s(),W("esri/widgets/support/GridControls/t9n/GridControls")],v.prototype,"messages",void 0),n([s(),W("esri/core/t9n/Units")],v.prototype,"messagesUnits",void 0),n([s()],v.prototype,"snappingManager",null),n([s()],v.prototype,"snappingOptions",null),n([s()],v.prototype,"theme",null),n([s()],v.prototype,"view",null),n([s({type:K})],v.prototype,"viewModel",void 0),n([s({type:F,nonNullable:!0})],v.prototype,"visibleElements",void 0),v=n([S("esri.widgets.support.GridControls")],v);var nr=v;export{nr as default};
