import{F as A,I as x,Qa as H,Xa as j,Za as R,a as C,la as F,oa as O,r as L,za as h}from"./chunk-N5C252A2.js";var _=class extends H{_beforeChanged(){super._beforeChanged(),(this.isDirty("pointerBaseWidth")||this.isDirty("cornerRadius")||this.isDirty("pointerLength")||this.isDirty("pointerX")||this.isDirty("pointerY")||this.isDirty("width")||this.isDirty("height"))&&(this._clear=!0)}_changed(){if(super._changed(),this._clear){this.markDirtyBounds();let t=this.width(),i=this.height();if(t>0&&i>0){let e=this.get("cornerRadius",8);e=h(e,0,Math.min(t/2,i/2));let r=this.get("pointerX",0),o=this.get("pointerY",0),a=this.get("pointerBaseWidth",15)/2,y=0,f=0,m=0,b=(r-y)*(i-f)-(o-f)*(t-y),n=(r-m)*(0-i)-(o-i)*(t-m),s=this._display;if(s.moveTo(e,0),b>0&&n>0){let l=Math.round(h(r,e+a,t-a-e));o=h(o,-1/0,0),s.lineTo(l-a,0),s.lineTo(r,o),s.lineTo(l+a,0)}if(s.lineTo(t-e,0),s.arcTo(t,0,t,e,e),b>0&&n<0){let l=Math.round(h(o,e+a,i-a-e));r=h(r,t,1/0),s.lineTo(t,e),s.lineTo(t,Math.max(l-a,e)),s.lineTo(r,o),s.lineTo(t,l+a)}if(s.lineTo(t,i-e),s.arcTo(t,i,t-e,i,e),b<0&&n<0){let l=Math.round(h(r,e+a,t-a-e));o=h(o,i,1/0),s.lineTo(t-e,i),s.lineTo(l+a,i),s.lineTo(r,o),s.lineTo(l-a,i)}if(s.lineTo(e,i),s.arcTo(0,i,0,i-e,e),b<0&&n>0){let l=Math.round(h(o,e+a,i-e-a));r=h(r,-1/0,0),s.lineTo(0,i-e),s.lineTo(0,l+a),s.lineTo(r,o),s.lineTo(0,Math.max(l-a,e))}s.lineTo(0,e),s.arcTo(0,0,e,0,e),s.closePath()}}}};Object.defineProperty(_,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PointedRectangle"}),Object.defineProperty(_,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:H.classNames.concat([_.className])});var k=class extends j{constructor(t,i,e,r=[]){super(t,i,e,r),Object.defineProperty(this,"_fx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_fy",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_fillDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_strokeDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_labelDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_w",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_h",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_keepHoverDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_htmlContentHovered",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_afterNew(){this._settings.themeTags=F(this._settings.themeTags,["tooltip"]),super._afterNew(),this._setDefaultFn("background",()=>_.new(this._root,{})).set("themeTags",["tooltip","background"]),this._label=this.children.push(R.new(this._root,{})),this._disposers.push(this._label.events.on("boundschanged",()=>{this._updateBackground()})),this._disposers.push(this.on("bounds",()=>{this._updateBackground()})),this._updateTextColor(),this._root.tooltipContainer.children.push(this),this.hide(0),this._disposers.push(this.label.onPrivate("htmlElement",t=>{t&&(this._disposers.push(x(t,"pointerover",i=>{this._htmlContentHovered=!0})),this._disposers.push(x(t,"pointerout",i=>{this._htmlContentHovered=!1})))})),this.on("visible",t=>{this._handleReaderAnnouncement()}),this.label.events.on("dataitemchanged",t=>{this._handleReaderAnnouncement()}),this._root._tooltips.push(this)}_handleReaderAnnouncement(){this.get("readerAnnounce")&&this.isVisibleDeep()&&this._root.readerAlert(this.label.getAccessibleText())}get label(){return this._label}_dispose(){super._dispose(),L(this._root._tooltips,this)}_updateChildren(){super._updateChildren(),(this.isDirty("pointerOrientation")||this.isPrivateDirty("minWidth")||this.isPrivateDirty("minHeight"))&&this.get("background")._markDirtyKey("width"),this.get("labelText")!=null&&this.label.set("text",this.get("labelText")),this.get("labelHTML")!=null&&this.label.set("html",this.get("labelHTML")),this.get("labelAriaLabel")!=null&&this.label.set("ariaLabel",this.get("labelAriaLabel"))}_changed(){if(super._changed(),(this.isDirty("pointTo")||this.isDirty("pointerOrientation"))&&this._updateBackground(),this.isDirty("tooltipTarget")&&this.updateBackgroundColor(),this.isDirty("keepTargetHover"))if(this.get("keepTargetHover")){let t=this.get("background");this._keepHoverDp=new A([t.events.on("pointerover",i=>{let e=this.get("tooltipTarget");e&&(e.parent&&e.parent.getPrivate("tooltipTarget")==e&&(e=e.parent),e.hover())}),t.events.on("pointerout",i=>{let e=this.get("tooltipTarget");e&&(e.parent&&e.parent.getPrivate("tooltipTarget")==e&&(e=e.parent),this._htmlContentHovered||e.unhover())})]),this.label.onPrivate("htmlElement",i=>{this._keepHoverDp&&i&&this._keepHoverDp.disposers.push(x(i,"pointerleave",e=>{let r=this.root._renderer.getEvent(e);t.events.dispatch("pointerout",{type:"pointerout",originalEvent:r.event,point:r.point,simulated:!1,target:t})}))})}else this._keepHoverDp&&(this._keepHoverDp.dispose(),this._keepHoverDp=void 0)}_onShow(){super._onShow(),this.updateBackgroundColor()}updateBackgroundColor(){let t=this.get("tooltipTarget"),i=this.get("background"),e,r;t&&i&&(e=t.get("fill"),r=t.get("stroke"),e==null&&(e=r),this.get("getFillFromSprite")&&(this._fillDp&&this._fillDp.dispose(),e!=null&&i.set("fill",e),this._fillDp=t.on("fill",o=>{o!=null&&(i.set("fill",o),this._updateTextColor(o))}),this._disposers.push(this._fillDp)),this.get("getStrokeFromSprite")&&(this._strokeDp&&this._strokeDp.dispose(),e!=null&&i.set("stroke",e),this._strokeDp=t.on("fill",o=>{o!=null&&i.set("stroke",o)}),this._disposers.push(this._strokeDp)),this.get("getLabelFillFromSprite")&&(this._labelDp&&this._labelDp.dispose(),e!=null&&this.label.set("fill",e),this._labelDp=t.on("fill",o=>{o!=null&&this.label.set("fill",o)}),this._disposers.push(this._labelDp))),this._updateTextColor(e)}_updateTextColor(t){this.get("autoTextColor")&&(t==null&&(t=this.get("background").get("fill")),t==null&&(t=this._root.interfaceColors.get("background")),t instanceof O&&this.label.set("fill",O.alternative(t,this._root.interfaceColors.get("alternativeText"),this._root.interfaceColors.get("text"))))}_setDataItem(t){super._setDataItem(t),this.label._setDataItem(t)}_updateBackground(){super.updateBackground();let t=this._root.container;if(t){let i=.5,e=.5,r=this.get("centerX");r instanceof C&&(i=r.value);let o=this.get("centerY");o instanceof C&&(e=o.value);let a=t.width(),y=t.height(),f=this.parent,m=0,b=0;if(f){m=f.x(),b=f.y();let g=f.get("layerMargin");g&&(m+=g.left||0,b+=g.top||0,a+=(g.left||0)+(g.right||0),y+=(g.top||0)+(g.bottom||0))}let n=this.get("bounds",{left:-m,top:-b,right:a-m,bottom:y-b});this._updateBounds();let s=this.width(),l=this.height();s===0&&(s=this._w),l===0&&(l=this._h);let w=this.get("pointTo",{x:a/2,y:y/2}),p=w.x,u=w.y,v=this.get("pointerOrientation"),c=this.get("background"),d=0,T=0,D=0;c instanceof _&&(d=c.get("pointerLength",0),T=c.get("strokeWidth",0)/2,D=T,c.set("width",s),c.set("height",l));let B=0,M=0,N=n.right-n.left,E=n.bottom-n.top;v=="horizontal"||v=="left"||v=="right"?(T=0,v=="horizontal"?p>n.left+N/2?(p-=s*(1-i)+d,D*=-1):p+=s*i+d:v=="left"?p+=s*(1-i)+d:(p-=s*i+d,D*=-1)):(D=0,v=="vertical"?u>n.top+l/2+d?u-=l*(1-e)+d:(u+=l*e+d,T*=-1):v=="down"?u-=l*(1-e)+d:(u+=l*e+d,T*=-1)),p=h(p,n.left+s*i,n.left+N-s*(1-i))+D,u=h(u,n.top+l*e,n.top+E-l*(1-e))-T,B=w.x-p+s*i+D,M=w.y-u+l*e-T,this._fx=p,this._fy=u;let P=this.get("animationDuration",0);if(P>0&&this.get("visible")&&this.get("opacity")>.1){let g=this.get("animationEasing");this.animate({key:"x",to:p,duration:P,easing:g}),this.animate({key:"y",to:u,duration:P,easing:g})}else this.set("x",p),this.set("y",u);c instanceof _&&(c.set("pointerX",B),c.set("pointerY",M)),s>0&&(this._w=s),l>0&&(this._h=l)}}};Object.defineProperty(k,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Tooltip"}),Object.defineProperty(k,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:j.classNames.concat([k.className])});export{k as a};
