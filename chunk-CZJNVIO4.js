import{a as Ge,b as Se,c as Rt,d as It}from"./chunk-WPDA2XSD.js";import{a as Et}from"./chunk-HEMZVBIO.js";import{b as Gt,c as St}from"./chunk-PRXMA6HV.js";import{a as Pe}from"./chunk-JEGXFID4.js";import{e as vt}from"./chunk-F6A6XWW4.js";import{b as Pt}from"./chunk-74LTYPBC.js";import{a as U}from"./chunk-WNSGKHQ6.js";import{b as L,c as bt}from"./chunk-R6GE4XRP.js";import{a as be}from"./chunk-XPRVY6JT.js";import{h as re}from"./chunk-7N3ZKWML.js";import{i as oe}from"./chunk-QDTU3MWT.js";import{j as ve}from"./chunk-I4M2OT5W.js";import{a as B,n as Te}from"./chunk-NTVLK3P2.js";import{a as I}from"./chunk-WMQNRNIU.js";import{a as $e}from"./chunk-VDKRSX77.js";import{a as wt,b as _t}from"./chunk-WUA6PW3I.js";import{F as R,d as Tt}from"./chunk-E57FTRWF.js";import{f as g}from"./chunk-7EG726PT.js";import{L as D,d as n}from"./chunk-C7INQGWT.js";import{H as m,i as ht}from"./chunk-WMHJC7XF.js";import{C as gt,t as te,z as He}from"./chunk-D2LVMNOU.js";import{a as i}from"./chunk-QGVBCWUY.js";import{r as K,t as u}from"./chunk-HHDFN2GK.js";import{a as ft}from"./chunk-47GHT6OF.js";import{a as b,b as F,f as d}from"./chunk-VTHXE323.js";var Ze,O=Ze=class extends D{constructor(e){super(e),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnColumnName=!1,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}static from(e){return ht(Ze,e)}};i([n({type:I})],O.prototype,"outSpatialReference",void 0),i([n({type:ve})],O.prototype,"processExtent",void 0),i([n({type:I})],O.prototype,"processSpatialReference",void 0),i([n({nonNullable:!0})],O.prototype,"returnColumnName",void 0),i([n({nonNullable:!0})],O.prototype,"returnFeatureCollection",void 0),i([n({nonNullable:!0})],O.prototype,"returnM",void 0),i([n({nonNullable:!0})],O.prototype,"returnZ",void 0),O=Ze=i([m("esri.rest.geoprocessor.GPOptions")],O);var Ee=O;var C=class extends g{constructor(){super(...arguments),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};i([n({type:ve})],C.prototype,"extent",void 0),i([n()],C.prototype,"height",void 0),i([n()],C.prototype,"href",void 0),i([n()],C.prototype,"opacity",void 0),i([n()],C.prototype,"rotation",void 0),i([n()],C.prototype,"scale",void 0),i([n()],C.prototype,"visible",void 0),i([n()],C.prototype,"width",void 0),C=i([m("esri.layers.support.MapImage")],C);var xt=C;var ae=class extends g{constructor(e){super(e),this.area=0,this.units=null}};i([n({json:{write:!0}})],ae.prototype,"area",void 0),i([U(St)],ae.prototype,"units",void 0),ae=i([m("esri.rest.support.ArealUnit")],ae);var jt=ae;var ie=class extends g{constructor(e){super(e),this.itemId=null,this.url=null}};i([n({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],ie.prototype,"itemId",void 0),i([n({type:String,json:{write:!0}})],ie.prototype,"url",void 0),ie=i([m("esri.rest.support.DataFile")],ie);var Re=ie;var ne=class extends g{constructor(e){super(e),this.distance=0,this.units=null}};i([n({json:{write:!0}})],ne.prototype,"distance",void 0),i([U(Gt)],ne.prototype,"units",void 0),ne=i([m("esri.rest.support.LinearUnit")],ne);var Dt=ne;var G="multi-value-",se=new wt({GPArealUnit:"areal-unit",GPBoolean:"boolean",GPComposite:"composite",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",Field:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string",GPValueTable:"value-table","GPMultiValue:GPArealUnit":`${G}areal-unit`,"GPMultiValue:GPBoolean":`${G}boolean`,"GPMultiValue:GPComposite":`${G}composite`,"GPMultiValue:GPDataFile":`${G}data-file`,"GPMultiValue:GPDate":`${G}date`,"GPMultiValue:GPDouble":`${G}double`,"GPMultiValue:GPFeatureRecordSetLayer":`${G}feature-record-set-layer`,"GPMultiValue:Field":`${G}field`,"GPMultiValue:GPLinearUnit":`${G}linear-unit`,"GPMultiValue:GPLong":`${G}long`,"GPMultiValue:GPRasterData":`${G}raster-data`,"GPMultiValue:GPRasterDataLayer":`${G}raster-data-layer`,"GPMultiValue:GPRecordSet":`${G}record-set`,"GPMultiValue:GPString":`${G}string`});var Y=class extends g{constructor(e){super(e),this.dataType=null,this.paramName=null,this.value=null}};i([U(se,{ignoreUnknown:!1})],Y.prototype,"dataType",void 0),i([n()],Y.prototype,"paramName",void 0),i([n()],Y.prototype,"value",void 0),Y=i([m("esri.rest.support.ParameterValue")],Y);var Ct=Y;var H=class extends g{constructor(e){super(e),this.format=null,this.itemId=null,this.url=null}};i([n()],H.prototype,"format",void 0),i([n({json:{read:{source:"itemID"},write:{target:"itemID"}}})],H.prototype,"itemId",void 0),i([n()],H.prototype,"url",void 0),H=i([m("esri.rest.support.RasterData")],H);var Mt=H;function Ot(e,t,r,o,a){return d(this,null,function*(){let s={},p={},l=[];return hr(o,l,s),Pt(l).then(c=>{let{outSpatialReference:y,processExtent:f,processSpatialReference:h,returnColumnName:_,returnFeatureCollection:w,returnM:T,returnZ:W}=r,{path:P}=L(e);for(let yt in s){let[yr,fr]=s[yt];p[yt]=c.slice(yr,fr)}let ee=y?y.wkid||y:null,_e=h?h.wkid||h:null,Q=t==="execute"?{returnColumnName:_||void 0,returnFeatureCollection:w||void 0,returnM:T||void 0,returnZ:W||void 0}:null,cr=pe(F(b(b(b({},f?{context:{extent:f,outSR:ee,processSR:_e}}:{"env:outSR":ee,"env:processSR":_e}),o),Q),{f:"json"}),null,p),mr=F(b({},a),{query:cr});return R(`${P}/${t}`,mr)})})}function hr(e,t,r){for(let o in e){let a=e[o];if(a&&typeof a=="object"&&a instanceof Pe){let{features:s}=a;r[o]=[t.length,t.length+s.length],s.forEach(p=>{t.push(p.geometry)})}}}function Xe(e,t){return d(this,null,function*(){switch(e){case"areal-unit":return jt.fromJSON(t);case"boolean":case"double":case"long":case"string":case"value-table":return t;case"date":return new Date(t);case"data-file":return Re.fromJSON(t);case"linear-unit":return Dt.fromJSON(t);case"feature-record-set-layer":if("url"in t)return Re.fromJSON(t);if("layerDefinition"in t){let r=new(yield import("./chunk-7UWKG2HI.js")).default,{layerDefinition:o,featureSet:a}=t;return r.read({layerDefinition:o,featureSet:a},{origin:"portal-item"}),r.spatialReference=I.fromJSON(a.spatialReference??o.spatialReference??o.extent.spatialReference),r}return Pe.fromJSON(t);case"record-set":return"url"in t?Re.fromJSON(t):Pe.fromJSON(t);case"raster-data":case"raster-data-layer":return"mapImage"in t?xt.fromJSON(t.mapImage):Mt.fromJSON(t);case"field":return vt.fromJSON(t)}})}function gr(e){return e.startsWith(G)}function wr(e){return e.replace(G,"")}function _r(e,t){return d(this,null,function*(){let r=wr(e),o=r==="composite"?t.map(a=>Xe(se.fromJSON(a.dataType),a.value)):t.map(a=>Xe(r,a));return Promise.all(o)})}function et(e){return d(this,null,function*(){let t=se.fromJSON(e.dataType),{paramName:r}=e,o=gr(t)?yield _r(t,e.value):yield Xe(t,e.value);return new Ct({dataType:t,paramName:r,value:o})})}function pe(e,t,r){for(let o in e){let a=e[o];Array.isArray(a)?e[o]=JSON.stringify(a.map(s=>pe({item:s},!0).item)):a instanceof Date&&(e[o]=a.getTime())}return bt(e,t,r)}var Ie,Tr=_t()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1}),tt=1e3,N=Ie=class extends g{constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.progress=null,this.requestOptions=null,this.sourceUrl=null,this._cancelJobTimer=void 0,this._jobCompletionTimer=void 0}cancelJob(e){return d(this,null,function*(){let{jobId:t,sourceUrl:r}=this,{path:o}=L(r),a=F(b(b({},this.requestOptions),e),{query:{f:"json"}}),s=`${o}/jobs/${t}/cancel`,{data:p}=yield R(s,a),{messages:l,jobStatus:c,progress:y}=Ie.fromJSON(p);return this.set({messages:l,jobStatus:c,progress:y}),c==="job-cancelled"?this:new Promise((f,h)=>{He(a.signal,()=>{this.clearCancelJobTimer(),h(te())}),this.clearCancelJobTimer();let _=()=>{this._cancelJobTimer||h(te()),this.checkJobStatus(e).then(({jobStatus:w})=>{switch(w){case"job-cancelling":default:this._cancelJobTimer=setTimeout(_,tt);break;case"job-deleted":case"job-deleting":case"job-executing":case"job-failed":case"job-new":case"job-submitted":case"job-succeeded":case"job-timed-out":case"job-waiting":h(this);break;case"job-cancelled":f(this)}})};this._cancelJobTimer=setTimeout(_,tt)})})}destroy(){clearInterval(this._cancelJobTimer),clearInterval(this._jobCompletionTimer)}checkJobStatus(e){return d(this,null,function*(){let{path:t}=L(this.sourceUrl),r=F(b(b({},this.requestOptions),e),{query:{f:"json"}}),o=`${t}/jobs/${this.jobId}`,{data:a}=yield R(o,r),{messages:s,jobStatus:p,progress:l}=Ie.fromJSON(a);return this.set({messages:s,jobStatus:p,progress:l}),this})}fetchResultData(e,t,r){return d(this,null,function*(){t=Ee.from(t||{});let{returnColumnName:o,returnFeatureCollection:a,returnM:s,returnZ:p,outSpatialReference:l}=t,{path:c}=L(this.sourceUrl),y=pe({returnColumnName:o||null,returnFeatureCollection:a||null,returnM:s||null,returnZ:p||null,outSR:l,returnType:"data",f:"json"},null),f=F(b(b({},this.requestOptions),r),{query:y}),h=`${c}/jobs/${this.jobId}/results/${e}`,{data:_}=yield R(h,f);return et(_)})}fetchResultImage(e,t,r){return d(this,null,function*(){let{path:o}=L(this.sourceUrl),a=F(b({},t.toJSON()),{f:"json"}),s=pe(a),p=F(b(b({},this.requestOptions),r),{query:s}),l=`${o}/jobs/${this.jobId}/results/${e}`,{data:c}=yield R(l,p);return et(c)})}fetchResultMapImageLayer(){return d(this,null,function*(){let{path:e}=L(this.sourceUrl),t=e.indexOf("/GPServer/"),r=`${e.slice(0,Math.max(0,t))}/MapServer/jobs/${this.jobId}`;return new(yield import("./chunk-JC3XZDT2.js")).default({url:r})})}waitForJobCompletion(){return d(this,arguments,function*(e={}){let{interval:t=tt,signal:r,statusCallback:o}=e;return new Promise((a,s)=>{He(r,()=>{this.clearJobCompletionTimer(),s(te())}),this.clearJobCompletionTimer();let p=()=>{this._jobCompletionTimer||s(te()),this.checkJobStatus().then(({jobStatus:l})=>{switch(l){case"job-succeeded":a(this);break;case"job-executing":case"job-new":case"job-submitted":case"job-waiting":o&&o(this),this._jobCompletionTimer=setTimeout(p,t);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-failed":case"job-timed-out":s(this);break;default:this._jobCompletionTimer=setTimeout(p,t)}}).catch(l=>{s(l)})};this._jobCompletionTimer=setTimeout(p,t)})})}clearCancelJobTimer(){clearTimeout(this._cancelJobTimer),this._cancelJobTimer=void 0}clearJobCompletionTimer(){clearTimeout(this._jobCompletionTimer),this._jobCompletionTimer=void 0}};i([n()],N.prototype,"jobId",void 0),i([U(Tr,{ignoreUnknown:!1})],N.prototype,"jobStatus",void 0),i([n({type:[Et]})],N.prototype,"messages",void 0),i([n()],N.prototype,"progress",void 0),i([n()],N.prototype,"requestOptions",void 0),i([n({json:{write:!0}})],N.prototype,"sourceUrl",void 0),N=Ie=i([m("esri.rest.support.JobInfo")],N);var kt=N;function Ft(e,t,r,o){return d(this,null,function*(){return r=Ee.from(r||{}),Ot(e,"submitJob",r,t??{},o).then(({data:a})=>{let s=kt.fromJSON(a);return s.sourceUrl=e,s})})}var $=class extends D{constructor(e){super(e),this.headerKeys=[],this.outSpatialReference=null,this.exceededTransferLimit=!1}};i([n()],$.prototype,"headerKeys",void 0),i([n()],$.prototype,"outSpatialReference",void 0),i([n()],$.prototype,"exceededTransferLimit",void 0),$=i([m("esri.rest.knowledgeGraph.GraphQueryResultHeader")],$);var q=$;var le=class extends D{constructor(e){super(e),this.resultRows=[],this.resultHeader=new q}};i([n()],le.prototype,"resultRows",void 0),i([n()],le.prototype,"resultHeader",void 0),le=i([m("esri.rest.knowledgeGraph.GraphQueryResult")],le);var rt=le;var de=class extends D{constructor(e){super(e),this.resultRowsStream=new ReadableStream,this.resultHeader=new q}};i([n()],de.prototype,"resultRowsStream",void 0),i([n()],de.prototype,"resultHeader",void 0),de=i([m("esri.rest.knowledgeGraph.GraphQueryStreamingResult")],de);var ot=de;var z=class extends g{constructor(e){super(e),this.name=null,this.unique=null,this.ascending=!0,this.description="",this.fieldNames=[]}};i([n({type:String,json:{write:!0}})],z.prototype,"name",void 0),i([n({type:Boolean,json:{write:!0}})],z.prototype,"unique",void 0),i([n({type:Boolean,json:{write:!0}})],z.prototype,"ascending",void 0),i([n({type:String,json:{write:!0}})],z.prototype,"description",void 0),i([n({type:[String],json:{write:!0}})],z.prototype,"fieldNames",void 0),z=i([m("esri.rest.knowledgeGraph.FieldIndex")],z);var xe=z;var E=class extends g{constructor(e){super(e),this.name=null,this.alias=null,this.fieldType=null,this.geometryType=null,this.hasM=null,this.hasZ=null,this.nullable=null,this.editable=!0,this.required=!1,this.defaultVisibility=!0,this.systemMaintained=null,this.role="esriGraphPropertyUNSPECIFIED",this.defaultValue=null}};i([n({type:String,json:{write:!0}})],E.prototype,"name",void 0),i([n({type:String,json:{write:!0}})],E.prototype,"alias",void 0),i([n({type:String,json:{write:!0}})],E.prototype,"fieldType",void 0),i([n({type:String,json:{write:!0}})],E.prototype,"geometryType",void 0),i([n({type:Boolean,json:{write:!0}})],E.prototype,"hasM",void 0),i([n({type:Boolean,json:{write:!0}})],E.prototype,"hasZ",void 0),i([n({type:Boolean,json:{write:!0}})],E.prototype,"nullable",void 0),i([n({type:Boolean,json:{write:!0}})],E.prototype,"editable",void 0),i([n({type:Boolean,json:{write:!0}})],E.prototype,"required",void 0),i([n({type:Boolean,json:{write:!0}})],E.prototype,"defaultVisibility",void 0),i([n({type:Boolean,json:{write:!0}})],E.prototype,"systemMaintained",void 0),i([n({type:String,json:{write:!0}})],E.prototype,"role",void 0),i([n({json:{write:!0}})],E.prototype,"defaultValue",void 0),E=i([m("esri.rest.knowledgeGraph.GraphProperty")],E);var je=E;var A=class extends g{constructor(e){super(e),this.name=null,this.alias=null,this.role="Regular",this.strict=null,this.properties=[],this.fieldIndexes=[],this.type=null}};i([n({type:String,json:{write:!0}})],A.prototype,"name",void 0),i([n({type:String,json:{write:!0}})],A.prototype,"alias",void 0),i([n({type:String,json:{write:!0}})],A.prototype,"role",void 0),i([n({type:Boolean,json:{write:!0}})],A.prototype,"strict",void 0),i([n({type:[je],json:{write:!0}})],A.prototype,"properties",void 0),i([n({type:[xe],json:{write:!0}})],A.prototype,"fieldIndexes",void 0),A=i([m("esri.rest.knowledgeGraph.GraphObjectType")],A);var ue=A;var at=class extends ue{constructor(e){super(e),this.type="entity"}};at=i([m("esri.rest.knowledgeGraph.EntityType")],at);var ce=at;var De=class extends ue{constructor(e){super(e),this.endPoints=[],this.type="relationship"}};i([n({json:{write:!0}})],De.prototype,"endPoints",void 0),De=i([m("esri.rest.knowledgeGraph.RelationshipType")],De);var Ce=De;var me=class extends g{constructor(e){super(e),this.value=null,this.behavior=null}};i([n({type:String,json:{write:!0}})],me.prototype,"value",void 0),i([n({type:String,json:{write:!0}})],me.prototype,"behavior",void 0),me=i([m("esri.rest.knowledgeGraph.SourceTypeValueBehavior")],me);var Me=me;var x=class extends g{constructor(e){super(e),this.timestamp=null,this.spatialReference=null,this.strict=null,this.objectIdField=null,this.globalIdField=null,this.arcgisManaged=null,this.identifierInfo=null,this.searchIndexes=[],this.entityTypes=[],this.relationshipTypes=[],this.metaEntityTypes=[],this.provenanceSourceTypeValues=[]}};i([n({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.timestamp=e?.getTime()}}}})],x.prototype,"timestamp",void 0),i([n({type:I,json:{write:!0}})],x.prototype,"spatialReference",void 0),i([n({type:Boolean,json:{write:!0}})],x.prototype,"strict",void 0),i([n({type:String,json:{write:!0}})],x.prototype,"objectIdField",void 0),i([n({type:String,json:{write:!0}})],x.prototype,"globalIdField",void 0),i([n()],x.prototype,"arcgisManaged",void 0),i([n()],x.prototype,"identifierInfo",void 0),i([n()],x.prototype,"searchIndexes",void 0),i([n({type:[ce],json:{write:!0}})],x.prototype,"entityTypes",void 0),i([n({type:[Ce],json:{write:!0}})],x.prototype,"relationshipTypes",void 0),i([n({type:[ce],json:{write:!0}})],x.prototype,"metaEntityTypes",void 0),i([n({type:[Me],json:{write:!0}})],x.prototype,"provenanceSourceTypeValues",void 0),x=i([m("esri.rest.knowledgeGraph.DataModel")],x);var Oe=x;var v=class extends g{constructor(e){super(e),this.capabilities=[],this.supportsSearch=!1,this.supportedQueryFormats=[],this.allowGeometryUpdates=!1,this.searchMaxRecordCount=null,this.serviceCapabilities=null,this.maxRecordCount=null,this.description="",this.copyrightText="",this.units="",this.spatialReference=null,this.currentVersion=null,this.dateFieldsTimeReference=null,this.serviceItemId="",this.supportsDocuments=!1,this.dataEditingNotSupported=!1,this.schemaEditingNotSupported=!1,this.supportsProvenance=!1}};i([n({type:[String],json:{write:!0}})],v.prototype,"capabilities",void 0),i([n({type:Boolean,json:{write:!0}})],v.prototype,"supportsSearch",void 0),i([n({type:[String],json:{write:!0}})],v.prototype,"supportedQueryFormats",void 0),i([n({type:Boolean,json:{write:!0}})],v.prototype,"allowGeometryUpdates",void 0),i([n({type:Number,json:{write:!0}})],v.prototype,"searchMaxRecordCount",void 0),i([n({type:Object,json:{write:!0}})],v.prototype,"serviceCapabilities",void 0),i([n({type:Number,json:{write:!0}})],v.prototype,"maxRecordCount",void 0),i([n({type:String,json:{write:!0}})],v.prototype,"description",void 0),i([n({type:String,json:{write:!0}})],v.prototype,"copyrightText",void 0),i([n({type:String,json:{write:!0}})],v.prototype,"units",void 0),i([n({type:I,json:{write:!0}})],v.prototype,"spatialReference",void 0),i([n({type:Number,json:{write:!0}})],v.prototype,"currentVersion",void 0),i([n({type:Object,json:{write:!0}})],v.prototype,"dateFieldsTimeReference",void 0),i([n({type:String,json:{write:!0}})],v.prototype,"serviceItemId",void 0),i([n({type:Boolean,json:{write:!0}})],v.prototype,"supportsDocuments",void 0),i([n({type:Boolean,json:{write:!0}})],v.prototype,"dataEditingNotSupported",void 0),i([n({type:Boolean,json:{write:!0}})],v.prototype,"schemaEditingNotSupported",void 0),i([n({type:Boolean,json:{write:!0}})],v.prototype,"supportsProvenance",void 0),v=i([m("esri.rest.knowledgeGraph.ServiceDefinition")],v);var ke=v;var Z=class extends g{constructor(e){super(e),this.url=null,this.dataModel=null,this.serviceDefinition=null}};i([n({type:String,json:{write:!0}})],Z.prototype,"url",void 0),i([n({type:Oe,json:{write:!0}})],Z.prototype,"dataModel",void 0),i([n({type:ke,json:{write:!0}})],Z.prototype,"serviceDefinition",void 0),Z=i([m("esri.rest.knowledgeGraph.KnowledgeGraph")],Z);var Nt=Z;function k(e,t,r){if(e.error_code!==0)throw new u(t,r,{errorCode:e.error_code,errorMessage:e.error_message})}function At(e,t,r,o=!1){let a=new r.ClientDataFetchRequestEncoder;a.deleteLater();for(let p of e){let l=vr(p,t,r,o);a.add_client_data_fetch_request_parameter(l)}a.encode();let s=a.get_encoding_result();return k(s.error,"knowledge-graph:fetchClientDataAtKeys-encoding-failed","Attempting to encode the fetchClientDataAtKeys failed"),structuredClone(s.get_byte_buffer())}function vr(e,t,r,o){let a=new r.ClientDataKey;a.deleteLater(),a.key_string=e;let s=new r.ClientDataFetchRequestParameter;s.deleteLater(),s.set_key(a);let p=t.get(e);return p&&!o&&(s.v_tag={v_tag:p.version}),s}var Ut="esri/rest/knowledgeGraph/wasmInterface/",it,br=null;function M(){return d(this,null,function*(){let e=br??it;if(e)return e;let t=!!ft("wasm-simd");return it=Pr(t),it})}function Pr(e){return d(this,null,function*(){if(e){let{default:r}=yield import("./chunk-7WSSRGKN.js").then(o=>o.a);return r({locateFile:o=>$e(Ut+o)})}let{default:t}=yield import("./chunk-EVTX4TR7.js").then(r=>r.a);return t({locateFile:r=>$e(Ut+r)})})}var J,Lt,Fe;(function(e){e[e.OBJECT=0]="OBJECT",e[e.ENTITY=1]="ENTITY",e[e.RELATIONSHIP=2]="RELATIONSHIP",e[e.PATH=3]="PATH",e[e.ARRAY=4]="ARRAY"})(J||(J={})),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(Lt||(Lt={})),function(e){e[e.exclude=0]="exclude",e[e.include=1]="include"}(Fe||(Fe={}));function nt(e,t){let r=new t.ArrayValue;return r.deleteLater(),e.forEach(o=>{r.add_value(pt(o,t))}),r}function st(e,t){let r=new t.ObjectValue;r.deleteLater();for(let[o,a]of Object.entries(e))r.set_key_value(o,pt(a,t));return r}function ye(e,t){if(e instanceof be)return Sr(e,t);if(e instanceof Te)return Er(e,t);if(e instanceof oe||e instanceof re)return Gr(e,t);throw new u("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function qt(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function zt(e,t,r){if(!e.extent)throw new u("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new u("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new u("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:r.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}function Jt(e,t){t.provenance_behavior={value:Fe[e]}}function pt(e,t){if(e==null)return"";if(typeof e!="object"||e instanceof Date)return e;if(e instanceof B)return ye(e,t);if(Array.isArray(e)){let r=new t.ArrayValue;return r.deleteLater(),e.forEach(o=>{r.add_value(pt(o,t))}),r}return st(e,t)}function Gr(e,t){let r=new t.GeometryValue;r.deleteLater(),r.has_z=e.hasZ,r.has_m=e.hasM;let o=[],a=[],s=[];e instanceof oe?(r.geometry_type=t.esriGeometryType.esriGeometryPolyline,s=e.paths):e instanceof re&&(r.geometry_type=t.esriGeometryType.esriGeometryPolygon,s=e.rings);let p=0,l=0;return s.forEach(c=>{let y=0;c.forEach(f=>{y++,f.forEach(h=>{o[l]=h,l++})}),a[p]=y,p++}),r.coords=new Float64Array(o),r.lengths=new Uint32Array(a),r}function Sr(e,t){let r=new t.GeometryValue;r.deleteLater(),r.geometry_type=r.geometry_type=t.esriGeometryType.esriGeometryMultipoint,r.has_z=e.hasZ,r.has_m=e.hasM;let o=[],a=[];a[0]=e.points.length;let s=0;return e.points.forEach(p=>{p.forEach(l=>{o[s]=l,s++})}),r.coords=new Float64Array(o),r.lengths=new Uint32Array(a),r}function Er(e,t){let r=new t.GeometryValue;r.deleteLater(),r.geometry_type=t.esriGeometryType.esriGeometryPoint,r.has_z=e.hasZ,r.has_m=e.hasM;let o=[],a=[];a[0]=1,o[0]=e.x,o[1]=e.y;let s=2;return e.hasZ&&(o[s]=e.z,s++),e.hasM&&(o[s]=e.m,s++),r.coords=new Float64Array(o),r.lengths=new Uint32Array(a),r}function fe(e,t){if(!e.typeName)throw new u("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(e instanceof Ge){let r=new t.EntityValue;r.deleteLater(),r.type_name=e.typeName;for(let[o,a]of Object.entries(e.properties))r.set_key_value(o,Wt(a,t));return e.id&&r.set_id(e.id),r}if(e instanceof Se){let r=new t.RelationshipValue;r.deleteLater(),r.type_name=e.typeName;for(let[o,a]of Object.entries(e.properties))r.set_key_value(o,Wt(a,t));return e.id&&r.set_id(e.id),e.originId&&e.destinationId&&r.set_related_entity_ids(e.originId,e.destinationId),r}throw new u("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function Qt(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function Wt(e,t){return e==null?null:typeof e!="object"||e instanceof Date?e:e instanceof B?ye(e,t):null}var Ne,Kt,he,Ae;(function(e){e[e.ClientDataKeyTypeUNSPECIFIED=0]="ClientDataKeyTypeUNSPECIFIED",e[e.ClientDataKeyTypeString=1]="ClientDataKeyTypeString"})(Ne||(Ne={})),function(e){e[e.ClientDataTypeUNSPECIFIED=0]="ClientDataTypeUNSPECIFIED",e[e.ClientDataTypeString=1]="ClientDataTypeString"}(Kt||(Kt={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.ClientData=1]="ClientData",e[e.NotModified=2]="NotModified"}(he||(he={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.Error=1]="Error",e[e.ClientDataValue=2]="ClientDataValue"}(Ae||(Ae={}));function Vt(e,t,r,o=!1){let a=new Map;for(let s=0;s<e.get_results_count();s++){let p=e.get_result_at(s);if(p.get_fetch_result_case().value!==Ae.ClientDataValue||p.error().error_code!==0){let h=p.get_key().key_string;r.has(h)&&t.delete(h);continue}let l=p.get_value(),c=p.get_key().key_string,y=r.get(c),f;if(l.get_data_case().value===he.NotModified&&y)f=y.value;else{if(l.get_data_case().value!==he.ClientData)continue;{f=l.get_data().client_data_string;let h=p.get_value().get_v_tag().v_tag;o||t.set(c,{key:c,version:h,value:f})}}a.set(c,f)}return a}function Bt(e){let t=e.get_keys(),r=new Array;for(let o=0;o<t.get_keys_count();o++){let a=t.get_key_at(o);a.get_client_data_key_type().value===Ne.ClientDataKeyTypeString&&r.push(a.key_string)}return r}var V=class extends D{constructor(e){super(e),this.name=null,this.supportedCategory="esriTypeUNSPECIFIED",this.analyzers=[],this.searchProperties=new Map}};i([n()],V.prototype,"name",void 0),i([n()],V.prototype,"supportedCategory",void 0),i([n()],V.prototype,"analyzers",void 0),i([n()],V.prototype,"searchProperties",void 0),V=i([m("esri.rest.knowledgeGraph.SearchIndex")],V);var Yt=V;var Ue,ge,we,Le,qe,ze,Je;(function(e){e[e.Regular=0]="Regular",e[e.Provenance=1]="Provenance",e[e.Document=2]="Document"})(Ue||(Ue={})),function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger",e[e.esriFieldTypeDateOnly=14]="esriFieldTypeDateOnly",e[e.esriFieldTypeTimeOnly=15]="esriFieldTypeTimeOnly",e[e.esriFieldTypeTimestampOffset=16]="esriFieldTypeTimestampOffset"}(ge||(ge={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(we||(we={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(Le||(Le={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(qe||(qe={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension",e[e.esriGraphPropertyProvenanceInstanceId=10]="esriGraphPropertyProvenanceInstanceId",e[e.esriGraphPropertyProvenanceSourceType=11]="esriGraphPropertyProvenanceSourceType",e[e.esriGraphPropertyProvenanceSourceName=12]="esriGraphPropertyProvenanceSourceName",e[e.esriGraphPropertyProvenanceSource=13]="esriGraphPropertyProvenanceSource",e[e.esriGraphPropertyProvenanceComment=14]="esriGraphPropertyProvenanceComment",e[e.esriGraphPropertyProvenanceTypeName=15]="esriGraphPropertyProvenanceTypeName",e[e.esriGraphPropertyProvenancePropertyName=16]="esriGraphPropertyProvenancePropertyName"}(ze||(ze={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(Je||(Je={}));var lt=!1;function $t(e){e.deleteLater(),lt=!1;let t=new Oe({timestamp:e.timestamp,spatialReference:new I(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:Je[e.identifier_info?.identifier_mapping_info?.identifier_info_type?.value],databaseNativeIdentifier:e.identifier_info?.identifier_mapping_info?.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:e.identifier_info?.identifier_mapping_info?.uniform_property_identifier?.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:Le[e.identifier_info?.identifier_generation_info?.uuid_method_hint?.value]}},searchIndexes:Nr(e.search_indexes),entityTypes:Ht(e.entity_types),relationshipTypes:kr(e.relationship_types),metaEntityTypes:Ht(e.meta_entity_types),provenanceSourceTypeValues:Fr(e.provenance_source_type_values.value_behavior_array)});return lt&&K.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("A big integer field was detected in the retrieved data model.  The `big-integer` field type is not fully supported in web clients.  Please see https://developers.arcgis.com/javascript/latest/api-reference/esri-layers-support-Field.html#type"),t}function Rr(e){return e.deleteLater(),new ce(Zt(e))}function Ir(e){return e.deleteLater(),new xe({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:Cr(e.fields)})}function Zt(e){return{name:e.name,alias:e.alias,role:Ue[e.role.value],strict:e.strict,properties:Mr(e.properties),fieldIndexes:Or(e.field_indexes)}}function xr(e){return e.deleteLater(),new je({alias:e.alias,name:e.name,fieldType:ge[e.field_type.value]?ge[e.field_type.value]:void 0,geometryType:we[e.geometry_type.value]?we[e.geometry_type.value]:null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:ze[e.role.value],defaultValue:e.default_value})}function jr(e){e.deleteLater();let t=Zt(e),r=[];for(let o=0;o<e.end_points.size();o++){let a=e.end_points.get(o);r.push({originEntityType:a.origin_entity_type,destinationEntityType:a.dest_entity_type})}return e.end_points.delete(),new Ce(Object.assign({endPoints:r},t))}function Dr(e){return new Me({behavior:e.behavior,value:e.value})}function Ht(e){let t=[];for(let r=0;r<e.size();r++)t.push(Rr(e.get(r)));return e.delete(),t}function Cr(e){let t=[];for(let r=0;r<e.size();r++)t.push(e.get(r));return e.delete(),t}function Mr(e){let t=[];for(let r=0;r<e.size();r++){let o=xr(e.get(r));o.fieldType==="esriFieldTypeBigInteger"&&(lt=!0),t.push(o)}return e.delete(),t}function Or(e){let t=[];for(let r=0;r<e.size();r++)t.push(Ir(e.get(r)));return e.delete(),t}function kr(e){let t=[];for(let r=0;r<e.size();r++)t.push(jr(e.get(r)));return e.delete(),t}function Fr(e){let t=[];for(let r=0;r<e.size();r++){let o=e.get(r);o.deleteLater(),t.push(Dr(o))}return e.delete(),t}function Nr(e){let t=[];for(let r=0;r<e.size();r++){let o=new Yt,a=e.get(0);o.name=a.name,o.supportedCategory=qe[a.supported_category.value];let s=a.analyzers.size();for(let p=0;p<s;p++)o.analyzers.push({name:a.analyzers.get(p).name});a.analyzers.delete();for(let p=0;p<a.search_properties.keys().size();p++){let l=a.search_properties.keys().get(p),c=a.search_properties.get(l),y=[];for(let f=0;f<c.property_names.size();f++)y.push(c.property_names.get(f));o.searchProperties.set(l,{propertyNames:y})}t.push(o)}return e.delete(),t}var j;(function(e){e[e.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",e[e.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",e[e.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",e[e.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",e[e.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",e[e.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",e[e.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",e[e.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH"})(j||(j={}));function Xt(e,t){let r={spatialReference:t},o=dt(e,r),a=e.lengths,s=e.coords,p=a[0];r.points=[];let l=0;for(let c=0;c<p;c++){let y=[];for(let f=0;f<o;f++)y[f]=s[l],l++;r.points.push(y)}return new be(r)}function er(e,t){let r={spatialReference:t},o=2;dt(e,r);let a=e.coords;return r.x=a[0],r.y=a[1],e.has_z&&(r.z=a[o],o++),e.has_m&&(r.m=a[o]),new Te(r)}function tr(e,t){let{paths:r,hasM:o,hasZ:a}=or(e,j.ESRI_GEOMETRY_POLYLINE);return new oe({paths:r,hasM:o,hasZ:a,spatialReference:t})}function rr(e,t){let{paths:r,hasM:o,hasZ:a}=or(e,j.ESRI_GEOMETRY_POLYGON);return new re({rings:r,hasM:o,hasZ:a,spatialReference:t})}function or(e,t){let r={paths:[],hasM:!1,hasZ:!1},o=dt(e,r),{coords:a,geometry_type:s,lengths:p}=e;if(s.value!==t)throw new u("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");let l=0;return p.forEach(c=>{let y=[];for(let f=0;f<c;f++){let h=[];for(let _=0;_<o;_++)h[_]=a[l],l++;y.push(h)}r.paths.push(y)}),r}function dt(e,t){let r=2;return e.has_z?(t.hasZ=e.has_z,r++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,r++):t.hasM=!1,r}var We=()=>K.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),Ar={decodedWasmObjToQueryResponseObj:(e,t,r)=>{if(e==null)return null;if(typeof e!="object"||"getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case j.ESRI_GEOMETRY_POINT:return er(e,r);case j.ESRI_GEOMETRY_MULTIPOINT:return Xt(e,r);case j.ESRI_GEOMETRY_POLYLINE:return tr(e,r);case j.ESRI_GEOMETRY_POLYGON:return rr(e,r);case j.ESRI_GEOMETRY_ENVELOPE:case j.ESRI_GEOMETRY_MULTI_PATCH:return We().warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case j.ESRI_GEOMETRY_NULL:case j.ESRI_GEOMETRY_ANY:default:return We().warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return We().warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case J.OBJECT:return Lr(e,t,r);case J.ENTITY:return ar(e,t,r);case J.RELATIONSHIP:return ir(e,t,r);case J.PATH:return qr(e,t,r);case J.ARRAY:return Ur(e,t,r);default:return We().warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function Ur(e,t,r){let o=[],a=e.count();for(let s=0;s<a;s++){let p=e.get_value_at(s);o.push(Qe(p,t,r))}return o}function Qe(e,t,r){return Ar.decodedWasmObjToQueryResponseObj(e,t,r)}function ar(e,t,r){let o=e.type_name,a=ut(e,t,r),s=e.get_id();return new Ge(Object.assign({typeName:o,id:s},a))}function ut(e,t,r){let o={},a=e.key_count();for(let s=0;s<a;s++)o[e.get_key_at(s)]=Qe(e.get_value_at(s),t,r);return{properties:o}}function Lr(e,t,r){return new Rt(ut(e,t,r))}function qr(e,t,r){let o=e.entity_count(),a=e.relationship_count(),s=[];for(let p=0;p<o;p++)s.push(ar(e.get_entity_at(p),t,r)),p<a&&s.push(ir(e.get_relationship_at(p),t,r));return new It({path:s})}function ir(e,t,r){let o=e.type_name,a=ut(e,t,r);return new Se(Object.assign({typeName:o,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},a))}function nr(e){let t=[];for(let o=0;o<e.get_header_keys().size();o++)t.push(e.get_header_keys().get(o));let r=new I(e.get_out_sr());return new q({headerKeys:t,outSpatialReference:r,exceededTransferLimit:e.exceeded_transfer_limit()})}var X=class extends D{constructor(e){super(e),this.hasError=!1,this.error=null,this.editResults=[]}};i([n()],X.prototype,"hasError",void 0),i([n()],X.prototype,"error",void 0),i([n()],X.prototype,"editResults",void 0),X=i([m("esri.rest.knowledgeGraph.GraphApplyEditsResult")],X);var sr=X;function pr(e){let t=e.has_error(),r=new sr({hasError:t,error:t?{errorCode:e.error.error_code,errorMessage:e.error.error_message}:null}),o=e.get_edit_results_count();for(let a=0;a<o;a++){let s=e.get_edit_results_at(a),p=e.get_edit_results_type_name_at(a),l=[],c=[],y=[],f=s.get_add_results_count(),h=s.get_update_results_count(),_=s.get_delete_results_count();for(let w=0;w<f;w++){let T=s.get_add_result_at(w);l.push({id:T.id,error:{errorCode:T.error.error_code,errorMessage:T.error.error_message}})}for(let w=0;w<h;w++){let T=s.get_update_result_at(w);c.push({id:T.id,error:{errorCode:T.error.error_code,errorMessage:T.error.error_message}})}for(let w=0;w<_;w++){let T=s.get_delete_result_at(w);y.push({id:T.id,error:{errorCode:T.error.error_code,errorMessage:T.error.error_message}})}r.editResults.push({typeName:p,adds:l,updates:c,deletes:y})}return r}var Be=new Map,sl=()=>new Map(Be.entries()),S={fetchKnowledgeGraph:e=>d(void 0,null,function*(){let t=new Nt({url:e}),r=[];return r.push(Ye(t)),r.push(zr(t)),yield Promise.all(r),t}),refreshDataModel:e=>d(void 0,null,function*(){e.dataModel=yield ur(e)}),refreshServiceDefinition:e=>d(void 0,null,function*(){let t=(yield R(e.url,{query:{f:"json"}})).data;return t.capabilities=t?.capabilities?.split(","),t.supportedQueryFormats=t?.supportedQueryFormats?.split(","),e.serviceDefinition=new ke(t),e.serviceDefinition}),executeFindPathsAsynchronous:(e,t)=>d(void 0,null,function*(){let r=e.inKnowledgeGraphUrl.split("/rest/services");if(r.length<2)throw new u("knowledge-graph:invalid-tool-url","The URL for the KG Service was not correctly formatted.  It should contain /reset/services/");let o=r[0];return yield Jr(`${o}/rest/services/System/KnowledgeGraphServerToolsAsync/GPServer/ServerFilteredFindPaths`,{in_knowledge_graph_url:e.inKnowledgeGraphUrl,config_type:"STRING",config_string:e.config.toJSON(),result_type:"STRING"},{},t)}),executeFindPaths:(e,t)=>d(void 0,null,function*(){let r=e.inKnowledgeGraphUrl.split("/rest/services");if(r.length<2)throw new u("knowledge-graph:invalid-tool-url","The URL for the KG Service was not correctly formatted.  It should contain /reset/services/");let o=r[0],a=yield Wr(`${o}/rest/services/System/KnowledgeGraphServerTools/GPServer/ServerFilteredFindPaths/execute`,b({method:"post",query:{f:"pjson",in_knowledge_graph_url:e.inKnowledgeGraphUrl,config_type:"STRING",config_string:JSON.stringify(e.config),result_type:"STRING"}},t));if(a.data.results.length<1)throw new u("knowledge-graph:no-results","No results were returned from the FindPaths tool - no results returned",a);let s;for(let p of a.data.results)if(p.paramName==="out_results_string"){s=p.value;break}if(!s)throw new u("knowledge-graph:no-results","No results were returned from the FindPaths tool - no results were returned on the expected paramater out_results_string",a);return s}),fetchAsynchronousFindPathsResultData:(e,t)=>d(void 0,null,function*(){return(yield e.fetchResultData("out_results_string",null,t)).value}),executeQueryStreaming:(e,t,r)=>d(void 0,null,function*(){let o="include",a=`${e.url}/graph/query`;yield ct(e);let s=yield Ve(a,r);if(!e.serviceDefinition?.supportsProvenance&&t.provenanceBehavior===o)throw new u("knowledge-graph:provenance-not-supported","The Knowledge Graph Service definition indicated that provenance is not supported");s.data.body=yield Vr(t,e);let p=yield Ke(s.data.url,s.data);if(e.dataModel){let l=yield lr(p,e.dataModel);return new ot({resultRowsStream:l.readableStream,resultHeader:l.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}),executeApplyEdits:(e,t,r)=>d(void 0,null,function*(){if(e.serviceDefinition?.dataEditingNotSupported)throw new u("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");let o=`${e.url}/graph/applyEdits`;yield ct(e);let a=yield Ve(o,r);return a.data.body=yield Kr(t,e),Yr(yield Ke(a.data.url,a.data))}),executeQuery:(e,t,r)=>d(void 0,null,function*(){let o=`${e.url}/graph/query`,a=yield R(o,{responseType:"array-buffer",query:b({f:"pbf",openCypherQuery:t.openCypherQuery},r?.query),signal:r?.signal,timeout:r?.timeout}),s=a.getHeader?.("content-type"),p=a.data;if(s?.includes("application/x-protobuf")){let l=new(yield M()).GraphQueryDecoder;if(l.deleteLater(),e.dataModel){let c=mt({wasmQueryDecoder:l,newArrayBufferToParse:p,dataModel:e.dataModel});return new rt({resultRows:c.resultRows,resultHeader:c.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:s,data:a.data})}),executeSearch:(e,t,r)=>d(void 0,null,function*(){let o=t.typeCategoryFilter,a=`${e.url}/graph/search`,s=yield R(a,{responseType:"array-buffer",query:b({f:"pbf",searchQuery:`"${t.searchQuery}"`,typeCategoryFilter:o},r?.query),signal:r?.signal,timeout:r?.timeout}),p=s.getHeader?.("content-type"),l=s.data;if(p?.includes("application/x-protobuf")){let c=new(yield M()).GraphQueryDecoder;if(c.deleteLater(),e.dataModel){let y=mt({wasmQueryDecoder:c,newArrayBufferToParse:l,dataModel:e.dataModel});return new rt({resultRows:y.resultRows,resultHeader:y.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:p,data:s.data})}),executeSearchStreaming:(e,t,r)=>d(void 0,null,function*(){let o=`${e.url}/graph/search`;yield ct(e);let a=yield Ve(o,r);a.data.body=yield Br(t);let s=yield Ke(a.data.url,a.data);if(e.dataModel){let p=yield lr(s,e.dataModel);return new ot({resultRowsStream:p.readableStream,resultHeader:p.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}),fetchClientDataAtKeys:(o,a,...s)=>d(void 0,[o,a,...s],function*(e,t,r={ignoreCache:!1}){if(!t.length)return new Map;let p=Be.get(e.url||"");p||(p=new Map,Be.set(e.url||"",p));let l=new Map(p.entries()),c=`${e.url}/clientData/fetch`;t=Array.from(new Set(t));let y=yield M(),f=At(t,p,y,r.ignoreCache),h=yield Ve(c,r.requestOptions);h.data.body=f;let _=yield Ke(h.data.url,h.data),w=_.headers.get("content-type");if(w?.includes("application/x-protobuf")){let T=new y.ClientDataFetchResponseDecoder;T.deleteLater();let W=yield _.arrayBuffer();return T.decode(new Uint8Array(W)),T.has_error()&&k(T.error,"knowledge-graph:fetchClientDataAtKeys-decoding-error","An error occurred while decoding the client data keys response"),Vt(T,p,l,r.ignoreCache)}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response when fetching client data",{responseType:w,data:_})}),fetchAllClientDataKeys:(e,t)=>d(void 0,null,function*(){let r=`${e.url}/clientData`,o=yield R(r,{responseType:"array-buffer",query:{f:"pbf"},signal:t?.signal,timeout:t?.timeout}),a=o.getHeader?.("content-type"),s=o.data;if(a?.includes("application/x-protobuf")){let p=new(yield M()).ClientDataKeysResponseDecoder;return p.deleteLater(),p.decode(new Uint8Array(s)),p.has_error()&&k(p.error,"knowledge-graph:fetchAllClientDataKeys-decoding-error","An error occurred while decoding the client data keys response"),Bt(p)}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:a,data:o.data})}),clearClientDataCache:()=>Be.clear(),_fetchWrapper:(e,t)=>d(void 0,null,function*(){return fetch(e,t)}),_submitJobWrapper:(e,t,r,o)=>d(void 0,null,function*(){return Ft(e,t,r,o)}),_esriRequestWrapper:(e,t)=>d(void 0,null,function*(){return R(e,t)})};function pl(e,t,r){return d(this,null,function*(){return S.executeApplyEdits(e,t,r)})}function ll(e,t,r){return d(this,null,function*(){return S.executeQuery(e,t,r)})}function dl(e,t,r){return d(this,null,function*(){return S.executeQueryStreaming(e,t,r)})}function ul(e,t,r){return d(this,null,function*(){return S.executeSearch(e,t,r)})}function cl(e,t,r){return d(this,null,function*(){return S.executeSearchStreaming(e,t,r)})}function ml(e,t){return S.fetchAllClientDataKeys(e,t)}function yl(e,t,r){return S.fetchClientDataAtKeys(e,t,r)}function fl(e){return d(this,null,function*(){return S.fetchKnowledgeGraph(e)})}function Ye(e){return d(this,null,function*(){return S.refreshDataModel(e)})}function zr(e){return d(this,null,function*(){return S.refreshServiceDefinition(e)})}function hl(e,t){return d(this,null,function*(){return S.executeFindPathsAsynchronous(e,t)})}function gl(e,t){return d(this,null,function*(){return S.executeFindPaths(e,t)})}function wl(e,t){return d(this,null,function*(){return S.fetchAsynchronousFindPathsResultData(e,t)})}function _l(){return S.clearClientDataCache()}function Ke(e,t){return d(this,null,function*(){return S._fetchWrapper(e,t)})}function Jr(e,t,r,o){return d(this,null,function*(){return S._submitJobWrapper(e,t,r,o)})}function Wr(e,t){return d(this,null,function*(){return S._esriRequestWrapper(e,t)})}function ct(e){return d(this,null,function*(){Tt?.findCredential(e.url)||(e.dataModel?yield ur(e):yield Ye(e))})}function Qr(e,t,r,o){t==null?r.set_param_key_value(e,""):typeof t!="object"||t instanceof Date?r.set_param_key_value(e,t):t instanceof B?r.set_param_key_value(e,ye(t,o)):Array.isArray(t)?r.set_param_key_value(e,nt(t,o)):r.set_param_key_value(e,st(t,o))}function Kr(e,t){return d(this,null,function*(){if(t.dataModel||(yield Ye(t)),!t.dataModel)throw new u("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");let r=yield M(),o=!!e.options?.cascadeDelete,a=new r.GraphApplyEditsEncoder(r.SpatialReferenceUtil.WGS84(),e.options?.inputQuantizationParameters?Qt(e.options?.inputQuantizationParameters):r.InputQuantizationUtil.WGS84_lossless());a.deleteLater(),a.cascade_delete=o;try{let p;e.entityAdds?.forEach(l=>{p=a.add_entity(fe(l,r)),k(p,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),e.relationshipAdds?.forEach(l=>{if(!l.originId||!l.destinationId)throw new u("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");p=a.add_relationship(fe(l,r)),k(p,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),e.entityUpdates?.forEach(l=>{if(!l.id)throw new u("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");p=a.update_entity(fe(l,r)),k(p,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),e.relationshipUpdates?.forEach(l=>{if(!l.id)throw new u("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");p=a.update_relationship(fe(l,r)),k(p,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),e.entityDeletes?.forEach(l=>{if(!l.typeName)throw new u("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");let c=a.make_delete_helper(l.typeName,!0);c.deleteLater(),l.ids?.forEach(y=>{c.delete_by_id(y)})}),e.relationshipDeletes?.forEach(l=>{if(!l.typeName)throw new u("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");let c=a.make_delete_helper(l.typeName,!1);l.ids?.forEach(y=>{c.delete_by_id(y)})}),a.encode()}catch(p){throw new u("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:p})}let s=a.get_encoding_result();return k(s.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),structuredClone(s.get_byte_buffer())})}function Vr(e,t){return d(this,null,function*(){let r=yield M(),o=new r.GraphQueryRequestEncoder;if(o.deleteLater(),e.outputSpatialReference?o.output_spatial_reference={wkid:e.outputSpatialReference.wkid,latestWkid:e.outputSpatialReference.latestWkid,vcsWkid:e.outputSpatialReference.vcsWkid,latestVcsWkid:e.outputSpatialReference.latestVcsWkid,wkt:e.outputSpatialReference.wkt??""}:o.output_spatial_reference=r.SpatialReferenceUtil.WGS84(),o.open_cypher_query=e.openCypherQuery,e.bindParameters)for(let[s,p]of Object.entries(e.bindParameters))Qr(s,p,o,r);if(e.bindGeometryQuantizationParameters)qt(e.bindGeometryQuantizationParameters,o);else{if(t.dataModel||(yield Ye(t)),t.dataModel?.spatialReference?.wkid!==4326)throw new u("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");o.input_quantization_parameters=r.InputQuantizationUtil.WGS84_lossless()}e.outputQuantizationParameters&&zt(e.outputQuantizationParameters,o,r),e.provenanceBehavior&&Jt(e.provenanceBehavior,o);try{o.encode()}catch(s){throw new u("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:s})}let a=o.get_encoding_result();if(a.error.error_code!==0)throw new u("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:a.error.error_code,errorMessage:a.error.error_message});return structuredClone(a.get_byte_buffer())})}function Br(e){return d(this,null,function*(){let t=yield M(),r=new t.GraphSearchRequestEncoder;if(r.deleteLater(),r.search_query=e.searchQuery,r.type_category_filter=t.esriNamedTypeCategory[e.typeCategoryFilter],e.returnSearchContext===!0&&(r.return_search_context=e.returnSearchContext),e.start!=null&&e.start>0&&(r.start_index=e.start),e.num!=null&&(r.max_num_results=e.num),e.idsFilter!=null&&Array.isArray(e.idsFilter)&&e.idsFilter.length>0)try{r.set_ids_filter(nt(e.idsFilter,t))}catch(a){throw new u("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:a})}e.namedTypesFilter?.forEach(a=>{r.add_named_type_filter(a)});try{r.encode()}catch(a){throw new u("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:a})}let o=r.get_encoding_result();if(o.error.error_code!==0)throw new u("knowledge-graph:search-encoding-failed","Attempting to get encoding result from the query failed",{errorCode:o.error.error_code,errorMessage:o.error.error_message});return structuredClone(o.get_byte_buffer())})}function Ve(e,t){return d(this,null,function*(){return R(e,{responseType:"native-request-init",method:"post",query:b({f:"pbf"},t?.query),body:"x",headers:{"Content-Type":"application/octet-stream"},signal:t?.signal,timeout:t?.timeout})})}function Yr(e){return d(this,null,function*(){let t=e.headers.get("content-type");if(t?.includes("application/x-protobuf")){let r=yield e.arrayBuffer(),o=new(yield M()).GraphApplyEditsDecoder;return o.deleteLater(),o.decode(new Uint8Array(r)),pr(o)}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:t,data:e.text()})})}var dr=50;function Tl(e){dr=e}function mt({wasmQueryDecoder:e,newArrayBufferToParse:t,dataModel:r,decodedHeader:o,limitMaxProcessingTime:a=!1}){t&&e.push_buffer(new Uint8Array(t));let s=[],p,l,c=0,y=Date.now(),f=!0;for(;e.next_row();){p&&l||(p=o??nr(e),l=p.outSpatialReference??new I({wkid:4326})),c||(c=e.get_header_keys().size());let h=new Array(c);for(let _=0;_<c;_++){let w=e.get_value(_);h[_]=Qe(w,r,l)}if(s.push(h),a&&Date.now()-y>dr){f=!1;break}}if(e.has_error())throw new u("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded - inner row decoding",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return{resultHeader:p,resultRows:s,parsedAllResultsFromBuffer:f}}function lr(e,t){return d(this,null,function*(){let r=e.headers.get("content-type");if(e.headers.get("content-length")&&K.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),r?.includes("application/x-protobuf")){let o=e.body?.getReader(),a=new(yield M()).GraphQueryDecoder,s,p,l;a.deleteLater();let c=new Promise((_,w)=>{p=_,l=w}),y=!1,f=null;return{readableStream:new ReadableStream({pull:function _(w){return d(this,null,function*(){if(!o){let P=new u("knowledge-graph:stream-decoding-error","Error reading from stream - reader is undefined");throw l(P),P}let{done:T,value:W}=f?{done:!1,value:null}:yield o.read().catch(P=>{throw l(P),o.releaseLock(),P});W&&(f=W);try{if(T){let Q;if(a.has_error()?Q=new u("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded - query stream done",{errorCode:a.error.error_code,errorMessage:a.error.error_message}):y||p(new q),o.releaseLock(),Q)throw w.error(Q),l(Q),Q;return void w.close()}let{resultHeader:P,resultRows:ee,parsedAllResultsFromBuffer:_e}=mt({wasmQueryDecoder:a,newArrayBufferToParse:W,dataModel:t,decodedHeader:s,limitMaxProcessingTime:!0});return _e&&(f=null),!s&&P&&(s=P,p(P),y=!0),ee.length>0?void w.enqueue(ee):yield _(w)}catch(P){throw K.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").error(P),l(P),o.releaseLock(),gt(P)?P:new u("knowledge-graph:unexpected-server-response","Error inside streaming data return parsing",{error:P})}})}}),resultHeader:yield c}}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:r,data:e.text()})})}function ur(e){return d(this,null,function*(){let t=`${e.url}/dataModel/queryDataModel`,r=yield R(t,{responseType:"array-buffer",query:{f:"pbf"}}),o=r.getHeader?.("content-type"),a=r.data;if(o?.includes("application/x-protobuf")){let s=(yield M()).decode_data_model_from_protocol_buffer(new Uint8Array(a));if(!s)throw new u("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");return $t(s)}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:r.data})})}export{M as a,ge as b,we as c,Be as d,sl as e,S as f,pl as g,ll as h,dl as i,ul as j,cl as k,ml as l,yl as m,fl as n,Ye as o,zr as p,hl as q,gl as r,wl as s,_l as t,Ke as u,Jr as v,Wr as w,Tl as x};
