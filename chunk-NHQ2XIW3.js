import{L as g,M as $,N as w}from"./chunk-HKHTIKVW.js";import{b as Z}from"./chunk-IJBTA53P.js";import{b as m,c as f,d as D,e as v,f as F}from"./chunk-5TW726OD.js";import{c,g as h}from"./chunk-VGD3XLDH.js";import{a as l,b as d,f as T}from"./chunk-VTHXE323.js";var A=",";var U={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},k=new Set(["integer","small-integer"]),p=null;function B(e){return g(e)||$(e)||w(e)}function E(e){return T(this,null,function*(){let{field:n,field2:t,field3:r,normalizationField:i,valueExpression:s}=e,o=[];if(s){if(!p){let{arcadeUtils:a}=yield Z();p=a}o=p.extractFieldNames(s)}return n&&o.push(n),t&&o.push(t),r&&o.push(r),i&&o.push(i),o})}function u(e){return String(e).padStart(2,"0")}function S(e,n,t){let r;return n==="date"||n==="number"?(n==="number"&&(e=new Date(e)),r=`TIMESTAMP'${t?e.getFullYear():e.getUTCFullYear()}-${u((t?e.getMonth():e.getUTCMonth())+1)}-${u(t?e.getDate():e.getUTCDate())} ${u(t?e.getHours():e.getUTCHours())}:${u(t?e.getMinutes():e.getUTCMinutes())}:${u(t?e.getSeconds():e.getUTCSeconds())}'`):r=e,r}function L(e,n,t,r){let{hasQueryEngine:i}=e,s=`(${S(t,I(e,t),i)} - ${S(n,I(e,n),i)})`,o=U[r],a="/";return o<1&&(o=1/o,a="*"),{sqlExpression:o===1?s:`(${s} ${a} ${o})`,sqlWhere:null}}function I(e,n){if(n instanceof Date)return"date";if(typeof n=="number")return"number";if(typeof n=="string"){let t=e.getField(n);if(n.toLowerCase()==="<now>")return;if(g(t))return"field"}}function q(e,n){let t=n&&e.getField(n);return!!t&&k.has(t.type)}function G(e){return`cast(${e} as float)`}function H(e,n){let{format:t,timeZoneOptions:r,fieldType:i}=n??{},s,o;if(r&&({timeZone:s,timeZoneName:o}=h(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,m(t||"short-date-short-time"),i)),typeof e=="string"&&isNaN(Date.parse(i==="time-only"?`1970-01-01T${e}Z`:e)))return e;switch(i){case"date-only":{let a=m(t||"short-date");return typeof e=="string"?D(e,l({},a)):f(e,d(l({},a),{timeZone:c}))}case"time-only":{let a=m(t||"short-time");return typeof e=="string"?v(e,a):f(e,d(l({},a),{timeZone:c}))}case"timestamp-offset":{if(!s&&typeof e=="string"&&new Date(e).toISOString()!==e)return e;let a=t||r?m(t||"short-date-short-time"):void 0,y=a?d(l({},a),{timeZone:s,timeZoneName:o}):void 0;return typeof e=="string"?F(e,y):f(e,y)}default:{let a=t||r?m(t||"short-date-short-time"):void 0;return f(typeof e=="string"?new Date(e):e,a?d(l({},a),{timeZone:s,timeZoneName:o}):void 0)}}}export{A as a,B as b,E as c,L as d,q as e,G as f,H as g};
