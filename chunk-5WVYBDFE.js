import{a as L}from"./chunk-OCNYIIP3.js";import{a as E}from"./chunk-6AT6XDV7.js";import{a as j}from"./chunk-JEGXFID4.js";import{a as U}from"./chunk-PWU2QHPV.js";import{b as J}from"./chunk-IJBTA53P.js";import{c as G}from"./chunk-AZS4Q4RE.js";import{a as x,d as A}from"./chunk-X5AA4JDN.js";import{d as v}from"./chunk-6XFS4U2F.js";import{j as C}from"./chunk-C7INQGWT.js";import{b as Z,r as h,t as b}from"./chunk-HHDFN2GK.js";import{a as w,f as $}from"./chunk-VTHXE323.js";var m=null;function Q(e,o,a,i={}){let n=o.elementType,r="value",p=n.type==="array"?[{name:r,type:n.type,elementType:n.elementType}]:n.type==="dictionary"?[{name:r,type:n.type,properties:n.properties}]:[{name:r,type:n.type}];return new L(e.map(c=>{let t={};return k(t,p,{[r]:c},a,i),t[r]}))}function W(e,o,a={}){let i=e instanceof j?new E({source:e.features,geometryType:e.geometryType,fields:e.fields,spatialReference:e.spatialReference}):e;return o.constructFeatureSet(i,a.spatialReference,null,!0,a.lruCache,a.interceptor)}function X(e,o,a={}){let{spatialReference:i,interceptor:n,lruCache:r}=a;return typeof e=="string"?o.createFeatureSetCollectionFromService(e,i,r,n):o.createFeatureSetCollectionFromMap(e,i,r,n)}function _(e,o,a,i={}){let n={};return k(n,o.properties,e,a,i),new m.Dictionary(n)}function k(e,o,a,i,n={}){let r={};for(let p of Object.keys(a))r[p.toLowerCase()]=a[p];for(let p of o){let c=p.name.toLowerCase();if(n.variablesPreProcessed)e[c]=r[c];else switch(p.type){case"array":{let t=r[c];e[c]=t==null?null:Q(t,p,i,n);break}case"feature":{let t=r[c];e[c]=t==null?null:m.Feature.createFromGraphic(t,n?.timeZone);break}case"featureSet":{let t=r[c];e[c]=t==null?null:i?W(t,i,n):null;break}case"featureSetCollection":{let t=r[c];e[c]=t==null?null:i?X(t,i,n):null;break}case"dictionary":{let t=r[c];e[c]=t==null?null:_(t,p,i,n);break}case"date":{let t=r[c];e[c]=t?t instanceof v?t:n?.timeZone?v.dateJSAndZoneToArcadeDate(t,n?.timeZone):v.dateJSToArcadeDate(t):null;break}case"dateOnly":{let t=r[c];e[c]=t?t instanceof x?t:x.fromReader(t):null;break}case"time":{let t=r[c];e[c]=t?t instanceof A?t:A.fromReader(t):null;break}case"knowledgeGraph":case"geometry":case"boolean":case"text":case"number":e[c]=r[c];break;case"voxel":{let t=r[c];e[c]=t==null?null:new m.Voxel(t,n?.timeZone);break}}}}function q(e,o){for(let a of e)o.push(a),a.type==="dictionary"&&q(a.properties,o);return o}function M(e,o,a,i,n){let{spatialReference:r,interceptor:p,lruCache:c,console:t,abortSignal:S,timeZone:d,services:y={portal:G.getDefault()}}=a,u={vars:{},spatialReference:r,interceptor:p,timeZone:d,lrucache:c,useAsync:n,services:y,console:t,abortSignal:S};return o&&k(u.vars,e.variables,o,i,a),u}function g(e,o){switch(o.getArcadeType(e)){case"number":case"text":case"boolean":case"point":case"polygon":case"polyline":case"multipoint":case"extent":return e;case"date":return e.toJSDate();case"time":case"dateOnly":return e.toString();case"feature":{let a=(e.type,e),i="geometry"in a?a.geometry():null,n="readAttributes"in a?a.readAttributes():a.attributes;return new U({geometry:i,attributes:n})}case"dictionary":{let a=e,i=a.attributes,n={};for(let r of Object.keys(i))n[r]=g(a.field(r),o);return n}case"array":return("toArray"in e?e.toArray():e).map(a=>g(a,o))}return e}var z={variables:[{name:"$feature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$userInput",type:"geometry"},{name:"$graph",type:"knowledgeGraph"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"},{name:"timeProperties",type:"dictionary",properties:[{name:"currentStart",type:"date"},{name:"currentEnd",type:"date"},{name:"startIncluded",type:"boolean"},{name:"endIncluded",type:"boolean"}]}]}]},N={variables:[{name:"$feature",type:"feature"},{name:"$aggregatedFeatures",type:"featureSet"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"},{name:"timeProperties",type:"dictionary",properties:[{name:"currentStart",type:"date"},{name:"currentEnd",type:"date"},{name:"startIncluded",type:"boolean"},{name:"endIncluded",type:"boolean"}]}]}]},V={variables:[{name:"$voxel",type:"voxel"}]},Y=new Map([["aggregate-field",{variables:[{name:"$feature",type:"feature"}]}],["form-constraint",{variables:[{name:"$feature",type:"feature"}]}],["feature-z",{variables:[{name:"$feature",type:"feature"}]}],["field-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$datastore",type:"featureSetCollection"}]}],["form-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$originalFeature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$featureSet",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$editContext",type:"dictionary",properties:[{name:"editType",type:"text"}]}]}],["labeling",{variables:[{name:"$feature",type:"feature"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"},{name:"timeProperties",type:"dictionary",properties:[{name:"currentStart",type:"date"},{name:"currentEnd",type:"date"},{name:"startIncluded",type:"boolean"},{name:"endIncluded",type:"boolean"}]}]}]}],["popup",z],["popup-element",z],["popup-feature-reduction",N],["popup-element-feature-reduction",N],["visualization",{variables:[{name:"$feature",type:"feature"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"},{name:"timeProperties",type:"dictionary",properties:[{name:"currentStart",type:"date"},{name:"currentEnd",type:"date"},{name:"startIncluded",type:"boolean"},{name:"endIncluded",type:"boolean"}]}]}]}],["popup-voxel",V],["popup-element-voxel",V]]);function fe(e){e==="feature-reduction-popup"?(C(h.getLogger("esri.arcade"),'profile name: "feature-reduction-popup"',{replacement:'"popup-feature-reduction"',version:"4.32",warnOnce:!0}),e="popup-feature-reduction"):e==="feature-reduction-popup-element"&&(C(h.getLogger("esri.arcade"),'profile name: "feature-reduction-popup-element"',{replacement:'"popup-element-feature-reduction"',version:"4.32",warnOnce:!0}),e="popup-element-feature-reduction");let o=Y.get(e);if(!o){let a=Array.from(Y.keys()).map(i=>`'${i}'`).join(", ");throw new b("createArcadeProfile:invalid-profile-name",`Invalid profile name '${e}'. You must specify one of the following values: ${a}`)}return Z(o)}function de(i,n){return $(this,arguments,function*(e,o,a={}){m||(m=yield J());let{arcade:r,arcadeUtils:p}=m,{loadScriptDependencies:c,referencesMember:t,scriptIsAsync:S}=r,d=q(o.variables,[]),y=d.filter(s=>s.type==="featureSet"||s.type==="featureSetCollection").map(s=>s.name.toLowerCase()),u=r.parseScript(e,y);if(!u)throw new b("arcade:invalid-script","Unable to create SyntaxTree");let B=p.extractFieldNames(u),H=r.scriptTouchesGeometry(u),T=d.map(s=>s.name.toLowerCase()).filter(s=>t(u,s)),l=S(u,y);yield c(u,l,y);let I={vars:{},spatialReference:null,useAsync:l};for(let s of T)I.vars[s]="any";let{lruCache:F}=a,O=r.compileScript(u,I),R=r.featureSetUtils(),{services:K}=a;return{execute:(s,f={})=>{if(l)throw new b("arcade:invalid-execution-mode","Cannot execute the script in synchronous mode");let D=O(M(o,s,w({lruCache:F},f),R,l));return f.rawOutput?D:g(D,p)},executeAsync:(D,...ge)=>$(this,[D,...ge],function*(s,f={}){let P=yield O(M(o,s,w({lruCache:F,services:K},f),R,l));return f.rawOutput?P:g(P,p)}),isAsync:l,variablesUsed:T,fieldsUsed:B,geometryUsed:H,syntaxTree:u}})}export{fe as a,de as b};
