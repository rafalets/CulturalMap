import{a as L}from"./chunk-XFESK2YB.js";import{b as R}from"./chunk-IJBTA53P.js";import{d as o,e as M}from"./chunk-J372WZPB.js";import{d as f}from"./chunk-7IPIJKWU.js";import{y as c}from"./chunk-C7INQGWT.js";import{o as O}from"./chunk-D2LVMNOU.js";import{h as _,i as v,t as A}from"./chunk-HHDFN2GK.js";import{a as D,b as V,f as a}from"./chunk-VTHXE323.js";var $="HH:mm",F="HH:mm:ss",U="HH:mm:ss.SSS",ke={HM:$,HMS:F,HMS_MS:U},ee=[U,F,$,"TT"],ie="yyyy-MM-dd",Ce=F;function T(e){if(!e||!o(e))return null;let i=f.fromFormat(e,ie);return i.isValid?i:null}function I(e){return e&&o(e)?O(ee,i=>{let n=f.fromFormat(e,i);return n.isValid?n:null})??null:null}function b(e){if(!e||!o(e))return null;let i=f.fromISO(e);return i.isValid?i:null}var s;(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(s||(s={}));var k=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function ne(e){return e!=null&&k.has(e.type)}function C(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function P(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function G(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}var te=new Set(["single","double","esriFieldTypeSingle","esriFieldTypeDouble"]),ze=c(k,te);function Xe(e,i,n){let t=n??e?.domain;if(!t)return null;switch(t.type){case"range":{let{min:r,max:l}=x(e,t);if(r!=null&&+i<r||l!=null&&+i>l)return s.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(r=>r==null||r.code!==i))return s.INVALID_CODED_VALUE}return null}function x(e,i){let n=i??e?.domain;if(!n||n.type!=="range")return;let t="range"in n?n.range[0]:n.minValue,r="range"in n?n.range[1]:n.maxValue,l=ne(e);return C(e)||G(e)||P(e)?V(D({},re(e,r,t)),{isInteger:l}):{min:t!=null&&typeof t=="number"?t:null,max:r!=null&&typeof r=="number"?r:null,rawMin:t,rawMax:r,isInteger:l}}function re(e,i,n){return C(e)?{min:T(n)?.toMillis(),max:T(i)?.toMillis(),rawMin:n,rawMax:i}:G(e)?{min:I(n)?.toMillis(),max:I(i)?.toMillis(),rawMin:n,rawMax:i}:P(e)?{min:b(n)?.toMillis(),max:b(i)?.toMillis(),rawMin:n,rawMax:i}:{max:null,min:null}}function H(e){if(!e)return;let i=e.match(le);return i?.groups?i.groups.doubleQuoted??i.groups.singleQuoted??i.groups.dotNotation:void 0}var le=/^(\$feature\[(?:"(?<doubleQuoted>[^"]+)"|'(?<singleQuoted>[^']+)')\]|\$feature\.(?<dotNotation>[a-zA-Z_][a-zA-Z0-9_]*))$/i;function Be(e){return e.match(ae)?.[1]?.replace(/\\'/g,"'")??null}var ae=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var se=/^([0-9_])/,oe=/[^a-z0-9_\u0080-\uffff]+/gi;function ti(e){return e==null?null:e.trim().replaceAll(oe,"_").replace(se,"F$1")||null}var ue=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],de=["field","normalizationField"];function ri(e,i){if(e!=null&&i!=null){for(let n of Array.isArray(e)?e:[e])if(z(ue,n,i),"visualVariables"in n&&n.visualVariables)for(let t of n.visualVariables)z(de,t,i)}}function z(e,i,n){if(e)for(let t of e){let r=_(t,i),l=r&&typeof r!="function"&&n.get(r);l&&v(t,l.name,i)}}function li(e,i){if(e!=null&&i?.fields?.length)if("startField"in e){let n=i.get(e.startField),t=i.get(e.endField);e.startField=n?.name??null,e.endField=t?.name??null}else{let n=i.get(e.startTimeField),t=i.get(e.endTimeField);e.startTimeField=n?.name??null,e.endTimeField=t?.name??null}}var w=new Set;function h(e,i){return e&&i?(w.clear(),m(w,e,i),Array.from(w).sort()):[]}function m(e,i,n){if(n)if(i?.fields?.length)if(n.includes("*"))for(let{name:t}of i.fields)e.add(t);else for(let t of n)y(e,i,t);else{if(n.includes("*"))return e.clear(),void e.add("*");for(let t of n)t!=null&&e.add(t)}}function y(e,i,n){if(typeof n=="string")if(i){let t=i.get(n);t&&e.add(t.name)}else e.add(n)}function ai(e,i){return i==null||e==null?[]:i.includes("*")?(e.fields??[]).map(n=>n.name):i}function si(e,i,n=1){if(!i||!e)return[];if(i.includes("*"))return["*"];let t=h(e,i);return t.length/e.fields.length>=n?["*"]:t}function d(e,i,n){return a(this,null,function*(){if(!n)return;let t,r=H(n);if(r)t=[r];else{let{arcadeUtils:l}=yield R();t=l.extractFieldNames(n,i?.fields?.map(u=>u.name))}for(let l of t)y(e,i,l)})}function S(e,i,n){return a(this,null,function*(){if(n&&n!=="1=1"){let t=yield L(n,i);if(!t.isStandardized)throw new A("fieldUtils:collectFilterFields","Where clause is not standardized",{where:n});m(e,i,t.fieldNames)}})}function oi({displayField:e,fields:i}){return e||(i?.length?E(i,"name-or-title")||E(i,"unique-identifier")||E(i,"type-or-category")||ce(i):null)}function ce(e){for(let i of e){if(!i?.name)continue;let n=i.name.toLowerCase();if(n.includes("name")||n.includes("title"))return i.name}return null}function E(e,i){for(let n of e)if(n?.valueType&&n.valueType===i)return n.name;return null}function ui(e,i){return a(this,null,function*(){if(!i)return;let n=i.elevationInfo?.featureExpressionInfo;return n?n.collectRequiredFields(e,i.fieldsIndex):void 0})}function fe(e,i,n){n.onStatisticExpression?d(e,i,n.onStatisticExpression.expression):e.add(n.onStatisticField)}function di(e,i,n){return a(this,null,function*(){if(!i||!n||!("fields"in n))return;let t=[],r=n.popupTemplate;t.push(X(e,i,r)),n.fields&&t.push(...n.fields.map(l=>a(this,null,function*(){return fe(e,i.fieldsIndex,l)}))),yield Promise.all(t)})}function ci(e,i){return a(this,null,function*(){let{fieldsIndex:n,trackInfo:t}=i;if(!i||!t||!n)return;let r=[t.latestObservations.renderer?.collectRequiredFields(e,n),t.previousObservations.renderer?.collectRequiredFields(e,n),t.trackLines.renderer?.collectRequiredFields(e,n)];t.popupTemplate&&r.push(X(e,i,t.popupTemplate));for(let l of[t.latestObservations.labelingInfo,t.previousObservations.labelingInfo,t.trackLines.labelingInfo])if(l)for(let u of l)r.push(B(e,n,u));yield Promise.all(r)})}function X(e,i,n){return a(this,null,function*(){let t=[];n?.expressionInfos&&t.push(...n.expressionInfos.map(l=>d(e,i.fieldsIndex,l.expression)));let r=n?.content;if(Array.isArray(r))for(let l of r)l.type==="expression"&&l.expressionInfo&&t.push(d(e,i.fieldsIndex,l.expressionInfo.expression));yield Promise.all(t)})}function fi(e,i,n){return a(this,null,function*(){i&&(i.timeInfo&&n?.timeExtent&&m(e,i.fieldsIndex,[i.timeInfo.startField,i.timeInfo.endField]),i.floorInfo&&m(e,i.fieldsIndex,[i.floorInfo.floorField]),n?.where!=null&&(yield S(e,i.fieldsIndex,n.where)))})}function mi(e,i,n){return a(this,null,function*(){i&&n&&(yield Promise.all(n.map(t=>me(e,i,t))))})}function me(e,i,n){return a(this,null,function*(){i&&n&&(n.valueExpression?yield d(e,i.fieldsIndex,n.valueExpression):n.field&&y(e,i.fieldsIndex,n.field))})}function pi(e){return e?h(e.fieldsIndex,j(e)):[]}function pe(e){if(!e)return[];let i=e.geometryFieldsInfo;return i?h(e.fieldsIndex,[i.shapeAreaField,i.shapeLengthField]):[]}function gi(e,i,n){return a(this,null,function*(){if(!i||!n)return;let t=i.fieldsIndex;yield Promise.all(n.filters.map(r=>S(e,t,r.where)))})}var ge=new Set(["oid","global-id","guid"]),ye=new Set(["oid","global-id"]),Fe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function Te(e){let i=new Set;q(e).forEach(t=>i.add(t)),pe(e).forEach(t=>i.add(t.toLowerCase()));let n=e&&"infoFor3D"in e?e.infoFor3D:void 0;return n&&(Object.values(n.assetMapFieldRoles).forEach(t=>i.add(t.toLowerCase())),Object.values(n.transformFieldRoles).forEach(t=>i.add(t.toLowerCase()))),Array.from(i)}function j(e){if(!e)return[];let i="editFieldsInfo"in e&&e.editFieldsInfo;if(!i)return[];let{creationDateField:n,creatorField:t,editDateField:r,editorField:l}=i;return[n,t,r,l].filter(Boolean)}function q(e){return j(e).map(i=>i.toLowerCase())}function yi(e,i){return e.editable&&!ge.has(e.type)&&!q(i).includes(e.name?.toLowerCase()??"")}function Fi(e,i){let n=e.name?.toLowerCase()??"";return!(i?.objectIdField!=null&&n===i.objectIdField.toLowerCase()||i?.globalIdField!=null&&n===i.globalIdField.toLowerCase()||Te(i).includes(n)||ye.has(e.type)||Fe.some(t=>t.test(n)))}function Ti(e,i){return a(this,null,function*(){let{labelingInfo:n,fieldsIndex:t}=i;n?.length&&(yield Promise.all(n.map(r=>B(e,t,r))))})}function B(e,i,n){return a(this,null,function*(){if(!n)return;let t=n.getLabelExpression(),r=n.where;if(t.type==="arcade")yield d(e,i,t.expression);else{let l=t.expression.match(/{[^}]*}/g);l&&l.forEach(u=>{y(e,i,u.slice(1,-1))})}yield S(e,i,r)})}function Ii(e){let i=e.defaultValue;return i!==void 0&&Q(e,i)?i:e.nullable?null:void 0}function bi(e){let i=typeof e=="string"?{type:e}:e;return Ne(i)?255:i.type==="esriFieldTypeDate"||i.type==="date"?8:void 0}function J(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function Ie(e){return e===null||J(e)}function be(e){return e===null||Number.isInteger(e)}function xe(){return!0}function Q(e,i){let n;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":n=e.nullable?be:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":n=e.nullable?Ie:J;break;case"string":case"esriFieldTypeString":n=e.nullable?M:o;break;default:n=xe}return arguments.length===1?n:n(i)}var W=["integer","small-integer","big-integer"],Y=["single","double"],xi=[...W,...Y],we=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],Ee=["esriFieldTypeSingle","esriFieldTypeDouble"],Z=new Set([...W,...we]),he=new Set([...Y,...Ee]),Se=c(Z,he);function wi(e){return e!=null&&Z.has(e.type)}function K(e){return e!=null&&Se.has(e.type)}function Ne(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function Ei(e){return e!=null&&(e.type==="date"||e.type==="esriFieldTypeDate")}function hi(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function Si(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function Ni(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}function Di(e){return e!=null&&(e.type==="oid"||e.type==="esriFieldTypeOID")}function Vi(e){return e!=null&&(e.type==="global-id"||e.type==="esriFieldTypeGlobalID")}function _i(e,i){return De(e,i)===null}var p,g;function vi(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function De(e,i){return e==null||e.nullable&&i===null?null:Q(e,i)?K(e)&&!Ve(e.type,Number(i))?p.OUT_OF_RANGE:null:g.INVALID_TYPE}function Ve(e,i){let n=typeof e=="string"?N(e):e;if(!n)return!1;let t=n.min,r=n.max;return n.isInteger?Number.isInteger(i)&&i>=t&&i<=r:i>=t&&i<=r}function Ai(e,i){return x(e,i)||(K(e)?N(e.type):void 0)}function N(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return _e;case"esriFieldTypeInteger":case"integer":return ve;case"esriFieldTypeBigInteger":case"big-integer":return Ae;case"esriFieldTypeSingle":case"single":return Oe;case"esriFieldTypeDouble":case"double":return Me}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(p||(p={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(g||(g={}));var _e={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},ve={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},Ae={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},Oe={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},Me={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function Oi(e,i,n){switch(e){case s.INVALID_CODED_VALUE:return`Value ${n} is not in the coded domain - field: ${i.name}, domain: ${JSON.stringify(i.domain)}`;case s.VALUE_OUT_OF_RANGE:return`Value ${n} is out of the range of valid values - field: ${i.name}, domain: ${JSON.stringify(i.domain)}`;case g.INVALID_TYPE:return`Value ${n} is not a valid value for the field type - field: ${i.name}, type: ${i.type}, nullable: ${i.nullable}`;case p.OUT_OF_RANGE:{let{min:t,max:r}=N(i.type);return`Value ${n} is out of range for the number type - field: ${i.name}, type: ${i.type}, value range is ${t} to ${r}`}}}function Mi(e,i){return!Le(e,i,null)}function Le(e,i,n){if(!i?.attributes||!e){if(n!=null)for(let l of e??[])n.add(l);return!0}let t=new Set(Object.keys(i.attributes)),r=!1;for(let l of e)if(!t.has(l)){if(r=!0,n==null)break;n.add(l)}return r}function Li(e){return!!e&&["raster.itempixelvalue","raster.servicepixelvalue"].some(i=>e.toLowerCase().startsWith(i))}function Ri(e,i){return a(this,null,function*(){let n=new Set;return e?.collectRequiredFields&&(yield e.collectRequiredFields(n,i)),Array.from(n).sort()})}function $i(e){let i=e?.match(/{[^}]+}/g);return i?i.map(n=>n.slice(1,-1).split(":")[0].trim()):[]}export{ke as a,ie as b,Ce as c,T as d,I as e,b as f,s as g,Xe as h,x as i,re as j,Be as k,ti as l,ri as m,li as n,h as o,m as p,y as q,ai as r,si as s,d as t,oi as u,ui as v,di as w,ci as x,fi as y,mi as z,pi as A,gi as B,q as C,yi as D,Fi as E,Ti as F,Ii as G,bi as H,wi as I,K as J,Ne as K,Ei as L,hi as M,Si as N,Ni as O,Di as P,Vi as Q,_i as R,p as S,g as T,vi as U,De as V,Ai as W,Oi as X,Mi as Y,Li as Z,Ri as _,$i as $};
