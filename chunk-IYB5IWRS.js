import{a as ue,c as le,d as ce,e as de}from"./chunk-MSPTOB4U.js";import{a as ie}from"./chunk-2NH7HOKA.js";import{a as pe}from"./chunk-QTLBGBE5.js";import{b as me}from"./chunk-CU2BECSO.js";import"./chunk-ONYJLWAD.js";import{a as W}from"./chunk-SOFEQ75M.js";import"./chunk-TKZJUAKL.js";import{a as H}from"./chunk-NPTPEVAF.js";import"./chunk-ZNPIBNGZ.js";import{a as k,b as K,d as Q}from"./chunk-32IGITEL.js";import{o as fe}from"./chunk-K4BZCJ7U.js";import{a as se,c as ae,d as $}from"./chunk-OI2D6VTT.js";import{a as re,c as oe,e as O,h as ne}from"./chunk-XIZXEWWA.js";import"./chunk-EDAGF7R6.js";import"./chunk-6EWMYOA7.js";import{e as M}from"./chunk-IDLNQPT7.js";import"./chunk-VRPEURU5.js";import{b as Y,c as C,d as R,k as Z,o as A,p as E,s as ee,t as te}from"./chunk-B57IWIA2.js";import"./chunk-JOGV3DWE.js";import{l as v}from"./chunk-HM5RIVQC.js";import"./chunk-ALCGI4NA.js";import"./chunk-NOQEJXLK.js";import{a as J,q as X}from"./chunk-DJW5LMRG.js";import"./chunk-QXXXCEV5.js";import"./chunk-QMKRRCM3.js";import"./chunk-TCGGI7DC.js";import"./chunk-ALWV3RJ2.js";import{a as _}from"./chunk-7C6Z24SS.js";import"./chunk-5WKDXHVH.js";import{c as N}from"./chunk-PTZYZULI.js";import"./chunk-KZKWOEFD.js";import"./chunk-7B2UKJ5N.js";import"./chunk-RSDQHAJX.js";import"./chunk-OGS2SUK5.js";import"./chunk-WNSGKHQ6.js";import{a as V}from"./chunk-J5MXC6AL.js";import{f as q}from"./chunk-RJWOVI3M.js";import"./chunk-IB2IUO7T.js";import"./chunk-MS3KE2OO.js";import{c as U}from"./chunk-NHSDW26F.js";import"./chunk-NMAGYK3Q.js";import"./chunk-GWBRHLNH.js";import"./chunk-XPRVY6JT.js";import"./chunk-7N3ZKWML.js";import"./chunk-E62WHYYG.js";import"./chunk-QDTU3MWT.js";import"./chunk-BCREO4Q5.js";import"./chunk-3SDSCSDJ.js";import"./chunk-I4M2OT5W.js";import"./chunk-NTVLK3P2.js";import"./chunk-WMQNRNIU.js";import"./chunk-HD52PWPC.js";import"./chunk-EIPVFA6F.js";import{g as D,r as S}from"./chunk-VOFKUGRY.js";import"./chunk-IG66NQHW.js";import"./chunk-ARRCN5K3.js";import"./chunk-JKNCWG7E.js";import"./chunk-F7VRLFCB.js";import"./chunk-ISSJ3A6Y.js";import"./chunk-VDKRSX77.js";import"./chunk-WUA6PW3I.js";import{F as G}from"./chunk-E57FTRWF.js";import"./chunk-U4J5SECU.js";import"./chunk-7EG726PT.js";import"./chunk-C7INQGWT.js";import{c as b}from"./chunk-WMHJC7XF.js";import"./chunk-NJEWDTYF.js";import"./chunk-N3SDOFND.js";import"./chunk-OVHPPCBL.js";import"./chunk-FNXQZPHT.js";import"./chunk-3TQOUBNU.js";import"./chunk-D2LVMNOU.js";import"./chunk-SNFOAZZQ.js";import"./chunk-QGVBCWUY.js";import{t as L}from"./chunk-HHDFN2GK.js";import"./chunk-47GHT6OF.js";import{a as P,b as z,f as h}from"./chunk-VTHXE323.js";function Te(e,t,r){let f=e.typedBuffer,i=e.typedBufferStride,o=t.typedBuffer,n=t.typedBufferStride,s=r?r.count:t.count,a=(r?.dstIndex??0)*i,c=(r?.srcIndex??0)*n;for(let l=0;l<s;++l){for(let u=0;u<9;++u)f[a+u]=o[c+u];a+=i,c+=n}}var Be=Object.freeze(Object.defineProperty({__proto__:null,copy:Te},Symbol.toStringTag,{value:"Module"}));function ve(e,t,r){let f=e.typedBuffer,i=e.typedBufferStride,o=t.typedBuffer,n=t.typedBufferStride,s=r?r.count:t.count,a=(r?.dstIndex??0)*i,c=(r?.srcIndex??0)*n;for(let l=0;l<s;++l){for(let u=0;u<16;++u)f[a+u]=o[c+u];a+=i,c+=n}}var we=Object.freeze(Object.defineProperty({__proto__:null,copy:ve},Symbol.toStringTag,{value:"Module"}));function he(e,t){xe(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function xe(e,t,r=3,f=r){let i=t.length/f,o=0,n=0;for(let s=0;s<i;++s)e[o]=t[n],e[o+1]=t[n+1],e[o+2]=t[n+2],o+=r,n+=f}function j(e,t,r,f,i){let o=e.typedBuffer,n=e.typedBufferStride,s=i?.count??e.count,a=(i?.dstIndex??0)*n;for(let c=0;c<s;++c)o[a]=t,o[a+1]=r,o[a+2]=f,a+=n}var be=Object.freeze(Object.defineProperty({__proto__:null,copy:xe,copyView:he,fill:j},Symbol.toStringTag,{value:"Module"}));function Se(e,t){ye(e.typedBuffer,t,e.typedBufferStride)}function ye(e,t,r=4){let f=t.typedBuffer,i=t.typedBufferStride,o=t.count,n=0,s=0;for(let a=0;a<o;++a)e[n]=f[s],e[n+1]=f[s+1],e[n+2]=f[s+2],e[n+3]=f[s+3],n+=r,s+=i}function T(e,t,r,f,i,o){let n=e.typedBuffer,s=e.typedBufferStride,a=o?.count??e.count,c=(o?.dstIndex??0)*s;for(let l=0;l<a;++l)n[c]=t,n[c+1]=r,n[c+2]=f,n[c+3]=i,c+=s}var Ve=Object.freeze(Object.defineProperty({__proto__:null,copy:ye,copyView:Se,fill:T},Symbol.toStringTag,{value:"Module"}));function x(e,t){return new e(new ArrayBuffer(t*e.ElementCount*ie(e.ElementType)))}function Mt(e,t,r){return h(this,null,function*(){let f=new ce(Me(r)),i=(yield pe(f,t,r,!0)).model,o=i.lods.shift(),n=new Map,s=new Map;i.textures.forEach((g,w)=>n.set(w,Re(g))),i.materials.forEach((g,w)=>s.set(w,Ae(g,n)));let a=Ce(o);for(let g of a.parts)Ee(a,g,s);let{position:c,normal:l,tangent:u,color:m,texCoord0:p}=a.vertexAttributes,d=M(e,r),F=e.spatialReference.isGeographic?M(e):d,I=fe({vertexAttributes:{position:c.typedBuffer,normal:l?.typedBuffer,tangent:u?.typedBuffer},vertexSpace:F,spatialReference:e.spatialReference},d,{allowBufferReuse:!0,sourceUnit:r?.unitConversionDisabled?void 0:"meters"});if(!I)throw new L("load-gltf-mesh:vertex-space-projection",`Failed to load mesh from glTF because we could not convert the vertex space from ${F.type} to ${d.type}`);return{transform:null,vertexSpace:d,components:a.components,spatialReference:e.spatialReference,vertexAttributes:new H(z(P({},I),{color:m?.typedBuffer,uv:p?.typedBuffer}))}})}function Me(e){let t=e?.resolveFile;return t?{busy:!1,request:(r,f,i)=>h(this,null,function*(){let o=t?.(r)??r;return(yield G(o,{responseType:f==="image"?"image":f==="binary"||f==="image+type"?"array-buffer":"json",signal:i?.signal,timeout:0})).data})}:null}function B(e,t){if(e==null)return"-";let r=e.typedBuffer;return`${b(t,r.buffer,()=>t.size)}/${r.byteOffset}/${r.byteLength}`}function _e(e){return e!=null?e.toString():"-"}function Ce(e){let t=0,r={color:!1,tangent:!1,normal:!1,texCoord0:!1},f=new Map,i=new Map,o=[];for(let n of e.parts){let{position:s,normal:a,color:c,tangent:l,texCoord0:u}=n.attributes,m=`
      ${B(s,f)}/
      ${B(a,f)}/
      ${B(c,f)}/
      ${B(l,f)}/
      ${B(u,f)}/
      ${_e(n.transform)}
    `,p=!1,d=b(i,m,()=>(p=!0,{start:t,length:s.count}));p&&(t+=s.count),a&&(r.normal=!0),c&&(r.color=!0),l&&(r.tangent=!0),u&&(r.texCoord0=!0),o.push({gltf:n,writeVertices:p,region:d})}return{vertexAttributes:{position:x(Z,t),normal:r.normal?x(C,t):null,tangent:r.tangent?x(R,t):null,color:r.color?x(E,t):null,texCoord0:r.texCoord0?x(Y,t):null},parts:o,components:[]}}function Re(e){return new k({data:(me(e.data),e.data),wrap:je(e.parameters.wrap)})}function Ae(e,t){let r=new V(Fe(e.color,e.opacity)),f=e.emissiveFactor?new V(Ie(e.emissiveFactor)):null,i=o=>o?new K({scale:o.scale?[o.scale[0],o.scale[1]]:[1,1],rotation:D(o.rotation??0),offset:o.offset?[o.offset[0],o.offset[1]]:[0,0]}):null;return new Q({color:r,colorTexture:t.get(e.colorTexture),normalTexture:t.get(e.normalTexture),emissiveColor:f,emissiveTexture:t.get(e.emissiveTexture),occlusionTexture:t.get(e.occlusionTexture),alphaMode:$e(e.alphaMode),alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,metallic:e.metallicFactor,roughness:e.roughnessFactor,metallicRoughnessTexture:t.get(e.metallicRoughnessTexture),colorTextureTransform:i(e.colorTextureTransform),normalTextureTransform:i(e.normalTextureTransform),occlusionTextureTransform:i(e.occlusionTextureTransform),emissiveTextureTransform:i(e.emissiveTextureTransform),metallicRoughnessTextureTransform:i(e.metallicRoughnessTextureTransform)})}function Ee(e,t,r){t.writeVertices&&Oe(e,t);let{indices:f,attributes:i,primitiveType:o,material:n}=t.gltf,s=de(f||i.position.count,o),a=t.region.start;if(a){let c=new Uint32Array(s);for(let l=0;l<s.length;l++)c[l]+=a;s=c}e.components.push(new W({name:t.gltf.name,faces:s,material:r.get(n),shading:i.normal?"source":"flat",trustSourceNormals:!0}))}function Oe(e,t){let{position:r,normal:f,tangent:i,color:o,texCoord0:n}=e.vertexAttributes,s=t.region.start,{attributes:a,transform:c}=t.gltf,l=a.position.count;if(re(r.slice(s,l),a.position,c),a.normal!=null&&f!=null){let u=X(_(),c),m=f.slice(s,l);oe(m,a.normal,u),S(u)&&ne(m,m)}else f!=null&&j(f,0,0,1,{dstIndex:s,count:l});if(a.tangent!=null&&i!=null){let u=J(_(),c),m=i.slice(s,l);se(m,a.tangent,u),S(u)&&ae(m,m)}else i!=null&&T(i,0,0,1,1,{dstIndex:s,count:l});if(a.texCoord0!=null&&n!=null?ue(n.slice(s,l),a.texCoord0):n!=null&&le(n,0,0,{dstIndex:s,count:l}),a.color!=null&&o!=null){let u=a.color,m=o.slice(s,l);if(u.elementCount===4)u instanceof R?$(m,u,1,255):(u instanceof E||u instanceof te)&&$(m,u,1/255,255);else{T(m,255,255,255,255);let p=A.fromTypedArray(m.typedBuffer,m.typedBufferStride);u instanceof C?O(p,u,1,255):(u instanceof A||u instanceof ee)&&O(p,u,1/255,255)}}else o!=null&&T(o.slice(s,l),255,255,255,255)}function $e(e){switch(e){case"OPAQUE":return"opaque";case"MASK":return"mask";case"BLEND":return"blend"}}function je(e){return{horizontal:ge(e.s),vertical:ge(e.t)}}function ge(e){switch(e){case v.CLAMP_TO_EDGE:return"clamp";case v.MIRRORED_REPEAT:return"mirror";case v.REPEAT:return"repeat"}}function y(e){return e**(1/q)*255}function Fe(e,t){return N(y(e[0]),y(e[1]),y(e[2]),t)}function Ie(e){return U(y(e[0]),y(e[1]),y(e[2]))}export{Mt as loadGLTFMesh};
