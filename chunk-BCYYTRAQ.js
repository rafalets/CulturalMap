import{a as T,b as y,c as b,d as C}from"./chunk-CU7B2I5A.js";import{a as m,b as f}from"./chunk-2ZKDDIFZ.js";import{a as V}from"./chunk-FHBFWDFD.js";import"./chunk-OYERMUCP.js";import{b as w}from"./chunk-QYRRGSBK.js";import"./chunk-6T37AWU6.js";import"./chunk-4AIH3WFI.js";import"./chunk-B5LBE5HD.js";import"./chunk-F6A6XWW4.js";import"./chunk-AESEF3B2.js";import"./chunk-PWU2QHPV.js";import"./chunk-WUJRCGDY.js";import"./chunk-QPGCDGIN.js";import"./chunk-LNVVFNTC.js";import"./chunk-HXMLP37S.js";import"./chunk-NHQ2XIW3.js";import"./chunk-MBE3KZ4V.js";import"./chunk-EWGQ3XHW.js";import"./chunk-YQPWWSMJ.js";import"./chunk-JEIB6WNP.js";import"./chunk-CVRJ6GOM.js";import"./chunk-X7QUUHRV.js";import"./chunk-7B2UKJ5N.js";import"./chunk-RSDQHAJX.js";import"./chunk-JR22Z7I2.js";import"./chunk-3QNSJ5HY.js";import"./chunk-UNVICPIE.js";import"./chunk-BGICKEJR.js";import"./chunk-TRZXSDYA.js";import"./chunk-OGS2SUK5.js";import"./chunk-TVHRLNTK.js";import"./chunk-JA3EMS2I.js";import"./chunk-HKHTIKVW.js";import"./chunk-XFESK2YB.js";import"./chunk-IJBTA53P.js";import"./chunk-ZHUXSQTN.js";import"./chunk-YLZWDFCJ.js";import"./chunk-TLMADEUL.js";import"./chunk-WNSGKHQ6.js";import"./chunk-J5MXC6AL.js";import"./chunk-OLOKUDVI.js";import"./chunk-RJWOVI3M.js";import"./chunk-MDL4XPLR.js";import"./chunk-AZS4Q4RE.js";import"./chunk-QEBUS3TL.js";import"./chunk-NHSDW26F.js";import"./chunk-WAGBL553.js";import"./chunk-J372WZPB.js";import"./chunk-6XFS4U2F.js";import"./chunk-XPRVY6JT.js";import"./chunk-7N3ZKWML.js";import"./chunk-E62WHYYG.js";import"./chunk-QDTU3MWT.js";import"./chunk-BCREO4Q5.js";import"./chunk-3SDSCSDJ.js";import"./chunk-I4M2OT5W.js";import"./chunk-NTVLK3P2.js";import"./chunk-WMQNRNIU.js";import"./chunk-HD52PWPC.js";import"./chunk-EIPVFA6F.js";import"./chunk-VOFKUGRY.js";import"./chunk-IG66NQHW.js";import"./chunk-ARRCN5K3.js";import{c as _}from"./chunk-7ZYPJJID.js";import{g as l,h as A}from"./chunk-UAKHZRKN.js";import"./chunk-HAHX77IL.js";import{a as I}from"./chunk-IXCTZWTQ.js";import"./chunk-6PN3I333.js";import"./chunk-ZTJLFKGG.js";import"./chunk-5TW726OD.js";import"./chunk-VGD3XLDH.js";import"./chunk-LB5YQINJ.js";import"./chunk-EKMHQEJY.js";import"./chunk-VACZNAP3.js";import"./chunk-JKNCWG7E.js";import"./chunk-SLAWDKDA.js";import"./chunk-KTE5HCNJ.js";import"./chunk-F7VRLFCB.js";import"./chunk-7IPIJKWU.js";import"./chunk-7R33MKVL.js";import"./chunk-ISSJ3A6Y.js";import"./chunk-VDKRSX77.js";import"./chunk-WUA6PW3I.js";import"./chunk-E57FTRWF.js";import"./chunk-U4J5SECU.js";import"./chunk-7EG726PT.js";import{d as a}from"./chunk-C7INQGWT.js";import{H as F}from"./chunk-WMHJC7XF.js";import"./chunk-NJEWDTYF.js";import"./chunk-N3SDOFND.js";import"./chunk-OVHPPCBL.js";import"./chunk-FNXQZPHT.js";import"./chunk-3TQOUBNU.js";import"./chunk-D2LVMNOU.js";import"./chunk-SNFOAZZQ.js";import{a as n}from"./chunk-QGVBCWUY.js";import{o as h}from"./chunk-HHDFN2GK.js";import"./chunk-47GHT6OF.js";import"./chunk-5RWLLGQU.js";import{f as M}from"./chunk-VTHXE323.js";var v,L="esri-feature-utility-network-associations",E={base:L,listItemHidden:`${L}__list-item--hidden`},k="nested",r=v=class extends T{constructor(e,t){super(e,t),this.description=null,this.flowItems=null,this.flowType="feature-utility-network-association-type",this.listType=null,this.parentFeatureViewModel=null,this.title=null,this.viewModel=new f,this.visibleElements=new m}initialize(){this.setUpObserver()}loadDependencies(){return _({chip:()=>import("./chunk-KUULEAF3.js"),icon:()=>import("./chunk-QXDSJABL.js"),list:()=>import("./chunk-QV3363IT.js"),"list-item":()=>import("./chunk-PXFXZ5UQ.js"),tooltip:()=>import("./chunk-65CNKD3K.js")})}destroy(){this.tooltipReferenceMap.clear()}render(){let e=this.viewModel.associationViewModels,{state:t,showAllEnabled:s}=this.viewModel,{state:i}=this.parentFeatureViewModel??{};return l("div",{class:this.classes(E.base,V.widget)},t==="loading"||t==="querying"||i==="loading"?this.renderLoading():l("calcite-list",{displayMode:k,label:this.selectedLayer?.title??this.messagesCommon.untitled},s&&this.selectedLayer?l(A,null,this.renderFilter(),this.renderFeatureCountWarning(),this._renderAssociatedFeatureListPage(),this.renderFeatureObserver()):Array.from(e.keys(),o=>this._renderTypeList(o,e.get(o)))))}_showAllAssociations(e){let{flowItems:t,viewModel:s,description:i}=this;if(!t||!e)return;s.showAllEnabled=!0;let o=new v({selectedLayer:e,title:e?.title,flowItems:t,parentFeatureViewModel:this.parentFeatureViewModel,featureVisibleElements:this.featureVisibleElements,description:i,visibleElements:new m({title:!1,description:!1}),viewModel:s});t.push(o)}_renderAssociatedFeatureListPage(){let e=this.viewModel.associationViewModels.get(this.selectedLayer).filter(t=>w(t.featureViewModel).toLowerCase().includes(this.filterText)).slice(0,this.endIndex);return[...this._renderTooltips(e),...this._renderAssociatedFeatureList(e)]}_renderItemTooltip(e){let{tooltipReferenceMap:t}=this;return b(e.association)?l("calcite-tooltip",{key:`tooltip-${e.featureViewModel.uid}`,overlayPositioning:"fixed",referenceElement:t.get(e.featureViewModel.uid)},this.getConnectivityTooltip(e.association.associationType)):null}_renderAssociatedFeature(e){let{featureViewModel:t}=e,s=w(t),i=t.state==="loading",o=this._findFlowItem(t),d=o<0&&this._isParentFeature(t),p=d||o>=0;return l("calcite-list-item",{class:i?E.listItemHidden:void 0,description:h(e.terminalName??""),key:`associated-feature-type-${t.uid}`,label:h(s),onCalciteListItemSelect:()=>this._handleFeatureClick(d,o,t)},b(e.association)?this.renderConnectivityIcon(e.association.associationType,e.featureViewModel.uid):null,C(e.association)?l("calcite-chip",{label:y(e.association),scale:"s",slot:"content-end"},y(e.association)):null,this._renderChevronIconNode(p))}_selectAssociation(e){return M(this,null,function*(){let{flowItems:t,featureVisibleElements:s}=this;if(!t)return;e.abilities={utilityNetworkAssociationsContent:!0};let{default:i}=yield import("./chunk-QGB7PDCM.js");t.push(new i({flowItems:t,flowType:"feature-association",viewModel:e,visibleElements:s}))})}_handleFeatureClick(e,t,s){if(e)this.flowItems.drain(i=>{"showAllEnabled"in i.viewModel&&(i.viewModel.showAllEnabled=!1),i.viewModel=null,i.destroy()});else if(t<0||!this.flowItems)this._selectAssociation(s);else for(;this.flowItems.length>t+1;){let i=this.flowItems.pop();i&&("showAllEnabled"in i.viewModel&&(i.viewModel.showAllEnabled=!1),i.viewModel=null,i.destroy())}}_featureViewModelMatch(e,t){let s=e.graphic,i=s?.layer,o=null;i?.type==="subtype-sublayer"&&i.parent?o=i.parent.globalIdField??null:i&&"globalIdField"in i&&(o=i.globalIdField);let d=o?s?.attributes[o]:null,p=t.graphic,c=p?.layer,u=null;c?.type==="subtype-sublayer"&&c.parent?u=c.parent.globalIdField??null:c&&"globalIdField"in c&&(u=c.globalIdField);let g=u?p?.attributes[u]:null;return d&&g&&d===g}_isParentFeature(e){let t=this.flowItems?.getItemAt(0);if(!t)return!1;let s=t.parentFeatureViewModel;return this._featureViewModelMatch(s,e)}_findFlowItem(e){return this.flowItems?.findIndex(t=>{if(t.flowType!=="feature-association")return!1;let s=t.viewModel;return this._featureViewModelMatch(s,e)})??-1}_renderTooltips(e){return e.toArray().map(t=>this._renderItemTooltip(t))}_renderAssociatedFeatureList(e){return e.toArray().map(t=>this._renderAssociatedFeature(t))}_renderChevronIconNode(e){return l("calcite-icon",{flipRtl:!0,icon:e?"move-up":"chevron-right",scale:"s",slot:"content-end"})}_renderTypeList(e,t){let{messagesFeature:s}=this,{displayCount:i}=this.viewModel,o=t.slice(0,i),d=o.length<t.length;return l("calcite-list-item",{key:"show-all",label:e.title,open:!0,value:e.id},l("calcite-chip",{label:String(t.length),scale:"s",slot:"content-end"},t.length),l("calcite-list",{group:e.id,label:e.title??""},[this._renderTooltips(o),this._renderAssociatedFeatureList(o)],d?l("calcite-list-item",{description:I(s?.numberRecords,{number:t.length.toString()}),key:"show-all-item",label:s.showAll,onCalciteListItemSelect:()=>this._showAllAssociations(e)},l("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})):null))}};n([a()],r.prototype,"description",void 0),n([a()],r.prototype,"featureVisibleElements",void 0),n([a()],r.prototype,"flowItems",void 0),n([a()],r.prototype,"flowType",void 0),n([a()],r.prototype,"listType",void 0),n([a()],r.prototype,"parentFeatureViewModel",void 0),n([a()],r.prototype,"title",void 0),n([a({type:f})],r.prototype,"viewModel",void 0),n([a({type:m,nonNullable:!0})],r.prototype,"visibleElements",void 0),r=v=n([F("esri.widgets.Feature.FeatureUtilityNetworkAssociationList")],r);var Y=r;export{Y as default};
