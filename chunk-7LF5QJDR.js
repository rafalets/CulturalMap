import{c as S,e as q,f as O,g as A,h as P,s as d,t as V,w as j}from"./chunk-3ZANJLLA.js";import{a as m}from"./chunk-4E4FE2IX.js";import{a as z}from"./chunk-O4PKXMAM.js";import{a as h,e as x,g as b}from"./chunk-LNVVFNTC.js";import{a as T,b as w,e as N,i as F}from"./chunk-I4M2OT5W.js";import{F as G}from"./chunk-IG66NQHW.js";import{t as R}from"./chunk-HHDFN2GK.js";import{f}from"./chunk-VTHXE323.js";var Z=new m,Y=new m,M=new m,E={esriGeometryPoint:S,esriGeometryPolyline:O,esriGeometryPolygon:A,esriGeometryMultipoint:q};function st(t,e,r,i=t.hasZ,s=t.hasM){if(e==null)return null;let o=t.hasZ&&i,n=t.hasM&&s;if(r){let l=d(M,e,t.hasZ,t.hasM,"esriGeometryPoint",r,i,s);return S(l,o,n)}return S(e,o,n)}function y(t,e,r,i,s,o,n=e,l=r){let u=e&&n,a=r&&l,p=i!=null?"coords"in i?i:i.geometry:null;if(p==null)return null;if(s){let c=V(Y,p,e,r,t,s,n,l);return o&&(c=d(M,c,u,a,t,o)),E[t]?.(c,u,a)??null}if(o){let c=d(M,p,e,r,t,o,n,l);return E[t]?.(c,u,a)??null}return j(Z,p,e,r,n,l),E[t]?.(Z,u,a)??null}function lt(t){return t&&J in t?JSON.parse(JSON.stringify(t,B)):t}var J="_geVersion",B=(t,e)=>t===J?void 0:e;function Q(t){return t==="mesh"?N:F(t)}function U(t,e){return t?e?4:3:e?3:2}function W(t,e,r,i){return k(t,e,r,i.coords[0],i.coords[1])}function _(t,e,r,i,s,o){let n=U(s,o),{coords:l,lengths:u}=i;if(!u)return!1;for(let a=0,p=0;a<u.length;a++,p+=n)if(!k(t,e,r,l[p],l[p+1]))return!1;return!0}function k(t,e,r,i,s){if(!t)return!1;let o=U(e,r),{coords:n,lengths:l}=t,u=!1,a=0;for(let p of l)u=$(u,n,o,a,p,i,s),a+=p*o;return u}function $(t,e,r,i,s,o,n){let l=t,u=i;for(let a=i,p=i+s*r;a<p;a+=r){u=a+r,u===p&&(u=i);let c=e[a],g=e[a+1],D=e[u],I=e[u+1];(g<n&&I>=n||I<n&&g>=n)&&c+(n-g)/(I-g)*(D-c)<o&&(l=!l)}return l}var C="unsupported-query",v={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function H(t){return t!=null&&v.spatialRelationship[t]===!0}function K(t){return t!=null&&v.queryGeometry[b(t)]===!0}function L(t){return t!=null&&v.layerGeometry[t]===!0}var X={esriSpatialRelIntersects:()=>import("./chunk-RGJUSX7E.js"),esriSpatialRelContains:()=>import("./chunk-UAXRUPRP.js"),esriSpatialRelCrosses:()=>import("./chunk-2APL24TY.js"),esriSpatialRelDisjoint:()=>import("./chunk-I3BQF6NM.js"),esriSpatialRelEnvelopeIntersects:null,esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:()=>import("./chunk-AOKZQPM2.js"),esriSpatialRelTouches:()=>import("./chunk-DX2NZ3GY.js"),esriSpatialRelWithin:()=>import("./chunk-XVVNXHMD.js"),esriSpatialRelRelation:null};function tt(t){let e=X[t];if(e==null)throw new Error(`Cannot load unsupported spatial operator: ${t}`);return e()}function wt(t,e,r,i,s){return f(this,null,function*(){if(x(e)){if(r==="esriGeometryPoint"&&(t==="esriSpatialRelIntersects"||t==="esriSpatialRelContains")){let n=P(new m,e,!1,!1);return l=>W(n,!1,!1,l)}if(r==="esriGeometryMultipoint"){let n=P(new m,e,!1,!1);if(t==="esriSpatialRelContains")return l=>_(n,!1,!1,l,i,s)}}if(h(e)){if(r==="esriGeometryPoint"&&(t==="esriSpatialRelIntersects"||t==="esriSpatialRelContains"))return n=>T(e,y(r,i,s,n));if(r==="esriGeometryMultipoint"&&t==="esriSpatialRelContains")return n=>w(e,y(r,i,s,n));if(t==="esriSpatialRelIntersects"){let n=Q(r);return l=>n(e,y(r,i,s,l))}}t==="esriSpatialRelEnvelopeIntersects"&&(t="esriSpatialRelIntersects");let o=yield tt(t);return n=>o.execute(e,y(r,i,s,n))})}function Nt(t,e,r){return f(this,null,function*(){let{spatialRel:i,geometry:s}=t;if(s){if(!H(i))throw new R(C,"Unsupported query spatial relationship",{query:t});if(G(s.spatialReference)&&G(r)){if(!K(s))throw new R(C,"Unsupported query geometry type",{query:t});if(!L(e))throw new R(C,"Unsupported layer geometry type",{query:t});if(t.outSR)return z(t.geometry?.spatialReference,t.outSR)}}})}function Ft(t){if(h(t))return!0;if(x(t)){for(let e of t.rings)if(e.length!==5||e[0][0]!==e[1][0]||e[0][0]!==e[4][0]||e[2][0]!==e[3][0]||e[0][1]!==e[3][1]||e[0][1]!==e[4][1]||e[1][1]!==e[2][1])return!1;return!0}return!1}function Vt(t,e){return f(this,null,function*(){if(!t)return null;let r=e.featureAdapter,{startTimeField:i,endTimeField:s}=t,o=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;if(i&&s)yield e.forEach(l=>{let u=r.getAttribute(l,i),a=r.getAttribute(l,s);u==null||isNaN(u)||(o=Math.min(o,u)),a==null||isNaN(a)||(n=Math.max(n,a))});else{let l=i||s;yield e.forEach(u=>{let a=r.getAttribute(u,l);a==null||isNaN(a)||(o=Math.min(o,a),n=Math.max(n,a))})}return{start:o,end:n}})}function jt(t,e,r){if(!e||!t)return null;let{startTimeField:i,endTimeField:s}=t;if(!i&&!s)return null;let{start:o,end:n}=e;if(o===null&&n===null)return null;if(o===void 0&&n===void 0)return nt();let l=r.getAttributeAsTimestamp?.bind(r)??r.getAttribute.bind(r);return i&&s?et(l,i,s,o,n):rt(l,i||s,o,n)}function et(t,e,r,i,s){return i!=null&&s!=null?o=>{let n=t(o,e),l=t(o,r);return(n==null||n<=s)&&(l==null||l>=i)}:i!=null?o=>{let n=t(o,r);return n==null||n>=i}:s!=null?o=>{let n=t(o,e);return n==null||n<=s}:void 0}function rt(t,e,r,i){return r!=null&&i!=null&&r===i?s=>t(s,e)===r:r!=null&&i!=null?s=>{let o=t(s,e);return o!=null&&o>=r&&o<=i}:r!=null?s=>{let o=t(s,e);return o!=null&&o>=r}:i!=null?s=>{let o=t(s,e);return o!=null&&o<=i}:void 0}function nt(){return()=>!1}export{st as a,y as b,lt as c,wt as d,Nt as e,Ft as f,Vt as g,jt as h};
