import{a as h,b as _,c as Q,d as q,e as ue,f as fe,n as pe,o as we,p as de,q as he,r as me,s as ge,t as ye}from"./chunk-45C7GL67.js";import{a as be}from"./chunk-TDUDFO2U.js";import"./chunk-TILBGQXL.js";import"./chunk-GW75YXIH.js";import"./chunk-6AEGO2CB.js";import"./chunk-2U6QECGD.js";import"./chunk-AXQERSA6.js";import{b as X}from"./chunk-DOYPD6O7.js";import"./chunk-EPMRM7KB.js";import{c as S}from"./chunk-4RDCETCH.js";import{D as $,G as le,H as L,J as O,M as p,P as se,_ as ce,a as te,b as ie,c as z,d as G,e as U,h as y,i as Z,j as w,k as b,l as E,n as v,r as H,s as Y,u as J,w as B,z as N}from"./chunk-MARRSUOJ.js";import"./chunk-IB6IQS7A.js";import"./chunk-LVYFLVM5.js";import"./chunk-3ZANJLLA.js";import"./chunk-7QY3BMVN.js";import"./chunk-WPDP647R.js";import"./chunk-4E4FE2IX.js";import"./chunk-5SSISWTF.js";import"./chunk-WH2SG675.js";import{a as i,b as l,e as T}from"./chunk-LWVUOW7N.js";import"./chunk-7EKEC7JO.js";import"./chunk-OCNYIIP3.js";import"./chunk-2ILDS6SI.js";import"./chunk-FVILOOND.js";import"./chunk-EBK2L6ZQ.js";import"./chunk-F6A6XWW4.js";import"./chunk-AESEF3B2.js";import"./chunk-LNVVFNTC.js";import"./chunk-TRZXSDYA.js";import"./chunk-HKHTIKVW.js";import"./chunk-XFESK2YB.js";import"./chunk-IJBTA53P.js";import"./chunk-WNSGKHQ6.js";import"./chunk-AZS4Q4RE.js";import"./chunk-QEBUS3TL.js";import"./chunk-VDADRLEF.js";import"./chunk-X5AA4JDN.js";import{a as R,c as k,d,f as C,g as ae}from"./chunk-J372WZPB.js";import"./chunk-6XFS4U2F.js";import"./chunk-XPRVY6JT.js";import"./chunk-7N3ZKWML.js";import"./chunk-E62WHYYG.js";import"./chunk-QDTU3MWT.js";import"./chunk-BCREO4Q5.js";import"./chunk-3SDSCSDJ.js";import"./chunk-I4M2OT5W.js";import{a as W}from"./chunk-NTVLK3P2.js";import{a as j}from"./chunk-WMQNRNIU.js";import"./chunk-HD52PWPC.js";import"./chunk-EIPVFA6F.js";import"./chunk-VOFKUGRY.js";import"./chunk-IG66NQHW.js";import"./chunk-ARRCN5K3.js";import"./chunk-IXCTZWTQ.js";import"./chunk-6PN3I333.js";import"./chunk-ZTJLFKGG.js";import"./chunk-5TW726OD.js";import"./chunk-VGD3XLDH.js";import"./chunk-SLAWDKDA.js";import"./chunk-KTE5HCNJ.js";import"./chunk-F7VRLFCB.js";import"./chunk-7IPIJKWU.js";import"./chunk-7R33MKVL.js";import"./chunk-ISSJ3A6Y.js";import"./chunk-VDKRSX77.js";import"./chunk-WUA6PW3I.js";import"./chunk-E57FTRWF.js";import"./chunk-U4J5SECU.js";import"./chunk-7EG726PT.js";import"./chunk-C7INQGWT.js";import"./chunk-WMHJC7XF.js";import"./chunk-NJEWDTYF.js";import"./chunk-N3SDOFND.js";import"./chunk-OVHPPCBL.js";import"./chunk-FNXQZPHT.js";import"./chunk-3TQOUBNU.js";import"./chunk-D2LVMNOU.js";import"./chunk-SNFOAZZQ.js";import"./chunk-QGVBCWUY.js";import"./chunk-HHDFN2GK.js";import"./chunk-47GHT6OF.js";import{f}from"./chunk-VTHXE323.js";function ne(r,e){return f(this,null,function*(){let n=[];for(let o=0;o<e.arguments.length;o++)n.push(yield u(r,e.arguments[o]));return n})}function M(r,e,n){return f(this,null,function*(){return e.preparsed===!0?n(r,null,e.arguments):n(r,e,yield ne(r,e))})}var re=class extends ie{constructor(e,n){super(),this.definition=null,this.context=null,this.definition=e,this.context=n}createFunction(e){return(...n)=>{let o={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:e.depthCounter+1},globalScope:this.context.globalScope};if(o.depthCounter.depth>64)throw new l(e,i.MaximumCallDepth,null);return ee(this.definition,o,n,null)}}call(e,n){return K(e,n,(o,a,t)=>{let s={spatialReference:e.spatialReference,services:e.services,console:e.console,libraryResolver:e.libraryResolver,exports:e.exports,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1}};if(s.depthCounter.depth>64)throw new l(e,i.MaximumCallDepth,n);return ee(this.definition,s,t,n)})}marshalledCall(e,n,o,a){return a(e,n,(t,s,c)=>f(this,null,function*(){let F={spatialReference:e.spatialReference,globalScope:o.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,abortSignal:e.abortSignal,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{}};return c=c.map(x=>!v(x)||x instanceof U?x:z(x,e,a)),z(yield ee(this.definition,F,c,n),o,a)}))}},A=class extends te{constructor(e){super(),this.source=e}global(e){let n=this.executingContext.globalScope[h(e)];if(v(n.value)&&!(n.value instanceof U)){let o=new U;o.fn=n.value,o.parameterEvaluator=K,o.context=this.executingContext,n.value=o}return n.value}setGlobal(e,n){if(v(n))throw new l(null,i.AssignModuleFunction,null);this.executingContext.globalScope[h(e)]={value:n}}hasGlobal(e){return this.executingContext.exports[e]===void 0&&(e=h(e)),this.executingContext.exports[e]!==void 0}loadModule(e){return f(this,null,function*(){let n=e.spatialReference;n==null&&(n=new j({wkid:102100})),this.moduleScope=ke({},e.customfunctions,e.timeZone),this.executingContext={spatialReference:n,services:e.services,libraryResolver:new _(e.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:e.abortSignal===void 0||e.abortSignal===null?{aborted:!1}:e.abortSignal,globalScope:this.moduleScope,console:e.console??Ae,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},yield oe(this.executingContext,this.source.syntax)})}};function K(r,e,n){return f(this,null,function*(){return e.preparsed===!0?n(r,null,e.arguments):n(r,e,yield ne(r,e))})}function u(r,e){return f(this,null,function*(){e.breakpoint&&(yield e.breakpoint());try{switch(e.type){case"UpdateExpression":return yield Ke(r,e);case"AssignmentExpression":return yield Ge(r,e);case"TemplateLiteral":return yield Je(r,e);case"Identifier":return V(r,e);case"MemberExpression":return yield We(r,e);case"Literal":return e.value;case"CallExpression":return yield Ye(r,e);case"UnaryExpression":return yield Te(r,e);case"BinaryExpression":return yield ze(r,e);case"LogicalExpression":return yield He(r,e);case"ArrayExpression":return yield _e(r,e);case"ObjectExpression":return yield Re(r,e);default:throw new l(r,i.Unrecognized,e)}}catch(n){throw T(r,e,n)}})}function g(r,e){return f(this,null,function*(){e.breakpoint&&(yield e.breakpoint());try{switch(e.type){case"ImportDeclaration":return yield Pe(r,e);case"ExportNamedDeclaration":return yield Ve(r,e);case"VariableDeclaration":return yield Fe(r,e,0);case"BlockStatement":return yield oe(r,e);case"FunctionDeclaration":return yield qe(r,e);case"ReturnStatement":return yield Le(r,e);case"IfStatement":return yield Ze(r,e);case"ExpressionStatement":return yield Ue(r,e);case"ForStatement":return yield Ne(r,e);case"WhileStatement":return yield Ce(r,e);case"ForInStatement":return yield Be(r,e);case"ForOfStatement":return yield De(r,e);case"BreakStatement":return b;case"EmptyStatement":return w;case"ContinueStatement":return E;default:throw new l(r,i.Unrecognized,e)}}catch(n){throw T(r,e,n)}})}function Re(r,e){return f(this,null,function*(){let n=[];for(let s=0;s<e.properties.length;s++){let c=e.properties[s],F=yield u(r,c.value),x=c.key.type==="Identifier"?c.key.name:yield u(r,c.key);n[s]={key:x,value:F}}let o={},a=new Map;for(let s=0;s<n.length;s++){let c=n[s];if(v(c.value))throw new l(r,i.NoFunctionInDictionary,e);if(d(c.key)===!1)throw new l(r,i.KeyMustBeString,e);let F=c.key.toString(),x=F.toLowerCase();a.has(x)?F=a.get(x):a.set(x,F),c.value===w?o[F]=null:o[F]=c.value}let t=new S(o);return t.immutable=!1,t})}function Ce(r,e){return f(this,null,function*(){let n=yield u(r,e.test);if(n===!1)return w;if(n!==!0)throw new l(r,i.BooleanConditionRequired,e);for(;n===!0;){let o=yield g(r,e.body);if(o===b)break;if(o instanceof y)return o;if(n=yield u(r,e.test),n!==!0&&n!==!1)throw new l(r,i.BooleanConditionRequired,e)}return w})}function Ne(r,e){return f(this,null,function*(){try{for(e.init!==null&&(e.init.type==="VariableDeclaration"?yield g(r,e.init):yield u(r,e.init));;){if(e.test!==null){let o=yield u(r,e.test);if(r.abortSignal?.aborted===!0)throw new l(r,i.Cancelled,e);if(o===!1)break;if(o!==!0)throw new l(r,i.BooleanConditionRequired,e)}let n=yield g(r,e.body);if(n===b)break;if(n instanceof y)return n;e.update!==null&&(yield u(r,e.update))}return w}catch(n){throw n}})}function P(r,e,n,o,a="i"){return f(this,null,function*(){let t=n.length;for(let s=0;s<t;s++){if(a==="k"){if(s>=n.length)throw new l(r,i.OutOfBounds,e);o.value=n[s]}else o.value=s;let c=yield g(r,e.body);if(c===b)break;if(c instanceof y)return c}return w})}function ve(r,e,n,o,a="i"){return f(this,null,function*(){let t=n.length();for(let s=0;s<t;s++){o.value=a==="k"?n.get(s):s;let c=yield g(r,e.body);if(c===b)break;if(c instanceof y)return c}return w})}function Se(r,e,n,o){return f(this,null,function*(){let a=n.iterator(r.abortSignal),t;for(;(t=yield a.next())!=null;){let s=X.createFromGraphicLikeObject(t.geometry,t.attributes,n,r.timeZone);s._underlyingGraphic=t,o.value=s;let c=yield g(r,e.body);if(c===b)break;if(c instanceof y)return c}return w})}function Oe(r,e,n,o){return f(this,null,function*(){for(let a of n.keys()){let t=n.field(a);o.value=new S({key:a,value:t});let s=yield g(r,e.body);if(s===b)break;if(s instanceof y)return s}return w})}function Ee(r,e,n,o){return f(this,null,function*(){for(let a of Q(n)){let t=q(n,a,r,e,1);o.value=new S({key:a,value:t});let s=yield g(r,e.body);if(s===b)break;if(s instanceof y)return s}return w})}function Be(r,e){return f(this,null,function*(){let n=yield u(r,e.right);e.left.type==="VariableDeclaration"&&(yield g(r,e.left));let o=h(e.left.type==="VariableDeclaration"?e.left.declarations[0].id:e.left),a=null;if(r.localScope!=null&&r.localScope[o]!==void 0&&(a=r.localScope[o]),a===null&&r.globalScope[o]!==void 0&&(a=r.globalScope[o]),a===null)throw new l(r,i.InvalidIdentifier,e);return C(n)||d(n)?yield P(r,e,n,a):N(n)?yield ve(r,e,n,a):n instanceof S||B(n)?yield P(r,e,n.keys(),a,"k"):J(n)?yield Se(r,e,n,a):H(n)?yield P(r,e,Q(n),a,"k"):w})}function De(r,e){return f(this,null,function*(){let n=yield u(r,e.right);e.left.type==="VariableDeclaration"&&(yield g(r,e.left));let o=h(e.left.type==="VariableDeclaration"?e.left.declarations[0].id:e.left),a=null;if(r.localScope!=null&&r.localScope[o]!==void 0&&(a=r.localScope[o]),a===null&&r.globalScope[o]!==void 0&&(a=r.globalScope[o]),a===null)throw new l(r,i.InvalidIdentifier,e);return C(n)||d(n)?yield P(r,e,n,a,"k"):N(n)?yield ve(r,e,n,a,"k"):n instanceof S||B(n)?yield Oe(r,e,n,a):J(n)?yield Se(r,e,n,a):H(n)?yield Ee(r,e,n,a):w})}function Ke(r,e){return f(this,null,function*(){let n=e.argument;if(n.type==="CallExpression")throw new l(r,i.NeverReach,e);if(n.type==="MemberExpression"){let t=yield u(r,n.object),s,c;if(n.computed===!0)s=yield u(r,n.property);else{if(n.property.type!=="Identifier")throw new l(r,i.Unrecognized,e);s=n.property.name}if(C(t)){if(!R(s))throw new l(r,i.ArrayAccessorMustBeNumber,e);if(s<0&&(s=t.length+s),s<0||s>=t.length)throw new l(r,i.OutOfBounds,e);c=p(t[s]),t[s]=e.operator==="++"?c+1:c-1}else if(t instanceof S){if(d(s)===!1)throw new l(r,i.KeyAccessorMustBeString,e);if(t.hasField(s)!==!0)throw new l(r,i.FieldNotFound,e,{key:s});c=p(t.field(s)),t.setField(s,e.operator==="++"?c+1:c-1)}else if(t instanceof A){if(d(s)===!1)throw new l(r,i.ModuleAccessorMustBeString,e);if(t.hasGlobal(s)!==!0)throw new l(r,i.ModuleExportNotFound,e);c=p(t.global(s)),t.setGlobal(s,e.operator==="++"?c+1:c-1)}else{if(!Y(t))throw N(t)?new l(r,i.Immutable,e):new l(r,i.InvalidParameter,e);if(d(s)===!1)throw new l(r,i.KeyAccessorMustBeString,e);if(t.hasField(s)!==!0)throw new l(r,i.FieldNotFound,e,{key:s});c=p(t.field(s)),t.setField(s,e.operator==="++"?c+1:c-1)}return e.prefix===!1?c:e.operator==="++"?c+1:c-1}let o=h(n),a;if(r.localScope!=null&&r.localScope[o]!==void 0)return a=p(r.localScope[o].value),r.localScope[o]={value:e.operator==="++"?a+1:a-1},e.prefix===!1?a:e.operator==="++"?a+1:a-1;if(r.globalScope[o]!==void 0)return a=p(r.globalScope[o].value),r.globalScope[o]={value:e.operator==="++"?a+1:a-1},e.prefix===!1?a:e.operator==="++"?a+1:a-1;throw new l(r,i.InvalidIdentifier,e)})}function I(r,e,n,o,a){switch(e){case"=":return r===w?null:r;case"/=":return p(n)/p(r);case"*=":return p(n)*p(r);case"-=":return p(n)-p(r);case"+=":return d(n)||d(r)?O(n)+O(r):p(n)+p(r);case"%=":return p(n)%p(r);default:throw new l(a,i.UnsupportedOperator,o)}}function Ge(r,e){return f(this,null,function*(){let n=e.left;if(n.type==="MemberExpression"){let a=yield u(r,n.object),t;if(n.computed===!0)t=yield u(r,n.property);else{if(n.property.type!=="Identifier")throw new l(r,i.InvalidIdentifier,e);t=n.property.name}let s=yield u(r,e.right);if(C(a)){if(!R(t))throw new l(r,i.ArrayAccessorMustBeNumber,e);if(t<0&&(t=a.length+t),t<0||t>a.length)throw new l(r,i.OutOfBounds,e);if(t===a.length){if(e.operator!=="=")throw new l(r,i.OutOfBounds,e);a[t]=I(s,e.operator,a[t],e,r)}else a[t]=I(s,e.operator,a[t],e,r)}else if(a instanceof S){if(d(t)===!1)throw new l(r,i.KeyAccessorMustBeString,e);if(a.hasField(t)===!0)a.setField(t,I(s,e.operator,a.field(t),e,r));else{if(e.operator!=="=")throw new l(r,i.FieldNotFound,e,{key:t});a.setField(t,I(s,e.operator,null,e,r))}}else if(a instanceof A){if(d(t)===!1)throw new l(r,i.KeyAccessorMustBeString,e);if(a.hasGlobal(t)!==!0)throw new l(r,i.ModuleExportNotFound,e);a.setGlobal(t,I(s,e.operator,a.global(t),e,r))}else{if(!Y(a))throw N(a)?new l(r,i.Immutable,e):new l(r,i.InvalidParameter,e);if(d(t)===!1)throw new l(r,i.KeyAccessorMustBeString,e);if(a.hasField(t)===!0)a.setField(t,I(s,e.operator,a.field(t),e,r));else{if(e.operator!=="=")throw new l(r,i.FieldNotFound,e,{key:t});a.setField(t,I(s,e.operator,null,e,r))}}return w}let o=h(n);if(r.localScope!=null&&r.localScope[o]!==void 0){let a=yield u(r,e.right);return r.localScope[o]={value:I(a,e.operator,r.localScope[o].value,e,r)},w}if(r.globalScope[o]!==void 0){let a=yield u(r,e.right);return r.globalScope[o]={value:I(a,e.operator,r.globalScope[o].value,e,r)},w}throw new l(r,i.InvalidIdentifier,e)})}function Ue(r,e){return f(this,null,function*(){let n=yield u(r,e.expression);return n===w?w:new Z(n)})}function Ze(r,e){return f(this,null,function*(){let n=yield u(r,e.test);if(n===!0)return g(r,e.consequent);if(n===!1)return e.alternate!==null?g(r,e.alternate):w;throw new l(r,i.BooleanConditionRequired,e)})}function oe(r,e){return f(this,null,function*(){return xe(r,e,0)})}function xe(r,e,n){return f(this,null,function*(){if(n>=e.body.length)return w;let o=yield g(r,e.body[n]);return o instanceof y||o===b||o===E||n===e.body.length-1?o:xe(r,e,n+1)})}function Le(r,e){return f(this,null,function*(){if(e.argument===null)return new y(w);let n=yield u(r,e.argument);return new y(n)})}function qe(r,e){return f(this,null,function*(){let n=h(e.id);return r.globalScope[n]={value:new re(e,r)},w})}function Pe(r,e){return f(this,null,function*(){let n=h(e.specifiers[0].local),o=r.libraryResolver.loadLibrary(n),a;return r.libraryResolver._moduleSingletons?.has(o.uri)?a=r.libraryResolver._moduleSingletons.get(o.uri):(a=new A(o),yield a.loadModule(r),r.libraryResolver._moduleSingletons?.set(o.uri,a)),r.globalScope[n]={value:a},w})}function Ve(r,e){return f(this,null,function*(){if(yield g(r,e.declaration),e.declaration.type==="FunctionDeclaration")r.exports[h(e.declaration.id)]="function";else if(e.declaration.type==="VariableDeclaration")for(let n of e.declaration.declarations)r.exports[h(n.id)]="variable";return w})}function Fe(r,e,n){return f(this,null,function*(){return n>=e.declarations.length?w:(yield je(r,e.declarations[n]),n===e.declarations.length-1||(yield Fe(r,e,n+1)),w)})}function je(r,e){return f(this,null,function*(){let n=null;if(n=e.init===null?null:yield u(r,e.init),r.localScope!==null){if(n===w&&(n=null),e.id.type!=="Identifier")throw new l(r,i.InvalidIdentifier,e);let a=h(e.id);return void(r.localScope!=null&&(r.localScope[a]={value:n}))}if(e.id.type!=="Identifier")throw new l(r,i.InvalidIdentifier,e);let o=h(e.id);n===w&&(n=null),r.globalScope[o]={value:n}})}function We(r,e){return f(this,null,function*(){let n=yield u(r,e.object);if(n===null)throw new l(r,i.MemberOfNull,e);if(e.computed===!1){if(e.property.type==="Identifier"){if(n instanceof S||B(n))return n.field(e.property.name);if(n instanceof W)return q(n,e.property.name,r,e);if(n instanceof A){if(!n.hasGlobal(e.property.name))throw new l(r,i.InvalidIdentifier,e);return n.global(e.property.name)}throw new l(r,i.InvalidMemberAccessKey,e)}throw new l(r,i.InvalidMemberAccessKey,e)}let o=yield u(r,e.property);if(n instanceof S||B(n)){if(d(o))return n.field(o);throw new l(r,i.InvalidMemberAccessKey,e)}if(n instanceof A){if(d(o))return n.global(o);throw new l(r,i.InvalidMemberAccessKey,e)}if(n instanceof W){if(d(o))return q(n,o,r,e);throw new l(r,i.InvalidMemberAccessKey,e)}if(C(n)){if(R(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=n.length+o),o>=n.length||o<0)throw new l(r,i.OutOfBounds,e);return n[o]}throw new l(r,i.InvalidMemberAccessKey,e)}if(N(n)){if(R(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=n.length()+o),o>=n.length()||o<0)throw new l(r,i.OutOfBounds,e);return n.get(o)}throw new l(r,i.InvalidMemberAccessKey,e)}if(d(n)){if(R(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=n.length+o),o>=n.length||o<0)throw new l(r,i.OutOfBounds,e);return n[o]}throw new l(r,i.InvalidMemberAccessKey,e)}throw new l(r,i.InvalidMemberAccessKey,e)})}function Te(r,e){return f(this,null,function*(){let n=yield u(r,e.argument);if(k(n)){if(e.operator==="!")return!n;if(e.operator==="-")return-1*p(n);if(e.operator==="+")return 1*p(n);if(e.operator==="~")return~p(n);throw new l(r,i.UnsupportedUnaryOperator,e)}if(e.operator==="-")return-1*p(n);if(e.operator==="+")return 1*p(n);if(e.operator==="~")return~p(n);throw new l(r,i.UnsupportedUnaryOperator,e)})}function _e(r,e){return f(this,null,function*(){let n=[];for(let o=0;o<e.elements.length;o++)n.push(yield u(r,e.elements[o]));for(let o=0;o<n.length;o++){if(v(n[o]))throw new l(r,i.NoFunctionInArray,e);n[o]===w&&(n[o]=null)}return n})}function ze(r,e){return f(this,null,function*(){let n=yield u(r,e.left),o=yield u(r,e.right);switch(e.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return ce(p(n),p(o),e.operator);case"==":return L(n,o);case"!=":return!L(n,o);case"<":case">":case"<=":case">=":return le(n,o,e.operator);case"+":return d(n)||d(o)?O(n)+O(o):p(n)+p(o);case"-":return p(n)-p(o);case"*":return p(n)*p(o);case"/":return p(n)/p(o);case"%":return p(n)%p(o);default:throw new l(r,i.UnsupportedOperator,e)}})}function He(r,e){return f(this,null,function*(){let n=yield u(r,e.left);if(!k(n))throw new l(r,i.LogicalExpressionOnlyBoolean,e);switch(e.operator){case"||":{if(n===!0)return n;let o=yield u(r,e.right);if(k(o))return o;throw new l(r,i.LogicExpressionOrAnd,e)}case"&&":{if(n===!1)return n;let o=yield u(r,e.right);if(k(o))return o;throw new l(r,i.LogicExpressionOrAnd,e)}default:throw new l(r,i.LogicExpressionOrAnd,e)}})}function V(r,e){let n=h(e);if(r.localScope!=null&&r.localScope[n]!==void 0)return r.localScope[n].value;if(r.globalScope[n]!==void 0)return r.globalScope[n].value;throw new l(r,i.InvalidIdentifier,e)}function Ye(r,e){return f(this,null,function*(){if(e.callee.type==="MemberExpression"){let o=yield u(r,e.callee.object);if(!(o instanceof A))throw new l(r,i.FunctionNotFound,e);let a=e.callee.computed===!1?e.callee.property.name:yield u(r,e.callee.property);if(!o.hasGlobal(a))throw new l(r,i.FunctionNotFound,e);let t=o.global(a);if(!v(t))throw new l(r,i.CallNonFunction,e);return t.call(r,e)}if(e.callee.type!=="Identifier")throw new l(r,i.FunctionNotFound,e);let n=h(e.callee);if(r.localScope!=null&&r.localScope[n]!==void 0){let o=r.localScope[n];if(v(o.value))return o.value.call(r,e);throw new l(r,i.CallNonFunction,e)}if(r.globalScope[n]!==void 0){let o=r.globalScope[n];if(v(o.value))return o.value.call(r,e);throw new l(r,i.CallNonFunction,e)}throw new l(r,i.FunctionNotFound,e)})}function Je(r,e){return f(this,null,function*(){let n="",o=0;for(let a of e.quasis)if(n+=a.value?a.value.cooked:"",a.tail===!1){if(e.expressions[o]){let t=yield u(r,e.expressions[o]);if(v(t))throw new l(r,i.NoFunctionInTemplateLiteral,e);n+=O(t)}o++}return n})}var m={};function Ie(r,e,n,o){return f(this,null,function*(){let a=yield u(r,e.arguments[n]);if(L(a,o))return u(r,e.arguments[n+1]);let t=e.arguments.length-n;return t===1?u(r,e.arguments[n]):t===2?null:t===3?u(r,e.arguments[n+2]):Ie(r,e,n+2,o)})}function Me(r,e,n,o){return f(this,null,function*(){if(o===!0)return u(r,e.arguments[n+1]);if(e.arguments.length-n===3)return u(r,e.arguments[n+2]);let a=yield u(r,e.arguments[n+2]);if(k(a)===!1)throw new l(r,i.ModuleExportNotFound,e.arguments[n+2]);return Me(r,e,n+2,a)})}function ee(r,e,n,o){return f(this,null,function*(){let a=r.body;if(n.length!==r.params.length)throw new l(e,i.WrongNumberOfParameters,null);for(let s=0;s<n.length;s++){let c=r.params[s];c.type==="Identifier"&&e.localScope!=null&&(e.localScope[h(c)]={value:n[s]})}let t=yield g(e,a);if(t instanceof y)return t.value;if(t===b)throw new l(e,i.UnexpectedToken,o);if(t===E)throw new l(e,i.UnexpectedToken,o);return t instanceof Z?t.value:t})}we(m,M),ye(m,M),de(m,M,V),me(m,M),he(m,M),ge(m,M),be({functions:m,compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:M,standardFunctionAsync:K}),m.iif=function(r,e){return f(this,null,function*(){$(e.arguments===null?[]:e.arguments,3,3,r,e);let n=yield u(r,e.arguments[0]);if(k(n)===!1)throw new l(r,i.BooleanConditionRequired,e);return u(r,n?e.arguments[1]:e.arguments[2])})},m.defaultvalue=function(r,e){return f(this,null,function*(){$(e.arguments===null?[]:e.arguments,2,3,r,e);let n=yield u(r,e.arguments[0]);if(e.arguments.length===3){let o=yield u(r,e.arguments[1]),a=ue(n,o);return a!=null&&a!==""?a:u(r,e.arguments[2])}return n==null||n===""?u(r,e.arguments[1]):n})},m.decode=function(r,e){return f(this,null,function*(){if(e.arguments.length<2)throw new l(r,i.WrongNumberOfParameters,e);if(e.arguments.length===2)return u(r,e.arguments[1]);if((e.arguments.length-1)%2==0)throw new l(r,i.WrongNumberOfParameters,e);return Ie(r,e,1,yield u(r,e.arguments[0]))})},m.when=function(r,e){return f(this,null,function*(){if(e.arguments.length<3)throw new l(r,i.WrongNumberOfParameters,e);if(e.arguments.length%2==0)throw new l(r,i.WrongNumberOfParameters,e);let n=yield u(r,e.arguments[0]);if(k(n)===!1)throw new l(r,i.BooleanConditionRequired,e.arguments[0]);return Me(r,e,0,n)})};var $e={fixSpatialReference:se,parseArguments:ne,standardFunction:M,standardFunctionAsync:K,evaluateIdentifier:V};for(let r in m)m[r]={value:new G(m[r])};var D=function(){};function ke(r,e,n){let o=new D;r==null&&(r={}),e==null&&(e={});let a=new S({newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});a.immutable=!1,o.textformatting={value:a};for(let t in e)o[t]={value:new G(e[t])};for(let t in r)o[t]={value:ae(r[t])?X.createFromGraphic(r[t],n):r[t]};return o}function Ae(r){console.log(r)}D.prototype=m,D.prototype.infinity={value:Number.POSITIVE_INFINITY},D.prototype.pi={value:Math.PI};var vr=$e;function Qe(r){let e={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:M,standardFunctionAsync:K,evaluateIdentifier:V};for(let n=0;n<r.length;n++)r[n].registerFunctions(e);for(let n in e.functions)m[n]={value:new G(e.functions[n])},D.prototype[n]=m[n];for(let n=0;n<e.signatures.length;n++)fe(e.signatures[n],"async")}function Sr(r,e){return f(this,null,function*(){let n=e.spatialReference;n==null&&(n=new j({wkid:102100}));let o=null;r.usesModules&&(o=new _(new Map,r.loadedModules));let a=ke(e.vars,e.customfunctions,e.timeZone),t={spatialReference:n,services:e.services,exports:{},libraryResolver:o,abortSignal:e.abortSignal===void 0||e.abortSignal===null?{aborted:!1}:e.abortSignal,globalScope:a,console:e.console??Ae,timeZone:e.timeZone??null,lrucache:e.lrucache,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},s=yield oe(t,r);if(s instanceof y||s instanceof Z){let c=s.value;if(c===w)return null;if(v(c))throw new l(t,i.IllegalResult,null);return c}if(s===w)return null;throw s===b?new l(t,i.IllegalResult,null):s===E?new l(t,i.IllegalResult,null):new l(t,i.NeverReach,null)})}Qe([pe]);export{Sr as executeScript,Qe as extend,vr as functionHelper};
