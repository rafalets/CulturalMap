import{D as Ce,G as Pe,I as _e,J as Re,g as de,h as Te,i as ve,k as ge,l as xe,m as Oe,o as ye,r as A,t as Se}from"./chunk-P64DWRJ7.js";import{d as Ae}from"./chunk-4MYROXQR.js";import{b as o}from"./chunk-L5JJXC3A.js";import{e as ae}from"./chunk-DBZKWPEX.js";import{b as we}from"./chunk-GAPCKNYR.js";import{b as v}from"./chunk-2IWALBQY.js";import{b as Ne}from"./chunk-BMQOGMDN.js";import{b as Me,c as be}from"./chunk-KRE5JNQN.js";import{a as N,b as De}from"./chunk-WXB3UZNT.js";import{b as le,e as x}from"./chunk-VOJIMLDZ.js";import{a as W,e as ne,g as f}from"./chunk-7VWXQFPJ.js";import{f as pe,h as me,i as fe}from"./chunk-FZ5X7HOK.js";import{g as ue,j as ce,k as he}from"./chunk-3D4Y6BLC.js";import{a as U}from"./chunk-OTUHXNWB.js";import{b as S}from"./chunk-NBT2WTKD.js";import{a as ie}from"./chunk-B564E6X6.js";import{f as T}from"./chunk-MEGSPQVO.js";import{a as y,b as R,c as oe,d as k,h as w}from"./chunk-3AS27HNO.js";import{a as m}from"./chunk-RWCIDBNQ.js";import{a as d,b as O,g as b}from"./chunk-ONYJLWAD.js";import{a as z}from"./chunk-3Q427ME6.js";import{i as q,x as se}from"./chunk-HM5RIVQC.js";import{C as re,a as K,b as X,c as B,e as _,m as F,t as $,u as ee,y as te}from"./chunk-5WKDXHVH.js";import{c as J}from"./chunk-PTZYZULI.js";import{a as c,c as Z,d as L,h as P}from"./chunk-NHSDW26F.js";import{a as s}from"./chunk-QGVBCWUY.js";import{a as V}from"./chunk-VTHXE323.js";var I=class extends Me{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=le,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=d.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=P,this.instancedDoublePrecision=!1,this.normalType=T.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.ambient=L(.2,.2,.2),this.diffuse=L(.8,.8,.8),this.externalColor=J(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=c(),this.hasSlicePlane=!1,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=O.Less,this.textureAlphaMode=b.Blend,this.textureAlphaCutoff=S,this.textureAlphaPremultiplied=!1,this.renderOccluded=he.Occlude,this.isDecoration=!1}},Ie=class extends be{constructor(){super(...arguments),this.origin=c(),this.slicePlaneLocalOrigin=this.origin}},C=class extends De{constructor(t,a,e=new N(we,()=>import("./chunk-E2SO4K22.js"))){super(t,a,e),this.type="DefaultMaterialTechnique"}_makePipeline(t,a){let{oitPass:e,output:n,transparent:u,cullFace:h,customDepthTest:p,hasOccludees:l,enableOffset:g}=t,M=e===U.NONE,D=e===U.FrontFace;return fe({blending:w(n)&&u?de(e):null,culling:Fe(t)?pe(h):null,depthTest:{func:xe(e,Be(p))},depthWrite:Te(t),drawBuffers:n===y.Depth?{buffers:[se.NONE]}:Oe(e,n),colorWrite:me,stencilWrite:l?Pe:null,stencilTest:l?a?Re:_e:null,polygonOffset:M||D?null:ge(g)})}initializePipeline(t){return this._occludeePipelineState=this._makePipeline(t,!0),this._makePipeline(t,!1)}getPipeline(t){return t?this._occludeePipelineState:super.getPipeline()}};function Be(i){return i===O.Lequal?q.LEQUAL:q.LESS}function Fe(i){return i.cullFace!==d.None||!i.hasSlicePlane&&!i.transparent&&!i.doubleSidedMode}var r=class extends Ae{constructor(t,a){super(),this.spherical=t,this.doublePrecisionRequiresObfuscation=a,this.alphaDiscardMode=b.Opaque,this.doubleSidedMode=v.None,this.pbrMode=x.Disabled,this.cullFace=d.None,this.normalType=T.Attribute,this.customDepthTest=O.Less,this.emissionSource=f.None,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1,this.occlusionPass=!1,this.hasVvInstancing=!0,this.useCustomDTRExponentForWater=!1,this.useFillLights=!0}get textureCoordinateType(){return this.hasColorTexture||this.hasMetallicRoughnessTexture||this.emissionSource===f.Texture||this.hasOcclusionTexture||this.hasNormalTexture?W.Default:W.None}get objectAndLayerIdColorInstanced(){return this.instanced}get discardInvisibleFragments(){return this.transparent}};s([o({count:b.COUNT})],r.prototype,"alphaDiscardMode",void 0),s([o({count:v.COUNT})],r.prototype,"doubleSidedMode",void 0),s([o({count:x.COUNT})],r.prototype,"pbrMode",void 0),s([o({count:d.COUNT})],r.prototype,"cullFace",void 0),s([o({count:T.COUNT})],r.prototype,"normalType",void 0),s([o({count:O.COUNT})],r.prototype,"customDepthTest",void 0),s([o({count:f.COUNT})],r.prototype,"emissionSource",void 0),s([o()],r.prototype,"hasVertexColors",void 0),s([o()],r.prototype,"hasSymbolColors",void 0),s([o()],r.prototype,"hasVerticalOffset",void 0),s([o()],r.prototype,"hasColorTexture",void 0),s([o()],r.prototype,"hasMetallicRoughnessTexture",void 0),s([o()],r.prototype,"hasOcclusionTexture",void 0),s([o()],r.prototype,"hasNormalTexture",void 0),s([o()],r.prototype,"hasScreenSizePerspective",void 0),s([o()],r.prototype,"hasVertexTangents",void 0),s([o()],r.prototype,"hasOccludees",void 0),s([o()],r.prototype,"hasModelTransformation",void 0),s([o()],r.prototype,"offsetBackfaces",void 0),s([o()],r.prototype,"vvSize",void 0),s([o()],r.prototype,"vvColor",void 0),s([o()],r.prototype,"receiveShadows",void 0),s([o()],r.prototype,"receiveAmbientOcclusion",void 0),s([o()],r.prototype,"textureAlphaPremultiplied",void 0),s([o()],r.prototype,"instanced",void 0),s([o()],r.prototype,"instancedColor",void 0),s([o()],r.prototype,"writeDepth",void 0),s([o()],r.prototype,"transparent",void 0),s([o()],r.prototype,"enableOffset",void 0),s([o()],r.prototype,"terrainDepthTest",void 0),s([o()],r.prototype,"cullAboveTerrain",void 0),s([o()],r.prototype,"snowCover",void 0),s([o()],r.prototype,"hasColorTextureTransform",void 0),s([o()],r.prototype,"hasEmissionTextureTransform",void 0),s([o()],r.prototype,"hasNormalTextureTransform",void 0),s([o()],r.prototype,"hasOcclusionTextureTransform",void 0),s([o()],r.prototype,"hasMetallicRoughnessTextureTransform",void 0);var E=class extends C{constructor(t,a){super(t,a,new N(Ne,()=>import("./chunk-MMMXVU6N.js"))),this.type="RealisticTreeTechnique"}};var Ee=class extends ce{constructor(t,a){super(t,Q),this.materialType="default",this.supportsEdges=!0,this.produces=new Map([[A.OPAQUE_MATERIAL,e=>(k(e)||R(e))&&!this.parameters.transparent],[A.TRANSPARENT_MATERIAL,e=>(k(e)||R(e))&&this.parameters.transparent&&this.parameters.writeDepth],[A.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(oe(e)||R(e))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._vertexBufferLayout=ke(this.parameters),this._configuration=new r(a.spherical,a.doublePrecisionRequiresObfuscation)}isVisibleForOutput(t){return t!==y.Shadow&&t!==y.ShadowExcludeHighlight&&t!==y.ShadowHighlight||this.parameters.castShadows}get visible(){let t=this.parameters;if(t.layerOpacity<S)return!1;let{hasInstancedColor:a,hasVertexColors:e,hasSymbolColors:n,vvColor:u}=t,h=a||u||n,p=t.colorMixMode==="replace",l=t.opacity>=S;if(e&&h)return p||l;let g=t.externalColor&&t.externalColor[3]>=S;return e?p?g:l:h?p||l:p?g:l}get hasEmissions(){return!!this.parameters.emissiveTextureId||!re(this.parameters.emissiveFactor,P)}getConfiguration(t,a){let e=this.parameters,{treeRendering:n,doubleSided:u,doubleSidedType:h}=e;return this._configuration.output=t,this._configuration.hasNormalTexture=!n&&!!e.normalTextureId,this._configuration.hasColorTexture=!!e.textureId,this._configuration.hasVertexTangents=!n&&e.hasVertexTangents,this._configuration.instanced=e.isInstanced,this._configuration.instancedDoublePrecision=e.instancedDoublePrecision,this._configuration.vvSize=!!e.vvSize,this._configuration.hasVerticalOffset=e.verticalOffset!=null,this._configuration.hasScreenSizePerspective=e.screenSizePerspective!=null,this._configuration.hasSlicePlane=e.hasSlicePlane,this._configuration.alphaDiscardMode=e.textureAlphaMode,this._configuration.normalType=n?T.Attribute:e.normalType,this._configuration.transparent=e.transparent,this._configuration.writeDepth=e.writeDepth,e.customDepthTest!=null&&(this._configuration.customDepthTest=e.customDepthTest),this._configuration.hasOccludees=a.hasOccludees,this._configuration.cullFace=e.hasSlicePlane?d.None:e.cullFace,this._configuration.cullAboveTerrain=a.cullAboveTerrain,this._configuration.hasModelTransformation=!n&&e.modelTransformation!=null,this._configuration.hasVertexColors=e.hasVertexColors,this._configuration.hasSymbolColors=e.hasSymbolColors,this._configuration.doubleSidedMode=n?v.WindingOrder:u&&h==="normal"?v.View:u&&h==="winding-order"?v.WindingOrder:v.None,this._configuration.instancedColor=e.hasInstancedColor,w(t)?(this._configuration.terrainDepthTest=a.terrainDepthTest,this._configuration.receiveShadows=e.receiveShadows,this._configuration.receiveAmbientOcclusion=e.receiveAmbientOcclusion&&a.ssao!=null):(this._configuration.terrainDepthTest=!1,this._configuration.receiveShadows=this._configuration.receiveAmbientOcclusion=!1),this._configuration.vvColor=!!e.vvColor,this._configuration.textureAlphaPremultiplied=!!e.textureAlphaPremultiplied,this._configuration.pbrMode=e.usePBR?e.isSchematic?x.Schematic:x.Normal:x.Disabled,this._configuration.hasMetallicRoughnessTexture=!n&&!!e.metallicRoughnessTextureId,this._configuration.emissionSource=n?f.None:e.emissiveTextureId!=null?f.Texture:e.usePBR?f.Value:f.None,this._configuration.hasOcclusionTexture=!n&&!!e.occlusionTextureId,this._configuration.offsetBackfaces=!(!e.transparent||!e.offsetTransparentBackfaces),this._configuration.oitPass=a.oitPass,this._configuration.enableOffset=a.camera.relativeElevation<ve,this._configuration.snowCover=qe(a),this._configuration.hasColorTextureTransform=!!e.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!e.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!e.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!e.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!e.metallicRoughnessTextureTransformMatrix,this._configuration}intersect(t,a,e,n,u,h){if(this.parameters.verticalOffset!=null){let p=e.camera;B(H,a[12],a[13],a[14]);let l=null;switch(e.viewingMode){case z.Global:l=$(Ve,H);break;case z.Local:l=X(Ve,Ue)}let g=0,M=_(Ge,H,p.eye),D=K(M),Le=F(M,M,1/D),Y=null;this.parameters.screenSizePerspective&&(Y=ee(l,Le)),g+=ue(p,D,this.parameters.verticalOffset,Y??0,this.parameters.screenSizePerspective),F(l,l,g),te(G,l,e.transform.inverseRotation),n=_(ze,n,G),u=_(We,u,G)}ye(t,e,n,u,Se(e.verticalOffset),h)}createGLMaterial(t){return new j(t)}createBufferWriter(){return new Ce(this._vertexBufferLayout)}},j=class extends ne{constructor(t){super(V(V({},t),t.material.parameters))}beginSlot(t){this._material.setParameters({receiveShadows:t.shadowMap.enabled});let a=this._material.parameters;this.updateTexture(a.textureId);let e=t.camera.viewInverseTransposeMatrix;return B(a.origin,e[3],e[7],e[11]),this._material.setParameters(this.textureBindParameters),this.getTechnique(a.treeRendering?E:C,t)}},Q=class extends I{constructor(){super(...arguments),this.treeRendering=!1,this.hasVertexTangents=!1}};function qe(i){return i.weather!=null&&i.weatherVisible&&i.weather.type==="snowy"&&i.weather.snowCover==="enabled"}function ke(i){let t=ae().vec3f(m.POSITION);return i.normalType===T.Compressed?t.vec2i16(m.NORMALCOMPRESSED,{glNormalized:!0}):t.vec3f(m.NORMAL),i.hasVertexTangents&&t.vec4f(m.TANGENT),(i.textureId||i.normalTextureId||i.metallicRoughnessTextureId||i.emissiveTextureId||i.occlusionTextureId)&&t.vec2f(m.UV0),i.hasVertexColors&&t.vec4u8(m.COLOR),i.hasSymbolColors&&t.vec4u8(m.SYMBOLCOLOR),ie()&&t.vec4u8(m.OBJECTANDLAYERIDCOLOR),t}var ze=c(),We=c(),Ue=Z(0,0,1),Ve=c(),G=c(),H=c(),Ge=c();export{Ie as a,Ee as b};
