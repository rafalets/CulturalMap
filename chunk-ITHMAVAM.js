import{f as i,h as R}from"./chunk-YNINCQ45.js";import{a as v}from"./chunk-SLAWDKDA.js";import{E as S,G as y,u as g}from"./chunk-D2LVMNOU.js";import{t as I}from"./chunk-HHDFN2GK.js";import{f as u}from"./chunk-VTHXE323.js";function x(s,t,o){return u(this,null,function*(){let r=yield U(s,t,o);yield b(r,t,o)})}function B(s,t,o,r,a){return u(this,null,function*(){let c=yield U(o,r,a);yield s.update({data:t}),yield b(c,r,a)})}function U(s,t,o){return u(this,null,function*(){if(!t?.resources)return;let r=t.portalItem===s.portalItem?new Set(s.paths):new Set;s.paths.length=0,s.portalItem=t.portalItem;let a=new Set(t.resources.toKeep.map(e=>e.resource.path)),c=new Set,l=[];a.forEach(e=>{r.delete(e),s.paths.push(e)});let p=[],m=[],h=[];for(let e of t.resources.toUpdate)if(r.delete(e.resource.path),a.has(e.resource.path)||c.has(e.resource.path)){let{resource:n,content:A,finish:d}=e,f=R(n,v());s.paths.push(f.path),p.push({resource:f,content:yield i(A),compress:e.compress}),d&&h.push(()=>d(f))}else{s.paths.push(e.resource.path),m.push({resource:e.resource,content:yield i(e.content),compress:e.compress});let n=e.finish;n&&h.push(()=>n(e.resource)),c.add(e.resource.path)}for(let e of t.resources.toAdd)if(s.paths.push(e.resource.path),r.has(e.resource.path))r.delete(e.resource.path);else{p.push({resource:e.resource,content:yield i(e.content),compress:e.compress});let n=e.finish;n&&h.push(()=>n(e.resource))}if(p.length||m.length){let{addOrUpdateResources:e}=yield import("./chunk-MMTVNQFW.js");yield e(t.portalItem,p,"add",o),yield e(t.portalItem,m,"update",o)}if(h.forEach(e=>e()),l.length===0)return r;let w=yield y(l);if(g(o),w.length>0)throw new I("save:resources","Failed to save one or more resources",{errors:w});return r})}function b(s,t,o){return u(this,null,function*(){if(!s||!t.portalItem)return;let r=[];for(let a of s){let c=t.portalItem.resourceFromPath(a);r.push(c.portalItem.removeResource(c,o))}yield S(r)})}export{x as a,B as b};
