import{a as p}from"./chunk-OVHPPCBL.js";import{a as h}from"./chunk-3TQOUBNU.js";import{N as D,t as g,w as x}from"./chunk-D2LVMNOU.js";import{f as T}from"./chunk-VTHXE323.js";var i=class{constructor(t,s=30){this.name=t,this._counter=0,this._samples=new Array(s)}push(t){t!=null&&(this._samples[++this._counter%this._samples.length]=t)}set(t){t!=null&&(this._samples[this._counter%this._samples.length]=t)}get median(){return this._samples.slice().sort((t,s)=>t-s)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((t,s)=>t+s,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var f=class{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}},d=class{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}},w=0,b=0,c={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},_=["prepare","preRender","render","postRender","update","finish"],k=[],n=new h,v=class{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1,M()}};function j(){r!=null&&(cancelAnimationFrame(r),r=requestAnimationFrame(A))}function M(){r==null&&(w=performance.now(),r=requestAnimationFrame(A))}var u={frameTasks:n,willDispatch:!1,clearFrameTasks:P,dispatch:q,executeFrameTasks:U,reschedule:j};function N(e){let t=new d(e);return k.push(t),u.willDispatch||(u.willDispatch=!0,p(q)),t}function O(e){let t=new f(e);return n.push(t),M(),new v(t)}var r=null;function P(e=!1){n.forAll(t=>{t.removed=!0}),e&&R()}function A(){let e=performance.now();r=null,r=n.some(s=>!s.paused&&!s.removed)?requestAnimationFrame(A):null,u.executeFrameTasks(e)}function U(e){let t=e-w;w=e;let s=b>0?b:1e3/60,l=Math.max(0,t-s);c.time=e,c.frameDuration=s-l;for(let o=0;o<_.length;o++){let y=performance.now(),F=_[o];n.forAll(a=>{a.paused||a.removed||(o===0&&a.ticks++,a.phases[F]&&(c.elapsedFrameTime=performance.now()-e,c.deltaTime=a.ticks===0?0:t,a.phases[F]?.call(a,c)))}),I[o].push(performance.now()-y)}R(),S.push(performance.now()-e)}var m=new h;function R(){n.forAll(e=>{e.removed&&m.push(e)}),n.removeUnorderedMany(m.data,m.length),m.clear()}function q(){for(;k.length;){let e=k.shift();e.isActive&&e.callback()}u.willDispatch=!1}function E(e=1,t){let s=D(),l=()=>{x(t)?s.reject(g()):e===0?s():(--e,p(()=>l()))};return l(),s.promise}function H(e){return E(1,e)}function Q(e){return T(this,null,function*(){yield H(e),yield new Promise(t=>requestAnimationFrame(()=>{e?.aborted||t()}))})}var I=_.map(e=>new i(e)),S=new i("total");export{i as a,N as b,O as c,E as d,H as e,Q as f};
