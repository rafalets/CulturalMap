import{a as Q,b as Y}from"./chunk-3BDL2KTL.js";import{a as q,b as w,c as k,d as A}from"./chunk-TGPGCQ44.js";import{f as H,g as U}from"./chunk-LNVVFNTC.js";import{b as K}from"./chunk-R6GE4XRP.js";import{h as D}from"./chunk-7N3ZKWML.js";import{i as F}from"./chunk-QDTU3MWT.js";import{j as C,k as B}from"./chunk-NTVLK3P2.js";import{r as J,s as O}from"./chunk-IG66NQHW.js";import{F as I}from"./chunk-E57FTRWF.js";import{h as _}from"./chunk-U4J5SECU.js";import{k as E,r as V,t as W}from"./chunk-HHDFN2GK.js";import{a as z,b as N,f as S}from"./chunk-VTHXE323.js";function Z(e,n,a,o){return S(this,null,function*(){let t=K(e),i=n[0].spatialReference,r=N(z({},o),{responseType:"json",query:N(z({},t.query),{f:"json",sr:O(i),target:JSON.stringify({geometryType:U(n[0]),geometries:n}),cutter:JSON.stringify(a)})}),s=yield I(t.path+"/cut",r),{cutIndexes:l,geometries:c=[]}=s.data;return{cutIndexes:l,geometries:c.map(p=>{let g=H(p);return g.spatialReference=i,g})}})}function $(e,n,a){return S(this,null,function*(){let o=typeof e=="string"?_(e):e,t=n[0].spatialReference,i=U(n[0]),r=N(z({},a),{query:N(z({},o.query),{f:"json",sr:O(t),geometries:JSON.stringify(Q(n))})}),{data:s}=yield I(o.path+"/simplify",r);return Y(s.geometries,i,t)})}var oe=()=>V.getLogger("esri.geometry.support.normalizeUtils");function se(e){return e.type==="polygon"}function re(e){return e[0].type==="polygon"}function ie(e){return e[0].type==="polyline"}function ee(e){let n=[],a=0,o=0;for(let t=0;t<e.length;t++){let i=e[t],r=null;for(let s=0;s<i.length;s++)r=i[s],n.push(r),s===0?(a=r[0],o=a):(a=Math.min(a,r[0]),o=Math.max(o,r[0]));r&&n.push([(a+o)/2,0])}return n}function ae(e,n){if(!(e instanceof F||e instanceof D)){let t="straightLineDensify: the input geometry is neither polyline nor polygon";throw oe().error(t),new W(t)}let a=A(e),o=[];for(let t of a){let i=[];o.push(i),i.push([t[0][0],t[0][1]]);for(let r=0;r<t.length-1;r++){let s=t[r][0],l=t[r][1],c=t[r+1][0],p=t[r+1][1],g=Math.sqrt((c-s)*(c-s)+(p-l)*(p-l)),u=(p-l)/g,d=(c-s)/g,h=g/n;if(h>1){for(let T=1;T<=h-1;T++){let P=T*n,f=d*P+s,m=u*P+l;i.push([f,m])}let b=(g+Math.floor(h-1)*n)/2,L=d*b+s,X=u*b+l;i.push([L,X])}i.push([c,p])}}return se(e)?new D({rings:o,spatialReference:e.spatialReference}):new F({paths:o,spatialReference:e.spatialReference})}function te(e,n,a){if(n){let o=ae(e,1e6);e=B(o,!0)}return a&&(e=k(e,a)),e}function ne(e,n,a){if(Array.isArray(e)){let o=e[0];if(o>n){let t=w(o,n);e[0]=o+t*(-2*n)}else if(o<a){let t=w(o,a);e[0]=o+t*(-2*a)}}else{let o=e.x;if(o>n){let t=w(o,n);e=e.clone().offset(t*(-2*n),0)}else if(o<a){let t=w(o,a);e=e.clone().offset(t*(-2*a),0)}}return e}function le(e,n){let a=-1;for(let o=0;o<n.cutIndexes.length;o++){let t=n.cutIndexes[o],i=n.geometries[o],r=A(i);for(let s=0;s<r.length;s++){let l=r[s];l.some(c=>{if(c[0]<180)return!0;{let p=0;for(let u=0;u<l.length;u++){let d=l[u][0];p=d>p?d:p}p=Number(p.toFixed(9));let g=-360*w(p,180);for(let u=0;u<l.length;u++){let d=i.getPoint(s,u);i.setPoint(s,u,d.clone().offset(g,0))}return!0}})}if(t===a){if(re(e))for(let s of A(i))e[t]=e[t].addRing(s);else if(ie(e))for(let s of A(i))e[t]=e[t].addPath(s)}else a=t,e[t]=i}return e}function fe(e,n,a){return S(this,null,function*(){if(!Array.isArray(e))return fe([e],n);n&&typeof n!="string"&&oe().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");let o=typeof n=="string"?n:n?.url??E.geometryServiceUrl,t,i,r,s,l,c,p,g,u=0,d=[],h=[];for(let f of e)if(f!=null)if(t||(t=f.spatialReference,i=J(t),r=t.isWebMercator,c=r?102100:4326,s=q[c].maxX,l=q[c].minX,p=q[c].plus180Line,g=q[c].minus180Line),i)if(f.type==="mesh")h.push(f);else if(f.type==="point")h.push(ne(f.clone(),s,l));else if(f.type==="multipoint"){let m=f.clone();m.points=m.points.map(x=>ne(x,s,l)),h.push(m)}else if(f.type==="extent"){let m=f.clone()._normalize(!1,!1,i);h.push(m.rings?new D(m):m)}else if(f.extent){let m=f.extent,x=w(m.xmin,l)*(2*s),M=x===0?f.clone():k(f.clone(),x);m.offset(x,0);let{xmin:R,xmax:y}=m;R=Number(R.toFixed(9)),y=Number(y.toFixed(9)),m.intersects(p)&&y!==s?(u=y>u?y:u,M=te(M,r),d.push(M),h.push("cut")):m.intersects(g)&&R!==l?(u=y*(2*s)>u?y*(2*s):u,M=te(M,r,360),d.push(M),h.push("cut")):h.push(M)}else h.push(f.clone());else h.push(f);else h.push(f);let b=w(u,s),L=-90,X=b,T=new F;for(;b>0;){let f=360*b-180;T.addPath([[f,L],[f,-1*L]]),L*=-1,b--}if(d.length>0&&X>0){let f=le(d,yield Z(o,d,T,a)),m=[],x=[];for(let y=0;y<h.length;y++){let j=h[y];if(j!=="cut")x.push(j);else{let G=f.shift(),v=e[y];v!=null&&v.type==="polygon"&&v.rings&&v.rings.length>1&&G.rings.length>=v.rings.length?(m.push(G),x.push("simplify")):x.push(r?C(G):G)}}if(!m.length)return x;let M=yield $(o,m,a),R=[];for(let y=0;y<x.length;y++){let j=x[y];j!=="simplify"?R.push(j):R.push(r?C(M.shift()):M.shift())}return R}let P=[];for(let f=0;f<h.length;f++){let m=h[f];if(m!=="cut")P.push(m);else{let x=d.shift();P.push(r===!0?C(x):x)}}return P})}function Ae(e){if(!e)return null;let n=e.extent;if(!n)return null;let a=e.spatialReference&&J(e.spatialReference);if(!a)return n;let[o,t]=a.valid,i=2*t,{width:r}=n,s,{xmin:l,xmax:c}=n;if([l,c]=[c,l],e.type==="extent"||r===0||r<=t||r>i||l<o||c>t)return n;switch(e.type){case"polygon":if(!(e.rings.length>1))return n;s=ee(e.rings);break;case"polyline":if(!(e.paths.length>1))return n;s=ee(e.paths);break;case"multipoint":s=e.points}let p=n.clone();for(let g=0;g<s.length;g++){let u=s[g][0];u<0?(u+=t,c=Math.max(u,c)):(u-=t,l=Math.min(u,l))}return p.xmin=l,p.xmax=c,p.width<r?(p.xmin-=t,p.xmax-=t,p):n}function Ge(e,n,a){let o=J(a);if(o==null)return e;let[t,i]=o.valid,r=2*i,s=0,l=0;n>i?s=Math.ceil(Math.abs(n-i)/r):n<t&&(s=-Math.ceil(Math.abs(n-t)/r)),e>i?l=Math.ceil(Math.abs(e-i)/r):e<t&&(l=-Math.ceil(Math.abs(e-t)/r));let c=e+(s-l)*r,p=c-n;return p>i?c-=r:p<t&&(c+=r),c}function Ie(e,n){let a=J(n);if(a){let[o,t]=a.valid,i=t-o;if(e<o)for(;e<o;)e+=i;if(e>t)for(;e>t;)e-=i}return e}export{ae as a,fe as b,Ae as c,Ge as d,Ie as e};
