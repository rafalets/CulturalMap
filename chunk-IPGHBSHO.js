import{b}from"./chunk-XPXAET6Q.js";import{c as j}from"./chunk-RCDSCJMH.js";import{d as E,x as p,y as m}from"./chunk-JR22Z7I2.js";import{a as c}from"./chunk-J5MXC6AL.js";import{a as f,b as L}from"./chunk-OLOKUDVI.js";import{i as z}from"./chunk-NHSDW26F.js";import{a as C}from"./chunk-CNQVGGE6.js";import{a as S}from"./chunk-JKNCWG7E.js";import{a as x}from"./chunk-VDKRSX77.js";import{F as k}from"./chunk-E57FTRWF.js";import{f as u}from"./chunk-VTHXE323.js";var O="picture-fill",R="simple-fill",T="simple-line",D="simple-marker",A="text",N="cim",v=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),g=new C(1e3);function et(t){let o=t.style,r=null;if(t)switch(t.type){case D:o!=="cross"&&o!=="x"&&(r=t.color);break;case R:o&&o!=="solid"?o!=="none"&&(r={type:"pattern",x:0,y:0,src:x(`esri/symbols/patterns/${o}.png`),width:5,height:5}):r=t.color;break;case O:r={type:"pattern",src:t.url,width:f(t.width)*t.xscale,height:f(t.height)*t.yscale,x:f(t.xoffset),y:f(t.yoffset)};break;case A:r=t.color;break;case N:r=b(t)}return r}function lt(t,o){let r=t+"-"+o;return g.get(r)!==void 0?Promise.resolve(g.get(r)):k(t,{responseType:"image"}).then(n=>{let e=n.data,l=e.naturalWidth,i=e.naturalHeight,a=document.createElement("canvas");a.width=l,a.height=i;let s=a.getContext("2d");s.fillStyle=o,s.fillRect(0,0,l,i),s.globalCompositeOperation="destination-in",s.drawImage(e,0,0);let y=a.toDataURL();return g.put(r,y),y})}function w(t){if(!t)return null;let o=null;switch(t.type){case R:case O:case D:o=w(t.outline);break;case T:{let r=f(t.width);t.style!=null&&t.style!=="none"&&r!==0&&(o={color:t.color,style:I(t.style),width:r,cap:t.cap,join:t.join==="miter"?f(t.miterLimit):t.join},o.dashArray=U(o).join(",")||"none");break}default:o=null}return o}function U(t){if(!t?.style)return[];let{dashArray:o,style:r,width:n}=t;if(typeof o=="string"&&o!=="none")return o.split(",").map(i=>Number(i));let e=n??0,l=v.has(r)?v.get(r).map(i=>i*e):[];if(t.cap!=="butt")for(let[i,a]of l.entries())l[i]=i%2==1?a+e:Math.max(a-e,1);return l}var I=(()=>{let t={};return o=>{if(t[o])return t[o];let r=o.replaceAll("-","");return t[o]=r,r}})(),it=new c([128,128,128]);var H=new c("white");function J(t){let o=t.symbolLayers?.at(-1);if(o&&"outline"in o)return o?.outline?.size}function gt(t){if(!t)return 0;if(m(t)){let o=J(t);return o??0}return L(w(t)?.width)}function wt(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(o=>o.type==="object");case"line-3d":return t.symbolLayers.some(o=>o.type==="path");case"polygon-3d":return t.symbolLayers.some(o=>o.type==="object"||o.type==="extrude");default:return!1}}function St(t){return t.resource?.href??""}function kt(t,o){if(!t)return null;let r=null;return m(t)?r=P(t):p(t)&&(r=t.type==="cim"?b(t):t.color?new c(t.color):null),r?d(r,o):null}function P(t){let o=t.symbolLayers;if(!o)return null;let r=null;return o.forEach(n=>{n.type==="object"&&n.resource?.href||(r=n.type==="water"?n.color:n.material?n.material.color:null)}),r?new c(r):null}function d(t,o){if(o==null||t==null)return t;let r=t.toRgba();return r[3]=r[3]*o,new c(r)}function W(t,o,r){let n=t.symbolLayers;if(!n)return;let e=l=>d(o=o??l??(r!=null?H:null),r);n.forEach(l=>{if(l.type!=="object"||!l.resource?.href||o)if(l.type==="water")l.color=e(l.color);else{let i=l.material!=null?l.material.color:null,a=e(i);l.material==null?l.material=new E({color:a}):l.material.color=a,r!=null&&"outline"in l&&l.outline?.color!=null&&(l.outline.color=d(l.outline.color,r))}})}function V(t,o,r){(o=o??t.color)&&(t.color=d(o,r)),r!=null&&"outline"in t&&t.outline?.color&&(t.outline.color=d(t.outline.color,r))}function xt(t,o,r){t&&(o||r!=null)&&(o&&(o=new c(o)),m(t)?W(t,o,r):p(t)&&V(t,o,r))}function $(t,o){return u(this,null,function*(){let r=t.symbolLayers;r&&(yield S(r,n=>u(this,null,function*(){return q(n,o)})))})}function q(t,o){return u(this,null,function*(){switch(t.type){case"extrude":G(t,o);break;case"icon":case"line":case"text":B(t,o);break;case"path":Q(t,o);break;case"object":yield K(t,o)}})}function B(t,o){let r=F(o);r!=null&&(t.size=r)}function F(t){for(let o of t)if(typeof o=="number")return o;return null}function G(t,o){t.size=typeof o[2]=="number"?o[2]:0}function K(t,o){return u(this,null,function*(){let{resourceSize:r,symbolSize:n}=yield X(t),e=M(o,r,n);t.width=h(o[0],n[0],r[0],e),t.depth=h(o[1],n[1],r[1],e),t.height=h(o[2],n[2],r[2],e)})}function Q(t,o){let r=M(o,z,[t.width,void 0,t.height]);t.width=h(o[0],t.width,1,r),t.height=h(o[2],t.height,1,r)}function M(t,o,r){for(let n=0;n<3;n++){let e=t[n];switch(e){case"symbol-value":{let l=r[n];return l!=null?l/o[n]:1}case"proportional":break;default:if(e&&o[n])return e/o[n]}}return 1}function X(t){return u(this,null,function*(){let{computeObjectLayerResourceSize:o}=yield import("./chunk-FGM2LI3N.js"),r=yield o(t,10),{width:n,height:e,depth:l}=t,i=[n,l,e],a=1;for(let s=0;s<3;s++){let y=i[s];if(y!=null){a=y/r[s];break}}for(let s=0;s<3;s++)i[s]==null&&(i[s]=r[s]*a);return{resourceSize:r,symbolSize:i}})}function h(t,o,r,n){switch(t){case"proportional":return r*n;case"symbol-value":return o??r;default:return t}}function Y(t,o){let r=F(o);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{let n=t.width/t.height;n>1?(t.width=r,t.height=r*n):(t.width=r*n,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}function Lt(t,o){return u(this,null,function*(){if(t&&o)return m(t)?$(t,o):void(p(t)&&Y(t,o))})}function Ct(t,o,r){if(t&&o!=null)if(m(t)){let n=t.symbolLayers;n&&n.forEach(e=>{if(e.type==="object")switch(r){case"tilt":e.tilt=(e.tilt??0)+o;break;case"roll":e.roll=(e.roll??0)+o;break;default:e.heading=(e.heading??0)+o}e.type==="icon"&&(e.angle+=o)})}else p(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=o))}function zt(t){if(!t)return null;let o=t.effects.filter(r=>r.type!=="bloom").map(r=>r.toJSON());return j(o)}function jt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(o=>o.type==="extrude")}export{et as a,lt as b,w as c,U as d,I as e,it as f,gt as g,wt as h,St as i,kt as j,xt as k,Lt as l,Ct as m,zt as n,jt as o};
