import{a as T}from"./chunk-VLECDDLP.js";import{b as J,d as N}from"./chunk-A2ZJFGPE.js";import{a as v}from"./chunk-PWU2QHPV.js";import{f as P}from"./chunk-LNVVFNTC.js";import{r as x,s as G,u as M}from"./chunk-IB2IUO7T.js";import{ka as A,p as O}from"./chunk-IG66NQHW.js";import{V as S}from"./chunk-U4J5SECU.js";import{r as F,t as E}from"./chunk-HHDFN2GK.js";import{a as y,b as j,f as g}from"./chunk-VTHXE323.js";function V(a,t,r){return g(this,null,function*(){let{geometry:s}=t,e=y({},t.attributes);if(r!=null&&s?.type==="mesh"){let{transformFieldRoles:o}=r,{origin:c,spatialReference:l,vertexSpace:p}=s,n=s.transform??new T,i=p.type==="local",u=a.spatialReference,w=u.isGeographic,X=O(u,l),Y=G(l,u)&&x(l,u);if(!(i&&w&&Y||!i&&!w&&X))return null;let m=M(c,l,u);if(m==null)return null;if(e[o.originX]=m.x,e[o.originY]=m.y,e[o.originZ]=m.z??0,n!=null){let{translation:I,scale:R,rotation:f}=n,h=i?1:A(l)/A(u);e[o.translationX]=I[0]*h,e[o.translationY]=I[2]*h,e[o.translationZ]=-I[1]*h,e[o.scaleX]=R[0],e[o.scaleY]=R[2],e[o.scaleZ]=R[1],e[o.rotationX]=f[0],e[o.rotationY]=f[2],e[o.rotationZ]=-f[1],e[o.rotationDeg]=f[3]}return{attributes:e}}return s==null?{attributes:e}:s.type==="mesh"||s.type==="extent"?null:{geometry:s.toJSON(),attributes:e}})}function H(a,t){return g(this,null,function*(){let r=yield Promise.all((t.addAttachments??[]).map(o=>W(a,o))),s=yield Promise.all((t.updateAttachments??[]).map(o=>W(a,o))),e=t.deleteAttachments??[];return r.length||s.length||e.length?{adds:r,updates:s,deletes:[...e]}:null})}function W(a,t){return g(this,null,function*(){let{feature:r,attachment:s}=t,{globalId:e,name:o,contentType:c,data:l,uploadId:p}=s,n={globalId:e};if(r&&("attributes"in r?n.parentGlobalId=r.attributes?.[a.globalIdField]:r.globalId&&(n.parentGlobalId=r.globalId)),p)n.uploadId=p;else if(l){let i=yield S(l);i&&(n.contentType=i.mediaType,n.data=i.data),l instanceof File&&(n.name=l.name)}return o&&(n.name=o),c&&(n.contentType=c),n})}function K(a,t,r){if(!t||t.length===0)return[];if(r&&N(t))return t.map(e=>e.globalId);if(J(t))return t.map(e=>e.objectId);let s=r?a.globalIdField:a.objectIdField;return s?t.map(e=>e.getAttribute(s)):[]}function Q(a){let t=a?.assetMaps;if(t){for(let e of t.addResults)e.success||F.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${e.globalId}.`);for(let e of t.updateResults)e.success||F.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${e.globalId}.`)}let r=a?.attachments,s={addFeatureResults:a?.addResults?.map(d)??[],updateFeatureResults:a?.updateResults?.map(d)??[],deleteFeatureResults:a?.deleteResults?.map(d)??[],addAttachmentResults:r?.addResults?r.addResults.map(d):[],updateAttachmentResults:r?.updateResults?r.updateResults.map(d):[],deleteAttachmentResults:r?.deleteResults?r.deleteResults.map(d):[]};return a?.editMoment&&(s.editMoment=a.editMoment),s}function d(a){let t=a.success===!0?null:a.error||{code:void 0,description:void 0};return{objectId:a.objectId,globalId:a.globalId,error:t?new E("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}function b(a,t){return new v({attributes:a.attributes,geometry:P(j(y({},a.geometry),{spatialReference:t}))})}function _(a,t){return{adds:a?.adds?.map(r=>b(r,t))||[],updates:a?.updates?.map(r=>({original:b(r[0],t),current:b(r[1],t)}))||[],deletes:a?.deletes?.map(r=>b(r,t))||[],spatialReference:t}}function tt(a){let t=a.details.raw,r=+t.code,s=+t.extendedCode;return r===500&&(s===-2147217144||s===-2147467261)}export{V as a,H as b,K as c,Q as d,d as e,_ as f,tt as g};
