import{A as R,C as W,Fb as T,Ga as se,S as $,T as ee,X as te,a as K,b as P,lb as ne,pb as oe}from"./chunk-UNRRVLTB.js";import{Ca as Z,Da as J,b as Y,g as k,o as H,tb as _,u as Q}from"./chunk-JLMESEWM.js";function O(){return{m_pGcs:new _,m_xyz:new P,m_factor:Number.NaN,m_geoLength:Number.NaN,setValues:ae,setLength:ie,assign:me}}function ae(i,e,t,n){this.m_factor=i,this.m_pGcs.assign(e),this.m_xyz.assign(n),this.m_geoLength=t}function ie(i){this.m_geoLength=i}function me(i){this.m_pGcs.assign(i.m_pGcs),this.m_xyz.assign(i.m_xyz),this.m_factor=i.m_factor,this.m_geoLength=i.m_geoLength}var re=class{getOperatorType(){return 10315}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}_ExecuteShapePreservingLength(e,t,n,u,s){if(e.hasNonLinearSegments()&&(e=new ee().execute(e,0,t.getTolerance(0),0,s)),t.isPannable()){let g=90,r=-90;if(n.getUnit().getUnitToBaseFactor()===1&&(g*=Math.PI/180,r*=Math.PI/180),t.getCoordinateSystemType()===2){let x=null,o=[0,0,0,0];x=t.getPECoordSys(),o[0]=0,o[1]=g,o[2]=0,o[3]=r,T.geogToProj(x,2,o),g=o[1],r=o[3]}let c=new K;e.queryEnvelope(c),c.ymin=r,c.ymax=g,e=new $().execute(e,c,t,s)}else{let g=t.getPCSHorizon();(e=new se().execute(e,g,t,s))===g&&(e=e.clone())}return e.isEmpty()?0:this._ExecuteIterativeApproach(e,t,n,u,1,s)}_ExecuteIterativeApproach(e,t,n,u,s,g){let r=oe();n.querySpheroidData(r);let c=r.majorSemiAxis,x=r.e2,o=n.getUnit().getUnitToBaseFactor(),b=40,C=Z(O,b),N=J(b,Number.NaN),d=O(),m=O(),h,a=[0,0,0,0],U=t.getPECoordSys(),E=new _,G=new _,y=new _,f=new _,S=new _,V=0,z=e.querySegmentIterator();for(;z.nextPath();)for(;z.hasNextSegment();){let D=z.nextSegment();E.assign(D.getStartXY()),G.assign(D.getEndXY()),t.getCoordinateSystemType()===2?(a[0]=E.x,a[1]=E.y,a[2]=G.x,a[3]=G.y,T.projToGeog(U,2,a),y.x=a[0]*o,y.y=a[1]*o,f.x=a[2]*o,f.y=a[3]*o):(y.setCoordsPoint2D(E),f.setCoordsPoint2D(G),y.scale(o),f.scale(o));let j=new P,I=new P;A(c,x,y,j),A(c,x,f,I);let l=v(c,j,I);d.setValues(0,y,Number.NaN,j),m.setValues(1,f,l,I),h=s,C[0].assign(m),N[0]=s;let p=0;for(;;){p>128&&Q("iterations exceeded");let q=.5*(d.m_factor+m.m_factor),M=D.getCoord2D(q);t.getCoordinateSystemType()===2?(a[0]=M.x,a[1]=M.y,T.projToGeog(U,1,a),S.x=a[0]*o,S.y=a[1]*o):(S.setCoordsPoint2D(M),S.scale(o)),y.setCoordsPoint2D(d.m_pGcs),f.setCoordsPoint2D(m.m_pGcs);let L=new P;A(c,x,S,L);let B=v(c,d.m_xyz,L),F=v(c,m.m_xyz,L);l=m.m_geoLength,Number.isNaN(l)&&(l=v(c,d.m_xyz,m.m_xyz));let w=B+F,X=h===s&&w>=20&&Math.abs(w-l)>1e-8*(l+w);if(p+2<b&&(X||Math.abs(w-l)>0&&h>0))m.setLength(F),C[p].assign(m),m.setValues(q,S,B,L),C[++p].assign(m),X?(h=s,N[p]=s):(h--,N[p-1]=h,N[p]=h);else{if(V+=w,p===0)break;d.assign(m),m.assign(C[--p]),h=N[p]}}}return V}execute(e,t,n){if(t&&t.getCoordinateSystemType()!==0||H(""),e.isEmpty()||e.getDimension()<1)return 0;let u=null,s=t.getGCS();s!==t&&(u=ne(t,s,null));let g=e.getGeometryType();if(g===Y.enumEnvelope){let r=new W;return r.addEnvelope(e,!1),this._ExecuteShapePreservingLength(r,t,s,u,n)}if(k(g)){let r=new R;return r.addSegment(e,!0),this._ExecuteShapePreservingLength(r,t,s,u,n)}return this._ExecuteShapePreservingLength(e,t,s,u,n)}};function A(i,e,t,n){n.assign(te(i,e,t))}function v(i,e,t){let n=i,u=new P;u.setSub(e,t);let s=u.length();return 2*n*Math.asin(s/(2*n))}export{re as a};
