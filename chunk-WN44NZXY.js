import{b as q}from"./chunk-VOFKUGRY.js";import{a as A,b as C}from"./chunk-VTHXE323.js";var W=2048,N=1.5,T=8;function V(t,i){let{format:e,quality:o,rotation:a,disableDecorations:h}=t||{},n=R(t,i.padding),r=$(t,{width:i.width-n.left-n.right,height:i.height-n.top-n.bottom}),{width:l,height:d}=_(t,r),u=O(e),f=Q[u];return{format:u,quality:q(o??f,0,100),area:r,width:l,height:d,rotation:a,disableDecorations:!!h,ignoreBackground:!!t?.ignoreBackground,ignorePadding:!!t?.ignorePadding}}function dt(t,i){let e=V(t,i),o=e.area,a=e.width/o.width,h=R(e,i.padding),n=h.left+h.right,r=h.top+h.bottom,l=i.width-n,d=i.height-r,u=Math.floor(l*a+n),f=Math.floor(d*a+r),g=t?.layers??[],w=e.ignoreBackground,j=e.ignorePadding;return{framebufferWidth:u,framebufferHeight:f,region:{x:Math.floor(o.x*a)+h.left,y:Math.floor(o.y*a)+h.top,width:e.width,height:e.height},format:e.format,quality:e.quality,rotation:e.rotation,pixelRatio:a,layers:g,disableDecorations:e.disableDecorations,ignoreBackground:w,ignorePadding:j,objectAndLayerIdColor:!1}}function ut(t,i,e){let{ctx:o,canvas:a}=F(t,e),h=o.getImageData(0,0,t.width,t.height),n=Z(a,i);return L(a),{dataUrl:n,data:h}}function ft(t,i){let{ctx:e,canvas:o}=F(t,i),a=e.getImageData(0,0,t.width,t.height);return L(o),a}function F(t,i){let e=X();i.premultipliedAlpha&&ot(t),e.width=t.width,e.height=t.height;let o=e.getContext("2d",{willReadFrequently:!0});return o.putImageData(t,0,0),i.flipY&&it(o),{ctx:o,canvas:e}}function L(t){t.width=0,t.height=0}function X(){return v==null&&(v=document.createElement("canvas")),v}var v=null;function Z(t,i){let e=at[i.format],o=i.quality/100;return t.toDataURL(e,o)}function ct(t,i){let e=O(t),o=Q[e];return{format:e,quality:q(i??o,0,100)}}function st(t,i){return i/Math.max(t[0],t[1])}function wt(t,i,e,o=0,a=0,h=t.width-o,n=t.height-a,r=!1){let{data:l}=t,{width:d,height:u,data:f}=i,g=h/d,w=n/u,j=Math.ceil(g/2),Y=Math.ceil(w/2),z=t.width;for(let s=0;s<u;s++)for(let m=0;m<d;m++){let x=4*(m+(r?u-s-1:s)*d),y=0,I=0,P=0,S=0,k=0,B=0,G=(s+.5)*w;for(let b=Math.floor(s*w);b<(s+1)*w;b++){let H=Math.abs(G-(b+.5))/Y,J=(m+.5)*g,K=H*H;for(let D=Math.floor(m*g);D<(m+1)*g;D++){let U=Math.abs(J-(D+.5))/j,M=Math.sqrt(K+U*U);if(M>=1)continue;let c=2*M*M*M-3*M*M+1,p=4*(o+D+(a+b)*z);B+=c*l[p+3],I+=c,!e&&l[p+3]<255&&(c=c*l[p+3]/255),P+=c*l[p],S+=c*l[p+1],k+=c*l[p+2],y+=c}}f[x]=P/y,f[x+1]=S/y,f[x+2]=k/y,f[x+3]=B/I}return i}function mt(t,i,e){if(!i)return t;let{framebufferWidth:o,framebufferHeight:a,pixelRatio:h,region:n}=t,r=R(t,e),l=r.left+r.right,d=r.top+r.bottom,u=o-l,f=a-d,g=Math.min(T,Math.min((W-l)/u,(W-d)/f));return g<N?t:C(A({},t),{framebufferWidth:Math.round(u*g)+l,framebufferHeight:Math.round(f*g)+d,pixelRatio:h*g,resample:{region:{x:Math.round((n.x-r.left)*g)+r.left,y:Math.round((n.y-r.top)*g)+r.top,width:Math.round(n.width*g),height:Math.round(n.height*g)},width:o,height:a}})}function _(t,i){if(!t)return i;let e=t.width,o=t.height;if(e!=null&&o!=null)return{width:Math.floor(e),height:Math.floor(o)};if(e==null&&o==null)return i;let a=i.width/i.height;return o==null?{width:Math.floor(e),height:Math.floor(e/a)}:{width:Math.floor(o*a),height:Math.floor(o)}}function $(t,i){let e={x:0,y:0,width:i.width,height:i.height};if(t?.area){t.area.x!=null&&(e.x=Math.floor(t.area.x)),t.area.y!=null&&(e.y=Math.floor(t.area.y));let o=t.area.width!=null?Math.floor(t.area.width):null,a=t.area.height!=null?Math.floor(t.area.height):null;if(e.width=i.width-e.x,e.height=i.height-e.y,o!=null&&a!=null)e.width=Math.min(e.width,o),e.height=Math.min(e.height,a);else if(o==null&&a!=null){let h=Math.min(e.width,o);e.height=h/e.width*e.height,e.width=h}else if(o!=null&&a==null){let h=Math.min(e.height,a);e.width=h/e.height*e.width,e.height=h}}return tt(et(e,t),i)}function tt(t,i){let e=Math.floor(Math.max(t.x,0)),o=Math.floor(Math.max(t.y,0)),a={x:e,y:o,width:Math.floor(Math.min(t.width,i.width-e)),height:Math.floor(Math.min(t.height,i.height-o))},h=a.width/a.height,n=t.width/t.height;if(n===h)return a;if(n>h){let d=Math.floor(a.width/n),u=a.height-d;return{x:a.x,y:Math.floor(a.y+u/2),width:a.width,height:d}}let r=Math.floor(a.height*n),l=a.width-r;return{x:Math.floor(a.x+l/2),y:a.y,width:r,height:a.height}}function et(t,i){if(i?.width==null||i.height==null)return t;let e=i.width/i.height,o=t.width/t.height;if(o===e)return t;if(o<e){let h=Math.floor(t.height*e);return t.x-=(h-t.width)/2,t.width=h,t}let a=Math.floor(t.width/e);return t.y-=(a-t.height)/2,t.height=a,t}function R(t,i){return!i||t?.ignorePadding?nt:i}function O(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return ht}}function it(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function ot(t){let i=t.data,e=i.length;for(let o=0;o<e;o+=4){let a=i[o+3];if(a!==255&&a>0){let h=255/a;i[o]=i[o]*h,i[o+1]=i[o+1]*h,i[o+2]=i[o+2]*h}}}var at={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},E=98,ht="png",Q={png:100,jpg:E,jpeg:E},nt={top:0,right:0,bottom:0,left:0};export{V as a,dt as b,ut as c,ft as d,Z as e,ct as f,st as g,wt as h,mt as i};
