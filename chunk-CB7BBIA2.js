import{e as G}from"./chunk-B6OGPRTQ.js";import"./chunk-XSALJEMC.js";import"./chunk-JAPGPEA6.js";import"./chunk-UFTHBQFR.js";import"./chunk-VU5W7W6Y.js";import{a as ue,b as Se}from"./chunk-2AZGC46B.js";import{a as xe,b as ve,c as C,d as f}from"./chunk-HR4LHAHO.js";import"./chunk-DJ6TVMFM.js";import{a as fe}from"./chunk-A6AUN6JK.js";import"./chunk-OC2XJJQU.js";import{a as P}from"./chunk-BYX5KLGZ.js";import{c as L,g as O}from"./chunk-5IRLA4AM.js";import"./chunk-AVLSWJCG.js";import{a as de,f as me,n as x,p as ge,s as _}from"./chunk-IOI3V6WL.js";import{c as y,e as E,g as m,l as he,o as j,p as ce,s as le}from"./chunk-IAM754TS.js";import"./chunk-DLMQHZTF.js";import"./chunk-2XQT24NO.js";import"./chunk-Y4OUS3AZ.js";import"./chunk-5K5ZHVX6.js";import"./chunk-SNPAQLOL.js";import{d as H,f as b}from"./chunk-RXT2WPNA.js";import"./chunk-VC7OIMIK.js";import"./chunk-NIYDRLW4.js";import{w as g}from"./chunk-WTJO2NGM.js";import"./chunk-3BZAI7HK.js";import"./chunk-LNYBTIG7.js";import{b as D,c as $}from"./chunk-EXXSZWI5.js";import"./chunk-6T37AWU6.js";import"./chunk-4AIH3WFI.js";import"./chunk-JOGV3DWE.js";import"./chunk-SKMO433W.js";import{a as w}from"./chunk-2FO7ARYZ.js";import"./chunk-NOQEJXLK.js";import"./chunk-DJW5LMRG.js";import{d as J,h as oe,i as M,j as K,l as ne,o as ae,q as pe}from"./chunk-QXXXCEV5.js";import"./chunk-TCGGI7DC.js";import"./chunk-ALWV3RJ2.js";import"./chunk-7C6Z24SS.js";import{c as re,e as ie,n as se}from"./chunk-5WKDXHVH.js";import"./chunk-B5LBE5HD.js";import"./chunk-F6A6XWW4.js";import"./chunk-AESEF3B2.js";import"./chunk-QPGCDGIN.js";import"./chunk-PTZYZULI.js";import"./chunk-KZKWOEFD.js";import"./chunk-LNVVFNTC.js";import"./chunk-XSTBHERR.js";import"./chunk-YQPWWSMJ.js";import"./chunk-JEIB6WNP.js";import"./chunk-6JJCXUHW.js";import"./chunk-7B2UKJ5N.js";import"./chunk-RSDQHAJX.js";import"./chunk-OGS2SUK5.js";import"./chunk-XFESK2YB.js";import"./chunk-WNSGKHQ6.js";import"./chunk-J5MXC6AL.js";import"./chunk-OLOKUDVI.js";import"./chunk-RJWOVI3M.js";import"./chunk-IB2IUO7T.js";import"./chunk-MS3KE2OO.js";import{a as T}from"./chunk-NHSDW26F.js";import"./chunk-NMAGYK3Q.js";import"./chunk-GWBRHLNH.js";import"./chunk-WKJJQIBC.js";import"./chunk-VDADRLEF.js";import"./chunk-XPRVY6JT.js";import"./chunk-7N3ZKWML.js";import"./chunk-E62WHYYG.js";import"./chunk-QDTU3MWT.js";import"./chunk-BCREO4Q5.js";import"./chunk-3SDSCSDJ.js";import"./chunk-I4M2OT5W.js";import"./chunk-NTVLK3P2.js";import"./chunk-WMQNRNIU.js";import"./chunk-HD52PWPC.js";import"./chunk-EIPVFA6F.js";import"./chunk-VOFKUGRY.js";import{ia as te}from"./chunk-IG66NQHW.js";import"./chunk-ARRCN5K3.js";import"./chunk-5TW726OD.js";import"./chunk-VGD3XLDH.js";import"./chunk-LB5YQINJ.js";import{b as ee}from"./chunk-EKMHQEJY.js";import"./chunk-VACZNAP3.js";import"./chunk-JKNCWG7E.js";import"./chunk-F7VRLFCB.js";import"./chunk-7IPIJKWU.js";import"./chunk-7R33MKVL.js";import"./chunk-ISSJ3A6Y.js";import"./chunk-VDKRSX77.js";import"./chunk-WUA6PW3I.js";import"./chunk-E57FTRWF.js";import"./chunk-U4J5SECU.js";import"./chunk-7EG726PT.js";import{L as Z,d as I}from"./chunk-C7INQGWT.js";import{H as Y}from"./chunk-WMHJC7XF.js";import"./chunk-NJEWDTYF.js";import"./chunk-N3SDOFND.js";import"./chunk-OVHPPCBL.js";import"./chunk-FNXQZPHT.js";import"./chunk-3TQOUBNU.js";import"./chunk-D2LVMNOU.js";import"./chunk-SNFOAZZQ.js";import{a as R}from"./chunk-QGVBCWUY.js";import"./chunk-HHDFN2GK.js";import"./chunk-47GHT6OF.js";import{f as X}from"./chunk-VTHXE323.js";var v=class{constructor(r,e){this.view=r,this.options=e,this.squaredShortLineThreshold=P.shortLineThreshold*P.shortLineThreshold}snap(r,e){return e.vertexHandle!=null?e.vertexHandle.type!=="vertex"?[]:this.snapExistingVertex(r,e):this.snapNewVertex(r,e)}edgeExceedsShortLineThreshold(r,e){return this.exceedsShortLineThreshold(m(r.leftVertex.pos,this.view,e),m(r.rightVertex.pos,this.view,e),e)}exceedsShortLineThreshold(r,e,{spatialReference:t}){return this.squaredShortLineThreshold===0||x(f(e,t,g,this.view),f(r,t,g,this.view))>this.squaredShortLineThreshold}isVertical(r,e,{spatialReference:t}){let i=te(t);return M(r,e)*i<P.verticalLineThresholdMeters}squaredProximityThreshold(r){return r==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){let{distance:r,touchSensitivityMultiplier:e}=this.options,t=r*e;return t*t}};var N=class extends v{snapNewVertex(r,e){let t=e.editGeometryOperations.data.components[0],i=t.edges.length,s=[];if(i<1)return s;let{spatialReference:o}=e,a=f(r,o,g,this.view),{view:n}=this,p=t.edges[i-1],h=p;do{if(this.edgeExceedsShortLineThreshold(h,e)){let d=_(h,n,e);this._processCandidateProposal(d.left,d.right,r,a,e,s)}h=h.leftVertex.leftEdge}while(h&&h!==p);return s}snapExistingVertex(r,e){let t=[],i=e.vertexHandle,s=i.component;if(s.edges.length<2)return t;let{view:o}=this,{spatialReference:a}=e,n=f(r,a,g,o),p=i.leftEdge,h=i.rightEdge;p&&h&&this.edgeExceedsShortLineThreshold(p,e)&&this.edgeExceedsShortLineThreshold(h,e)&&this._processCandidateProposal(m(p.leftVertex.pos,o,e),m(h.rightVertex.pos,o,e),r,n,e,t);let d=s.edges[0],l=d;do{if(l!==i.leftEdge&&l!==i.rightEdge&&this.edgeExceedsShortLineThreshold(l,e)){let u=_(l,o,e);this._processCandidateProposal(u.left,u.right,r,n,e,t)}l=l.rightVertex.rightEdge}while(l&&l!==d);return t}_processCandidateProposal(r,e,t,i,s,o){let{spatialReference:a,pointer:n}=s,p=T();Te(p,r,e,t,s);let h=E(p);x(i,f(h,a,g,this.view))<this.squaredProximityThreshold(n)&&o.push(new fe({lineStart:r,lineEnd:e,targetPoint:h,isDraped:s.elevationInfo?.mode==="on-the-ground"}))}};function Te(c,r,e,t,i){we(c,r,e,t,i)||ye(c,t,r,e)}function we(c,r,e,t,{spatialReference:i}){let s=L(r,e,i,i);if(s==null)return!1;let o=L(e,t,i,i);if(o==null)return!1;let a=G(e,t,i);if(a==null)return!1;let n=Math.abs($.shortestSignedDiff(s,o))>Math.PI/2?D.normalize(s+Math.PI):s;return O(c,e,i,b(a,"meters"),H(n,"radians","geographic"),"geodesic"),c[2]=t[2],!0}function ye(c,r,e,t){de(r,{start:e,end:t,type:le.LINE},c),c[2]=r[2]}var z=class extends v{snapNewVertex(r,e){let t=e.editGeometryOperations.data.components[0],i=t.edges.length,s=t.vertices.length,o=[];if(i<2)return o;let{view:a}=this,n=f(r,e.spatialReference,g,a),p=m(t.vertices[s-1].pos,a,e),h=m(t.vertices[0].pos,a,e),d=t.edges[i-1],l=d;do{if(this.edgeExceedsShortLineThreshold(l,e)){let u=_(l,a,e);this._checkEdgeForParallelLines(u,p,r,n,e,o),this._checkEdgeForParallelLines(u,h,r,n,e,o)}l=l.leftVertex.leftEdge}while(l&&l!==d);return o}snapExistingVertex(r,e){let t=[],i=e.vertexHandle,s=i.component;if(s.edges.length<3)return t;let{view:o}=this,a=f(r,e.spatialReference,g,o),n=i.leftEdge,p=i.rightEdge,h=s.vertices[0],d=m(h.pos,o,e),l=s.vertices.length,u=s.vertices[l-1],A=m(u.pos,o,e),k=s.edges[0],S=k;do{if(S!==n&&S!==p&&this.edgeExceedsShortLineThreshold(S,e)){let q=_(S,o,e);n&&this._checkEdgeForParallelLines(q,m(n.leftVertex.pos,o,e),r,a,e,t),p&&this._checkEdgeForParallelLines(q,m(p.rightVertex.pos,o,e),r,a,e,t),i===h?this._checkEdgeForParallelLines(q,A,r,a,e,t):i===u&&this._checkEdgeForParallelLines(q,d,r,a,e,t)}S=S.rightVertex.rightEdge}while(S&&S!==k);return t}_checkEdgeForParallelLines(r,e,t,i,s,o){let a=r.left,n=r.right;if(j(V,e,a,n),K(V,e)<P.parallelLineThreshold)return;j(V,t,a,n,e);let{spatialReference:p,pointer:h}=s,d=E(y(V[0],V[1],t[2]));if(x(i,f(d,p,g,this.view))<this.squaredProximityThreshold(h)){if(this.isVertical(d,e,s)||this.isVertical(a,n,s)||Le(r,o))return;o.push(new ue({referenceLine:r,lineStart:e,targetPoint:d,isDraped:s.elevationInfo?.mode==="on-the-ground"}))}}};function Le(c,r){let e=c.left,t=c.right;for(let i of r)if(j(V,t,i.constraint.start,i.constraint.end,e),K(V,t)<P.parallelLineThreshold)return i.addReferenceLine(c),!0;return!1}var V=w();var U=class extends v{snapNewVertex(r,e){let t=e.editGeometryOperations.data.components[0],i=[];if(t.vertices.length<2)return i;let{view:s}=this,o=f(r,e.spatialReference,g,s),a=t.vertices.at(-1);this._checkForSnappingCandidate(C.LastVertex,i,a.leftEdge,a,a.leftEdge.leftVertex,r,o,e);let n=t.vertices[0];return this._checkForSnappingCandidate(C.FirstVertex,i,n.rightEdge,n,n.rightEdge.rightVertex,r,o,e),i}snapExistingVertex(r,e){let t=[],i=e.vertexHandle;if(i.component.vertices.length<3)return t;let{view:s}=this,o=f(r,e.spatialReference,g,s),a=i.leftEdge,n=i.rightEdge;if(a?.leftVertex.leftEdge){let p=a.leftVertex.leftEdge;this._checkForSnappingCandidate(C.ExistingEdge,t,p,p.rightVertex,p.leftVertex,r,o,e)}if(n?.rightVertex.rightEdge){let p=n.rightVertex.rightEdge;this._checkForSnappingCandidate(C.ExistingEdge,t,p,p.leftVertex,p.rightVertex,r,o,e)}return t}_checkForSnappingCandidate(r,e,t,i,s,o,a,n){if(!this.edgeExceedsShortLineThreshold(t,n))return;let p=this.view,h=m(i.pos,p,n),d=m(s.pos,p,n);_e(Ee,d,h,o,n),this._checkForSnappingCandidateAlongProjectedRay(r,e,d,h,Ee,o,a,n)}_checkForSnappingCandidateAlongProjectedRay(r,e,t,i,s,o,a,n){let{spatialReference:p,pointer:h}=n,d=J(W,o,i),l=ae(s,d)/ne(s),u=oe(W,i,s,l),A=E(y(u[0],u[1],o[2]));if(x(a,f(A,p,g,this.view))>this.squaredProximityThreshold(h)||this.isVertical(A,i,n)||this.isVertical(i,t,n))return;let k=se(T(),i,s,Math.sign(l));e.push(new xe({targetPoint:A,constraint:new me(i,k),previousVertex:t,otherVertex:i,otherVertexType:ve.CENTER,selfSnappingType:r,isDraped:n.elevationInfo?.mode==="on-the-ground"}))}};function _e(c,r,e,t,i){Ae(c,r,e,t,i)||Re(c,r,e)}function Ae(c,r,e,t,{spatialReference:i}){let s=L(r,e,i,i);if(s==null)return!1;let o=L(e,t,i,i);if(o==null)return!1;let a=Math.sign(D.shortestSignedDiff(s,o))*Math.PI*.5,n=H(s+a,"radians","geographic"),p=T(),h=G(e,t,i);return h!=null&&(O(p,e,i,b(h,"meters"),n,"geodesic"),ie(c,p,e),!0)}function Re(c,r,e){let t=J(W,e,r);re(c,t[1],-t[0],0)}var W=w(),Ee=T();var B=class extends v{snapNewVertex(r,e){let t=e.editGeometryOperations.data.components[0],i=[],s=t.vertices.length;if(e.editGeometryOperations.data.type!=="polygon"||s<2)return i;let{view:o}=this,a=t.vertices[0],n=t.vertices[s-1],p=m(a.pos,o,e),h=m(n.pos,o,e);return this._processCandidateProposal(p,h,r,e,i),i}snapExistingVertex(r,e){let t=[],i=e.vertexHandle,s=i.component;if(s.edges.length<2||e.editGeometryOperations.data.type==="polyline"&&(i.index===0||i.index===s.vertices.length-1))return t;let{view:o}=this,a=m(i.leftEdge.leftVertex.pos,o,e),n=m(i.rightEdge.rightVertex.pos,o,e);return this._processCandidateProposal(a,n,r,e,t),t}_processCandidateProposal(r,e,t,i,s){if(!this.exceedsShortLineThreshold(r,e,i))return;let o=pe(Pe,r,e,.5),a=.5*M(r,e),n=ce(Pe,t,o,a),p=E(y(n[0],n[1],t[2])),{spatialReference:h,pointer:d}=i,l=f(t,h,g,this.view);if(x(l,f(p,h,g,this.view))<this.squaredProximityThreshold(d)){if(this.isVertical(r,p,i)||this.isVertical(p,e,i))return;s.push(new Se({targetPoint:p,point1:r,point2:e,isDraped:i.elevationInfo?.mode==="on-the-ground"}))}}},Pe=w();var F=class extends Z{constructor(c){super(c),this.updating=!1,this._snappers=new ee,this._domain=he.SELF}initialize(){this._snappers.push(new z(this.view,this.options),new N(this.view,this.options),new U(this.view,this.options),new B(this.view,this.options))}set options(c){this._set("options",c);for(let r of this._snappers)r.options=c}fetchCandidates(c,r,e){return X(this,null,function*(){if(!(r&this._domain&&this.options.effectiveSelfEnabled))return[];let t=[];for(let i of this._snappers.items)for(let s of i.snap(c,e))t.push(s);return ge(c,t),t})}};R([I({readOnly:!0})],F.prototype,"updating",void 0),R([I({constructOnly:!0})],F.prototype,"view",void 0),R([I()],F.prototype,"options",null),F=R([Y("esri.views.interactive.snapping.SelfSnappingEngine")],F);export{F as SelfSnappingEngine};
