import"./chunk-3VETG6KN.js";import"./chunk-45BQJH7U.js";import"./chunk-ESSDCWGF.js";import"./chunk-WVKBXQWE.js";import"./chunk-GK3RYCKG.js";import"./chunk-D45JG62Z.js";import"./chunk-B564E6X6.js";import"./chunk-TBHSFWI7.js";import"./chunk-MEGSPQVO.js";import"./chunk-FSWSNKJD.js";import"./chunk-3AS27HNO.js";import"./chunk-GV3ZFCVD.js";import"./chunk-SOEEM7Z7.js";import"./chunk-T7PUQGWM.js";import"./chunk-MVDZB4AK.js";import"./chunk-44A27HB7.js";import"./chunk-47NSYSFY.js";import"./chunk-QXNVQZT7.js";import"./chunk-RWCIDBNQ.js";import"./chunk-3K4AMRAC.js";import{d as Z,i as q}from"./chunk-XIZXEWWA.js";import"./chunk-EDAGF7R6.js";import"./chunk-6EWMYOA7.js";import{a as z,b as $}from"./chunk-VRPEURU5.js";import"./chunk-ICWXUNPZ.js";import"./chunk-VC7OIMIK.js";import"./chunk-NIYDRLW4.js";import"./chunk-3Q427ME6.js";import"./chunk-3BZAI7HK.js";import"./chunk-LNYBTIG7.js";import"./chunk-2ILDS6SI.js";import"./chunk-FVILOOND.js";import"./chunk-6T37AWU6.js";import"./chunk-4AIH3WFI.js";import"./chunk-SKMO433W.js";import"./chunk-2FO7ARYZ.js";import"./chunk-NOQEJXLK.js";import"./chunk-DJW5LMRG.js";import"./chunk-QMKRRCM3.js";import"./chunk-TCGGI7DC.js";import"./chunk-ALWV3RJ2.js";import"./chunk-7C6Z24SS.js";import"./chunk-5WKDXHVH.js";import"./chunk-B5LBE5HD.js";import"./chunk-F6A6XWW4.js";import"./chunk-AESEF3B2.js";import"./chunk-QPGCDGIN.js";import"./chunk-PTZYZULI.js";import"./chunk-KZKWOEFD.js";import"./chunk-LNVVFNTC.js";import"./chunk-YQPWWSMJ.js";import"./chunk-JEIB6WNP.js";import"./chunk-7B2UKJ5N.js";import"./chunk-RSDQHAJX.js";import"./chunk-OGS2SUK5.js";import"./chunk-WNSGKHQ6.js";import"./chunk-J5MXC6AL.js";import"./chunk-OLOKUDVI.js";import"./chunk-RJWOVI3M.js";import"./chunk-IB2IUO7T.js";import"./chunk-MS3KE2OO.js";import{a as Y}from"./chunk-NHSDW26F.js";import"./chunk-NMAGYK3Q.js";import"./chunk-GWBRHLNH.js";import"./chunk-VDADRLEF.js";import"./chunk-XPRVY6JT.js";import"./chunk-7N3ZKWML.js";import"./chunk-E62WHYYG.js";import"./chunk-QDTU3MWT.js";import"./chunk-BCREO4Q5.js";import"./chunk-3SDSCSDJ.js";import"./chunk-I4M2OT5W.js";import"./chunk-NTVLK3P2.js";import{a as O}from"./chunk-WMQNRNIU.js";import"./chunk-HD52PWPC.js";import"./chunk-EIPVFA6F.js";import{r as G}from"./chunk-VOFKUGRY.js";import"./chunk-IG66NQHW.js";import"./chunk-ARRCN5K3.js";import"./chunk-IXCTZWTQ.js";import"./chunk-6PN3I333.js";import"./chunk-ZTJLFKGG.js";import"./chunk-5TW726OD.js";import"./chunk-VGD3XLDH.js";import"./chunk-F7VRLFCB.js";import"./chunk-7IPIJKWU.js";import"./chunk-7R33MKVL.js";import"./chunk-ISSJ3A6Y.js";import{a as J}from"./chunk-VDKRSX77.js";import"./chunk-WUA6PW3I.js";import"./chunk-E57FTRWF.js";import"./chunk-U4J5SECU.js";import"./chunk-7EG726PT.js";import"./chunk-C7INQGWT.js";import"./chunk-WMHJC7XF.js";import"./chunk-NJEWDTYF.js";import"./chunk-N3SDOFND.js";import"./chunk-OVHPPCBL.js";import"./chunk-FNXQZPHT.js";import{a as W}from"./chunk-3TQOUBNU.js";import"./chunk-D2LVMNOU.js";import"./chunk-SNFOAZZQ.js";import"./chunk-QGVBCWUY.js";import"./chunk-HHDFN2GK.js";import"./chunk-47GHT6OF.js";import{f as h}from"./chunk-VTHXE323.js";var x,U;(function(e){e[e.None=0]="None",e[e.Int16=1]="Int16",e[e.Int32=2]="Int32"})(x||(x={})),function(e){e[e.Replace=0]="Replace",e[e.Outside=1]="Outside",e[e.Inside=2]="Inside",e[e.Finished=3]="Finished"}(U||(U={}));function K(){return C||(C=new Promise(e=>import("./chunk-Y473QWNT.js").then(t=>t.i).then(({default:t})=>{let n=t({locateFile:ce,onRuntimeInitialized:()=>e(n)});delete n.then})).catch(e=>{throw e})),C}function ce(e){return J(`esri/libs/i3s/${e}`)}var C;var I=class{constructor(t,n,o,i,f,a){this.layout=t,this.interleavedVertexData=n,this.indices=o,this.hasColors=i,this.hasModifications=f,this.positionData=a}},N=class{constructor(t,n,o,i,f,a,c){this.componentOffsets=t,this.featureIds=n,this.anchorIds=o,this.anchors=i,this.transformedGeometry=f,this.globalTrafo=a,this.obb=c}};var Ne=new W({deallocator:null}),Ee=Y();var Q,y,X,ee,te;(function(e){e[e.Unmodified=0]="Unmodified",e[e.Culled=1]="Culled",e[e.NotChecked=2]="NotChecked"})(Q||(Q={})),function(e){e[e.Unmodified=0]="Unmodified",e[e.PotentiallyModified=1]="PotentiallyModified",e[e.Culled=2]="Culled",e[e.Unknown=3]="Unknown",e[e.NotChecked=4]="NotChecked"}(y||(y={}));(function(e){e[e.Unknown=0]="Unknown",e[e.Uncached=1]="Uncached",e[e.Cached=2]="Cached"})(X||(X={})),function(e){e[e.None=0]="None",e[e.MaxScreenThreshold=1]="MaxScreenThreshold",e[e.ScreenSpaceRelative=2]="ScreenSpaceRelative",e[e.RemovedFeatureDiameter=3]="RemovedFeatureDiameter",e[e.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"}(ee||(ee={})),function(e){e[e.Hole=0]="Hole",e[e.Leaf=1]="Leaf"}(te||(te={}));function $e(e){return h(this,null,function*(){s=yield b();let t=[e.geometryBuffer];return{result:ne(s,e,t),transferList:t}})}function Ze(e){return h(this,null,function*(){s=yield b();let t=[e.geometryBuffer],{geometryBuffer:n}=e,o=n.byteLength,i=s._malloc(o),f=new Uint8Array(s.HEAPU8.buffer,i,o);f.set(new Uint8Array(n));let a=s.dracoDecompressPointCloudData(i,f.byteLength);if(s._free(i),a.error.length>0)throw new Error(`i3s.wasm: ${a.error}`);let c=a.featureIds?.length>0?a.featureIds.slice():null,d=a.positions.slice();return c&&t.push(c.buffer),t.push(d.buffer),{result:{positions:d,featureIds:c},transferList:t}})}function qe(e){return h(this,null,function*(){yield b(),ue(e);let t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}})}function Ke(e){return h(this,null,function*(){yield b(),le(e)})}function Qe(e){return h(this,null,function*(){s=yield b(),s.setLegacySchema(e.context,e.jsonSchema)})}function Xe(e){return h(this,null,function*(){let{localMatrix:t,origin:n,positions:o,vertexSpace:i}=e,f=O.fromJSON(e.inSpatialReference),a=O.fromJSON(e.outSpatialReference),c,[{projectBuffer:d},{initializeProjection:L}]=yield Promise.all([import("./chunk-HMBRWDDU.js"),import("./chunk-EHL6HNJF.js")]);yield L(f,a);let R=[0,0,0];if(!d(n,f,0,R,a,0))throw new Error("Failed to project");if(i.type==="georeferenced"&&i.origin==null){if(c=new Float64Array(o.length),!d(o,f,0,c,a,0,c.length/3))throw new Error("Failed to project")}else{let l=i.type==="georeferenced"?z.fromJSON(i):$.fromJSON(i),{projectMeshVertexPositions:u}=yield import("./chunk-ZW7ARYYF.js"),m=u({vertexAttributes:{position:o},transform:t?{localMatrix:t}:void 0,vertexSpace:l,spatialReference:f},a);if(!m)throw new Error("Failed to project");c=m}let A=c.length,[v,S,M]=R;for(let l=0;l<A;l+=3)c[l]-=v,c[l+1]-=S,c[l+2]-=M;return{result:{projected:c,original:o,projectedOrigin:R},transferList:[c.buffer,o.buffer]}})}function et(n){return h(this,arguments,function*({normalMatrix:e,normals:t}){let o=new Float32Array(t.length);return Z(o,t,e),G(e)&&q(o,o),{result:{transformed:o,original:t},transferList:[o.buffer,t.buffer]}})}function tt(e){se(e)}var fe,s;function le(e){if(!s)return;let t=e.modifications,n=s._malloc(8*t.length),o=new Float64Array(s.HEAPU8.buffer,n,t.length);for(let i=0;i<t.length;++i)o[i]=t[i];s.setModifications(e.context,n,t.length,e.isGeodetic),s._free(n)}function ne(e,t,n){let{context:o,globalTrafo:i,mbs:f,obbData:a,elevationOffset:c,geometryBuffer:d,geometryDescriptor:L,indexToVertexProjector:R,vertexToRenderProjector:A}=t,v=e._malloc(d.byteLength),S=33,M=e._malloc(S*Float64Array.BYTES_PER_ELEMENT),l=new Uint8Array(e.HEAPU8.buffer,v,d.byteLength);l.set(new Uint8Array(d));let u=new Float64Array(e.HEAPU8.buffer,M,S);E(u,[NaN,NaN,NaN]);let m=u.byteOffset+3*u.BYTES_PER_ELEMENT,w=new Float64Array(u.buffer,m);E(w,i),m+=16*u.BYTES_PER_ELEMENT,w=new Float64Array(u.buffer,m),E(w,f),m+=4*u.BYTES_PER_ELEMENT,a&&(w=new Float64Array(u.buffer,m),E(w,a));let P=L,oe={isDraco:!1,isLegacy:!1,color:t.layouts.some(p=>p.some(g=>g.name==="color")),normal:t.needNormals&&t.layouts.some(p=>p.some(g=>g.name==="normalCompressed")),uv0:t.layouts.some(p=>p.some(g=>g.name==="uv0")),uvRegion:t.layouts.some(p=>p.some(g=>g.name==="uvRegion")),featureIndex:P.featureIndex},r=e.process(o,!!t.obbData,v,l.byteLength,P,oe,M,c,R,A,t.normalReferenceFrame);if(e._free(M),e._free(v),r.error.length>0)throw new Error(`i3s.wasm: ${r.error}`);if(r.discarded)return null;let F=r.componentOffsets.length>0?r.componentOffsets.slice():null,T=r.featureIds.length>0?r.featureIds.slice():null,re=r.anchorIds.length>0?Array.from(r.anchorIds):null,ie=r.anchors.length>0?Array.from(r.anchors):null,j=r.interleavedVertedData.slice().buffer,B=r.indicesType===x.Int16?new Uint16Array(r.indices.buffer,r.indices.byteOffset,r.indices.byteLength/2).slice():new Uint32Array(r.indices.buffer,r.indices.byteOffset,r.indices.byteLength/4).slice(),_=r.positions.slice(),{buffer:D,byteOffset:k,byteLength:V}=r.positionIndices,H=r.positionIndicesType===x.Int16?new Uint16Array(D,k,V/2).slice():new Uint32Array(D,k,V/4).slice(),ae=new I(t.layouts[0],j,B,r.hasColors,r.hasModifications,{data:_,indices:H});return T&&n.push(T.buffer),F&&n.push(F.buffer),n.push(j),n.push(B.buffer),n.push(_.buffer),n.push(H.buffer),new N(F,T,re,ie,ae,i,r.obb)}function nt(e){return e===0?y.Unmodified:e===1?y.PotentiallyModified:e===2?y.Culled:y.Unknown}function ue(e){if(!s)return;let{context:t,buffer:n}=e,o=s._malloc(n.byteLength),i=n.byteLength/Float64Array.BYTES_PER_ELEMENT,f=new Float64Array(s.HEAPU8.buffer,o,i),a=new Float64Array(n);f.set(a),s.filterOBBs(t,o,i),a.set(f),s._free(o)}function se(e){s&&s.destroy(e)===0&&(s=null)}function E(e,t){for(let n=0;n<t.length;++n)e[n]=t[n]}function st(){return h(this,null,function*(){s||(yield b())})}function b(){return h(this,null,function*(){return s||(s=yield fe??=K()),s})}var ot={transform:(e,t)=>s&&ne(s,e,t),destroy:se};export{tt as destroyContext,Ze as dracoDecompressPointCloudData,qe as filterObbsForModifications,ue as filterObbsForModificationsSync,st as initialize,nt as interpretObbModificationResults,$e as process,Xe as project,Qe as setLegacySchema,Ke as setModifications,le as setModificationsSync,ot as test,et as transformNormals};
