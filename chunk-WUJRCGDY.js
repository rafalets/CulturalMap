import{a as oe}from"./chunk-CVRJ6GOM.js";import{a as c}from"./chunk-OGS2SUK5.js";import{$ as pe,p as ie,t as se}from"./chunk-HKHTIKVW.js";import{a as U}from"./chunk-WNSGKHQ6.js";import{a as re}from"./chunk-J5MXC6AL.js";import{a as at}from"./chunk-HD52PWPC.js";import{a as b}from"./chunk-EIPVFA6F.js";import{a as ee}from"./chunk-5TW726OD.js";import{b as q}from"./chunk-EKMHQEJY.js";import{a as Zt}from"./chunk-ISSJ3A6Y.js";import{a as lt,b as te}from"./chunk-WUA6PW3I.js";import{f as a}from"./chunk-7EG726PT.js";import{L as nt,d as o}from"./chunk-C7INQGWT.js";import{H as i,q as Xt,r as f}from"./chunk-WMHJC7XF.js";import{K as Yt}from"./chunk-D2LVMNOU.js";import{a as t}from"./chunk-QGVBCWUY.js";import{b as d,r as Qt}from"./chunk-HHDFN2GK.js";import{a as Ht,f as pt}from"./chunk-VTHXE323.js";var _t,R=_t=class extends a{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new _t({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};t([o({type:String,json:{write:!0}})],R.prototype,"name",void 0),t([o({type:String,json:{write:!0}})],R.prototype,"title",void 0),t([o({type:String,json:{write:!0}})],R.prototype,"expression",void 0),t([o({type:["string","number"],json:{write:!0}})],R.prototype,"returnType",void 0),R=_t=t([i("esri.popup.ExpressionInfo")],R);var ne=R;var jt,y=jt=class extends oe.IdentifiableMixin(nt){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new jt({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};t([o()],y.prototype,"active",void 0),t([o()],y.prototype,"className",void 0),t([o()],y.prototype,"disabled",void 0),t([o()],y.prototype,"icon",void 0),t([o()],y.prototype,"id",void 0),t([o()],y.prototype,"indicator",void 0),t([o()],y.prototype,"title",void 0),t([o()],y.prototype,"type",void 0),t([o()],y.prototype,"visible",void 0),y=jt=t([i("esri.support.actions.ActionBase")],y);var P=y;var St,mt=St=class extends P{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new St({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};t([o()],mt.prototype,"image",void 0),mt=St=t([i("esri.support.actions.ActionButton")],mt);var ae=mt;var dt=class extends a{constructor(e){super(e),this.type=null}};t([o({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],dt.prototype,"type",void 0),dt=t([i("esri.popup.content.Content")],dt);var m=dt;var ct=new lt({asc:"ascending",desc:"descending"}),G=class extends c.ClonableMixin(a){constructor(e){super(e),this.field=null,this.order="ascending"}};t([o({type:String,json:{write:!0}})],G.prototype,"field",void 0),t([o({type:ct.apiValues,json:{type:ct.jsonValues,read:ct.read,write:ct.write}})],G.prototype,"order",void 0),G=t([i("esri.popup.support.AttachmentsOrderByInfo")],G);var le=G;var N=class extends c.ClonableMixin(m){constructor(e){super(e),this.description=null,this.displayType="auto",this.orderByFields=null,this.title=null,this.type="attachments"}};t([o({type:String,json:{write:!0}})],N.prototype,"description",void 0),t([o({type:["auto","preview","list"],json:{write:!0}})],N.prototype,"displayType",void 0),t([o({type:[le],json:{write:!0}})],N.prototype,"orderByFields",void 0),t([o({type:String,json:{write:!0}})],N.prototype,"title",void 0),t([o({type:["attachments"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],N.prototype,"type",void 0),N=t([i("esri.popup.content.AttachmentsContent")],N);var T=N;var Ct,O=Ct=class extends m{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new Ct({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?d(this.outFields):null})}};t([o()],O.prototype,"creator",void 0),t([o()],O.prototype,"destroyer",void 0),t([o()],O.prototype,"outFields",void 0),t([o({type:["custom"],readOnly:!0})],O.prototype,"type",void 0),O=Ct=t([i("esri.popup.content.CustomContent")],O);var Rt=O;var Tt,D=Tt=class extends a{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new Tt({title:this.title,expression:this.expression})}};t([o({type:String,json:{write:!0}})],D.prototype,"title",void 0),t([o({type:String,json:{write:!0}})],D.prototype,"expression",void 0),t([o({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],D.prototype,"returnType",void 0),D=Tt=t([i("esri.popup.ElementExpressionInfo")],D);var me=D;var Ot,$=Ot=class extends m{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){return new Ot({expressionInfo:this.expressionInfo?.clone()})}};t([o({type:me,json:{write:!0}})],$.prototype,"expressionInfo",void 0),t([o({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],$.prototype,"type",void 0),$=Ot=t([i("esri.popup.content.ExpressionContent")],$);var W=$;var K=class extends c.ClonableMixin(a){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};t([U(ee)],K.prototype,"dateFormat",void 0),t([o({type:Boolean,json:{write:!0}})],K.prototype,"digitSeparator",void 0),t([o({type:f,json:{write:!0}})],K.prototype,"places",void 0),K=t([i("esri.popup.support.FieldInfoFormat")],K);var de=K;var At,v=At=class extends a{constructor(e){super(e),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new At({fieldName:this.fieldName,format:this.format?.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};t([o({type:String,json:{write:!0}})],v.prototype,"fieldName",void 0),t([o({type:de,json:{write:!0}})],v.prototype,"format",void 0),t([o({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],v.prototype,"isEditable",void 0),t([o({type:String,json:{write:!0}})],v.prototype,"label",void 0),t([U(new lt({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],v.prototype,"stringFieldOption",void 0),t([o({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],v.prototype,"statisticType",void 0),t([o({type:String,json:{write:!0}})],v.prototype,"tooltip",void 0),t([o({type:Boolean,json:{write:!0}})],v.prototype,"visible",void 0),v=At=t([i("esri.popup.FieldInfo")],v);var ut=v;var Mt,g=Mt=class extends m{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,r){r.fieldInfos=e&&e.map(s=>s.toJSON())}clone(){return new Mt(d({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};t([o({type:Object,json:{write:!0}})],g.prototype,"attributes",void 0),t([o({type:String,json:{write:!0}})],g.prototype,"description",void 0),t([o({type:[ut]})],g.prototype,"fieldInfos",void 0),t([b("fieldInfos")],g.prototype,"writeFieldInfos",null),t([o({type:String,json:{write:!0}})],g.prototype,"title",void 0),t([o({type:["fields"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],g.prototype,"type",void 0),g=Mt=t([i("esri.popup.content.FieldsContent")],g);var A=g;var M=class extends a{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};t([o({type:String,json:{write:!0}})],M.prototype,"altText",void 0),t([o({type:String,json:{write:!0}})],M.prototype,"caption",void 0),t([o({type:String,json:{write:!0}})],M.prototype,"title",void 0),t([o({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],M.prototype,"type",void 0),M=t([i("esri.popup.content.mixins.MediaInfo")],M);var V=M;var Et,E=Et=class extends nt{constructor(e){super(e),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new Et({color:this.color?.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};t([o()],E.prototype,"color",void 0),t([o()],E.prototype,"fieldName",void 0),t([o()],E.prototype,"tooltip",void 0),t([o()],E.prototype,"value",void 0),E=Et=t([i("esri.popup.content.support.ChartMediaInfoValueSeries")],E);var ce=E;var Bt,_=Bt=class extends a{constructor(e){super(e),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new Bt({colors:d(this.colors),fields:d(this.fields),normalizeField:this.normalizeField,series:d(this.series),tooltipField:this.tooltipField})}};t([o({type:[re],json:{type:[[f]],write:!0}})],_.prototype,"colors",void 0),t([o({type:[String],json:{write:{isRequired:!0}}})],_.prototype,"fields",void 0),t([o({type:String,json:{write:!0}})],_.prototype,"normalizeField",void 0),t([o({type:[ce],json:{read:!1}})],_.prototype,"series",void 0),t([o({type:String,json:{write:!0}})],_.prototype,"tooltipField",void 0),_=Bt=t([i("esri.popup.content.support.ChartMediaInfoValue")],_);var ue=_;var H=class extends V{constructor(e){super(e),this.type=null,this.value=void 0}};t([o({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],H.prototype,"type",void 0),t([o({type:ue,json:{write:{isRequired:!0}}})],H.prototype,"value",void 0),H=t([i("esri.popup.content.mixins.ChartMediaInfo")],H);var j=H;var S=te()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var kt,ft=kt=class extends j{constructor(e){super(e),this.type="bar-chart"}clone(){return new kt({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};t([o({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:{writer:S.write,isRequired:!0}}})],ft.prototype,"type",void 0),ft=kt=t([i("esri.popup.content.BarChartMediaInfo")],ft);var yt=ft;var Jt,ht=Jt=class extends j{constructor(e){super(e),this.type="column-chart"}clone(){return new Jt({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};t([o({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:{writer:S.write,isRequired:!0}}})],ht.prototype,"type",void 0),ht=Jt=t([i("esri.popup.content.ColumnChartMediaInfo")],ht);var vt=ht;var Lt,Q=Lt=class extends a{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new Lt({linkURL:this.linkURL,sourceURL:this.sourceURL})}};t([o({type:String,json:{write:!0}})],Q.prototype,"linkURL",void 0),t([o({type:String,json:{write:{isRequired:!0}}})],Q.prototype,"sourceURL",void 0),Q=Lt=t([i("esri.popup.content.support.ImageMediaInfoValue")],Q);var fe=Q;var qt,z=qt=class extends V{constructor(e){super(e),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){return new qt({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?.clone()})}};t([o({type:Number,json:{write:!0}})],z.prototype,"refreshInterval",void 0),t([o({type:["image"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],z.prototype,"type",void 0),t([o({type:fe,json:{write:{isRequired:!0}}})],z.prototype,"value",void 0),z=qt=t([i("esri.popup.content.ImageMediaInfo")],z);var wt=z;var Ut,xt=Ut=class extends j{constructor(e){super(e),this.type="line-chart"}clone(){return new Ut({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};t([o({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:{writer:S.write,isRequired:!0}}})],xt.prototype,"type",void 0),xt=Ut=t([i("esri.popup.content.LineChartMediaInfo")],xt);var bt=xt;var Pt,It=Pt=class extends j{constructor(e){super(e),this.type="pie-chart"}clone(){return new Pt({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};t([o({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:{writer:S.write,isRequired:!0}}})],It.prototype,"type",void 0),It=Pt=t([i("esri.popup.content.PieChartMediaInfo")],It);var gt=It;var X={base:V,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":yt,"column-chart":vt,"line-chart":bt,"pie-chart":gt,image:wt}};var Dt,w=Dt=class extends m{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(r=>r.type==="image"?wt.fromJSON(r):r.type==="barchart"?yt.fromJSON(r):r.type==="columnchart"?vt.fromJSON(r):r.type==="linechart"?bt.fromJSON(r):r.type==="piechart"?gt.fromJSON(r):void 0).filter(Boolean)}writeMediaInfos(e,r){r.mediaInfos=e&&e.map(s=>s.toJSON())}clone(){return new Dt(d({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};t([o()],w.prototype,"activeMediaInfoIndex",void 0),t([o({type:Object,json:{write:!0}})],w.prototype,"attributes",void 0),t([o({type:String,json:{write:!0}})],w.prototype,"description",void 0),t([o({types:[X]})],w.prototype,"mediaInfos",void 0),t([at("mediaInfos")],w.prototype,"readMediaInfos",null),t([b("mediaInfos")],w.prototype,"writeMediaInfos",null),t([o({type:String,json:{write:!0}})],w.prototype,"title",void 0),t([o({type:["media"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],w.prototype,"type",void 0),w=Dt=t([i("esri.popup.content.MediaContent")],w);var B=w;var Wt,Y=Wt=class extends a{constructor(e){super(e),this.field=null,this.order=null}clone(){return new Wt({field:this.field,order:this.order})}};t([o({type:String,json:{write:!0}})],Y.prototype,"field",void 0),t([o({type:["asc","desc"],json:{write:!0}})],Y.prototype,"order",void 0),Y=Wt=t([i("esri.popup.support.RelatedRecordsInfoFieldOrder")],Y);var Ft=Y;var I=class extends c.ClonableMixin(m){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};t([o({type:String,json:{write:!0}})],I.prototype,"description",void 0),t([o({type:Number,json:{type:f,write:!0}})],I.prototype,"displayCount",void 0),t([o({type:["list"],json:{write:{isRequired:!0}}})],I.prototype,"displayType",void 0),t([o({type:[Ft],json:{write:!0}})],I.prototype,"orderByFields",void 0),t([o({type:Number,json:{type:f,write:{isRequired:!0}}})],I.prototype,"relationshipId",void 0),t([o({type:String,json:{write:!0}})],I.prototype,"title",void 0),t([o({type:["relationship"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],I.prototype,"type",void 0),I=t([i("esri.popup.content.RelationshipContent")],I);var k=I;var Kt,Z=Kt=class extends m{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new Kt({text:this.text})}};t([o({type:String,json:{write:!0}})],Z.prototype,"text",void 0),t([o({type:["text"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],Z.prototype,"type",void 0),Z=Kt=t([i("esri.popup.content.TextContent")],Z);var J=Z;var F=class extends c.ClonableMixin(a){constructor(e){super(e),this.title=null,this.description=null,this.type=null,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};t([o({type:String,json:{write:!0}})],F.prototype,"title",void 0),t([o({type:String,json:{write:!0}})],F.prototype,"description",void 0),t([o({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],F.prototype,"type",void 0),t([o({type:Number,json:{type:f,write:!0}})],F.prototype,"associatedNetworkSourceId",void 0),t([o({type:Number,json:{type:f,write:!0}})],F.prototype,"associatedAssetGroup",void 0),t([o({type:Number,json:{type:f,write:!0}})],F.prototype,"associatedAssetType",void 0),F=t([i("esri.popup.support.UtilityNetworkAssociationType")],F);var ye=F;var C=class extends c.ClonableMixin(m){constructor(e){super(e),this.description=null,this.displayCount=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};t([o({type:String,json:{write:!0}})],C.prototype,"description",void 0),t([o({type:Number,json:{type:f,write:!0}})],C.prototype,"displayCount",void 0),t([o({type:String,json:{write:!0}})],C.prototype,"title",void 0),t([o({type:[ye],json:{write:!0}})],C.prototype,"associationTypes",void 0),t([U({utilityNetworkAssociations:"utility-network-associations"})],C.prototype,"type",void 0),C=t([i("esri.popup.content.UtilityNetworkAssociationsContent")],C);var tt=C;var he={base:null,key:"type",typeMap:{attachment:T,media:B,text:J,expression:W,field:A,relationship:k,utilityNetworkAssociations:tt}},ve={base:null,key:"type",typeMap:{attachment:T,media:B,text:J,expression:W,field:A,relationship:k}};var Vt,et=Vt=class extends a{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new Vt({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};t([o({type:Boolean,json:{write:!0}})],et.prototype,"returnTopmostRaster",void 0),t([o({type:Boolean,json:{write:!0}})],et.prototype,"showNoDataRecords",void 0),et=Vt=t([i("esri.popup.LayerOptions")],et);var we=et;var zt,ot=zt=class extends a{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new zt({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?d(this.orderByFields):null})}};t([o({type:Boolean,json:{write:!0}})],ot.prototype,"showRelatedRecords",void 0),t([o({type:[Ft],json:{write:!0}})],ot.prototype,"orderByFields",void 0),ot=zt=t([i("esri.popup.RelatedRecordsInfo")],ot);var Gt=ot;var $t,rt=$t=class extends P{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new $t({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};t([o()],rt.prototype,"image",void 0),t([o()],rt.prototype,"value",void 0),rt=$t=t([i("esri.support.actions.ActionToggle")],rt);var xe=rt;var it="relationships/",be="expression/",ge=q.ofType({key:"type",defaultKeyValue:"button",base:P,typeMap:{button:ae,toggle:xe}}),Fe={base:m,key:"type",typeMap:{media:B,custom:Rt,text:J,attachments:T,fields:A,expression:W,relationship:k,utilityNetworkAssociations:tt}},Ie=new Set(["attachments","fields","media","text","expression","relationship"]),Ne=new Set([...Ie,"utility-network-associations"]),l=class extends c.ClonableMixin(a){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>Xt(Fe,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Yt(e)?e:(Qt.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,r){let{popupElements:s}=r;return Array.isArray(s)&&s.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,s):this._readPopupInfo(r)}writeWebSceneContent(e,r,s,p){this._writePopupTemplateContent(e,r,p)}writeWebMapContent(e,r,s,p){this._writePopupTemplateContent(e,r,p)}writeFieldInfos(e,r,s,p){let{content:n}=this,u=Array.isArray(n)?n:null;if(e){let h=u?u.filter(x=>x.type==="fields"):[],L=h.length&&h.every(x=>x.fieldInfos?.length);r.fieldInfos=e.filter(Boolean).map(x=>{let st=x.toJSON(p);return L&&(st.visible=!1),st})}if(u)for(let h of u)h.type==="fields"&&this._writeFieldsContent(h,r)}writeLayerOptions(e,r,s,p){r[s]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(p)}writeTitle(e,r){r.title=e||""}collectRequiredFields(e,r){return pt(this,null,function*(){let s=this.expressionInfos||[];yield this._collectExpressionInfoFields(e,r,[...s,...this._getContentExpressionInfos(this.content,s)]),ie(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])})}getRequiredFields(e){return pt(this,null,function*(){let r=new Set;return yield this.collectRequiredFields(r,e),[...r].sort()})}_writePopupTemplateContent(e,r,s){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(p=>s?.origin==="web-scene"?Ie.has(p.type):Ne.has(p.type)).map(p=>p?.toJSON(s)),r.popupElements.forEach(p=>{p.type==="attachments"?this._writeAttachmentContent(r):p.type==="media"?this._writeMediaContent(p,r):p.type==="text"?this._writeTextContent(p,r):p.type==="relationship"&&this._writeRelationshipContent(p,r)})):r.description=e}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;let s=d(e.fieldInfos);Array.isArray(r.fieldInfos)?s.forEach(p=>{let n=r.fieldInfos.find(u=>u.fieldName?.toLowerCase()===p.fieldName?.toLowerCase());n?n.visible=!0:r.fieldInfos.push(p)}):r.fieldInfos=s}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){let s=e.orderByFields?.map(n=>this._toFieldOrderJSON(n,e.relationshipId))||[],p=[...r.relatedRecordsInfo?.orderByFields||[],...s];r.relatedRecordsInfo=Ht({showRelatedRecords:!0},p?.length&&{orderByFields:p})}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;let s=d(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...s]:r.mediaInfos=s}_readPopupInfoElements(e,r,s){let p={description:!1,mediaInfos:!1};return s.map(n=>n.type==="media"?(n.mediaInfos||!r||p.mediaInfos||(n.mediaInfos=r,p.mediaInfos=!0),B.fromJSON(n)):n.type==="text"?(n.text||!e||p.description||(n.text=e,p.description=!0),J.fromJSON(n)):n.type==="attachments"?T.fromJSON(n):n.type==="fields"?A.fromJSON(n):n.type==="expression"?W.fromJSON(n):n.type==="relationship"?k.fromJSON(n):n.type==="utilityNetworkAssociations"?tt.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){let{field:r,order:s}=e;if(!r?.startsWith(it))return null;let p=r.replace(it,"").split("/");if(p.length!==2)return null;let n=parseInt(p[0],10),u=p[1];return!Number.isNaN(n)&&u?k.fromJSON({relationshipId:n,orderByFields:[{field:u,order:s}]}):null}_toFieldOrderJSON(e,r){let{order:s,field:p}=e;return{field:`${it}${r}/${p}`,order:s}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:s,relatedRecordsInfo:p={showRelatedRecords:!1}}){let n=[];e?n.push(new J({text:e})):n.push(new A),Array.isArray(r)&&r.length&&n.push(B.fromJSON({mediaInfos:r})),s&&n.push(T.fromJSON({displayType:"auto"}));let{showRelatedRecords:u,orderByFields:h}=p;return u&&h?.length&&h.forEach(L=>{let x=this._toRelationshipContent(L);x&&n.push(x)}),n.length?n:e}_getContentElementFields(e){let r=e?.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){let s=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...s.reduce((p,n)=>[...p,...this._getMediaInfoFields(n)],[])]}return r==="text"?this._extractFieldNames(e.text):r==="relationship"||r==="utility-network-associations"?[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)]:[]}_getMediaInfoFields(e){let{caption:r,title:s,value:p}=e,n=p||{},{fields:u,normalizeField:h,tooltipField:L,sourceURL:x,linkURL:st}=n,Nt=[...this._extractFieldNames(s),...this._extractFieldNames(r),...this._extractFieldNames(x),...this._extractFieldNames(st),...u??[]];return h&&Nt.push(h),L&&Nt.push(L),Nt}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((s,p)=>[...s,...p.type==="expression"&&p.expressionInfo?[p.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,s)=>[...r,...this._getContentElementFields(s)],[]):[]}_collectExpressionInfoFields(e,r,s){return pt(this,null,function*(){s&&(yield Promise.all(s.map(p=>se(e,r,p.expression))))})}_getFieldInfoFields(e){return e?e.filter(({fieldName:r,visible:s})=>!(s!==void 0&&!s||!r||r.startsWith(it)||r.startsWith(be))).map(r=>r.fieldName):[]}_getActionsFields(e){return e?e.toArray().reduce((r,s)=>[...r,...this._getActionFields(s)],[]):[]}_getActionFields(e){let{className:r,title:s,type:p}=e,n=p==="button"||p==="toggle"?e.image:"";return[...this._extractFieldNames(s),...this._extractFieldNames(r),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){return pe(e).filter(r=>!(r.indexOf(it)===0||r.indexOf(be)===0))}};t([o({type:ge})],l.prototype,"actions",void 0),t([o()],l.prototype,"content",void 0),t([Zt("content")],l.prototype,"castContent",null),t([at("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],l.prototype,"readContent",null),t([b("web-scene","content",{popupElements:{type:q.ofType(ve)},showAttachments:{type:Boolean},mediaInfos:{type:q.ofType(X)},description:{type:String},relatedRecordsInfo:{type:Gt}})],l.prototype,"writeWebSceneContent",null),t([b("content",{popupElements:{type:q.ofType(he)},showAttachments:{type:Boolean},mediaInfos:{type:q.ofType(X)},description:{type:String},relatedRecordsInfo:{type:Gt}})],l.prototype,"writeWebMapContent",null),t([o({type:[ne],json:{write:!0}})],l.prototype,"expressionInfos",void 0),t([o({type:[ut]})],l.prototype,"fieldInfos",void 0),t([b("fieldInfos")],l.prototype,"writeFieldInfos",null),t([o({type:we})],l.prototype,"layerOptions",void 0),t([b("layerOptions")],l.prototype,"writeLayerOptions",null),t([o({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],l.prototype,"lastEditInfoEnabled",void 0),t([o()],l.prototype,"outFields",void 0),t([o()],l.prototype,"overwriteActions",void 0),t([o()],l.prototype,"returnGeometry",void 0),t([o({json:{type:String}})],l.prototype,"title",void 0),t([b("title")],l.prototype,"writeTitle",null),l=t([i("esri.PopupTemplate")],l);var ya=l;export{le as a,T as b,me as c,de as d,ut as e,A as f,ce as g,B as h,Ft as i,J as j,ye as k,ne as l,P as m,ae as n,xe as o,ya as p};
