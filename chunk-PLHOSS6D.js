import{a as b,b as F,d as S}from"./chunk-T27YAKLG.js";import{c as P}from"./chunk-BBB7KLHV.js";import{h as R,t as x}from"./chunk-IB2IUO7T.js";import"./chunk-MS3KE2OO.js";import"./chunk-NHSDW26F.js";import"./chunk-NMAGYK3Q.js";import"./chunk-GWBRHLNH.js";import"./chunk-XPRVY6JT.js";import"./chunk-7N3ZKWML.js";import"./chunk-E62WHYYG.js";import"./chunk-QDTU3MWT.js";import"./chunk-BCREO4Q5.js";import"./chunk-3SDSCSDJ.js";import"./chunk-I4M2OT5W.js";import{n as k}from"./chunk-NTVLK3P2.js";import"./chunk-WMQNRNIU.js";import"./chunk-HD52PWPC.js";import"./chunk-EIPVFA6F.js";import"./chunk-VOFKUGRY.js";import{q as w}from"./chunk-IG66NQHW.js";import"./chunk-ARRCN5K3.js";import{e as _}from"./chunk-JKNCWG7E.js";import"./chunk-F7VRLFCB.js";import"./chunk-ISSJ3A6Y.js";import"./chunk-VDKRSX77.js";import"./chunk-WUA6PW3I.js";import"./chunk-E57FTRWF.js";import"./chunk-U4J5SECU.js";import"./chunk-7EG726PT.js";import{L as T,d as l}from"./chunk-C7INQGWT.js";import{H as g}from"./chunk-WMHJC7XF.js";import"./chunk-NJEWDTYF.js";import"./chunk-N3SDOFND.js";import"./chunk-OVHPPCBL.js";import"./chunk-FNXQZPHT.js";import"./chunk-3TQOUBNU.js";import{N as v,r as y,u as c}from"./chunk-D2LVMNOU.js";import"./chunk-SNFOAZZQ.js";import{a as i}from"./chunk-QGVBCWUY.js";import{t as h}from"./chunk-HHDFN2GK.js";import{a as m}from"./chunk-47GHT6OF.js";import{f as u}from"./chunk-VTHXE323.js";var n=class extends T{constructor(){super({}),this.files=[],this.progress=0,this._uploadTask=null,this._layer=null}destroy(){this.cancel(),this.files=[],this._layer=null,this._uploadTask=null}get state(){let e=this._uploadTask;return e&&this.files.length!==0?e.finished?e.error?"error":"success":"pending":"default"}get result(){return this._uploadTask?.value??null}get error(){return this._uploadTask?.error??null}uploadTo(e){this.cancel(),this.files=[],this._layer=e,this._uploadTask=_(o=>u(this,null,function*(){let a=yield z(e);c(o),this.progress=0,this.files=a;let r=F(b.upload,d=>{this.progress=d},"Upload.uploadTo");if(a.length===0)return null;c(o);let s=yield e.extractAndFilterFiles(a);c(o),s.length>0&&(this.files=s);let t=yield e.convertMesh(s,{signal:o,onProgress:r.makeOnProgress("createFromFiles")});if(c(o),!t)throw new h("editor:upload","could not upload or convert model");let p=s.reduce((d,j)=>d+j.size,0),E=r.simulate("loadMesh",S(p));try{yield t.load()}finally{E.remove()}if(m("enable-feature:georeferenced-uploads")&&t.metadata.georeferenced){if(yield w(e.spatialReference,t.origin?.spatialReference))return{type:"georeferenced",mesh:t};if((e.spatialReference.isWebMercator||e.spatialReference.isWGS84)&&(yield M(t,e.spatialReference)))return{type:"georeferenced-reprojected",mesh:t}}return t.spatialReference=e.spatialReference,t.vertexSpace.origin=[0,0,0],{type:"non-georeferenced",mesh:t}}))}retry(){this._layer&&this.uploadTo(this._layer)}cancel(){this._uploadTask?.abort()}};i([l()],n.prototype,"files",void 0),i([l()],n.prototype,"progress",void 0),i([l()],n.prototype,"state",null),i([l()],n.prototype,"result",null),i([l()],n.prototype,"error",null),i([l()],n.prototype,"_uploadTask",void 0),i([l()],n.prototype,"_layer",void 0),n=i([g("esri.widgets.Editor.Upload")],n);var f=null;function z(e){return u(this,null,function*(){let{resolve:o,promise:a}=v(),r=document.createElement("input");r.type="file",r.multiple=!1,r.accept=[...P(e.infoFor3D),".zip"].join(","),r.style.display="none",document.body.appendChild(r);let s=y(r,"change",()=>o(r.files?Array.from(r.files):[]));return f?f(r):r.click(),a.finally(()=>{s.remove(),r.remove()})})}function X(e,o){f=a=>{o?.(),Promise.resolve().then(()=>e).then(r=>{if(!f)return;let s=new DataTransfer;r.forEach(t=>s.items.add(t)),a.files=s.files,a.dispatchEvent(new Event("change"))})}}function Y(){f=null}function M(e,o){return u(this,null,function*(){if(yield x(e.spatialReference,o),!e.vertexSpace.origin)return!1;let[a,r,s]=e.vertexSpace.origin,t=new k({x:a,y:r,z:s,spatialReference:e.spatialReference}),p=R(t,o);return!!p&&(e.vertexSpace.origin=[p.x,p.y,p.z??0],e.spatialReference=o,!0)})}export{n as Upload,Y as clearPromptForFilesStub,X as stubFilePickerToSelect};
