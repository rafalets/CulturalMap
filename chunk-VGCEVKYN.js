import{c as g}from"./chunk-6T37AWU6.js";import{a as J}from"./chunk-XC4BCVYU.js";import{b as Q}from"./chunk-V7IMCFL4.js";import{a as U}from"./chunk-LPCVOXF2.js";import{a as j}from"./chunk-E4VXIIFB.js";import{a as x,b as v}from"./chunk-F6A6XWW4.js";import{F as G}from"./chunk-JR22Z7I2.js";import{I as V,K as W}from"./chunk-HKHTIKVW.js";import{a as k}from"./chunk-XFESK2YB.js";import{q as S,r as z}from"./chunk-MDL4XPLR.js";import{a as F}from"./chunk-EIPVFA6F.js";import{d as B}from"./chunk-JKNCWG7E.js";import{d as N}from"./chunk-SLAWDKDA.js";import{a as M}from"./chunk-WUA6PW3I.js";import{d as w}from"./chunk-E57FTRWF.js";import{f as R}from"./chunk-7EG726PT.js";import{d as y}from"./chunk-C7INQGWT.js";import{C as P,H as D,j as L}from"./chunk-WMHJC7XF.js";import{a as p}from"./chunk-QGVBCWUY.js";import{b as E,t as i}from"./chunk-HHDFN2GK.js";import{a as I,b as T,f as a}from"./chunk-VTHXE323.js";function H(t,e,n){return a(this,null,function*(){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=$(t));let r=tt(t),o=t.capabilities.query.supportsPagination;e.start=0,e.num=r;let s=null;for(;;){let u=yield t.source.queryFeaturesJSON(e,n);if(s==null?s=u:s.features=s.features.concat(u.features),s.exceededTransferLimit=u.exceededTransferLimit,!o||!u.exceededTransferLimit)break;e.start+=r}return s})}function tt(t){return $(t)*et(t)}function et(t){return t.capabilities.query.maxRecordCount||2e3}function $(t){return t.capabilities.query.supportsMaxRecordCountFactor?g.MAX_MAX_RECORD_COUNT_FACTOR:1}var O,l=O=class extends R{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.orderByFields=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new O(E({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};p([y({type:[String],json:{write:!0}})],l.prototype,"attachmentTypes",void 0),p([y({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],l.prototype,"attachmentsWhere",void 0),p([y({type:Boolean,json:{write:!0}})],l.prototype,"cacheHint",void 0),p([y({type:[String],json:{write:!0}})],l.prototype,"keywords",void 0),p([y({type:[String],json:{write:!0}})],l.prototype,"globalIds",void 0),p([y({json:{write:!0}})],l.prototype,"name",void 0),p([y({type:Number,json:{read:{source:"resultRecordCount"}}})],l.prototype,"num",void 0),p([y({type:[Number],json:{write:!0}})],l.prototype,"objectIds",void 0),p([y({type:[String],json:{write:!0}})],l.prototype,"orderByFields",void 0),p([y({type:Boolean,json:{default:!1,write:!0}})],l.prototype,"returnMetadata",void 0),p([y({type:[Number],json:{write:!0}})],l.prototype,"size",void 0),p([y({type:Number,json:{read:{source:"resultOffset"}}})],l.prototype,"start",void 0),p([F("start"),F("num")],l.prototype,"writeStart",null),p([y({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],l.prototype,"where",void 0),l=O=p([D("esri.rest.support.AttachmentQuery")],l),l.from=L(l);var _=l;var Jt=new M({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});function Qt(t,e,n,r){return a(this,null,function*(){let o=yield b(t);if(yield C(t,e,r),!o.addAttachment)throw new i(r,"Layer source does not support addAttachment capability");return o.addAttachment(e,n)})}function C(t,e,n){let{attributes:r}=e,{objectIdField:o}=t;return t.capabilities?.data?.supportsAttachment?e?r?o&&r[o]?Promise.resolve():Promise.reject(new i(n,`feature is missing the identifying attribute ${o}`)):Promise.reject(new i(n,"'attributes' are required on a feature to query attachments")):Promise.reject(new i(n,"A feature is required to add/delete/update attachments")):Promise.reject(new i(n,"this layer doesn't support attachments"))}function Ut(t,e,n,r,o){return a(this,null,function*(){let s=yield b(t);if(yield C(t,e,o),!s.updateAttachment)throw new i(o,"Layer source does not support updateAttachment capability");return s.updateAttachment(e,n,r)})}function Vt(t,e,n){return a(this,null,function*(){let{applyEdits:r}=yield import("./chunk-ZETTPAV6.js"),o=yield t.load(),s=n;return o.type==="feature"&&o.infoFor3D&&e.deleteFeatures!=null&&o.globalIdField!=null&&(s=T(I({},s),{globalIdToObjectId:yield at(o,e.deleteFeatures,o.globalIdField)})),r(o,o.source,e,n)})}function Wt(t,e,n){return a(this,null,function*(){let{uploadAssets:r}=yield import("./chunk-ZETTPAV6.js"),o=yield t.load();return r(o,o.source,e,n)})}function Ht(t,e,n,r){return a(this,null,function*(){let o=yield b(t);if(yield C(t,e,r),!o.deleteAttachments)throw new i(r,"Layer source does not support deleteAttachments capability");return o.deleteAttachments(e,n)})}function $t(t,e,n){return a(this,null,function*(){let r=(yield t.load({signal:e?.signal})).source;if(!r.fetchRecomputedExtents)throw new i(n,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)})}function _t(t,e,n,r){return a(this,null,function*(){e=_.from(e),yield t.load();let o=t.source,s=t.capabilities;if(!s?.data?.supportsAttachment)throw new i(r,"this layer doesn't support attachments");let{attachmentTypes:u,objectIds:d,globalIds:c,num:m,size:f,start:h,where:A}=e;if(!s?.operations?.supportsQueryAttachments&&(u?.length>0||c?.length>0||f?.length>0||m||h||A))throw new i(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(d?.length||c?.length||A))throw new i(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!o.queryAttachments)throw new i(r,"Layer source does not support queryAttachments capability",e);return!s?.attachment?.supportsOrderByFields&&e.orderByFields?.length&&((e=e.clone()).orderByFields=null),o.queryAttachments(e)})}function Zt(t,e,n,r){return a(this,null,function*(){let o=yield b(t);if(!o.queryObjectIds)throw new i(r,"Layer source does not support queryObjectIds capability");return o.queryObjectIds(g.from(e)??t.createQuery(),n)})}function Xt(t,e,n,r){return a(this,null,function*(){let o=yield b(t);if(!o.queryFeatureCount)throw new i(r,"Layer source does not support queryFeatureCount capability");return o.queryFeatureCount(g.from(e)??t.createQuery(),n)})}function Kt(t,e,n,r){return a(this,null,function*(){let o=yield b(t);if(!o.queryExtent)throw new i(r,"Layer source does not support queryExtent capability");return o.queryExtent(g.from(e)??t.createQuery(),n)})}function Yt(t,e,n,r){return a(this,null,function*(){let o=yield b(t);if(!o.queryRelatedFeatures)throw new i(r,"Layer source does not support queryRelatedFeatures capability");return o.queryRelatedFeatures(j.from(e),n)})}function te(t,e,n,r){return a(this,null,function*(){let o=yield b(t);if(!o.queryRelatedFeaturesCount)throw new i(r,"Layer source does not support queryRelatedFeaturesCount capability");return o.queryRelatedFeaturesCount(j.from(e),n)})}function ee(t){return a(this,null,function*(){let e=t.source;if(e?.refresh)try{let{dataChanged:n,updates:r}=yield e.refresh();if(r!=null&&(t.sourceJSON=I(I({},t.sourceJSON),r),t.read(r,{origin:"service",url:t.parsedUrl})),n)return!0}catch{}if(t.definitionExpression)try{return(yield k(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1})}function re(t){let e=new g,n=t.capabilities?.data,r=t.capabilities?.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),n&&(n.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),n.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];let{timeOffset:o,timeExtent:s}=t;return e.timeExtent=o!=null&&s!=null?s.offset(-o.value,o.unit):s||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function ne(t){let{globalIdField:e,fields:n}=t;if(e)return e;if(n){for(let r of n)if(r.type==="esriFieldTypeGlobalID")return r.name}}function oe(t){let{objectIdField:e,fields:n}=t;if(e)return e;if(n){for(let r of n)if(r.type==="esriFieldTypeOID")return r.name}}function se(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function ie(t,e,n,r){let o=n?.feature,s=!!t.subtypes?.length;if(s&&!n?.excludeImpliedDomains){let c=nt(t,e);if(c)return c}let u=s&&rt(t,o);if(u){let c=u?.domains?.[e];return c?.type==="inherited"?r:c}let d=ut(t.types,t.typeIdField,o);if(d){let c=d.domains&&d.domains[e];if(c&&c?.type!=="inherited")return c}if(r)return r;if(!n?.excludeImpliedDomains){let c=ot(t,e);if(c)return c}return null}function rt(t,e){let{subtypes:n,subtypeField:r}=t;if(!e?.attributes||!n?.length||!r)return null;let o=e.attributes[r];return o==null?null:n.find(s=>s.code===o)}function nt(t,e){let{fieldsIndex:n,subtypeField:r}=t,{name:o,type:s}=n.get(e)??{};if(!o)return null;if((r&&n.get(r)?.name)===o&&t.subtypes?.length){let u=t.subtypes.map(d=>new x({code:K(d.code,s),name:d.name}));if(u?.length)return new v({codedValues:u})}return null}function ot(t,e){let{fieldsIndex:n}=t,{name:r,type:o}=n.get(e)??{};if(!r)return null;if(("typeIdField"in t?n.get(t.typeIdField)?.name:null)===r&&"types"in t&&t.types?.length){let s=t.types.map(u=>new x({code:K(u.id,o),name:u.name}));return new v({codedValues:s})}return null}function K(t,e){return e?W({type:e})&&typeof t=="number"?`${t}`:V({type:e})&&typeof t=="string"?Number.parseInt(t,10):t:t}function b(t){return a(this,null,function*(){return(yield t.load()).source})}function ae(t,e){return a(this,null,function*(){if(!w)return;let n=w.findCredential(t);if(n)return n.userId;let r;try{let o=yield S(t,e);o&&(r=yield w.checkSignInStatus(`${o}/sharing`))}catch{}return r?r.userId:null})}function Y(t,e){return a(this,null,function*(){if(!w||w.findCredential(t))return;let n;try{let r=yield S(t,e);r&&(n=yield w.checkSignInStatus(`${r}/sharing`))}catch{}if(n)try{let r=e!=null?e.signal:null;yield w.getCredential(t,{signal:r})}catch{}})}function ue(t,e,n){return a(this,null,function*(){let r=t.parsedUrl?.path;r&&t.authenticationTriggerEvent===e&&(yield Y(r,n))})}function le(t){return a(this,null,function*(){let e=t.parsedUrl?.path;e&&st(t)&&(yield Y(e))})}function st(t){return it(t)&&("serviceDefinitionExpression"in t&&Z(t.serviceDefinitionExpression)||"definitionExpression"in t&&Z(t.definitionExpression))}function it(t){return!(!z(t)||!t.capabilities?.query.supportsCurrentUser)}function Z(t){return!!t?.toLowerCase().includes("current_user")}function ce(t){return!lt(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}var q=P({types:G});function pe(t,e){if(t.defaultSymbol)return t.types?.length?new Q({defaultSymbol:q(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(n=>({id:n.id,symbol:q(n.symbol,n,e)}))}):new J({symbol:q(t.defaultSymbol,t,e)})}function de(t){let e=t.sourceJSON?.cacheMaxAge;if(!e)return!1;let n=t.editingInfo?.lastEditDate?.getTime();return n==null||(e*=1e3,Date.now()-n<e)}function at(t,e,n){return a(this,null,function*(){if(e==null)return null;let r=[],{objectIdField:o}=t;if(e.forEach(m=>{let f=null;if("attributes"in m){let{attributes:h}=m;f={globalId:h[n],objectId:h[o]!=null&&h[o]!==-1?h[o]:null}}else f={globalId:m.globalId,objectId:m.objectId!=null&&m.objectId!==-1?m.objectId:null};f.globalId!=null&&(f.objectId!=null&&f.objectId!==-1||r.push(f.globalId))}),r.length===0)return null;let s=t.createQuery();s.where=r.map(m=>`${n}='${m}'`).join(" OR "),s.returnGeometry=!1,s.outFields=[o,n],s.cacheHint=!1;let u=yield B(H(t,s));if(!u.ok)return null;let d=new Map,c=u.value.features;for(let m of c){let f=m.attributes[n],h=m.attributes[o];f!=null&&h!=null&&h!==-1&&d.set(N(f),h)}return d})}function ut(t,e,n){if(!e||!n||!t)return null;let r=n.getAttribute(e);return r==null?null:t.find(o=>{let{id:s}=o;return s!=null&&s.toString()===r.toString()})??null}function lt(t){return t.sourceJSON?.isMultiServicesView||ct(t)}function ct(t){return!!t.sourceJSON?.capabilities?.toLowerCase().split(",").map(e=>e.trim()).includes("map")}function ye(t,e,n){let r=e?.queryAttributeBins;if(!r)throw new i(n,"Layer source does not support binning");switch(t.binParameters.type){case"auto-interval":if(!r.supportsAutoInterval)throw new i(n,"Layer source does not support auto-interval binning");if(t.binParameters.normalizationType&&(!r.supportsNormalization||!X(t.binParameters.normalizationType,r.supportedNormalizationTypes)))throw new i(n,"Layer source does not support normalization binning");break;case"date":if(!r.supportsDate)throw new i(n,"Layer source does not support date binning");if(t.binParameters.snapToData&&!r.supportsSnapToData)throw new i(n,"Layer source does not support snapToData binning");if(t.binParameters.returnFullIntervalBin&&!r.supportsReturnFullIntervalBin)throw new i(n,"Layer source does not support returnFullIntervalBin binning");break;case"fixed-boundaries":if(!r.supportsFixedBoundaries)throw new i(n,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!r.supportsFixedInterval)throw new i(n,"Layer source does not support fixed-interval binning");if(t.binParameters.normalizationType&&(!r.supportsNormalization||!X(t.binParameters.normalizationType,r.supportedNormalizationTypes)))throw new i(n,"Layer source does not support normalization binning")}if(t.binParameters.stackBy&&!r.supportsStackBy)throw new i(n,"Layer source does not support stackBy binning");if(t.binParameters.splitBy&&!r.supportsSplitBy)throw new i(n,"Layer source does not support splitBy binning");if(t.binParameters.firstDayOfWeek&&!r.supportsFirstDayOfWeek)throw new i(n,"Layer source does not support firstDayOfWeek binning");let o=r?.supportedStatistics;if(t.outStatistics&&o){let s=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(let{statisticType:u}of t.outStatistics){let d=s.get(u);if(d&&!o[d])throw new i(n,`Layer source does not support ${u} statistic type`)}}}function X(t,e){return t!=null&&!!e?.[U.toJSON(t)]}export{H as a,_ as b,Jt as c,Qt as d,Ut as e,Vt as f,Wt as g,Ht as h,$t as i,_t as j,Zt as k,Xt as l,Kt as m,Yt as n,te as o,ee as p,re as q,ne as r,oe as s,se as t,ie as u,rt as v,nt as w,ae as x,Y as y,ue as z,le as A,Z as B,ce as C,pe as D,de as E,at as F,ut as G,lt as H,ye as I};
