import"./chunk-J5F7R33S.js";import{a as $t}from"./chunk-DLYBSV6I.js";import"./chunk-C7HLNGAF.js";import{C as _t,Cb as v,Db as dt,Eb as R,Fa as pt,Fb as vt,Gb as k,Ia as H,P as T,S as ut,T as ct,W as lt,X as M,Y as N,a as w,aa as wt,b as E,bb as At,eb as zt,hb as Xt,ib as Lt,lb as K,m as Yt,pb as V,tb as bt,y as W,zb as gt}from"./chunk-UNRRVLTB.js";import"./chunk-6DVIB4O4.js";import{$ as Mt,Ca as kt,Da as Rt,E as J,F as ht,Ga as Q,Ja as b,M as L,N as q,P as j,_ as Et,a as rt,b as ot,na as Tt,o as mt,tb as S,u as X,ub as Z,y as St}from"./chunk-JLMESEWM.js";import{d as I,e as U}from"./chunk-QGVBCWUY.js";import{a as Ft}from"./chunk-VTHXE323.js";var xt=class{constructor(t,s,i,n,a=0,e=4){this.m_ptDistFrom=new S,this.m_segStartPt=new S,this.m_segEndPt=new S,this.m_geodeticLength=new v,this.m_az12=new v,this.m_minGeodeticDist=new v,this.m_segStartPt3d=new E,this.m_segEndPt3d=new E,this.m_sr=n,this.m_distCurveType=a,this.m_segCurveType=e,this.m_inputGCS=this.m_sr.getGCS(),this.m_rpu=this.m_inputGCS.getUnit().getUnitToBaseFactor(),this.m_bIsPannablePcs=this.m_sr.getCoordinateSystemType()===2&&this.m_sr.isPannable();let r=V();this.m_inputGCS.querySpheroidData(r),this.m_a=r.majorSemiAxis,this.m_eSquared=r.e2,this.setPointDistFrom(t),this.setSegmentEndPoints(s,i)}setSegmentEndPoints(t,s){this.m_segStartPt.assign(t),this.m_segEndPt.assign(s),this.m_bIsPannablePcs||(this.m_segStartPt.mulThis(this.m_rpu),this.m_segEndPt.mulThis(this.m_rpu)),this.m_segCurveType===2&&(this.m_segStartPt3d.assign(M(this.m_a,this.m_eSquared,this.m_segStartPt)),this.m_segEndPt3d.assign(M(this.m_a,this.m_eSquared,this.m_segEndPt))),this.calculateAndUpdateSegmentLength()}setPointDistFrom(t){this.m_ptDistFrom.assign(t),this.m_ptDistFrom.scale(this.m_rpu)}setSegmentCurveType(t){this.m_segCurveType=t}setDistanceCurveType(t){this.m_distCurveType=t}makeFunctor(){return t=>{let s;switch(this.m_segCurveType){case 0:case 1:case 3:{let i={stack:[],error:void 0,hasError:!1};try{let n=I(i,new v,!1),a=I(i,new v,!1);k.geodeticCoordinate(this.m_a,this.m_eSquared,this.m_segStartPt.x,this.m_segStartPt.y,this.m_geodeticLength.val*t,this.m_az12.val,n,a,this.m_segCurveType),s=new S(n.val,a.val);break}catch(n){i.error=n,i.hasError=!0}finally{U(i)}}case 2:{let i=E.lerp(this.m_segStartPt3d,this.m_segEndPt3d,t);s=N(this.m_a,this.m_eSquared,i);break}case 4:s=S.lerp(this.m_segStartPt,this.m_segEndPt,t),this.m_bIsPannablePcs&&(Lt(this.m_sr,0,[s],1),s.mulThis(this.m_rpu));break;default:X("Invalid curve type")}return k.geodeticDistance(this.m_a,this.m_eSquared,this.m_ptDistFrom.x,this.m_ptDistFrom.y,s.x,s.y,this.m_minGeodeticDist,null,null,this.m_distCurveType),this.m_minGeodeticDist.val}}calculateAndUpdateSegmentLength(){switch(this.m_segCurveType){case 0:case 2:case 1:case 3:k.geodeticDistance(this.m_a,this.m_eSquared,this.m_segStartPt.x,this.m_segStartPt.y,this.m_segEndPt.x,this.m_segEndPt.y,this.m_geodeticLength,this.m_az12,null,this.m_segCurveType);break;case 4:this.m_geodeticLength.val=S.distance(this.m_segStartPt,this.m_segEndPt);break;default:X("Invalid curve type")}}[Symbol.dispose](){this.m_geodeticLength[Symbol.dispose](),this.m_az12[Symbol.dispose](),this.m_minGeodeticDist[Symbol.dispose]()}};var It=class{constructor(t,s,i,n,a=100){this.m_startPt=t.clone(),this.m_endPt=s.clone(),this.m_cE2=n,this.m_cE=Math.sqrt(this.m_cE2),this.m_c1By2e=1/(2*this.m_cE),this.m_cRpu=i.getGCS().getUnit().getUnitToBaseFactor(),this.isPcs=i.getCoordinateSystemType()===2,this.PEProjcs=i.getPECoordSys(),this.m_points=Rt(2*a,Number.NaN)}setSegmentEndPoints(t,s){this.m_startPt.assign(t),this.m_endPt.assign(s)}makeFunctor(){return t=>{let s=[0,0];s[0]=this.m_startPt.x*(1-t)+this.m_endPt.x*t,s[1]=this.m_startPt.y*(1-t)+this.m_endPt.y*t,this.isPcs&&vt.projToGeogCenter(this.PEProjcs,1,s,0);let i=Math.sin(s[1]*this.m_cRpu);return this.m_cE2===0?i:-Math.log((1-this.m_cE*i)/(1+this.m_cE*i))*this.m_c1By2e+i/(1-this.m_cE2*i*i)}}};function Qt(c,t,s){let i=new w;c.queryEnvelope(i);let n=Yt(t,i,!0).total(),a=t.getPannableExtent();a.xmin=i.xmin-10*n,a.xmax=i.xmax+10*n;let e=new ut().execute(c,a,t,s).getImpl().querySegmentIterator();e.stripAttributes();let r=V();t.querySpheroidData(r);let h=r.e2,_=h===0?2:1,u=new S(0,0),o=new S(0,0),m=new J(0),l=new It(u,o,t,h,100);for(;e.nextPath();)for(;e.hasNextSegment();){let d=e.nextSegment();u.assign(d.getStartXY()),o.assign(d.getEndXY()),l.setSegmentEndPoints(u,o);let g=W(6,0,1,1e-12,1e-15,l.makeFunctor());m.pe((o.x-u.x)*g)}let p=r.majorSemiAxis;return _*p*p*(1-h)*Math.PI*m.getResult()/t.getPannableExtent().width()}function Zt(c,t,s,i,n){let a=te(c,t,n),e=Ut(c,a.first,s,i,n),r=1,h=0,_=0;do{if(r++,a.first*=.5,a.first<50*t.getTolerance(0))return e;a.second*=2,_=Ut(c,a.first,s,i,n),h=Math.abs(_-e),e=_}while(Math.abs(e)>1&&h>1e-8*Math.abs(e)&&(a.second<65e3&&r<8||r<4));return _}function Ut(c,t,s,i,n){let a=new ct().execute(c,t,0,0,n),e;e=i?new H().execute(a,i,n):a;let r=s.getUnit().getUnitToBaseFactor()===1?Math.PI/180:1,h=new w;e.queryEnvelope(h);let _=new w,u=new w,o=new w;_.setCoords({xmin:h.xmin,ymin:75*r,xmax:h.xmax,ymax:90*r}),u.setCoords({xmin:h.xmin,ymin:-60*r,xmax:h.xmax,ymax:75*r}),o.setCoords({xmin:h.xmin,ymin:-90*r,xmax:h.xmax,ymax:-60*r}),_.inflateCoords(.01*_.width(),0),u.inflateCoords(.01*u.width(),0),o.inflateCoords(.01*o.width(),0);let m=0;return m+=Gt(e,_,s,n),m+=Gt(e,u,s,n),m+=Gt(e,o,s,n),m}function Gt(c,t,s,i){let n=new ut().execute(c,t,s,i);if(n!==null&&!n.isEmpty()){let a=new w;n.queryEnvelope(a);let{first:e,second:r}=Kt(s,a,!1),h=K(s,e,null),_=new H().execute(n,h,i).calculateArea2D();return r&&e.destroy(),_}return 0}var yt=[null,null,null,null,null,null,null];function Wt(c,t,s){let i=c.getUnit().getUnitToBaseFactor(),n=t.getCenter();n.scale(180*i/Math.PI);let a=new S;a.x=0,a.y=0;let e=0;if(e===0){n.y>45?(a.y=b,e=0):n.y<-45?(a.y=-b,e=1):n.x>=45&&n.x<135?(a.x=b,e=2):n.x>=135||n.x<-135?(a.x=b,e=3):n.x<-45&&n.x>=-135?(a.x=-b,e=4):(a.x=0,e=5);let f=i*Math.sqrt(Mt(t.xmin-t.xmax)+Mt(t.ymin-t.ymax)),y=a.clone(),P=t.getCenter();if(P.scale(i),e<2&&(y.x=P.x),S.distance(y,P)+.5*f>b)return null}let r=yt[e];if(r!==null&&r.getGCS().equalHorizontal(c))return r;let h=c.getText(),_=a.x,u=a.y,o=0,m=0,l=0,p=-1;e!==6?p=R.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA:(rt(s),l=0,p=R.PE_PRJ_CYLINDRICAL_EQAREA);let d=gt("EqualAreaPCS"),g;p===R.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA?g=`PROJCS["${d}",${h},PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",${o}],PARAMETER["False_Northing",${m}],PARAMETER["Central_Meridian",${_}],PARAMETER["Latitude_of_Origin",${u}],UNIT["Meter",1.0]]`:p===R.PE_PRJ_CYLINDRICAL_EQAREA?g=`PROJCS["${d}",${h},PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting",${o}],PARAMETER["False_Northing",${m}],PARAMETER["Central_Meridian",${_}],PARAMETER["Standard_Parallel_1",${l}],PARAMETER["Latitude_of_Origin",${u}],UNIT["Meter",1.0]]`:X("getEqualAreaPcsFixed");let x=bt(g);return yt[e]&&yt[e].destroy(),yt[e]=x,x}function Kt(c,t,s){let i=Wt(c,t,s);if(i!==null)return Q(i,!1);let n=c.getText(),a=c.getUnit().getUnitToBaseFactor(),e=(t.xmin+t.width()/2)*a,r=(t.ymin+t.height()/2)*a,h=0,_=0,u=0,o=0,m=-1;t.ymin*a>=75*Math.PI/180||t.ymax*a<=-60*Math.PI/180?m=R.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA:t.ymin>0||t.ymax<0?(u=(t.ymin+1/3*t.height())*a,o=(t.ymin+2/3*t.height())*a,m=R.PE_PRJ_ALBERS):(u=(t.ymin+2/3*t.height())*a,m=R.PE_PRJ_CYLINDRICAL_EQAREA);let l=gt("EqualAreaPCS"),p;return m===R.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA?p=`PROJCS["${l}",${n},PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",${h}],PARAMETER["False_Northing",${_}],PARAMETER["Central_Meridian",${e}],PARAMETER["Latitude_of_Origin",${r}],UNIT["Meter",1.0]]`:m===R.PE_PRJ_ALBERS?p=`PROJCS["${l}",${n},PROJECTION["Albers"],PARAMETER["False_Easting",${h}],PARAMETER["False_Northing",${_}],PARAMETER["Central_Meridian",${e}],PARAMETER["Standard_Parallel_1",${u}],PARAMETER["Standard_Parallel_2",${o}],PARAMETER["Latitude_of_Origin",${r}],UNIT["Meter",1.0]]`:m===R.PE_PRJ_CYLINDRICAL_EQAREA?p=`PROJCS["${l}",${n},PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting",${h}],PARAMETER["False_Northing",${_}],PARAMETER["Central_Meridian",${e}],PARAMETER["Standard_Parallel_1",${u}],PARAMETER["Latitude_of_Origin",${r}],UNIT["Meter",1.0]]`:X("getEqualAreaPCSInstance"),Q(bt(p),!0)}function te(c,t,s){let i=c.calculateLength2D(),n=new $t().execute(c,t,s)/25e3,a=i/c.getSegmentCount()*2,e=Math.min(a,i/n);return e===0&&(e=1),Q(e,i/e)}var qt=class{getOperatorType(){return 10314}supportsCurves(){return!0}accelerateGeometry(t,s,i){return!1}canAccelerateGeometry(t){return!1}execute(t,s,i){if(s.getCoordinateSystemType()===0&&mt(""),t.isEmpty()||t.getDimension()<2)return 0;if(St(t),t.getGeometryType()===ot.enumEnvelope){let _=new _t;return _.addEnvelope(t,!1),this.execute(_,s,i)}let n=t;t.getDescription().getAttributeCount()>1&&(n=t.clone(),n.dropAllAttributes());let a=new ct().execute(n,0,s.getTolerance(0),0,i),e=null,r=s.getGCS();r!==s&&(e=K(s,r));let h=new pt().execute(a,s,!1,i);return h.isEmpty()?0:(h===t&&(h=t.clone()),s.isPannable()?Qt(h,s,i):Zt(h,s,r,e,i))}};function Ct(){return{m_p_PCS:new S,m_factor:Number.NaN,setValues:ee,assign:ie}}function ee(c,t){this.m_factor=c,this.m_p_PCS.assign(t)}function ie(c){this.m_factor=c.m_factor,this.m_p_PCS.assign(c.m_p_PCS)}var Nt=class{constructor(t,s,i,n){this.m_ptStart=new E,this.m_ptEnd=new E,this.m_ptStart.assign(s),this.m_ptEnd.assign(i),this.m_deltaX=this.m_ptEnd.x-this.m_ptStart.x,this.m_deltaY=this.m_ptEnd.y-this.m_ptStart.y,this.m_e=Math.sqrt(t),this.m_e2=t,this.m_c1MinusE2=1-t;let a=Math.sin(n),e;e=this.m_e2===0?2*a:a*(L(this.m_e*a)+1/(1-this.m_e2*a*a)),this.m_baseA=e}setSegmentEndPoints(t,s){this.m_ptStart.assign(t),this.m_ptEnd.assign(s),this.m_deltaX=this.m_ptEnd.x-this.m_ptStart.x,this.m_deltaY=this.m_ptEnd.y-this.m_ptStart.y}makeFunctor(){return t=>{let s=1-t,i=s*this.m_ptStart.x+t*this.m_ptEnd.x,n=s*this.m_ptStart.y+t*this.m_ptEnd.y,a=s*this.m_ptStart.z+t*this.m_ptEnd.z,e=i*i+n*n,r=a/Math.sqrt(a*a+this.m_c1MinusE2*this.m_c1MinusE2*e),h;return this.m_e2===0?h=2*r:h=r*(L(this.m_e*r)+1/(1-this.m_e2*r*r)),(this.m_deltaY*i-this.m_deltaX*n)/e*(h-this.m_baseA)}}};function se(){return{e:Number.NaN,one_p_e:Number.NaN,one_m_e:Number.NaN,one_m_e_2:Number.NaN,atanh_e_over_e:Number.NaN,half_qp:Number.NaN,f:Number.NaN,z:Number.NaN}}function Dt(){return{sin_phi:Number.NaN,one_p_sin_phi:Number.NaN,one_m_sin_phi:Number.NaN,one_m_e_2_sin_2_phi:Number.NaN,sin_half_phi_pf:Number.NaN,sin_half_phi_pz:Number.NaN,sin_half_asin_e_sin_phi_pf:Number.NaN,sin_half_asin_e_sin_phi_pz:Number.NaN,atanh_sin_phi:Number.NaN,atanh_esin_phi:Number.NaN,make_negative:!1,initialize:ne,changeSign:ae,assign:re,clone:oe}}function ne(c,t,s,i){let n=.5*c;this.sin_phi=Math.sin(c);let a=t*this.sin_phi,e=.5*Math.asin(a);this.one_p_sin_phi=1+this.sin_phi,this.one_m_sin_phi=1-this.sin_phi,this.one_m_e_2_sin_2_phi=(1+a)*(1-a),this.sin_half_phi_pf=Math.sin(n+s),this.sin_half_phi_pz=Math.sin(n+i),this.sin_half_asin_e_sin_phi_pf=Math.sin(e+s),this.sin_half_asin_e_sin_phi_pz=Math.sin(e+i),this.atanh_sin_phi=Math.log(this.sin_half_phi_pf/this.sin_half_phi_pz),this.atanh_esin_phi=Math.log(this.sin_half_asin_e_sin_phi_pf/this.sin_half_asin_e_sin_phi_pz)}function ae(){this.sin_phi=-this.sin_phi;let c=this.one_p_sin_phi;this.one_p_sin_phi=this.one_m_sin_phi,this.one_m_sin_phi=c,c=this.sin_half_phi_pf,this.sin_half_phi_pf=this.sin_half_phi_pz,this.sin_half_phi_pz=c,c=this.sin_half_asin_e_sin_phi_pf,this.sin_half_asin_e_sin_phi_pf=this.sin_half_asin_e_sin_phi_pz,this.sin_half_asin_e_sin_phi_pz=c,this.atanh_sin_phi=-this.atanh_sin_phi,this.atanh_esin_phi=-this.atanh_esin_phi}function re(c){this.sin_phi=c.sin_phi,this.one_p_sin_phi=c.one_p_sin_phi,this.one_m_sin_phi=c.one_m_sin_phi,this.one_m_e_2_sin_2_phi=c.one_m_e_2_sin_2_phi,this.sin_half_phi_pf=c.sin_half_phi_pf,this.sin_half_phi_pz=c.sin_half_phi_pz,this.sin_half_asin_e_sin_phi_pf=c.sin_half_asin_e_sin_phi_pf,this.sin_half_asin_e_sin_phi_pz=c.sin_half_asin_e_sin_phi_pz,this.atanh_sin_phi=c.atanh_sin_phi,this.atanh_esin_phi=c.atanh_esin_phi,this.make_negative=c.make_negative}function oe(){return Ft({},this)}var Bt=class{constructor(t,s,i){this.m_transformPCS2GCS=null,this.m_scaleToRadians=new Z,this.m_scaleToDegrees=new Z,this.m_progressTracker=i,rt(s!==4),this.m_curveType=s,this.m_inputSR=t,t&&t.getCoordinateSystemType()!==0||mt(""),this.m_inputGCS=t.getGCS(),this.m_a=0,this.m_eSquared=0,this.m_b=0,this.m_rpu=0}executePolygonGeodeticArea(t){let s,i=t.clone();if(i.dropAllAttributes(),t.hasNonLinearSegments()&&(i=new ct().execute(i,0,this.m_inputSR.getTolerance(0),0,this.m_progressTracker)),this.m_inputSR.isPannable()){let e=new w;i.queryEnvelope(e);let r=this.m_inputSR.getPannableExtent();if(!r.containsEnvelope(e)){let h=r.getCenterX()-e.getCenterX(),_=new Z;_.setShiftCoords(h,0),i.applyTransformation(_),e.move(h,0);let u=new ht;r.queryIntervalX(u);let o=new ht;e.queryIntervalX(o),i=u.contains(o)?At(i,this.m_inputSR):new H().foldInto360RangeGeodetic(i,this.m_inputSR,this.m_curveType)}}if(this.m_transformPCS2GCS?(i=new pt().execute(i,this.m_inputSR,!1,this.m_progressTracker),s=i.createInstance(),Xt(this.m_transformPCS2GCS,i,s,this.m_progressTracker)||(s=new H().execute(i,this.m_transformPCS2GCS,this.m_progressTracker))):s=new pt().execute(i,this.m_inputGCS,!1,this.m_progressTracker),s.isEmpty())return 0;if(this.m_curveType===1){let e=V();return this.m_inputGCS.querySpheroidData(e),this.m_a=e.majorSemiAxis,this.m_eSquared=e.e2,this.loxodromeArea(s)}let n=s.getImpl();this.m_rpu=this.m_inputGCS.getUnit().getUnitToBaseFactor(),this.m_scaleToRadians.setScale(this.m_rpu),n.applyTransformation(this.m_scaleToRadians),this.m_scaleToDegrees=this.m_scaleToRadians,this.m_scaleToDegrees.invertThis();let a=V();if(this.m_inputGCS.querySpheroidData(a),this.m_a=a.majorSemiAxis,this.m_b=a.minorSemiAxis,this.m_eSquared=a.e2,this.m_curveType===2)return this.executeClippedPolygonGreatEllipticArea(s);{let e={stack:[],error:void 0,hasError:!1};try{let r=dt.unit(9101),h=this.m_inputGCS.getPECoordSys(),_=I(e,h.cloneAlterUnits(r),!1),u,o,m=this.executeClippedPolygonGeodeticArea(s,_,0),l=0;do l++,u=this.executeClippedPolygonGeodeticArea(s,_,l),o=Math.abs(u-m),m=u;while(Math.abs(u)>1&&o>1e-8*Math.abs(u)&&l<7);return u}catch(r){e.error=r,e.hasError=!0}finally{U(e)}}}executeClippedPolygonGeodeticArea(t,s,i){let n={stack:[],error:void 0,hasError:!1};try{let a=new w;t.queryEnvelope(a);let e=I(n,this.getEqualAreaPCSInstance(s,a),!1),r=t.clone();zt(e,r);let h=50,_=r.getImpl().getAttributeStreamRef(0),u=t.getImpl().getAttributeStreamRef(0),o=I(n,new v,!1),m=I(n,new v,!1),l=40,p=[0,0],d=kt(Ct,l),g=Rt(l,-1),x=Ct(),f=Ct(),y,P,B=e,G=r.calculateArea2D(),C=new J(0),Y=.5*Math.PI,tt=1e-10*Math.abs(G)+1e-6,Pt=t.getPathCount(),z,$,O,D,A=new S,F=new S,et=new S,it=new S,st=new S,nt=new S,Ot,ft;for($=t.getPathStart(0),z=0;z<Pt;z++,$=O)for(O=t.getPathEnd(z),_.queryPoint2D(O-1<<1,et),u.queryPoint2D(O-1<<1,A),Math.abs(A.y)>Y&&(A.y=j(Y,A.y)),D=$;D<O;D++,et.assign(it),A.assign(F)){if(_.queryPoint2D(D<<1,it),u.queryPoint2D(D<<1,F),Math.abs(F.y)>Y&&(F.y=j(Y,F.y)),Ot=S.distance(et,it),Ot<h||A.y===0&&F.y===0)continue;k.geodeticDistance(this.m_a,this.m_eSquared,A.x,A.y,F.x,F.y,o,m,null,this.m_curveType);let Ht=o.val,Vt=m.val;for(x.setValues(0,et),f.setValues(1,it),P=i,d[0].assign(f),g[0]=i,y=0;y>=0;){ft=.5*(x.m_factor+f.m_factor),k.geodeticCoordinate(this.m_a,this.m_eSquared,A.x,A.y,Ht*ft,Vt,o,m,this.m_curveType),st.x=o.val,st.y=m.val,p[0]=st.x,p[1]=st.y,vt.geogToProj(B,1,p),nt.x=p[0],nt.y=p[1];let jt=-nt.offset(x.m_p_PCS,f.m_p_PCS),at=.5*jt*S.distance(x.m_p_PCS,f.m_p_PCS);if(C.pe(at),Math.abs(at)>tt||Math.abs(at)>0&&P>0)f.setValues(ft,nt),y++,d[y].assign(f),Math.abs(at)<=tt?(P--,g[y-1]=P,g[y]=P):(P=g[y-1],g[y]=P);else{if(y<=0)break;x.assign(f),y--,f.assign(d[y]),P=g[y]}}}return G+=C.getResult(),Math.abs(G)}catch(a){n.error=a,n.hasError=!0}finally{U(n)}}executeClippedPolygonGreatEllipticArea(t){let s=[],i=[],n=new S,a=new S,e=M(1,this.m_eSquared,new S(0,.5*Math.PI)),r=new J(0),h=new J(0),_=new J(0),u=new E,o=new E,m=new w;t.queryLooseEnvelope(m);let l=0;m.containsCoords(m.xmin,0)||(l=Math.abs(m.ymin)<Math.abs(m.ymax)?m.ymin:m.ymax);let p=new Nt(this.m_eSquared,u,o,l),d=this.m_a*this.m_a,g=t.getImpl().querySegmentIterator();for(g.stripAttributes();g.nextPath();)for(;g.hasNextSegment();){let x=g.nextSegment();n.assign(x.getStartXY()),a.assign(x.getEndXY()),a.x-n.x>Math.PI?n.x+=2*Math.PI:a.x-n.x<-Math.PI&&(a.x+=2*Math.PI),this.splitSegmentCrossingItegralThreshold(x,s,i);for(let f of s)u.assign(M(this.m_a,this.m_eSquared,f.getStartXY())),o.assign(M(this.m_a,this.m_eSquared,f.getEndXY())),p.setSegmentEndPoints(u,o),this.adaptiveIntegrationWithRomberg(p,r);for(let f of i){let y=f.getStartXY(),P=f.getEndXY(),B=l;y.y<0&&(P=Tt(y,y=P),y.y=-y.y,P.y=-P.y,B=-B);let G=M(1,this.m_eSquared,y),C=M(1,this.m_eSquared,P),Y=Math.min(y.y,P.y),tt=wt(this.m_eSquared,y.x,P.x,B,Y);h.pe(tt);let Pt=Math.abs(wt(this.m_eSquared,y.x,P.x,Y,b)),z=new E;z.setSub(G,e);let $=new E;$.setSub(C,e);let O=new E;O.setCrossProductVector(z,$);let D=d*(Pt-.5*O.length());D=j(D,P.x-y.x),_.pe(D)}s.length=0,i.length=0}return _.getResult()+d*(.5*(1-this.m_eSquared)*r.getResult()+h.getResult())}getEqualAreaPCSInstance(t,s){let i=s.getCenterX(),n=0,a=0,e,r,h=s.height(),_,u;(_=s.ymin>45*Math.PI/180||s.ymax<45*-Math.PI/180)?e=j(.5*Math.PI,s.getCenterY()):(e=s.getCenterY(),r=s.ymin+h*(2/3));let o=gt("EqualAreaPCS"),m=t.toString();return u=_?dt.fromString(R.PE_TYPE_PROJCS,`PROJCS["${o}", ${m}, PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",${n}],PARAMETER["False_Northing", ${a}],PARAMETER["Central_Meridian", ${i}], PARAMETER["Latitude_of_Origin", ${e}], UNIT["Meter",1.0]]`):dt.fromString(R.PE_TYPE_PROJCS,`PROJCS["${o}", ${m}, PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting", ${n}],PARAMETER["False_Northing", ${a}],PARAMETER["Central_Meridian", ${i}],PARAMETER["Standard_Parallel_1", ${r}],PARAMETER["Latitude_of_Origin", ${e}],UNIT["Meter",1.0]]`),u}splitSegmentCrossingItegralThreshold(t,s,i){let r=M(this.m_a,this.m_eSquared,new S(0,b)),h=M(this.m_a,this.m_eSquared,new S(0,-b)),_=this.splitSegmentPassingThroughPole(t);for(let u of _){let o=u.getStartXY(),m=u.getEndXY(),l=M(this.m_a,this.m_eSquared,o),p=M(this.m_a,this.m_eSquared,m),d=new S,g=new E,x=E.sqrDistance(r,l),f=E.sqrDistance(l,p);if(x<=100){if(!(f>400)){i.push(new T({start:o,end:m}));continue}g.assign(p.sub(l)),g.normalizeThis(),g.assign(l.add(g.mul(20))),d.assign(N(this.m_a,this.m_eSquared,g)),i.push(new T({start:o,end:d})),o.assign(d)}if(l.assign(M(this.m_a,this.m_eSquared,o)),x=E.sqrDistance(r,p),f=E.sqrDistance(l,p),x<=100){if(!(f>400)){i.push(new T({start:o,end:m}));continue}g.assign(p.sub(l)),g.normalizeThis(),g.assign(p.sub(g.mul(20))),d.assign(N(this.m_a,this.m_eSquared,g)),i.push(new T({start:d,end:m})),m.assign(d)}if(l.assign(M(this.m_a,this.m_eSquared,o)),p.assign(M(this.m_a,this.m_eSquared,m)),x=E.sqrDistance(h,l),f=E.sqrDistance(l,p),x<=100){if(!(f>400)){i.push(new T({start:o,end:m}));continue}g.assign(p.sub(l)),g.normalizeThis(),g.assign(l.add(g.mul(20))),d.assign(N(this.m_a,this.m_eSquared,g)),i.push(new T({start:o,end:d})),o.assign(d)}if(l.assign(M(this.m_a,this.m_eSquared,o)),p.assign(M(this.m_a,this.m_eSquared,m)),x=E.sqrDistance(h,p),f=E.sqrDistance(l,p),x<=100){if(!(f>400)){i.push(new T({start:o,end:m}));continue}g.assign(p.sub(l)),g.normalizeThis(),g.assign(p.sub(g.mul(20))),d.assign(N(this.m_a,this.m_eSquared,g)),i.push(new T({start:d,end:m})),m.assign(d)}s.push(new T({start:o,end:m}))}}splitSegmentPassingThroughPole(t){let s={stack:[],error:void 0,hasError:!1};try{let i=[],n=new E,a=new E,e=new E,r=new S,h=20,_=3.124139361,u=10,o=t.getStartXY(),m=t.getEndXY(),l=I(s,new v,!1);if(k.geodeticDistance(this.m_a,this.m_eSquared,o.x,o.y,m.x,m.y,l,null,null,2),Math.abs(m.x-o.x)>_&&l.val>h){let p=new xt(new S(0,90),o.divide(this.m_rpu),m.divide(this.m_rpu),this.m_inputGCS,2,2),d=lt(p.makeFunctor(),0,1,1e-10);if(d.second<=u&&d.first>0&&d.first<1)return n.assign(M(this.m_a,this.m_eSquared,o)),a.assign(M(this.m_a,this.m_eSquared,m)),Et(n,a,d.first,e),r.assign(N(this.m_a,this.m_eSquared,e)),i.push(new T({start:o,end:r})),i.push(new T({start:r,end:m})),i;if(p.setPointDistFrom(new S(0,-90)),d=lt(p.makeFunctor(),0,1,1e-10),d.second<=u&&d.first>0&&d.first<1)return n.assign(M(this.m_a,this.m_eSquared,o)),a.assign(M(this.m_a,this.m_eSquared,m)),Et(n,a,d.first,e),r.assign(N(this.m_a,this.m_eSquared,e)),i.push(new T({start:o,end:r})),i.push(new T({start:r,end:m})),i}return i.push(new T({start:o,end:m})),i}catch(i){s.error=i,s.hasError=!0}finally{U(s)}}adaptiveIntegrationWithRomberg(t,s){let i=t.makeFunctor(),n=0,a=1,e=i(n),r=i(a),h=1e-17,_=1e-14,u=(n+a)/2,o=i(u),m=Math.abs(o-e),l=Math.abs(r-o),p=0;for(;p++<32&&(m/l<.1||l/m<.1);)m<l?(s.pe(W(5,n,u,_,h,i)),n=u,e=o):(s.pe(W(5,u,a,_,h,i)),a=u,r=o),u=(n+a)/2,o=Math.abs(i(u)),m=Math.abs(o-e),l=Math.abs(r-o);s.pe(W(5,n,a,_,h,i))}loxodromeAreaHemi(t,s,i,n,a){let e=i.clone(),r=a.clone(),h,_,u,o,m,l,p,d,g,x,f,y,P,B,G,C;return e.make_negative&&e.changeSign(),r.make_negative&&r.changeSign(),f=n-s,Math.abs(e.sin_phi)===1||Math.abs(r.sin_phi)===1?t.half_qp*f:e.sin_phi===r.sin_phi?(x=.5*t.one_m_e_2*e.sin_phi*(1/e.one_m_e_2_sin_2_phi+L(t.e*e.sin_phi))*f,x):(G=Math.log(r.sin_half_phi_pf*e.sin_half_phi_pz/(r.sin_half_phi_pz*e.sin_half_phi_pf)),C=Math.log(r.sin_half_asin_e_sin_phi_pf*e.sin_half_asin_e_sin_phi_pz/(r.sin_half_asin_e_sin_phi_pz*e.sin_half_asin_e_sin_phi_pf)),this.m_eSquared===1?(m=0,h=.5*(G+r.sin_phi/r.one_m_e_2_sin_2_phi-e.sin_phi/e.one_m_e_2_sin_2_phi),_=0):(m=-2*t.atanh_e_over_e*(Math.log(r.one_p_sin_phi/e.one_p_sin_phi)-t.e*C),h=(G-t.e*C)/t.one_m_e_2,_=(Math.log(r.one_m_e_2_sin_2_phi/e.one_m_e_2_sin_2_phi)+m/t.atanh_e_over_e)/t.one_m_e_2),u=-C*(e.atanh_esin_phi+r.atanh_esin_phi),o=1/e.one_m_e_2_sin_2_phi-1/r.one_m_e_2_sin_2_phi,l=q(r.one_m_sin_phi/t.one_p_e,t.e)-q(e.one_m_sin_phi/t.one_p_e,t.e),p=q(r.one_p_sin_phi/t.one_p_e,t.e)-q(e.one_p_sin_phi/t.one_p_e,t.e),d=q(e.one_m_sin_phi/-t.one_m_e,t.e)-q(r.one_m_sin_phi/-t.one_m_e,t.e),g=q(e.one_p_sin_phi/-t.one_m_e,t.e)-q(r.one_p_sin_phi/-t.one_m_e,t.e),x=.25/h*(_+u+o+m+.5*(l+p+d+g)),x+=t.half_qp,y=.5*t.one_m_e_2*e.sin_phi*(1/e.one_m_e_2_sin_2_phi+L(t.e*e.sin_phi)),P=.5*t.one_m_e_2*r.sin_phi*(1/r.one_m_e_2_sin_2_phi+L(t.e*r.sin_phi)),P<y&&(B=y,y=P,P=B),x<y&&(x=y),x>P&&(x=P),x*=f,x)}loxodromeArea(t){let s=Math.PI/180,i=0,n=se(),a=Dt(),e=Dt();n.e=Math.sqrt(this.m_eSquared),n.one_p_e=1+n.e,n.one_m_e=1-n.e,n.one_m_e_2=1-this.m_eSquared,n.atanh_e_over_e=L(n.e),this.m_eSquared>=1?n.half_qp=1:n.half_qp=.5*(1+n.atanh_e_over_e*n.one_m_e_2),n.f=.25*Math.PI,n.z=.75*Math.PI,e.initialize(0,n.e,n.f,n.z);let r=t.getPathCount(),h=new S,_=new S,u=t.getImpl().getAttributeStreamRef(0);for(let o=0;o<r;o++){let m=t.getPathStart(o),l=t.getPathEnd(o);if(!(l-m<=1)){u.queryPoint2D(2*(l-1),h);for(let p=m;p<l;p++){u.queryPoint2D(2*p,_);let d=h.y*s,g=_.y*s;if(p===m?(a.initialize(d,n.e,n.f,n.z),a.make_negative=!1):a.assign(e),e.initialize(g,n.e,n.f,n.z),e.make_negative=!1,h.y*_.y<0){if(h.y>=90&&_.y<=-90||_.y>=90&&h.y<=-90)return Number.NaN;let x=Dt();x.initialize(0,n.e,n.f,n.z),x.make_negative=!1;let f=a.atanh_sin_phi-n.e*a.atanh_esin_phi,y=e.atanh_sin_phi-n.e*e.atanh_esin_phi,P=(y*h.x-f*_.x)/(y-f);d<0?(a.make_negative=!0,i-=this.loxodromeAreaHemi(n,h.x*s,a,P*s,x),a.make_negative=!1,i+=this.loxodromeAreaHemi(n,P*s,x,_.x*s,e)):(i+=this.loxodromeAreaHemi(n,h.x*s,a,P*s,x),e.make_negative=!0,i-=this.loxodromeAreaHemi(n,P*s,x,_.x*s,e),e.make_negative=!1)}else h.y>=0?i+=this.loxodromeAreaHemi(n,h.x*s,a,_.x*s,e):(a.make_negative=!0,e.make_negative=!0,i-=this.loxodromeAreaHemi(n,h.x*s,a,_.x*s,e),a.make_negative=!1,e.make_negative=!1);h.assign(_)}}}return this.m_a*i*this.m_a}calculate(t){if(t.isEmpty()||t.getDimension()<2)return 0;if(t.getGeometryType()===ot.enumEnvelope){let s=new _t;return s.addEnvelope(t,!1),this.calculate(s)}return this.m_inputSR!==this.m_inputGCS&&this.m_transformPCS2GCS===null&&(this.m_transformPCS2GCS=K(this.m_inputSR,this.m_inputGCS,null)),this.executePolygonGeodeticArea(t)}},Jt=class{getOperatorType(){return 10311}supportsCurves(){return!0}accelerateGeometry(t,s,i){return!1}canAccelerateGeometry(t){return!1}execute(t,s,i,n){return St(t),i===4?new qt().execute(t,s,n):new Bt(s,i,n).calculate(t)}};export{Jt as OperatorGeodeticArea};
