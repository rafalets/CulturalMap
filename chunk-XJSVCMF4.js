import{a as x,b as X,c as ee,d as ge,e as Me,f as te}from"./chunk-WGX2RQVH.js";import{a as zt}from"./chunk-JBWK3TLM.js";import{c as Ht}from"./chunk-WAIROH7D.js";import{a as B}from"./chunk-J74DFTDJ.js";import{a as Ce,b as He,c as Le,i as Y,m as Ut}from"./chunk-CZJNVIO4.js";import{m as Ge}from"./chunk-3ZANJLLA.js";import{b as Pe}from"./chunk-WPDP647R.js";import{a as pt}from"./chunk-4E4FE2IX.js";import{a as Ue,d as $t}from"./chunk-TJSLQWS6.js";import{k as ze}from"./chunk-IPGHBSHO.js";import{b as Rt,c as vt}from"./chunk-QS52XG5C.js";import{a as $e}from"./chunk-EUD3KSLO.js";import{h as Qt}from"./chunk-FVILOOND.js";import{a as Mt,b as St}from"./chunk-5E3QY4A2.js";import{a as Nt,b as Ct,c as Lt}from"./chunk-2EUOCJVM.js";import{a as Gt}from"./chunk-ODTAY6YM.js";import{b as kt,c as At}from"./chunk-YVRSGFS3.js";import{a as ce,b as J,c as qt}from"./chunk-YNPFZOJD.js";import{a as Ot,b as Pt}from"./chunk-3ZX35QIC.js";import{c as xt}from"./chunk-7PERXXHH.js";import{a as jt}from"./chunk-QYRRGSBK.js";import{b as Dt}from"./chunk-DCKTHYU4.js";import{c as V}from"./chunk-6T37AWU6.js";import{a as Ft}from"./chunk-XC4BCVYU.js";import{a as _t}from"./chunk-JEGXFID4.js";import{e as fe}from"./chunk-F6A6XWW4.js";import{p as Et}from"./chunk-WUJRCGDY.js";import{a as pe}from"./chunk-QPGCDGIN.js";import{f as lt}from"./chunk-LNVVFNTC.js";import{a as It}from"./chunk-OOAI5LGC.js";import{a as ct,b as ut,c as yt}from"./chunk-5TMYC5PF.js";import{a as Tt}from"./chunk-IWPCZHB6.js";import{c as mt,f as ft,i as ht,m as gt,n as bt}from"./chunk-SCKV27CX.js";import{a as dt}from"./chunk-S7QYPX7J.js";import{a as wt}from"./chunk-KWZIB4M6.js";import{a as je}from"./chunk-JR22Z7I2.js";import{f as Z}from"./chunk-3QNSJ5HY.js";import{m as Bt,n as Wt}from"./chunk-HKHTIKVW.js";import{a as Oe}from"./chunk-XFESK2YB.js";import{a as qe}from"./chunk-J5MXC6AL.js";import{h as de,t as he}from"./chunk-IB2IUO7T.js";import{h as me}from"./chunk-7N3ZKWML.js";import{i as xe}from"./chunk-QDTU3MWT.js";import{j as le}from"./chunk-I4M2OT5W.js";import{n as Ae}from"./chunk-NTVLK3P2.js";import{a as Ne}from"./chunk-WMQNRNIU.js";import{a as at}from"./chunk-EIPVFA6F.js";import{G as H}from"./chunk-IG66NQHW.js";import{a as st}from"./chunk-VDKRSX77.js";import{b as ve}from"./chunk-WUA6PW3I.js";import{F as ke}from"./chunk-E57FTRWF.js";import{L as nt,d as f,o as it}from"./chunk-C7INQGWT.js";import{H as se,c as j}from"./chunk-WMHJC7XF.js";import{t as ot}from"./chunk-D2LVMNOU.js";import{a as m}from"./chunk-QGVBCWUY.js";import{b as A,r as _e,t as G}from"./chunk-HHDFN2GK.js";import{a as q,b as K,c as rt,f as S}from"./chunk-VTHXE323.js";var Se=class{constructor(){this.version="",this.queryResult=new Be}},Be=class{constructor(){this.featureResult=new We}},We=class{constructor(){this.objectIdFieldName="",this.uniqueIdField=new Qe,this.globalIdFieldName="",this.geohashFieldName="",this.geometryProperties=new Ve,this.geometryType=null,this.spatialReference=new Ne,this.exceededTransferLimit=!1,this.hasZ=!1,this.hasM=!1,this.transform=new be,this.fields=[],this.fieldNameToAttributeIndexMap={},this.values=[],this.features=[],this.geometryFields=[]}},Qe=class{constructor(){this.name="",this.isSystemMaintained=!1}},Ve=class{constructor(){this.shapeAreaFieldName="",this.shapeLengthFieldName="",this.units=""}},be=class{constructor(){this.quantizeOriginPosition="upperLeft",this.scale=new Je,this.translate=new Ye}},Je=class{constructor(){this.xScale=0,this.yScale=0,this.mScale=0,this.zScale=0}},Ye=class{constructor(){this.xTranslate=0,this.yTranslate=0,this.mTranslate=0,this.zTranslate=0}},Fe=class{constructor(){this.name="",this.fieldType="esriFieldTypeString",this.alias="",this.sqlType="sqlTypeVarchar",this.domain="",this.defaultValue=""}},De=class{constructor(){this.attributes=[],this.compressedGeometry=new ue,this.centroid=new ue,this.aggregateGeometries=[]}},ue=class{constructor(){this.geometryType=null,this.lengths=[],this.coords=[]}};var re;(function(e){e.ELEMENTUID="ELEMENTUID",e.TYPENAME="TYPENAME"})(re||(re={}));var Vt=[re.ELEMENTUID,re.TYPENAME],Ke,Ze;(function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME"})(Ke||(Ke={})),function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME",e[e.FROMUID=2]="FROMUID",e[e.TOUID=3]="TOUID"}(Ze||(Ze={}));var Jt,Te,we,ie;(function(e){e[e.featureResult=0]="featureResult",e[e.countResult=1]="countResult",e[e.idsResult=2]="idsResult"})(Jt||(Jt={})),function(e){e[e.upperLeft=0]="upperLeft",e[e.lowerLeft=1]="lowerLeft"}(Te||(Te={})),function(e){e[e.sqlTypeBigInt=0]="sqlTypeBigInt",e[e.sqlTypeBinary=1]="sqlTypeBinary",e[e.sqlTypeBit=2]="sqlTypeBit",e[e.sqlTypeChar=3]="sqlTypeChar",e[e.sqlTypeDate=4]="sqlTypeDate",e[e.sqlTypeDecimal=5]="sqlTypeDecimal",e[e.sqlTypeDouble=6]="sqlTypeDouble",e[e.sqlTypeFloat=7]="sqlTypeFloat",e[e.sqlTypeGeometry=8]="sqlTypeGeometry",e[e.sqlTypeGUID=9]="sqlTypeGUID",e[e.sqlTypeInteger=10]="sqlTypeInteger",e[e.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",e[e.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",e[e.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",e[e.sqlTypeNChar=14]="sqlTypeNChar",e[e.sqlTypeNVarChar=15]="sqlTypeNVarChar",e[e.sqlTypeOther=16]="sqlTypeOther",e[e.sqlTypeReal=17]="sqlTypeReal",e[e.sqlTypeSmallInt=18]="sqlTypeSmallInt",e[e.sqlTypeSqlXml=19]="sqlTypeSqlXml",e[e.sqlTypeTime=20]="sqlTypeTime",e[e.sqlTypeTimestamp=21]="sqlTypeTimestamp",e[e.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",e[e.sqlTypeTinyInt=23]="sqlTypeTinyInt",e[e.sqlTypeVarbinary=24]="sqlTypeVarbinary",e[e.sqlTypeVarchar=25]="sqlTypeVarchar"}(we||(we={})),function(e){e[e.OID_ARRAY=0]="OID_ARRAY",e[e.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",e[e.STRING_ARRAY=2]="STRING_ARRAY",e[e.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(ie||(ie={}));function Yt(e){let t=new Se;t.version=e.version;let i=e.get_query_result();if(i.results_type.value!==0)throw new Error("Got a non-feature collection type");let r=i.get_feature_result(),o=t.queryResult.featureResult;o.objectIdFieldName=r.objectid_field_name,o.exceededTransferLimit=r.exceeded_transfer_limit,o.hasM=r.has_m,o.hasZ=r.has_z,o.geometryType=Le[r.geometry_type.value],o.globalIdFieldName=r.globalid_field_name,o.geohashFieldName=r.geohash_field_name;let n=o.uniqueIdField,l=r.unique_id_field;n.name=l.name,n.isSystemMaintained=l.isSystemMaintained;let s=o.geometryProperties,y=r.geometry_properties;s.shapeAreaFieldName=y.shapeAreaFieldName,s.shapeLengthFieldName=y.shapeLengthFieldName,s.units=y.units;let a=o.spatialReference,p=r.spatial_reference;a.wkid=p.wkid,a.latestWkid=p.latestWkid,a.vcsWkid=p.vcsWkid,a.latestVcsWkid=p.latestVcsWkid,a.wkt=p.wkt,o.transform=Dr(r.transform);let c=o.fields,d=o.fieldNameToAttributeIndexMap,u=r.fields,h=u.size();for(let T=0;T<h;T++){let M=u.get(T),D=Kt(M);c.push(D),d[D.name]=T,M.delete()}u.delete();let b=o.values,L=r.values_count();for(let T=0;T<L;T++)b.push(r.get_value_at(T));let C=o.features,N=r.features,_=N.size();if(_>0){for(let T of Vt)if(d[T]===void 0)throw new Error(`Feature collection missing required attribute: ${T}`)}for(let T=0;T<_;T++){let M=new De,D=N.get(T),U=M.attributes,z=D.attributes_count();for(let R=0;R<z;R++)U.push(D.get_attribute_at(R));let k=D.get_compressed_geometry();k&&(M.compressedGeometry=Xe(k),M.centroid=Xe(D.get_centroid()));let O=M.aggregateGeometries,v=D.aggregate_geometries,Q=v.size();for(let R=0;R<Q;R++){let ae=v.get(R),ye=Xe(ae);O.push(ye),ae.delete()}v.delete(),C.push(M),D.delete()}N.delete();let F=o.geometryFields,I=r.geometry_fields,g=I.size();for(let T=0;T<g;T++){let M=I.get(T),D=Fr(M);F.push(D),M.delete()}return I.delete(),t}function Xe(e){let t=new ue;t.geometryType=Le[e.geometry_type.value];let i=[],r=[];for(let o=0;o<e.lengths.length;o++)i.push(e.lengths[o]);for(let o=0;o<e.coords.length;o++)r.push(e.coords[o]);return t.lengths=i,t.coords=r,t}function Kt(e){let t=new Fe;return t.name=e.name,t.alias=e.alias,t.fieldType=He[e.field_type.value],t.sqlType=we[e.sql_type.value],t.domain=e.domain,t.defaultValue=e.default_value,t}function Fr(e){let t=Kt(e);return t.geometryType=Le[e.geometry_type.value],t}function Dr(e){let t=new be;t.quantizeOriginPosition=Te[e.quantizeOriginPosition.value];let i=t.scale,r=e.scale;i.xScale=r.xScale,i.yScale=r.yScale,i.mScale=r.mScale,i.zScale=r.zScale;let o=t.translate,n=e.translate;return o.xTranslate=n.xTranslate,o.yTranslate=n.yTranslate,o.mTranslate=n.mTranslate,o.zTranslate=n.zTranslate,t}function Rr(e){return S(this,null,function*(){let t=[],i={generateAllSublayers:!1,namedTypeDefinitions:new Map};return e.entitiesUrl&&t.push(Zt(e.entitiesUrl).then(r=>{Xt(r,i)})),e.relationshipsUrl&&t.push(Zt(e.relationshipsUrl).then(r=>{Xt(r,i)})),yield Promise.all(t),i})}function si(e,t){return S(this,null,function*(){t??=!1;let i={generateAllSublayers:t,namedTypeDefinitions:new Map};return yield Ar(e).then(r=>{Or(r,i)}),i})}function li(e){return S(this,null,function*(){let t=yield Ce(),i=new t.MapOfObjectIdentifierSets;vr(i,t,e);let r=new t.MapOfObjectIdentifierSetsEncoder;try{r.set_map_of_identifier_sets(i),r.encode();let o=r.get_encoding_result();if(o.error.error_code!==0)throw new G("knowledge-graph:layer-support-utils",o.error.error_message);let n=structuredClone(o.get_byte_buffer());return r.delete(),n}finally{i.delete()}})}function vr(e,t,i){for(let[r,o]of i.namedTypeDefinitions){if(!o.members||o.useAllData)continue;let n=o.members.keys(),l=!1,s=!0,y=new t.ObjectIdArray,a=new t.StringArray,p=new t.GlobalIdArray,c=new t.IdentifierArray,d=new t.ObjectIdentifierSet;for(let u of n)s&&(l=!isNaN(Number(u)),s=!1),l?y.add_objectid(Number(u)):(a.add_string(u),p.add_globalid(u)),c.add_identifier(u);d.set_oid_array(y),d.set_string_array(a),d.set_globalid_array(p),d.set_identifier_array(c),y.delete(),a.delete(),p.delete(),c.delete(),e.put_identifier_set(r,d),d.delete()}return e}function Zt(e){return S(this,null,function*(){let t=yield ke(e,{responseType:"array-buffer"});return kr(yield t.data)})}function kr(e){return S(this,null,function*(){let t=new(yield Ce()).FeatureCollectionDecoder,i=t.decode(new Uint8Array(e));if(i.error_code!==0)throw new G("knowledge-graph:layer-support-utils",i.error_message);let r=t.get_feature_collection(),o=Yt(r);return t.delete(),o})}function Ar(e){return S(this,null,function*(){let t=yield ke(e,{responseType:"array-buffer"}),i=yield t.data;return xr(new Uint8Array(i))})}function xr(e){return S(this,null,function*(){let t=new(yield Ce()).MapOfObjectIdentifierSetsDecoder,i=t.decode(new Uint8Array(e)),r=new Map;if(i.error_code!==0)throw new G("knowledge-graph:layer-support-utils",i.error_message);let o=t.get_map_of_identifier_sets(),n=o.keys,l=n.size();for(let s=0;s<l;s++){let y=n.get(s),a=o.query_identifier_set(y),p=[];if(a.id_array_type.value===ie.GLOBALID_ARRAY){let c=a.get_globalid_array(),d=c.count();for(let u=0;u<d;u++)p.push(c.get_globalid_at(u))}else if(a.id_array_type.value===ie.IDENTIFIER_ARRAY){let c=a.get_identifier_array(),d=c.count();for(let u=0;u<d;u++)p.push(c.get_identifier_at(u).toString())}else if(a.id_array_type.value===ie.STRING_ARRAY){let c=a.get_string_array(),d=c.count();for(let u=0;u<d;u++)p.push(c.get_string_at(u))}else{if(a.id_array_type.value!==ie.OID_ARRAY)throw new G("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{let c=a.get_oid_array(),d=c.count();for(let u=0;u<d;u++)p.push(c.get_objectid_at(u).toString())}}r.set(y,p)}return t.delete(),r})}function Xt(e,t){if(!e?.queryResult?.featureResult)return t;let i=e.queryResult.featureResult.fieldNameToAttributeIndexMap;for(let r of e.queryResult.featureResult.features){let o=r.attributes[i[re.TYPENAME]],n=j(t.namedTypeDefinitions,o,()=>({useAllData:!1,members:new Map})),l=r.attributes[i[re.ELEMENTUID]];if(r.compressedGeometry?.coords?.length>0){let s=r.compressedGeometry.lengths;r.compressedGeometry.geometryType==="esriGeometryPoint"&&(s=[]),n.members.set(l,{id:l,linkChartLocation:new pt(s,r.compressedGeometry.coords)})}else n.members.set(l,{id:l})}return t}function Or(e,t){for(let[i,r]of e){let o=j(t.namedTypeDefinitions,i,()=>({useAllData:!1,members:new Map}));for(let n of r)o.members.has(n)||o.members.set(n,{id:n})}return t}var pi={fetchAndConvertSerializedLinkChart:e=>Rr(e)};var oe=class e{constructor(){this._featureLookup=new Map}static getInstance(){return e.instance||(e.instance=new e),e.instance}static resetInstance(){e.instance&&(e.instance=null)}deleteFromStore(t){t.forEach(i=>{this._featureLookup.delete(i)})}readFromStoreByList(t){let i=[];return t.forEach(r=>{let o=this.readFromStoreById(r);o&&i.push(o)}),i}readFromStoreById(t){return this._featureLookup.get(t)??null}writeToStore(t,i,r){let o=[];return t.forEach(n=>{if(!n?.id)return;n.properties||(n.properties=[]);let l,s=null;if(r&&n.properties[r]&&(s=Ge(n.properties[r])),"originId"in n&&"destinationId"in n&&(n.properties[X]=n.originId,n.properties[ee]=n.destinationId),n.properties[i]=n.id,n.id&&this._featureLookup.has(n.id)&&this._featureLookup.get(n.id).attributes){let y=this._featureLookup.get(n.id),a=JSON.parse(JSON.stringify(Object.assign(y.attributes,n.properties)));r&&n.properties[r]&&(a[r]=lt(n.properties[r])),l=new Pe(s?JSON.parse(JSON.stringify(s)):y?.geometry?JSON.parse(JSON.stringify(y.geometry)):null,a,null,n.properties[i])}else l=new Pe(s?JSON.parse(JSON.stringify(s)):null,n.properties,null,n.properties[i]);this._featureLookup.set(`${n.typeName?`${n.typeName}__${n.id}`:n.id}`,l),o.push(l)}),o}};var et,E=null;function bi(){return et||(et=import("./chunk-MU5VGJB7.js").then(e=>e.l).then(({default:e})=>e({locateFile:t=>st(`esri/libs/linkchartlayout/${t}`)})).then(e=>{Pr(e)}),et)}function Pr(e){E=e}var er,W,tr,Ie;(function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot",e[e.IsOld=8]="IsOld"})(er||(er={})),function(e){e[e.Success=0]="Success",e[e.Error=1]="Error",e[e.Canceled=2]="Canceled"}(W||(W={})),function(e){e[e.Regular=0]="Regular",e[e.Curved=1]="Curved",e[e.Recursive=2]="Recursive"}(tr||(tr={})),function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom"}(Ie||(Ie={}));var rr={none:0,"start-only":1,"start-and-end":2};function Gr(e){let t=K(q({timeDirection:"right",timeBannerUTCOffsetInMinutes:0,eventsTicksVisualization:"start-and-end",showDurationLineForNonZeroDurationEntityEvents:!0,durationLineWidth:5,entityPositionAtDurationRatio:1,showNonZeroDurationIntervalBounds:!1,separateTimeOverlaps:!0,separateTimelineOverlaps:!0,moveFirstBends:!0,secondBendRatio:.3,lineSeparationMultiplier:1,spaceSeparatedLinesEvenly:!1,useBezierCurves:!1,separatedLineShapeRatio:0},e?.toJSON()??{}),{eventsTicksVisualization:e?.eventsTicksVisualization??"start-and-end"});return K(q({},t),{timeDirection:{value:Ie[t.timeDirection]??Ie.right},eventsTicksVisualization:{value:rr[t.eventsTicksVisualization]??rr["start-and-end"]}})}function ne(e,t,i,r,o,n){let l=i.length,s=o.length,y=Float64Array.BYTES_PER_ELEMENT,a=Uint32Array.BYTES_PER_ELEMENT,p=Uint8Array.BYTES_PER_ELEMENT,c=16,d=c+l*(p+2*y)+s*(2*a),u=E._malloc(d);try{let h=u+c-u%c,b=h+l*y,L=b+l*y,C=L+s*a,N=C+s*a,_=()=>[E.HEAPF64.subarray(h>>3,(h>>3)+l),E.HEAPF64.subarray(b>>3,(b>>3)+l),E.HEAPU32.subarray(L>>2,(L>>2)+s),E.HEAPU32.subarray(C>>2,(C>>2)+s),E.HEAPU8.subarray(N,N+l)],[F,I,g,T,M]=_();F.set(i),I.set(r),g.set(o),T.set(n),M.set(t);let D=e(l,N,h,b,s,L,C),U=null,z=null;if(D.value===W.Success){let ae=E.getLayoutLinksTypes(),ye=E.getLayoutLinksVerticesEndIndices(),Re=E.getLayoutLinksVertices(),tt=E.countLayoutLinksVertices();!s||ae&&ye?tt&&!Re?D.value=W.Error:(U={types:new Uint8Array(E.HEAPU8.subarray(ae,ae+s)),vertexEndIndex:new Uint32Array(E.HEAPU32.subarray(ye>>2,(ye>>2)+s)),vertices:new Float64Array(E.HEAPF64.subarray(Re>>3,(Re>>3)+2*tt))},z=E.getAuxiliaryGraphicElements()):D.value=W.Error}let[k,O,v,Q,R]=_();return i.set(k),r.set(O),o.set(v),n.set(Q),t.set(R),{status:D.value,links:U,graphics:z}}finally{E._free(u),E.cleanupLayout()}}var ir=2,or=1,nr=-1,ar,sr,lr,pr,dr,cr,ur,yr,mr;(function(e){function t(){return E.getMinIdealEdgeLength()}function i(r,o,n,l,s,y,a=ir,p=or,c=nr){return ne((d,u,h,b,L,C,N)=>E.applyForceDirectedLayout(r,d,u,h,b,L,C,N,a,p,c),o,n,l,s,y)}e.getMinIdealEdgeLength=t,e.apply=i})(ar||(ar={})),function(e){function t(i,r,o,n,l,s,y=ir,a=or,p=nr){return ne((c,d,u,h,b,L,C)=>E.applyCommunityLayout(i,c,d,u,h,b,L,C,y,a,p),r,o,n,l,s)}e.apply=t}(sr||(sr={})),function(e){function t(i,r,o,n,l,s){return ne((y,a,p,c,d,u,h)=>E.applySimpleLayout(i,y,a,p,c,d,u,h),r,o,n,l,s)}e.apply=t}(lr||(lr={})),function(e){function t(i,r,o,n,l,s){return ne((y,a,p,c,d,u,h)=>E.applyHierarchicalLayout(i,y,a,p,c,d,u,h),r,o,n,l,s)}e.apply=t}(pr||(pr={})),function(e){function t(i,r,o,n,l,s){return ne((y,a,p,c,d,u,h)=>E.applyRadialTreeLayout(i,y,a,p,c,d,u,h),r,o,n,l,s)}e.apply=t}(dr||(dr={})),function(e){function t(i,r,o,n,l,s){return ne((y,a,p,c,d,u,h)=>E.applySmartTreeLayout(i,y,a,p,c,d,u,h),r,o,n,l,s)}e.apply=t}(cr||(cr={})),function(e){function t(i,r,o,n,l,s,y,a,p,c,d,u){return ne((h,b,L,C,N,_,F)=>{if(l.length!==h)return{value:W.Error};if(s.length!==h)return{value:W.Error};if(p.length!==N)return{value:W.Error};if(c.length!==N)return{value:W.Error};let I=Float64Array.BYTES_PER_ELEMENT,g=16,T=E._malloc(g+h*I),M=E._malloc(g+h*I),D=E._malloc(g+N*I),U=E._malloc(g+N*I),z=T+g-T%g,k=M+g-M%g,O=D+g-D%g,v=U+g-U%g;try{return E.HEAPF64.subarray(z>>3,(z>>3)+h).set(l),E.HEAPF64.subarray(k>>3,(k>>3)+h).set(s),E.HEAPF64.subarray(O>>3,(O>>3)+N).set(p),E.HEAPF64.subarray(v>>3,(v>>3)+N).set(c),E.applyChronologicalLayout(i,h,b,L,C,z,k,N,_,F,O,v,d,Gr(u))}finally{E._free(T),E._free(M),E._free(D),E._free(U)}},r,o,n,y,a)}e.apply=t}(ur||(ur={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(yr||(yr={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(mr||(mr={}));var Ei=ve()({none:"none",startAndEnd:"start-and-end",startOnly:"start-only"}),_i=ve()({absoluteValue:"absolute-value",multiplier:"multiplier"});var fr=new Map([["basic-grid","basic-grid"],["geographic-organic-standard","geographic-organic-standard"],["hierarchical-bottom-to-top","hierarchical-bottom-to-top"],["hierarchical-top-to-bottom","hierarchical-bottom-to-top"],["organic-community","organic-community"],["organic-fusiform","organic-standard"],["organic-leaf-circle","organic-standard"],["organic-standard","organic-standard"],["radial-node-centric","radial-root-centric"],["radial-root-centric","radial-root-centric"],["tree-bottom-to-top","tree-left-to-right"],["tree-left-to-right","tree-left-to-right"],["tree-right-to-left","tree-left-to-right"],["tree-top-to-bottom","tree-left-to-right"],["chronological-mono-timeline","chronological-mono-timeline"],["chronological-multi-timeline","chronological-multi-timeline"]]);function qr(e,t){let i=new Map;if(t.dataModel?.relationshipTypes)for(let r of t.dataModel.relationshipTypes)r.name&&i.set(r.name,[]);for(let r of e)i.has(r.typeName)&&i.get(r.typeName)?.push(r.id);return i}function zi(e,t,i){return S(this,null,function*(){let r=[],o=qr(e,t),n={},l=[];for(let[p,c]of o){if(c.length<1)continue;let d=`${p}_ids`;n[d]=c,l.push(`MATCH (n)-[r:${p}]->(m) WHERE id(r) in $${d} RETURN id(n), labels(n)[0], id(m), labels(m)[0]`)}if(l.length===0)return[];let s=l.join(" UNION "),y=new B({openCypherQuery:s,bindParameters:n}),a=(yield Y(t,y,i?.requestOptions)).resultRowsStream.getReader();for(;;){let{done:p,value:c}=yield a.read();if(p)break;for(let d of c)r.push({id:d[0],typeName:d[1]}),r.push({id:d[2],typeName:d[3]})}return r})}var Hi=e=>fr.get(e)??"radial-root-centric";function hr(e){if(!e.spatialReference.isWGS84)throw new G("knowledge-graph:layer-support-utils","The utilsExtentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map(t=>[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]])}var $=class extends nt{constructor(e){super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;let t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach(i=>{i.name&&(t.set(i.name,"entity"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(i.name),i.properties?.forEach(r=>{r.geometryType&&r.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(i.name,{name:r.name??"",geometryType:r.geometryType})}))}),e.knowledgeGraph.dataModel.relationshipTypes?.forEach(i=>{i.name&&(t.set(i.name,"relationship"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(i.name),i.properties?.forEach(r=>{r.geometryType&&r.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(i.name,{name:r.name??"",geometryType:r.geometryType})}))}),e.inclusionModeDefinition?.namedTypeDefinitions.forEach((i,r)=>{if(t.get(r)==="entity")this.entityTypeNames.add(r);else{if(t.get(r)!=="relationship")return _e.getLogger(this).warn(`A named type, ${r}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(r);this.relationshipTypeNames.add(r)}let o=new Map;i.members?.forEach(n=>{j(this.memberIdTypeLookup,n.id,()=>new Set).add(r);let l=this.getById(n.id);l&&o.set(n.id,l)}),this.sublayerCaches.set(r,o)})}addToLayer(e){e.forEach(({typeName:t,id:i})=>{if(!this.inclusionModeDefinition)throw new G("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){let r=this.inclusionModeDefinition.namedTypeDefinitions.get(t);r.members||(r.members=new Map),r.members.set(i,{id:i}),j(this.memberIdTypeLookup,i,()=>new Set).add(t)}}else{let r=new Map;r.set(i,{id:i}),this.inclusionModeDefinition.namedTypeDefinitions.set(t,{useAllData:!1,members:r}),j(this.memberIdTypeLookup,i,()=>new Set).add(t)}})}getById(e){return oe.getInstance().readFromStoreById(e)}getData(e,t,i){return S(this,null,function*(){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let r;if(r=e||new V({where:"1=1",outFields:["*"]}),t.parentCompositeLayer.type==="link-chart"){let o=t.parentCompositeLayer,n=this._processingCacheUpdatesLookup.get(t.objectType.name??""),l=r.outFields;l&&l.length===1&&l[0]===x&&r.where==="1=1"||(yield Promise.all(n??[]));let s=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],y=[];return s.forEach(a=>{if(this.relationshipTypeNames.has(t.objectType.name)){a.geometry=o.relationshipLinkChartDiagramLookup.get(a.attributes[t.objectIdField]);let p=this.memberIdTypeLookup.get(a.attributes[X]),c=this.memberIdTypeLookup.get(a.attributes[ee]),d=this._isEndEntitySpatial(p,a,X),u=this._isEndEntitySpatial(c,a,ee);a.attributes[te]=Number(d&&u)}else{a.geometry=o.entityLinkChartDiagramLookup.get(a.attributes[t.objectIdField]);let p=this.geographicLookup.get(t.objectType.name);p&&a.attributes[p.name]?a.attributes[te]=1:a.attributes[te]=0}a.attributes[ge]=a.geometry,y.push(a)}),y}return this.retrieveDataFromService(r,t,i)})}getConnectedRecordIds(e,t,i){return S(this,null,function*(){let r=[],o="",n=this._getNamedTypeIdMapFromNodeIds(e);if(t&&t?.length!==0){for(let p of t)o=o+p+"|";o=o.slice(0,-1)}let l={},s=[];for(let[p,c]of n){let d=`${p}_ids`;l[d]=c,t&&t?.length!==0?s.push(`MATCH (n:${p}) WHERE id(n) IN $${d} WITH n MATCH (n)-[r:${o}]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`):s.push(`MATCH (n:${p}) WHERE id(n) IN $${d} WITH n MATCH (n)-[r]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`)}if(!s.length)return r;let y=s.join(" UNION "),a=(yield Y(this.knowledgeGraph,new B({openCypherQuery:y,bindParameters:l}),{signal:i?.signal})).resultRowsStream.getReader();for(;;){let{done:p,value:c}=yield a.read();if(p)break;for(let d=0;d<c.length;d++){let u=c[d];r.push({id:u[0],typeName:u[1]}),r.push({id:u[2],typeName:u[3]})}}return r})}getRelationshipsBetweenNodes(e,t,i){return S(this,null,function*(){let r=this._getNamedTypeIdMapFromNodeIds(e);if(r.size===0)return[];let o={relationshipExclusionIds:t,possibleConnectionEntityIds:e},n=[];for(let[a,p]of r.entries()){let c=`${a}_ids`;o[c]=p,n.push(`MATCH (n:${a}) WHERE id(n) IN $${c} WITH n MATCH (n)-[r]->(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}let l=n.join(" UNION "),s=[],y=(yield Y(this.knowledgeGraph,new B({openCypherQuery:l,bindParameters:o}),{signal:i?.signal})).resultRowsStream.getReader();for(;;){let{done:a,value:p}=yield y.read();if(a)break;for(let c=0;c<p.length;c++){let d=p[c];s.push({id:d[0],typeName:d[1]})}}return s})}getRelationshipsFromNodes(e,t,i,r){return S(this,null,function*(){let o=this._getNamedTypeIdMapFromNodeIds(e);if(o.size===0||t.length===0)return[];let n={relationshipExclusionIds:i,possibleConnectionEntityIds:t},l=[];for(let[c,d]of o.entries()){let u=`${c}_ids`;n[u]=d,l.push(`MATCH (n:${c}) WHERE id(n) IN $${u} WITH n MATCH (n)-[r]-(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}let s=l.join(" UNION "),y=new Map,a=(yield Y(this.knowledgeGraph,new B({openCypherQuery:s,bindParameters:n}),{signal:r?.signal})).resultRowsStream.getReader();for(;;){let{done:c,value:d}=yield a.read();if(c)break;for(let u=0;u<d.length;u++){let h=d[u],b=y.get(h[1]);b||(b=new Set,y.set(h[1],b)),b.add(h[0])}}let p=[];for(let[c,d]of y)for(let u of d)p.push({id:u,typeName:c});return p})}refreshCacheContent(e,t,i,r=!0,o){return S(this,null,function*(){let n=oe.getInstance(),l=[],s=new Map,y=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach(a=>{a.name&&y.set(a.name,a)}),this.knowledgeGraph.dataModel.relationshipTypes?.forEach(a=>{a.name&&y.set(a.name,a)}),e||this.inclusionModeDefinition?e?e.forEach(a=>{if(this.memberIdTypeLookup.has(a))for(let p of this.memberIdTypeLookup.get(a))s.has(p)?s.get(p)?.push(a):s.set(p,[a])}):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach((a,p)=>{a.useAllData?s.set(p,null):a.members&&a.members.forEach(c=>{s.has(p)&&s.get(p)!==null?s.get(p)?.push(c.id):s.set(p,[c.id])})}):(this.knowledgeGraph.dataModel.entityTypes?.forEach(a=>{a.name&&s.set(a.name,null)}),this.knowledgeGraph.dataModel.entityTypes?.forEach(a=>{a.name&&s.set(a.name,null)}));for(let[a,p]of s){let c=new Set(p),d=new Promise((u,h)=>{S(this,null,function*(){let L=new Set,C=[],N,_="",F=!1;if(t||y.get(a)?.properties?.forEach(T=>{T.name&&L.add(T.name)}),i&&this.geographicLookup.has(a)){let T=this.geographicLookup.get(a)?.name;T&&L.add(T)}if(this.entityTypeNames.has(a))_=`MATCH (n:${a}) ${p?"WHERE id(n) IN $ids ":""}return ID(n)`,L.forEach(T=>{_+=`, n.${T}`,C.push(T)});else{if(!this.relationshipTypeNames.has(a))throw new G("knowledge-graph:layer-data-manager",`The graph type of ${a} could not be determined. Was this type set in the KG data model and inclusion definition?`);F=!0,_=`MATCH ()-[n:${a}]->() ${p?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,L.forEach(T=>{_+=`, n.${T}`,C.push(T)})}N=new B(p?{openCypherQuery:_,bindParameters:{ids:p}}:{openCypherQuery:_});let I=(yield Y(this.knowledgeGraph,N,{signal:o?.signal})).resultRowsStream.getReader();for(;;){let{done:T,value:M}=yield I.read();if(T)break;let D=[];for(let k=0;k<M.length;k++){let O=M[k],v=0,Q=0,R={properties:{}};for(R.id=O[v],v++,Q++,F&&(R.originId=O[v],v++,Q++,R.destinationId=O[v],v++,Q++,j(this.nodeConnectionsLookup,R.originId,()=>new Set).add(R.id),j(this.nodeConnectionsLookup,R.destinationId,()=>new Set).add(R.id),j(this.relationshipConnectionsLookup,R.id,()=>[R.originId,R.destinationId]));v<O.length;v++)R.properties[C[v-Q]]=O[v];c.delete(R.id),D.push(R)}let U=n.writeToStore(D,x,this.geographicLookup.get(a)?.name);this.sublayerCaches.has(a)||this.sublayerCaches.set(a,new Map),r&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(a)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(a,{useAllData:!1,members:new Map}),r&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(a).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(a).members=new Map);let z=this.sublayerCaches.get(a);U.forEach(k=>{z?.set(k.attributes[x],k),r&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(a).members.has(k.attributes[x])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(a).members.set(k.attributes[x],{id:k.attributes[x]}),j(this.memberIdTypeLookup,k.attributes[x],()=>new Set).add(a))})}let g=this.inclusionModeDefinition?.namedTypeDefinitions.get(a);if(g)for(let T of c)g.members?.delete(T)}).then(()=>{u(null)}).catch(L=>{L.name==="AbortError"?u(null):h(L)})});l.push(d),this._processingCacheUpdatesLookup.get(a)?.push(d)}if(yield Promise.all(l),o?.signal?.aborted)throw ot()})}removeFromLayer(e){let t=new Set,i=new Set(e.map(r=>r.id));for(let r of e)t.add(r.typeName),this.memberIdTypeLookup.get(r.id)?.size===1?this.memberIdTypeLookup.delete(r.id):this.memberIdTypeLookup.get(r.id)?.delete(r.typeName),this.inclusionModeDefinition?.namedTypeDefinitions.forEach((o,n)=>{n===r.typeName&&o.members?.has(r.id)&&o.members.delete(r.id)});t.forEach(r=>{this.sublayerCaches.get(r)?.forEach((o,n)=>{i.has(n)&&this.sublayerCaches.get(r)?.delete(n)})})}retrieveDataFromService(e,t,i){return S(this,null,function*(){let r=oe.getInstance(),o=new Set,n=[],l,s="",y=[],a=t.graphType==="relationship",p=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,c=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name),d=!p&&c?Array.from(c).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&e.objectIds!=null&&(d=e.objectIds);else if(e.objectIds!=null&&d&&d.length>0){let h=e.objectIds;e.objectIds=d.filter(b=>h.includes(b))}else if(e.objectIds!=null)d=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=d}if(e.outFields!=null){let h=e.outFields;h.includes("*")?t.fields.forEach(b=>{o.add(b.name)}):h.forEach(b=>{b!==x&&b!==t.geometryFieldName&&o.add(b)})}if(e.geometry!=null){let h=e.geometry,b,L=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,C=L?.spatialReference,N=L?.serviceCapabilities?.geometryCapabilities,_=N?.geometryMaxBoundingRectangleSizeX,F=N?.geometryMaxBoundingRectangleSizeY;if(h.type==="point"){let I=h;I.spatialReference?.isWGS84||(yield he(I.spatialReference,H),I=de(I,H)),b=new le({spatialReference:H,xmin:I.x-1e-4,ymin:I.y-1e-4,xmax:I.x+1e-4,ymax:I.y+1e-4})}else h?.extent?.spatialReference&&!h.spatialReference?.isWGS84?(yield he(h.extent.spatialReference,H),b=de(h.extent,H)):b=h.extent;if(_&&F&&C){if(C.wkid!==4326){let I=new le({spatialReference:C,xmax:_,ymax:F}),g=de(I,H);_=g.xmax,F=g.ymax}if(b.xmax-b.xmin>_)throw new G("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${_}\xB0 latitude, limit exceeded`);if(b.ymax-b.ymin>F)throw new G("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${F}\xB0 longitude, limit exceeded`)}if(e.where!=null&&e.where!=="1=1"){let I=yield Oe(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach(g=>{I.fieldNames.includes(g.name)&&o.add(g.name)})}s=a?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&o.add(t.geometryFieldName),o.forEach(I=>{s+=`, n.${I}`,n.push(I)}),l=new B({openCypherQuery:s,bindParameters:{param_filter_geom:new me({rings:hr(b)})}})}else{let h="";if(e.where!=null&&e.where!=="1=1"){let C=yield Oe(e.where,t.fieldsIndex);t.fields.forEach(g=>{C.fieldNames.includes(g.name)&&o.add(g.name)});let N=new Set(["column-reference","string","number","binary-expression"]),_=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]),F=!1,I=g=>{if(g.type==="column-reference")return`n.${g.column}`;if(g.type==="string")return`'${g.value}'`;if(g.type==="number")return`${g.value}`;if(g.type==="binary-expression"&&N.has(g.left.type)&&N.has(g.right.type)&&_.has(g.operator))return`${I(g.left)} ${g.operator} ${I(g.right)}`;if(g.type==="binary-expression"&&g.operator==="LIKE"){let T="";if(g.left.type==="function"&&g.left.args.value[0].type==="column-reference")T+=`lower(n.${g.left.args.value[0].column})`;else{if(g.left.type!=="column-reference")return F=!0,"";T+=`lower(n.${g.left.column})`}if(T+=" CONTAINS (",g.right.type!=="string")return F=!0,"";{let M=g.right.value;M.charAt(0)==="%"&&(M=M.slice(1)),M.charAt(M.length-1)==="%"&&(M=M.slice(0,-1)),T+=`'${M.toLowerCase()}')`}return T}return F=!0,""};h=I(C.parseTree),F&&(h="")}let b="";b=a?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let L=!1;d&&(L=!0,b+=" WHERE ID(n) IN $ids"),h&&(b+=L?" AND":" WHERE",b+=` ${h}`),b+=" return ID(n)",a&&(b+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&o.add(t.geometryFieldName),o.forEach(C=>{b+=`, n.${C}`,n.push(C)}),l=new B(d?{openCypherQuery:b,bindParameters:{ids:d}}:{openCypherQuery:b})}let u=(yield Y(t.parentCompositeLayer.dataManager.knowledgeGraph,l,i)).resultRowsStream.getReader();for(;;){let{done:h,value:b}=yield u.read();if(h)break;let L=[];for(let C=0;C<b.length;C++){let N=b[C],_=0,F=0,I={properties:{}};for(I.id=N[_],_++,F++,a&&(I.originId=N[_],_++,F++,I.destinationId=N[_],_++,F++);_<N.length;_++)I.properties[n[_-F]]=N[_];L.push(I)}y=y.concat(r.writeToStore(L,x,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return y})}_isEndEntitySpatial(e,t,i){for(let r of e??[])if(this.entityTypeNames.has(r)){let o=this.geographicLookup.get(r),n=o&&this.sublayerCaches.get(r)?.get(t.attributes[i]);if(o&&n?.attributes[o.name])return!0}return!1}_getNamedTypeIdMapFromNodeIds(e){let t=new Map;return e.forEach(i=>{if(this.memberIdTypeLookup.has(i))for(let r of this.memberIdTypeLookup.get(i)){if(!this.entityTypeNames.has(r))return;t.has(r)?t.get(r)?.push(i):t.set(r,[i])}}),t}};m([f()],$.prototype,"knowledgeGraph",void 0),m([f()],$.prototype,"inclusionModeDefinition",void 0),m([f()],$.prototype,"entityTypeNames",void 0),m([f()],$.prototype,"relationshipTypeNames",void 0),m([f()],$.prototype,"geographicLookup",void 0),m([f()],$.prototype,"sublayerCaches",void 0),m([f()],$.prototype,"nodeConnectionsLookup",void 0),m([f()],$.prototype,"relationshipConnectionsLookup",void 0),m([f()],$.prototype,"memberIdTypeLookup",void 0),$=m([se("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],$);var jr={initializeLayersFromClientData:(e,t,i)=>S(void 0,null,function*(){if(t||(t=[...e.layers,...e.tables].map(n=>n.graphTypeName)),t?.length===0)return;let r=new Map;for(let n of t)r.set(n,gr(e,n));let o=yield Ut(e.dataManager.knowledgeGraph,Array.from(r.values()),{requestOptions:{signal:i?.signal}});for(let n of[...e.layers,...e.tables]){let l=n.objectType.name;if(l==null)continue;let s=o.get(gr(e,l));if(s){let y=JSON.parse(s);y===null||typeof y!="object"||y.hasOwnProperty("showLabels")||(y.showLabels=!1),n.read(y,{origin:"service"})}}})},gr=(e,t)=>e.type==="knowledge-graph"?`${t}/Map`:`${t}/LinkChart/LinkChartSubLayer`;function No(e,t,i){return S(this,null,function*(){return jr.initializeLayersFromClientData(e,t,i)})}var br=["#4a0932","#b31515","#18382e","#a64f1b","#102432","#8c213f","#ed9310","#2c6954","#144d59","#ffc730","#75351e","#454f4b","#78b1c2","#191921","#8f8f82","#9be0c0","#dbb658","#87b051","#11495c","#c43541","#9c5596","#44498b","#ad9d63","#86afb3","#5c98ca","#b0bfa2","#73241f","#b86b53","#d9d78c","#3e756d","#f260a1","#a0d17d","#c27c30","#eb82eb","#ffdf3c","#ffb259","#ab52b3","#3cccb4","#0095ba","#d92b30"],$r="#8f8f82";function Tr(e){return e<0||e>=br.length?new qe($r):new qe(br[e])}function wr(e){let t=e.toArray();return new je({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,style:"solid",width:.75,color:t},{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-10,ymin:-5,xmax:0,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-12,-3.47],[-12,3.6],[1.96,-.03],[-12,-3.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t}]}}]}]}}})}function Ir(e){let t="ESRI__ID",i=4;for(let r of e)if(r.name){if(r.name.toLowerCase()==="name"){t=r.name;break}r.name.toLowerCase().includes("name")?(t=r.name,i=2):r.fieldType==="esriFieldTypeString"&&i>3&&(t=r.name,i=3)}return t}function Er(e,t,i){let r={color:[80,80,80],haloColor:[255,255,255],haloSize:.7,font:{size:10,weight:"normal"}},o=new J({labelExpressionInfo:new ce({expression:i==="ESRI__ID"?`${t}`:`$feature.${i}`}),labelPlacement:"above-center",symbol:new Z(r)}),n=new J({labelExpressionInfo:new ce({expression:`'${t}' + IIf($feature.ESRI__AggregationCount>1, ' (' + $feature.ESRI__AggregationCount + ')', '')`}),labelPlacement:"center-along",labelPosition:"parallel",repeatLabel:!1,symbol:new Z(K(q({},r),{yoffset:"12px"}))});return e==="entity"?[o]:[n]}function _r(e,t,i){let r={color:[255,255,255],haloColor:[0,0,0],haloSize:.7,font:{size:10,weight:"bold"}},o=i==="ESRI__ID"?`${e}`:`$feature.${i}`;return t==="point"?[new J({labelExpressionInfo:new ce({expression:o}),labelPlacement:"above-center",symbol:new Z(r)})]:t==="polyline"?[new J({labelExpressionInfo:new ce({expression:o}),labelPlacement:"center-along",repeatLabel:!0,symbol:new Z(r)})]:t==="polygon"?[new J({labelExpressionInfo:new ce({expression:o}),labelPlacement:"always-horizontal",symbol:new Z(r)})]:null}var Nr=Gt(),Cr=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return m([f(Nr.fields)],t.prototype,"fields",void 0),m([f(Nr.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=m([se("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],t),t};function P(e){if(!e.json)return e;e.json.write=Lr(e.json.write);let t=e.json.origins;if(!t)return e;let i;for(i in t){let r=t[i];r&&(r.write=Lr(r.write))}return e}function Lr(e){return typeof e=="object"&&e?(e.enabled!==!1&&(e.overridePolicy=Ur(e)),e):e===!0?Ee():e}function Ur(e){let n=e,{target:t,writer:i,overridePolicy:r}=n,o=rt(n,["target","writer","overridePolicy"]);return function(l,s){let y=Mr.call(this,l,s);return y.enabled?q(q({},o),y):y}}function Ee(){return{overridePolicy:Mr}}function Mr(e,t){let i=!!this.geometryType,r={enabled:i};return i&&(r=q(q({},r),Sr.call(this,e,t))),r}function Sr(e,t){return{ignoreOrigin:this.originIdOf(t)>it.DEFAULTS}}var w=class extends Cr(Nt(vt(St(yt(At(Pt(Tt(It(dt(wt)))))))))){constructor(e){super(e),this.blendMode="normal",this.capabilities=$t(!1,!1),this.charts=null,this.definitionExpression=null,this.displayField="",this.displayFilterEnabled=!0,this.displayFilterInfo=null,this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=x,this.objectType=null,this.opacity=1,this.orderBy=null,this.parent=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then(()=>{let t=new MessageChannel;return new Qt(t.port1,{channel:t,client:{queryFeatures:(i,r={})=>{let o=V.fromJSON(i);return this.queryFeaturesJSON(o,r)}}}),[t.port2]})},this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){let t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){let e=[];return this.objectType?.properties?.forEach(t=>{let i=t.fieldType==="esriFieldTypeOID"?"esriFieldTypeInteger":t.fieldType;e.push(fe.fromJSON({name:t.name,type:i,alias:t.alias,defaultValue:t.defaultValue,editable:t.editable,nullable:t.nullable}))}),e.push(fe.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),fe.fromJSON({name:Me,type:"esriFieldTypeInteger",alias:Me,editable:!1}),fe.fromJSON({name:te,type:"esriFieldTypeInteger",alias:te,editable:!1})),e}get geometryType(){if(this.parentCompositeLayer?.type==="link-chart")return this.graphType==="relationship"?"polyline":"point";let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.geometryType;return t&&t!=="esriGeometryNull"?pe.fromJSON(t):null}get geometryFieldName(){return this.parentCompositeLayer?.type==="link-chart"?ge:this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name)?.name??null}get graphTypeName(){return this.objectType?.name}get hasM(){let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name;return(t?this.objectType?.properties?.[t]:null)?.hasM??!1}get hasZ(){let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name;return(t?this.objectType?.properties?.[t]:null)?.hasZ??!1}set labelingInfo(e){this._set("labelingInfo",e)}get labelingInfo(){if(this._isOverridden("labelingInfo"))return this._get("labelingInfo");let e=this.objectType.properties?Ir(this.objectType.properties):"ESRI__ID";return this.parentCompositeLayer.type==="link-chart"?Er(this.graphType,this.graphTypeName,e):_r(this.graphTypeName,this.geometryType,e)}set renderer(e){Bt(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){if(this._isOverridden("renderer"))return this._get("renderer");let e=this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel,t=[...e?.entityTypes??[],...e?.relationshipTypes??[]].map(o=>o.name).indexOf(this.graphTypeName),i=Tr(t);if(this.parentCompositeLayer?.type==="link-chart"){if(this.graphType==="relationship")return new Ft({type:"simple",symbol:wr(i)});let o=$e(Ue(pe.toJSON("point")).renderer);return ze(o.symbol,i),o}let r=$e(Ue(pe.toJSON(this.geometryType)).renderer);return ze(r.symbol,i),r}get spatialReference(){return this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel?.spatialReference??Ne.WGS84}set timeInfo(e){this._set("timeInfo",e)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(e){this._set("title",e)}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return jt(this,e)}createQuery(){return new V({where:"1=1",outFields:["*"]})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){return null}queryFeatures(e,t){return S(this,null,function*(){yield this.load();let{resolvedQuery:i,queryEngine:r}=yield this._setupQueryObjects(e),o=_t.fromJSON(yield r.executeQuery(i.toJSON(),t?.signal));return o.features.forEach(n=>{n.sourceLayer=this}),o})}queryFeaturesJSON(e,t){return S(this,null,function*(){yield this.load();let{resolvedQuery:i,queryEngine:r}=yield this._setupQueryObjects(e);return yield r.executeQuery(i.toJSON(),t?.signal)})}queryFeatureCount(e,t){return S(this,null,function*(){yield this.load();let{resolvedQuery:i,queryEngine:r}=yield this._setupQueryObjects(e);return r.executeQueryForCount(i.toJSON(),t?.signal)})}queryExtent(){return S(this,arguments,function*(e={},t){yield this.load();let i=K(q({},e),{returnGeometry:!0}),{resolvedQuery:r,queryEngine:o}=yield this._setupQueryObjects(i),n=yield o.executeQueryForExtent(r.toJSON(),t?.signal),l;return l=n.extent?.xmin!=null&&n.extent?.xmax!=null&&n.extent?.ymin!=null&&n.extent?.ymax!=null?new le(n.extent):new le,{count:n.count,extent:l}})}queryObjectIds(e,t){return S(this,null,function*(){yield this.load();let i=V.from(e),r;if(this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)r=this._cachedQueryEngine;else{let o=yield this.parentCompositeLayer.dataManager.getData(i,this,t);r=this.loadQueryEngine(o)}return yield r.executeQueryForIds(i.toJSON(),t?.signal)})}loadQueryEngine(e){let t=new zt({geometryType:pe.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),i=new Ht({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:pe.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:this.timeInfo?.toJSON(),featureStore:t});return i.featureStore.addMany(e),i}refreshCachedQueryEngine(){return S(this,null,function*(){let e=yield this.parentCompositeLayer.dataManager.getData(new V({where:"1=1",outFields:[x]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)})}load(e){return this.addResolvingPromise(this.parent.load(e).then(()=>Wt(this.timeInfo,this.fieldsIndex))),Promise.resolve(this)}_setupQueryObjects(e,t){return S(this,null,function*(){let i=V.from(e),r=i.geometry;if(r&&!r.spatialReference?.isWGS84&&(yield he(r.spatialReference,H),i.geometry=de(r instanceof me||r instanceof xe||r instanceof Ae?r:r.extent,H)),this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)return{resolvedQuery:i,queryEngine:this._cachedQueryEngine};let o=yield this.parentCompositeLayer.dataManager.getData(i,this,t);return{resolvedQuery:i,queryEngine:this.loadQueryEngine(o)}})}};m([f(P(A(ct)))],w.prototype,"blendMode",void 0),m([f()],w.prototype,"capabilities",void 0),m([f({json:{origins:{"web-scene":{write:!1}},write:Ee()}})],w.prototype,"charts",void 0),m([f({readOnly:!0})],w.prototype,"defaultPopupTemplate",null),m([f({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],w.prototype,"definitionExpression",void 0),m([f()],w.prototype,"displayField",void 0),m([f(P(A(Ct)))],w.prototype,"displayFilterEnabled",void 0),m([f(P(A(Lt)))],w.prototype,"displayFilterInfo",void 0),m([f(P(A(ut)))],w.prototype,"effect",void 0),m([f()],w.prototype,"elevationInfo",void 0),m([f(P(A(Mt)))],w.prototype,"featureEffect",void 0),m([f(P(A(Rt)))],w.prototype,"featureReduction",null),m([f()],w.prototype,"fields",null),m([f()],w.prototype,"geometryType",null),m([f()],w.prototype,"geometryFieldName",null),m([f({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],w.prototype,"graphType",void 0),m([f({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],w.prototype,"graphTypeName",null),m([f()],w.prototype,"hasM",null),m([f()],w.prototype,"hasZ",null),m([f({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],w.prototype,"id",void 0),m([f({type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",default:!1,write:{overridePolicy(){return{enabled:!!this.geometryType,alwaysWriteDefaults:!0,ignoreOrigin:!0}}}}})],w.prototype,"labelsVisible",void 0),m([f({type:[J],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:zr,write:Ee()}})],w.prototype,"labelingInfo",null),m([f({readOnly:!0,json:{read:!1,write:{writer(e,t){switch(this.parentCompositeLayer?.type){case"link-chart":t.layerType="LinkChartSubLayer";break;case"knowledge-graph":t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],w.prototype,"layerType",void 0),m([f(P(A(ft)))],w.prototype,"legendEnabled",void 0),m([f(P(A(bt)))],w.prototype,"maxScale",void 0),m([f(P(A(gt)))],w.prototype,"minScale",void 0),m([f()],w.prototype,"objectIdField",void 0),m([f()],w.prototype,"objectType",void 0),m([f(P(A(ht)))],w.prototype,"opacity",void 0),m([f(P(A(kt)))],w.prototype,"orderBy",void 0),m([f({clonable:!1})],w.prototype,"parent",void 0),m([f()],w.prototype,"parentCompositeLayer",void 0),m([f(P(A(mt)))],w.prototype,"popupEnabled",void 0),m([f({type:Et,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],w.prototype,"popupTemplate",void 0),m([f({type:Number,json:{write:{overridePolicy:Sr}}})],w.prototype,"refreshInterval",void 0),m([f({types:Dt,json:{name:"layerDefinition.drawingInfo.renderer",write:Ee()}})],w.prototype,"renderer",null),m([f()],w.prototype,"source",void 0),m([f()],w.prototype,"spatialReference",null),m([f({type:xt,json:{name:"layerDefinition.timeInfo",write:!0,origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:!0},"portal-item":{name:"layerDefinition.timeInfo",read:!0,write:!0}}}})],w.prototype,"timeInfo",null),m([f({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],w.prototype,"title",null),m([at("title")],w.prototype,"writeTitle",null),m([f({json:{read:!1}})],w.prototype,"type",void 0),m([f(P(A(Ot)))],w.prototype,"useViewTime",void 0),m([f({type:Boolean,json:{name:"visibility",write:Ee()}})],w.prototype,"visible",void 0),w=m([se("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],w);var vn=w;function zr(e,t,i){let r=[["ESRI__AGGREGATION_COUNT",Me],["ESRI__ORIGIN_ID",X],["ESRI__DESTINATION_ID",ee],["ESRI__LAYOUT_GEOMETRY",ge]];try{for(let o of e)for(let[n,l]of r)o.labelExpression=o.labelExpression?.replaceAll(n,l),o.labelExpressionInfo?.expression&&(o.labelExpressionInfo.expression=o.labelExpressionInfo.expression.replaceAll(n,l))}catch(o){_e.getLogger(this).warn("Error updating labelingInfo",o)}return qt(e,t,i)}export{si as a,li as b,pi as c,oe as d,bi as e,er as f,W as g,tr as h,ar as i,sr as j,lr as k,pr as l,dr as m,cr as n,ur as o,zi as p,Hi as q,$ as r,No as s,vn as t};
