import{a as b,c as oe,d as se,e as ne,f as S}from"./chunk-UAKHZRKN.js";import{a as Y,b as Z,c as ee,d as C,e as te}from"./chunk-HAHX77IL.js";import{b as q}from"./chunk-ZTJLFKGG.js";import{a as L,b as K,i as Q}from"./chunk-LB5YQINJ.js";import{a as W}from"./chunk-VACZNAP3.js";import{a as X}from"./chunk-SLAWDKDA.js";import{a as J}from"./chunk-KTE5HCNJ.js";import{c as G}from"./chunk-7R33MKVL.js";import{a as M}from"./chunk-ISSJ3A6Y.js";import{a as ie}from"./chunk-VDKRSX77.js";import{t as V}from"./chunk-U4J5SECU.js";import{G as U,d as m}from"./chunk-C7INQGWT.js";import{H}from"./chunk-WMHJC7XF.js";import{i as B}from"./chunk-FNXQZPHT.js";import{M as z,i as A,q as $,r as D,y as j}from"./chunk-D2LVMNOU.js";import{a as h}from"./chunk-QGVBCWUY.js";import{b as O,r as N}from"./chunk-HHDFN2GK.js";import{H as re}from"./chunk-5RWLLGQU.js";import{a as y,f as E}from"./chunk-VTHXE323.js";var T=!1,ae=e=>{T=!0,re(e)};var de;function le(){T||ae(V(ie(de)))}function $e(e){let t=[];for(let r of Object.keys(e))customElements.get(`calcite-${r}`)||t.push(e[r]?.());return t.length>0?Promise.all(t):null}de="components/assets";function ce(e){return typeof e=="string"?document.getElementById(e):e??null}function ze(e,t){for(;;){let r=e.firstChild;if(!r)break;t.appendChild(r)}}var pe={handleInterceptedEvent:(e,t,r,o)=>(e.scheduleRender(),t.properties[`on${o.type}`].apply(t.properties.bind||r,[o]))};var be={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{t.charAt(0)==="-"?e.style.setProperty(t,r):e.style[t]=r}},he=e=>y(y({},be),e);var we=(e,t)=>{let r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r},Re=(e,t)=>e.find(t),me=(e,t,r=!1)=>{let o=e;return t.forEach((c,i)=>{let p=o?.children?Re(o.children,n=>n.domNode===c):void 0;r&&!p&&i!==t.length-1||(o=p)}),o},ue=e=>{let t,r=y(y({},pe),e),o=he(r),c=o.performanceLogger,i,p=!0,n=!1,s=[],u=[],f=(l,a,w)=>{let v;o.eventHandlerInterceptor=(Ne,Ae,je,Le)=>function(_){let R;c("domEvent",_);let I=we(_.currentTarget,v.domNode),_e=I.some(P=>customElements.get(P?.tagName?.toLowerCase()));if(_.eventPhase===Event.CAPTURING_PHASE||!_e)I.reverse(),R=me(v.getLastRender(),I);else{let P=_.composedPath(),Pe=P.slice(P.indexOf(_.currentTarget),P.indexOf(v.domNode)).reverse();R=me(v.getLastRender(),Pe,!0)}let x;return R&&(x=r.handleInterceptedEvent(t,R,this,_)),c("domEventProcessed",_),x},r.postProcessProjectionOptions?.(o);let k=w();v=l(a,k,o),o.eventHandlerInterceptor=void 0,s.push(v),u.push(w),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(v,k)},g=()=>{if(i=void 0,p){p=!1,c("renderStart",void 0);for(let l=0;l<s.length;l++){let a=u[l]();c("rendered",void 0);try{s[l].update(a)}catch(w){console.error(w)}c("patched",void 0)}c("renderDone",void 0),p=!0}};return r.modifyDoRenderImplementation&&(g=r.modifyDoRenderImplementation(g,s,u)),t={renderNow:g,scheduleRender:()=>{i||n||(i=requestAnimationFrame(g))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),n=!0},resume:()=>{n=!1,p=!0,t.scheduleRender()},append:(l,a)=>{f(b.append,l,a)},insertBefore:(l,a)=>{f(b.insertBefore,l,a)},merge:(l,a)=>{f(b.merge,l,a)},replace:(l,a)=>{f(b.replace,l,a)},detach:l=>{for(let a=0;a<u.length;a++)if(u[a]===l)return u.splice(a,1),s.splice(a,1)[0];throw new Error("renderFunction was not found")}},t};var fe=new Set;function ge(e){fe.add(e),e.finally(()=>fe.delete(e))}var ye,Ee="esri.widgets.Widget",Ce=0;function ve(e,t){let r=Object.prototype.hasOwnProperty;for(let o in t)r.call(t,o)&&r.call(e,o)&&(e[o]!=null&&t[o]!=null&&typeof e[o]=="object"&&typeof t[o]=="object"?ve(e[o],t[o]):e[o]=t[o]);return e}var Ie=ue({postProcessProjectionOptions(e){let t=e.eventHandlerInterceptor,r=/capture$/i;e.eventHandlerInterceptor=(o,c,i,p)=>{let n=t?.(o,c,i,p),s=r.test(o);if(!((o=o.replace(r,"")).toLowerCase()in i)||s){let u=o[2].toLowerCase()+o.slice(3),f=a=>n?.call(i,a);i.addEventListener(u,f,s);let g=()=>i.removeEventListener(u,f,s),l=p.afterRemoved;p.afterRemoved=a=>{l?.(a),g()}}return n}},handleInterceptedEvent(e,t,r,o){let{eventPhase:c,type:i}=o,p=c===Event.CAPTURING_PHASE,n=`on${i}${p?"capture":""}`,s=t.properties;(s&&n in s||(n=`on${i[0].toUpperCase()}${i.slice(1)}${p?"Capture":""}`,s&&n in s))&&(Y(),e.scheduleRender(),s[n].call(s.bind||r,o))}}),F=!1,d=class extends J.EsriPromiseMixin(W.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._projector=Ie,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=z(()=>E(this,null,function*(){if(this._messageBundleProps?.length){let n=yield Promise.allSettled(this._messageBundleProps.map(f=>E(this,[f],function*({bundlePath:s,propertyName:u}){if(this.destroyed)return;let g=yield q(s);this.uiStrings&&Object.keys(this.uiStrings)&&(g=ve(O(g),this.uiStrings)),this[u]=g})));if(this.destroyed)return;for(let s of n)s.status==="rejected"&&N.getLogger(this).error("widget-intl:locale-error",this.declaredClass,s.reason)}yield this.loadLocale()})),le();let r="esri-widget-uid-"+X(),o=this.render.bind(this);this._trackingTarget=new U(()=>{this.autoRenderingEnabled&&this.scheduleRender()});let c=()=>({vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),i=()=>{if(!this._readyForTrueRender||this.destroyed)return null;let n=o()??c(),s=n.properties??={};if(s.key??=r,S(n.vnodeSelector)){if(!this.visible)return c()}else this.visible?s.styles||(s.styles={}):(s.class="",s.styles={display:"none"}),s.styles.display??="";let u=0;return n.children?.forEach(f=>{S(f.vnodeSelector)||(f.properties??={},f.properties.key??=`${this.id}--${u++}`)}),ne(this,n)};this.render=()=>{if(F)return i();let n=Z(this)??null;if(n)return n;this._trackingTarget.clear(),F=!0;try{n=B(this._trackingTarget,i)}catch(s){throw N.getLogger(this).error(s),s}finally{F=!1}return n&&ee(this,n),n};let p=this.beforeFirstRender();p?this._resourcesFetch=p.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),ge(this._resourcesFetch)}normalizeCtorArgs(e,t){let r=y({},e);return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){let e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(j):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(A(this._trackingTarget),A(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,C(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return ce(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+Ce++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(ye=oe,se)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(C(this),this._projector.scheduleRender())}classes(...e){return te.apply(this,e)}renderNow(){C(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles(L(()=>this.viewModel,(t,r)=>{r&&this.removeHandles("delegated-events"),t&&$(t)&&this.addHandles(this._delegatedEventNames.map(o=>D(t,o,c=>{this.emit(o,c)})),"delegated-events")},Q)),this.postInitialize();let e=()=>E(this,null,function*(){yield this._loadLocale().catch(j),this.scheduleRender()});this.addHandles([G(e),L(()=>this.uiStrings,e),K(()=>this.container,t=>{this.destroyed||this._attach(t)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};d[ye]=!0,d.vnodeSelector="div",h([m()],d.prototype,"_readyForTrueRender",void 0),h([m({value:null})],d.prototype,"container",null),h([M("container")],d.prototype,"castContainer",null),h([m()],d.prototype,"icon",null),h([m()],d.prototype,"id",null),h([m()],d.prototype,"label",null),h([m()],d.prototype,"renderable",null),h([m()],d.prototype,"uiStrings",void 0),h([m()],d.prototype,"viewModel",void 0),h([m({value:!0})],d.prototype,"visible",null),h([m()],d.prototype,"key",void 0),h([m()],d.prototype,"children",void 0),h([m()],d.prototype,"afterCreate",void 0),h([m()],d.prototype,"afterUpdate",void 0),h([m()],d.prototype,"afterRemoved",void 0),d=h([H(Ee)],d);var It=d;function Lt(e){return(t,r)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:r})}}export{ce as a,ze as b,$e as c,It as d,Lt as e};
