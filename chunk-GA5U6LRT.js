import{b as te}from"./chunk-NWZSGM66.js";import{a as D}from"./chunk-RGMFEUPT.js";import{a as Y,b as I,l as O}from"./chunk-HWQBVARH.js";import{C as Z,P as $,a as _,la as X,m as W,pa as ee,s as w}from"./chunk-UNRRVLTB.js";import{a as B,b as F}from"./chunk-6DVIB4O4.js";import{Pa as K,W as k,a as G,b as E,o as T,tb as N,y as H,ya as J}from"./chunk-JLMESEWM.js";var U=class{getOperatorType(){return 10203}accelerateGeometry(e,s,o){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}executeMany(e,s){return new L(e,s)}execute(e,s){return new L(null,s).labelPoint(e)}},L=class extends B{progress_(){}tock(){return!0}getRank(){return 1}constructor(e,s){super(),this.m_index=-1,this.m_progressCounter=0,this.m_progressTracker=s,this.m_inputGeoms=e}next(){let e=this.m_inputGeoms.next();return e?(H(e),this.m_index=this.m_inputGeoms.getGeometryID(),this.labelPoint(e)):null}getGeometryID(){return this.m_index}labelPoint(e){if(e===null&&T("null pointer is not allowed"),e.getGeometryType()===E.enumPoint)return e;if(e.isEmpty())return new w({vd:e.getDescription()});switch(e.getGeometryType()){case E.enumPolygon:return this.labelPointPolygon(e);case E.enumPolyline:return this.labelPointPolyline(e);case E.enumMultiPoint:return this.labelPointMultiPoint(e);case E.enumEnvelope:return this.labelPointEnvelope(e);default:T("geometry is not supported")}}labelPointPolygon(e){let s=new _;e.queryEnvelope(s);let o=W(null,s,!0).total(),u=null,r=e;if(e.hasNonLinearSegments()){let t=new Z({copy:e}),m=ee(t,.25*o,o);G(m!==e),u=m,r=u}let l=0,P=0;for(let t=0,m=r.getPathCount();t<m;++t){let M=Math.abs(r.calculateRingArea2D(t));M>P&&(P=M,l=t)}let a=new N;if(Math.abs(P)<=2*o*o?a.setNAN():a.assign(te(r,l)),Number.isNaN(a.x)){let t=new _;return r.queryPathEnvelope(l,t),new w({pt:t.getCenter()})}if(r.getPointCount()<4)return new w({x:a.x,y:a.y});let h=N.getNAN(),n=[h.clone(),h.clone(),h.clone(),h.clone()],p=[Number.NaN,Number.NaN,Number.NaN,Number.NaN],g=[Number.NaN,Number.NaN,Number.NaN,Number.NaN],v=!1,f=new D().getNearestCoordinate(r,a,!0,!1);if(f.m_distance===0&&(v=!0,n[0]=a,f=new D().getNearestCoordinate(r,a,!1,!1),f.m_distance>.25*s.minDimension()*1.66666666))return new w({x:a.x,y:a.y});p[0]=f.m_distance,g[0]=0;let d=new N,c=!1,i=.25,y=-1,C=new _;r.queryPathEnvelope(l,C);do{let t=Number.NaN;if(n[1]=this.calculateParacentroid_(r,k(C.xmin,C.xmax,i),o),n[1].isNAN()||(f=new D().getNearestCoordinate(r,n[1],!1,!1),t=f.m_distance),t>o&&X(r,n[1],o)===1)c=!0,p[1]=t,g[1]=N.sqrDistance(n[1],a);else if(t>y&&(y=t,d.setCoordsPoint2D(n[1])),i-=.01,i<.1){if(!(y>=0))break;c=!0,p[1]=y,n[1]=d,g[1]=N.sqrDistance(n[1],a)}}while(!c);c=!1,i=.5,y=-1;let j=.01,R=1;do{let t=Number.NaN;if(n[2]=this.calculateParacentroid_(r,k(C.xmin,C.xmax,i),o),n[2].isNAN()||(f=new D().getNearestCoordinate(r,n[2],!1,!1),t=f.m_distance),t>o&&X(r,n[2],o)===1)c=!0,p[2]=t,g[2]=N.sqrDistance(n[2],a);else if(t>y&&(y=t,d.setCoordsPoint2D(n[2])),i=.5+j*R,j+=.01,R*=-1,i<.3||i>.7){if(!(y>=0))break;c=!0,p[2]=y,n[2]=d,g[2]=N.sqrDistance(n[2],a)}}while(!c);c=!1,i=.75,y=-1;do{let t=Number.NaN;if(n[3]=this.calculateParacentroid_(r,k(C.xmin,C.xmax,i),o),n[3].isNAN()||(f=new D().getNearestCoordinate(r,n[3],!1,!1),t=f.m_distance),t>o&&X(r,n[3],o)===1)c=!0,p[3]=t,g[3]=N.sqrDistance(n[3],a);else if(t>y&&(y=t,d.setCoordsPoint2D(n[3])),i+=.01,i>.9){if(!(y>=0))break;c=!0,p[3]=y,n[3]=d,g[3]=N.sqrDistance(n[3],a)}}while(!c);let b=[0,1,2,3],q=v?0:1;for(let t=q;t<4;t++)for(let m=q;m<3;m++){let M=g[m],Q=g[m+1];if(K(M,Q)>0){let se=b[m];b[m]=b[m+1],b[m+1]=se,g[m]=Q,g[m+1]=M}}let S=q,z=0,A=0;for(let t=q;t<4;t++){switch(t){case 0:A=2*p[b[t]];break;case 1:A=1.66666666*p[b[t]];break;case 2:A=1.33333333*p[b[t]];break;case 3:A=p[b[t]]}A>z&&(z=A,S=b[t])}return G(!n[S].isNAN()),new w({x:n[S].x,y:n[S].y})}labelPointPolyline(e){let s=new N;if(e.getPointCount()>2*e.getPathCount()){let o=-1,u=-Number.MAX_VALUE;for(let a=0,h=e.getPathCount();a<h;a++)if(e.getPathSize(a)>2){let n=e.calculatePathLength2D(a);n>u&&(u=n,o=a)}let r=e.getPathStart(o),l=e.getPathEnd(o),P=Math.trunc((r+l)/2);s.assign(e.getXY(P))}else{let o=-Number.MAX_VALUE,u=e.querySegmentIterator();for(;u.nextPath();)if(u.hasNextSegment()){let r=u.nextSegment(),l=r.calculateLength2D();l>o&&(o=l,s.assign(r.getCoord2D(r.lengthToT(.5*l))))}}return new w({x:s.x,y:s.y})}labelPointMultiPoint(e){let s=new _;e.queryEnvelope(s);let o=s.getCenter(),u=new D().getNearestCoordinate(e,o,!1,!1).m_coordinate;return new w({x:u.x,y:u.y})}labelPointEnvelope(e){let s=e.getCenterXY();return new w({x:s.x,y:s.y})}calculateParacentroid_(e,s,o){let u=new _;e.queryEnvelope(u);let r=new N(s,0),l=Number.MAX_VALUE,P=Number.MAX_VALUE,a=!1,h=!1,n=new $;n.setStartXYCoords(r.x,u.ymin-1),n.setEndXYCoords(r.x,u.ymax+1);let p=new _,g=new N,v=new N,f=J(N,2),d=e.querySegmentIterator();for(;d.nextPath();)for(;d.hasNextSegment();){let c=d.nextSegment();if(c.queryEnvelope(p),G(c.isMonotoneQuickAndDirty()),g.setCoordsPoint2D(n.getStartXY()),v.setCoordsPoint2D(n.getEndXY()),p.clipLine(g,v)===0||n.intersect(c,f,null,null,o)!==1)continue;let i=f[0].y;l>P?i<l&&(l=i,a=!0):i<P&&(P=i,h=!0)}return a&&h?r.y=(l+P)/2:r.setNAN(),r}},V=new U;function ne(x){return V.execute(x,null)}function re(x){let e=V.executeMany(new F(x),null);return Array.from(e)}function oe(){return V.supportsCurves()}function ae(x){return O(ne(I(x)),Y(x))}function ie(x){let e=x.map(I),s=Y(x);return re(e).map(o=>O(o,s))}var ue=oe(),be=Object.freeze(Object.defineProperty({__proto__:null,execute:ae,executeMany:ie,supportsCurves:ue},Symbol.toStringTag,{value:"Module"}));export{ae as a,ie as b,ue as c,be as d};
