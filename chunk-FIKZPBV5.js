import{a as $}from"./chunk-6AEGO2CB.js";import{a as V}from"./chunk-2U6QECGD.js";import{c as G}from"./chunk-4RDCETCH.js";import{A as W,B as K,C as Q,D as I,J as D,ga as U,p as J,r as T,v as M,y as C}from"./chunk-MARRSUOJ.js";import"./chunk-IB6IQS7A.js";import"./chunk-LVYFLVM5.js";import{a as _}from"./chunk-J74DFTDJ.js";import{a as O,b as X,c as Y,d as Z}from"./chunk-WPDA2XSD.js";import{a as c,b as f}from"./chunk-LWVUOW7N.js";import{a as rr,b as tr}from"./chunk-L755QJ73.js";import"./chunk-OCNYIIP3.js";import"./chunk-F6A6XWW4.js";import"./chunk-AESEF3B2.js";import"./chunk-3BDL2KTL.js";import"./chunk-LNVVFNTC.js";import"./chunk-WNSGKHQ6.js";import"./chunk-R6GE4XRP.js";import{a as L}from"./chunk-HVKMTRIC.js";import{c as P}from"./chunk-AZS4Q4RE.js";import"./chunk-QEBUS3TL.js";import{c as z,g as B,h as H}from"./chunk-IB2IUO7T.js";import"./chunk-MS3KE2OO.js";import"./chunk-NHSDW26F.js";import"./chunk-NMAGYK3Q.js";import"./chunk-GWBRHLNH.js";import"./chunk-X5AA4JDN.js";import{a as b,d as m,f as S,h as F}from"./chunk-J372WZPB.js";import"./chunk-6XFS4U2F.js";import"./chunk-XPRVY6JT.js";import"./chunk-7N3ZKWML.js";import"./chunk-E62WHYYG.js";import"./chunk-QDTU3MWT.js";import"./chunk-BCREO4Q5.js";import"./chunk-3SDSCSDJ.js";import"./chunk-I4M2OT5W.js";import{a as v,j as N,k as E}from"./chunk-NTVLK3P2.js";import{a as x}from"./chunk-WMQNRNIU.js";import"./chunk-HD52PWPC.js";import"./chunk-EIPVFA6F.js";import"./chunk-VOFKUGRY.js";import"./chunk-IG66NQHW.js";import"./chunk-ARRCN5K3.js";import"./chunk-KTE5HCNJ.js";import"./chunk-F7VRLFCB.js";import"./chunk-7IPIJKWU.js";import"./chunk-7R33MKVL.js";import"./chunk-ISSJ3A6Y.js";import"./chunk-VDKRSX77.js";import"./chunk-WUA6PW3I.js";import"./chunk-E57FTRWF.js";import"./chunk-U4J5SECU.js";import"./chunk-7EG726PT.js";import"./chunk-C7INQGWT.js";import"./chunk-WMHJC7XF.js";import"./chunk-NJEWDTYF.js";import"./chunk-N3SDOFND.js";import"./chunk-OVHPPCBL.js";import"./chunk-FNXQZPHT.js";import"./chunk-3TQOUBNU.js";import"./chunk-D2LVMNOU.js";import"./chunk-SNFOAZZQ.js";import"./chunk-QGVBCWUY.js";import{k as A}from"./chunk-HHDFN2GK.js";import"./chunk-47GHT6OF.js";import{f as y}from"./chunk-VTHXE323.js";var u=null;function ar(r){return y(this,null,function*(){let t=A.geometryServiceUrl??"";if(!t){z()||(yield B());for(let n of r)n.container[n.indexer]=H(n.container[n.indexer],x.WGS84);return}let e=r.map(n=>n.container[n.indexer]),a=new rr({geometries:e,outSpatialReference:x.WGS84}),i=yield tr(t,a);for(let n=0;n<i.length;n++){let o=r[n];o.container[o.indexer]=i[n]}})}function nr(r,t){return y(this,null,function*(){let e=new L({portal:r,id:t});return yield e.load(),u===null&&(u=yield import("./chunk-JTWN4733.js")),yield u.fetchKnowledgeGraph(e.url)})}function k(r,t,e,a,i){if(r===null)return null;if(m(r)||b(r))return r;if(W(r)||W(r))return r.toJSDate();if(K(r))return r.toStorageFormat();if(Q(r))return r.toStorageString();if(M(r)){let n={};for(let o of r.keys())n[o]=k(r.field(o),t,e,a,i),n[o]instanceof v&&i.push({container:n,indexer:o});return n}if(S(r)){let n=r.map(o=>k(o,t,e,a,i));for(let o=0;o<n.length;o++)n[o]instanceof v&&i.push({container:n,indexer:o});return n}return T(r)?r.spatialReference.isWGS84?r:r.spatialReference.isWebMercator&&t?E(r):r:void 0}function ir(r,t){if(!r)return r;if(r.spatialReference.isWGS84&&t.spatialReference.isWebMercator)return N(r);if(r.spatialReference.equals(t.spatialReference))return r;throw new f(t,c.WrongSpatialReference,null)}function j(r,t){if(!r)return null;let e={};for(let a in r)e[a]=d(r[a],t);return e}function d(r,t){return r===null?null:S(r)?r.map(e=>d(e,t)):r instanceof O?{graphTypeName:r.typeName,id:r.id,graphType:"entity",properties:j(r.properties,t)}:r instanceof Y?{graphType:"object",properties:j(r.properties,t)}:r instanceof X?{graphTypeName:r.typeName,id:r.id,graphType:"relationship",originId:r.originId??null,destinationId:r.destinationId??null,properties:j(r.properties,t)}:r instanceof Z?{graphType:"path",path:r.path?r.path.map(e=>d(e,t)):null}:T(r)?ir(r,t):m(r)||b(r)||F(r)?r:null}function Dr(r){r.mode==="async"&&(r.functions.knowledgegraphbyportalitem=function(t,e){return r.standardFunctionAsync(t,e,(a,i,n)=>{if(I(n,2,2,t,e),n[0]===null)throw new f(t,c.PortalRequired,e);if(n[0]instanceof V){let h=D(n[1]),l;return l=t.services?.portal?t.services.portal:P.getDefault(),nr($(n[0],l),h)}if(m(n[0])===!1)throw new f(t,c.InvalidParameter,e);let o=D(n[0]);return nr(t.services?.portal??P.getDefault(),o)})},r.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),r.functions.querygraph=function(t,e){return r.standardFunctionAsync(t,e,(a,i,n)=>y(this,null,function*(){I(n,2,4,t,e);let o=n[0];if(!C(o))throw new f(t,c.InvalidParameter,e);let h=n[1];if(!m(h))throw new f(t,c.InvalidParameter,e);u===null&&(u=yield import("./chunk-JTWN4733.js"));let l=null,g=J(n[2],null);if(!(g instanceof G||g===null))throw new f(t,c.InvalidParameter,e);if(g){let s=[];l=k(g,!0,!1,t,s),s=s.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),s.length>0&&(yield ar(s))}let q=new _({openCypherQuery:h,bindParameters:l});(o?.serviceDefinition?.currentVersion??11.3)>11.2&&(q.outputSpatialReference=t.spatialReference);let er=(yield u.executeQueryStreaming(o,q)).resultRowsStream.getReader(),R=[];try{for(;;){let{done:s,value:p}=yield er.read();if(s)break;if(S(p))for(let w of p)R.push(d(w,t));else{let w=[];for(let or of p)w.push(d(p[or],t));R.push(w)}}}catch(s){throw s}return G.convertJsonToArcade(R,U(t),!1,!0)}))},r.signatures.push({name:"querygraph",min:2,max:4}))}export{Dr as registerFunctions};
