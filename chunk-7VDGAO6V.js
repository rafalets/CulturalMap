import{a as Ae,c as Pt}from"./chunk-RW7NPOAD.js";import{B as wt,a as tt,m as bt,n as Tt,o as De,p as Ie,q as Ce,r as Ge,s as Be,v as ct,w as Zt,x as vt,y as qt}from"./chunk-BKA6DT3N.js";import{d as Le,e as Fe}from"./chunk-ET5YWLZA.js";import{a as k,b as Ut,d as Ht,e as ke,n as we,o as Ee,p as ze,w as Xt}from"./chunk-WQQ6B254.js";import{a as We,b as Ne,c as Ye}from"./chunk-X5QMXU27.js";import{a as Rt,c as Vt,k as xe}from"./chunk-R2FEHFRM.js";import{a as fe}from"./chunk-4E4FE2IX.js";import{a as ve}from"./chunk-4D3QHJI2.js";import{a as Pe,e as be,g as Te}from"./chunk-E2J2V7JN.js";import{G as P,L as K,M as Y,W as Se,X as Me,c as ye,d as ge,y as _e}from"./chunk-X7BNFUFQ.js";import{h as p}from"./chunk-HM5RIVQC.js";import{s as at}from"./chunk-QXXXCEV5.js";import{E as kt}from"./chunk-7Y6S2GNA.js";import{a as gt,b as _t,c as St,r as N,t as Mt,y as H}from"./chunk-63B3IOWG.js";import{a as de}from"./chunk-J5MXC6AL.js";import{a as x}from"./chunk-OLOKUDVI.js";import{a as me}from"./chunk-7N3ZKWML.js";import{b as Ot,f as he}from"./chunk-VOFKUGRY.js";import{r as yt,t as ue}from"./chunk-HHDFN2GK.js";import{a as pe}from"./chunk-47GHT6OF.js";import{a as g,b as S,e as W,f as E}from"./chunk-VTHXE323.js";function Re(e,t,r,i,s,o,n){jt=0;let a=(i-r)*o,c=s&&s.length,u=c?(s[0]-r)*o:a,l,f,d,h,m,y=Ve(t,r,i,0,u,o,!0);if(y&&y.next!==y.prev){if(c&&(y=Pr(t,r,i,s,y,o)),a>80*o){l=d=t[0+r*o],f=h=t[1+r*o];for(let _=o;_<u;_+=o){let v=t[_+r*o],w=t[_+1+r*o];l=Math.min(l,v),f=Math.min(f,w),d=Math.max(d,v),h=Math.max(h,w)}m=Math.max(d-l,h-f),m=m!==0?1/m:0}pt(y,e,o,l,f,m,n,0)}}function Ve(e,t,r,i,s,o,n){let a;if(n===Er(e,t,r,i,s,o)>0)for(let c=i;c<s;c+=o)a=Oe(c+t*o,e[c+t*o],e[c+1+t*o],a);else for(let c=s-o;c>=i;c-=o)a=Oe(c+t*o,e[c+t*o],e[c+1+t*o],a);return a&&X(a,a.next)&&(ut(a),a=a.next),a}function lt(e,t=e){if(!e)return e;let r,i=e;do if(r=!1,i.steiner||!X(i,i.next)&&b(i.prev,i,i.next)!==0)i=i.next;else{if(ut(i),i=t=i.prev,i===i.next)break;r=!0}while(r||i!==t);return t}function pt(e,t,r,i,s,o,n,a){if(!e)return;!a&&o&&(e=Ue(e,i,s,o));let c=e;for(;e.prev!==e.next;){let u=e.prev,l=e.next;if(o?Mr(e,i,s,o):Sr(e))t.push(u.index/r+n),t.push(e.index/r+n),t.push(l.index/r+n),ut(e),e=l.next,c=l.next;else if((e=l)===c){a?a===1?pt(e=Lr(e,t,r,n),t,r,i,s,o,n,2):a===2&&Ar(e,t,r,i,s,o,n):pt(lt(e),t,r,i,s,o,n,1);break}}}function Sr(e){let t=e.prev,r=e,i=e.next;if(b(t,r,i)>=0)return!1;let s=e.next.next,o=s,n=0;for(;s!==e.prev&&(n===0||s!==o);){if(n++,et(t.x,t.y,r.x,r.y,i.x,i.y,s.x,s.y)&&b(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function Mr(e,t,r,i){let s=e.prev,o=e,n=e.next;if(b(s,o,n)>=0)return!1;let a=s.x<o.x?s.x<n.x?s.x:n.x:o.x<n.x?o.x:n.x,c=s.y<o.y?s.y<n.y?s.y:n.y:o.y<n.y?o.y:n.y,u=s.x>o.x?s.x>n.x?s.x:n.x:o.x>n.x?o.x:n.x,l=s.y>o.y?s.y>n.y?s.y:n.y:o.y>n.y?o.y:n.y,f=Qt(a,c,t,r,i),d=Qt(u,l,t,r,i),h=e.prevZ,m=e.nextZ;for(;h&&h.z>=f&&m&&m.z<=d;){if(h!==e.prev&&h!==e.next&&et(s.x,s.y,o.x,o.y,n.x,n.y,h.x,h.y)&&b(h.prev,h,h.next)>=0||(h=h.prevZ,m!==e.prev&&m!==e.next&&et(s.x,s.y,o.x,o.y,n.x,n.y,m.x,m.y)&&b(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;h&&h.z>=f;){if(h!==e.prev&&h!==e.next&&et(s.x,s.y,o.x,o.y,n.x,n.y,h.x,h.y)&&b(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;m&&m.z<=d;){if(m!==e.prev&&m!==e.next&&et(s.x,s.y,o.x,o.y,n.x,n.y,m.x,m.y)&&b(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function Oe(e,t,r,i){let s=rt.create(e,t,r);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function ut(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function kr(e){let t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function Pr(e,t,r,i,s,o){let n=new Array;for(let a=0,c=i.length;a<c;a++){let u=Ve(e,t,r,i[a]*o,a<c-1?i[a+1]*o:r*o,o,!1);u===u.next&&(u.steiner=!0),n.push(kr(u))}n.sort(zr);for(let a of n)s=br(a,s);return s}function br(e,t){let r=Tr(e,t);if(!r)return t;let i=Xe(r,e);return lt(i,i.next),lt(r,r.next)}function Tr(e,t){let r=t,i=e.x,s=e.y,o,n=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){let d=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(d<=i&&d>n){if(n=d,d===i){if(s===r.y)return r;if(s===r.next.y)return r.next}o=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!o)return null;if(i===n)return o.prev;let a=o,c=o.x,u=o.y,l,f=1/0;for(r=o.next;r!==a;)i>=r.x&&r.x>=c&&i!==r.x&&et(s<u?i:n,s,c,u,s<u?n:i,s,r.x,r.y)&&(l=Math.abs(s-r.y)/(i-r.x),(l<f||l===f&&r.x>o.x)&&ht(r,e)&&(o=r,f=l)),r=r.next;return o}function Ue(e,t,r,i){let s;for(;s!==e;s=s.next){if(s=s||e,s.z===null&&(s.z=Qt(s.x,s.y,t,r,i)),s.prev.next!==s||s.next.prev!==s)return s.prev.next=s,s.next.prev=s,Ue(e,t,r,i);s.prevZ=s.prev,s.nextZ=s.next}return e.prevZ.nextZ=null,e.prevZ=null,vr(e)}function vr(e){let t,r=1;for(;;){let i,s=e;e=null,t=null;let o=0;for(;s;){o++,i=s;let n=0;for(;n<r&&i;n++)i=i.nextZ;let a=r;for(;n>0||a>0&&i;){let c;n===0?(c=i,i=i.nextZ,a--):a!==0&&i?s.z<=i.z?(c=s,s=s.nextZ,n--):(c=i,i=i.nextZ,a--):(c=s,s=s.nextZ,n--),t?t.nextZ=c:e=c,c.prevZ=t,t=c}s=i}if(t.nextZ=null,r*=2,o<2)return e}}function b(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function He(e,t,r,i){return!!(X(e,t)&&X(r,i)||X(e,i)&&X(r,t))||b(e,t,r)>0!=b(e,t,i)>0&&b(r,i,e)>0!=b(r,i,t)>0}function wr(e,t){let r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&He(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function Er(e,t,r,i,s,o){let n=0;for(let a=i,c=s-o;a<s;a+=o)n+=(e[c+t*o]-e[a+t*o])*(e[a+1+t*o]+e[c+1+t*o]),c=a;return n}function et(e,t,r,i,s,o,n,a){return(s-n)*(t-a)-(e-n)*(o-a)>=0&&(e-n)*(i-a)-(r-n)*(t-a)>=0&&(r-n)*(o-a)-(s-n)*(i-a)>=0}function ht(e,t){return b(e.prev,e,e.next)<0?b(e,t,e.next)>=0&&b(e,e.prev,t)>=0:b(e,t,e.prev)<0||b(e,e.next,t)<0}function Qt(e,t,r,i,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function X(e,t){return e.x===t.x&&e.y===t.y}function zr(e,t){return e.x-t.x}function Lr(e,t,r,i){let s=e;do{let o=s.prev,n=s.next.next;!X(o,n)&&He(o,s,s.next,n)&&ht(o,n)&&ht(n,o)&&(t.push(o.index/r+i),t.push(s.index/r+i),t.push(n.index/r+i),ut(s),ut(s.next),s=e=n),s=s.next}while(s!==e);return s}function Ar(e,t,r,i,s,o,n){let a=e;do{let c=a.next.next;for(;c!==a.prev;){if(a.index!==c.index&&Fr(a,c)){let u=Xe(a,c);return a=lt(a,a.next),u=lt(u,u.next),pt(a,t,r,i,s,o,n,0),void pt(u,t,r,i,s,o,n,0)}c=c.next}a=a.next}while(a!==e)}function Fr(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!wr(e,t)&&ht(e,t)&&ht(t,e)&&Dr(e,t)}function Dr(e,t){let r=e,i=!1,s=(e.x+t.x)/2,o=(e.y+t.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&s<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==e);return i}function Xe(e,t){let r=rt.create(e.index,e.x,e.y),i=rt.create(t.index,t.x,t.y),s=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=s,s.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}var rt=class e{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(t,r,i){let s=jt<Jt.length?Jt[jt++]:new e;return s.index=t,s.x=r,s.y=i,s.prev=null,s.next=null,s.z=null,s.prevZ=null,s.nextZ=null,s.steiner=!1,s}},Jt=[],Ir=8096,jt=0;for(let e=0;e<Ir;e++)Jt.push(new rt);var Cr=1e-5,Z=new Vt(0,0,0,1,0),$t=new Vt(0,0,0,1,0);function Ze(e,t,r){let i=0;for(let s=1;s<r;s++){let o=e[2*(t+s-1)],n=e[2*(t+s-1)+1];i+=(e[2*(t+s)]-o)*(e[2*(t+s)+1]+n)}return i}function Gr(e,t,r,i,s){let o=0,n=2;for(let a=r;a<i;a+=3){let c=(e[a]-s)*n,u=(e[a+1]-s)*n,l=(e[a+2]-s)*n;o+=Math.abs((t[c]-t[l])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[l+1]-t[c+1]))}return o}function qe(e,t){let{coords:r,lengths:i}=t,s=0,o=e,n=0;for(let a=0;a<i.length;){let c=a,u=i[a],l=Ze(r,n,u),f=[];for(;++c<i.length;){let y=i[c],_=Ze(r,n+u,y);if(!(_>0))break;l+=_,f.push(n+u),u+=y}let d=o.length;Re(o,r,n,n+u,f,2,s);let h=Gr(o,r,d,o.length,s),m=Math.abs(l);if(Math.abs((h-m)/Math.max(1e-7,m))>Cr)return o.length=0,!1;a=c,n+=u}return!0}function Qe(e){let{coords:t,lengths:r}=e,{buffer:i}=Ne(t,r);return i}function Br(e,t,r){let i=0;for(let s=0;s<e.lengths.length;s++){let o=e.lengths[s];for(let n=0;n<o;n++){let a=e.coords[2*(n+i)],c=e.coords[2*(n+i)+1];if(a<t||a>r||c<t||c>r)return!0}i+=o}return!1}function zt(e,t){if(e==null)return null;if(!Br(e,-128,640))return e;Z.setPixelMargin(t),Z.reset(Rt.Polygon);let r=0;for(let n=0;n<e.lengths.length;n++){let a=e.lengths[n],c=e.coords[2*(0+r)],u=e.coords[2*(0+r)+1];Z.moveTo(c,u);for(let l=1;l<a;l++)c=e.coords[2*(l+r)],u=e.coords[2*(l+r)+1],Z.lineTo(c,u);Z.close(),r+=a}let i=Z.result(!1);if(!i)return null;let s=[],o=[];for(let n of i){let a=0;for(let c of n)o.push(c.x),o.push(c.y),a++;s.push(a)}return new fe(s,o)}function Je(e,t){$t.setPixelMargin(t);let r=$t,i=-t,s=512+t,o=[],n=!1;if(!e.nextPath())return null;let a=e.pathLength(),c=!0;for(;c;){e.seekPathStart();let u=[];if(!e.pathSize)return null;r.reset(Rt.LineString),e.nextPoint();let l=e.x,f=e.y;if(n)r.moveTo(l,f);else{if(l<i||l>s||f<i||f>s){n=!0;continue}u.push({x:l,y:f})}let d=!1;for(;e.nextPoint();)if(l=e.x,f=e.y,n)r.lineTo(l,f);else{if(l<i||l>s||f<i||f>s){d=!0;break}u.push({x:l,y:f})}if(d)n=!0;else{if(n){let h=r.resultWithStarts();if(h)for(let m of h)o.push(S(g({},m),{pathLength:a}))}else o.push({line:u,start:0,pathLength:a});c=e.nextPath(),a=c?e.pathLength():0,n=!1}}return o=o.filter(u=>u.line.length>1),o.length===0?null:o}Z.setExtent(512),$t.setExtent(512);var Wr=96/72,Lt=class{static executeEffects(t,r,i,s,o){let n=Wr,a=Xt(t),c=new Ut(r);for(let u of t){let l=Ht(u);l&&(c=l.execute(c,u,n,i,s,a,o))}return c}static applyEffects(t,r,i){if(!t)return r;let s=Xt(t),o,n=new Ut(k.fromJSONCIM(r));for(let u of t){let l=Ht(u);l&&(n=l.execute(n,u,1,null,i,s,!1))}let a=[],c=null;for(;o=n.next();)a.push(...me(o)),c=o.geometryType;return a.length===0||c===null?null:c==="esriGeometryPolygon"?{rings:a}:{paths:a}}};var je=null;function it(){return je}function $e(){return E(this,null,function*(){je=yield import("./chunk-FOYQ56X5.js")})}function Ke(e){switch(e){case p.BYTE:case p.UNSIGNED_BYTE:return 1;case p.SHORT:case p.UNSIGNED_SHORT:case p.HALF_FLOAT:return 2;case p.FLOAT:case p.INT:case p.UNSIGNED_INT:return 4}}function Nr(e){let t=[],r=[],i=[];for(let s of e){let o=Ke(s.type)*s.count;switch(o%2||o%4||4){case 4:t.push(s);continue;case 2:r.push(s);continue;case 1:i.push(s);continue;default:throw new Error("Found unexpected dataType byte count")}}return t.push(...r),t.push(...i),t}var At=class e{static fromVertexSpec(t,r){let{attributes:i,optionalAttributes:s}=t,o,n,a,c=[];for(let y in i){let _=i[y];_.pack==="position"?o=S(g({},_),{name:y,offset:0}):_.pack==="id"?n=S(g({},_),{name:y,offset:4}):y==="bitset"?a=S(g({},_),{name:y,offset:7}):c.push(S(g({},_),{name:y}))}for(let y in s)if(r[y]===!0){let _=s[y];c.push(S(g({},_),{name:y}))}let u=Nr(c),l=[],f=8,d=1;for(let y of u)l.push(S(g({},y),{offset:f})),f+=Ke(y.type)*y.count,y.packAlternating&&(d=Math.max(y.packAlternating.count,d));let h=Uint32Array.BYTES_PER_ELEMENT,m=f%h;return new e(o,n,a,l,f+(m?h-m:0),d)}constructor(t,r,i,s,o,n){this.position=t,this.id=r,this.bitset=i,this.standardAttributes=s,this.stride=o,this.packVertexCount=n,s.push(i),this._attributes=[t,r,i,...s]}get attributeLayout(){if(!this._attributeLayout){let t=Ae(this._attributes),r=this._attributes.map(i=>({name:i.name,count:i.count,offset:i.offset,type:i.type,packPrecisionFactor:i.packPrecisionFactor,normalized:i.normalized??!1}));this._attributeLayout={attributes:r,hash:t,stride:this.stride}}return this._attributeLayout}};var Ft=class e{static fromVertexSpec(t,r){let i=At.fromVertexSpec(t,r);return new e(i)}constructor(t){this._spec=t,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(t,r,i,s,o,n){for(let a=0;a<this._spec.packVertexCount;a++){let c=a*this._spec.stride;this._packPosition(i,s,c),this._packId(r,c);let u=this._spec.bitset;if(n){if(u.packTessellation){let l=u.packTessellation(n,o,i,s);this._pack(l,u,c)}for(let l of this._spec.standardAttributes)if(l.packTessellation!=null){let f=l.packTessellation(n,o,i,s);this._pack(f,l,c)}else if(l.packAlternating?.packTessellation){let f=l.packAlternating.packTessellation(n,o,i,s);for(let d=0;d<this._spec.packVertexCount;d++){let h=f[d];this._pack(h,l,d*this._spec.stride)}}}}t.vertexWriteRegion(this._packedU32View)}pack(t,r){for(let i of this._spec.standardAttributes)if(i.pack&&typeof i.pack!="string"){let s=i.pack(t,r);for(let o=0;o<this._spec.packVertexCount;o++)this._pack(s,i,o*this._spec.stride)}else if(i.packAlternating?.pack){let s=i.packAlternating.pack(t,r);for(let o=0;o<this._spec.packVertexCount;o++){let n=s[o];this._pack(n,i,o*this._spec.stride)}}}_packPosition(t,r,i){let{offset:s}=this._spec.position,o=this._spec.position.packPrecisionFactor??1,n=Le(t*o,r*o);this._dataView.setUint32(i+s,n,!0)}_packId(t,r){let i=t*(this._spec.id.packPrecisionFactor??1),s=4278190080&this._dataView.getUint32(r+this._spec.id.offset,!0);this._dataView.setUint32(r+this._spec.id.offset,i|s,!0)}_pack(t,r,i){Fe(this._dataView,t,r,i)}};function Yr(e){if(!e)return!1;for(let t of e)switch(t.effect.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1}var T=class{constructor(t,r,i,s){this._instanceId=t,this._evaluator=r,this._enabledOptionalAttributes=i,this._viewParams=s,this._evaluator.evaluator=o=>this.vertexSpec.createComputedParams(o)}get _vertexPack(){if(!this._cachedVertexPack){let t=Ft.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||t.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=t}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}get _preventEffectClipping(){return!1}setReferences(t){this._references=t}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}loadDependencies(){return E(this,null,function*(){Yr(this._evaluator.inputMeshParams.effects?.effectInfos)&&(yield $e())})}enqueueRequest(t,r,i){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(t,r,i)}write(t,r,i,s,o){this.ensurePacked(r,i,s);let n=this.evaluatedMeshParams.effects;if(!n||n.length===0)return void this._write(t,i,void 0,o);let a=i.readGeometryForDisplay()?.clone();if(!a)return;let c=k.fromOptimizedCIM(a,i.geometryType),u=it();c.invertY();let l=t.id||"",f=Lt.executeEffects(n,c,l,u,this._preventEffectClipping),d;for(;d=f.next();)d.invertY(),this._write(t,i,d,o)}ensurePacked(t,r,i){if(!this._evaluator.hasDynamicProperties)return;let s=this._evaluator.evaluateMeshParams(t,r,i);this._vertexPack.pack(s,this._viewParams)}hasArcadeDependency(t){return this._evaluator.hasArcadeDependency(t)}_writeVertex(t,r,i,s,o){let n=this.evaluatedMeshParams;this._vertexPack.writeVertex(t,r,i,s,n,o)}};var Or=100,Rr=pe("featurelayer-fast-triangulation-enabled"),O=class e extends T{loadDependencies(){return E(this,null,function*(){yield Promise.all([W(e.prototype,this,"loadDependencies").call(this),We()])})}_write(t,r,i){let s=i?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(s);o&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,r,o),t.recordEnd())}_clip(t){if(!t)return null;let r=this.hasEffects;return zt(t,r?256:8)}_writeGeometry(t,r,i){let s=i.maxLength>Or,o=[],n=this.createTesselationParams(r);if(!s&&Rr&&qe(o,i))return void(o.length&&this._writeVertices(t,r,i.coords,n,o));let a=Qe(i);this._writeVertices(t,r,a,n)}_writeVertices(t,r,i,s,o){let n=r.getDisplayId(),a=t.vertexCount(),c=this.hasEffects,u=0;if(o)for(let l of o){let f=i[2*l],d=i[2*l+1];c&&t.recordBounds(f,d,0,0),this._writeVertex(t,n,f,d,s),u++}else for(let l=0;l<i.length;l+=2){let f=Math.round(i[l]),d=Math.round(i[l+1]);c&&t.recordBounds(f,d,0,0),this._writeVertex(t,n,f,d,s),u++}t.indexEnsureSize(u);for(let l=0;l<u;l++)t.indexWrite(l+a)}};var Vr={createComputedParams:e=>e,optionalAttributes:{},attributes:{id:{type:p.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.UNSIGNED_BYTE,count:1},pos:{type:p.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:p.FLOAT,count:1,packTessellation:({inverseArea:e})=>e}}},tr=class extends O{constructor(){super(...arguments),this.vertexSpec=Vr}createTesselationParams(t){return{inverseArea:1/t.readGeometryArea()}}};var Ur=()=>yt.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils"),Hr=0,Xr=100;function D(e,t){return[!!e?.minScale&&t.scaleToZoom(e.minScale)||Hr,!!e?.maxScale&&t.scaleToZoom(e.maxScale)||Xr]}function C(e){return 1<<e}function z(e){let t=0;for(let[r,i]of e)i&&(t|=1<<r);return t}function M(e){let t;if(!e)return[0,0,0,0];if(typeof e=="string"){let n=de.fromString(e);if(!n)return Ur().errorOnce(new ue("mapview:mesh-processing","Unable to parse string into color",{color:e})),[0,0,0,0];t=n.toArray()}else t=e;let[r,i,s,o]=t;return[r*(o/255),i*(o/255),s*(o/255),o]}function er(e){switch(e){case"butt":case N.Butt:return gt.BUTT;case"round":case N.Round:return gt.ROUND;case"square":case N.Square:return gt.SQUARE}}function rr(e){switch(e){case"bevel":case Mt.Bevel:return _t.BEVEL;case"miter":case Mt.Miter:return _t.MITER;case"round":case Mt.Round:return _t.ROUND}}function Dt(e,t){return Math.round(Math.min(Math.sqrt(e*t),255))}function mt(e,t){return Math.round(e*t)/t}var q={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:p.SHORT,count:2,packPrecisionFactor:Y,pack:({scaleInfo:e},{tileInfo:t})=>D(e,t)}},attributes:{id:{type:p.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.UNSIGNED_BYTE,count:1},pos:{type:p.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>M(e)}}},st=class extends O{constructor(){super(...arguments),this.vertexSpec=q}createTesselationParams(t){return null}};var G={createComputedParams:e=>e,optionalAttributes:q.optionalAttributes,attributes:S(g({},q.attributes),{tlbr:{count:4,type:p.UNSIGNED_SHORT,pack:({sprite:e})=>{let{rect:t,width:r,height:i}=e,s=t.x+P,o=t.y+P;return[s,o,s+r,o+i]}},inverseRasterizationScale:{count:1,type:p.BYTE,packPrecisionFactor:16,pack:({sprite:e})=>1/e.rasterizationScale}})},It=class extends st{constructor(){super(...arguments),this.vertexSpec=G}_write(t,r,i){let s=i?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(s);if(!o)return;let n=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,n),this._writeGeometry(t,r,o),t.recordEnd()}};function ft(e){let{sprite:t,aspectRatio:r,scaleProportionally:i}=e,s=x(e.height),o=s>0?s:t.height,n=s*r;return n<=0?n=t.width:i&&(n*=t.width/t.height),{width:n,height:o}}function Kt(e){let{applyRandomOffset:t,sampleAlphaOnly:r}=e;return z([[De,t],[bt,r]])}var te={createComputedParams:e=>e,optionalAttributes:G.optionalAttributes,attributes:S(g({},G.attributes),{bitset:{count:1,type:p.UNSIGNED_BYTE,pack:Kt},width:{count:1,type:p.HALF_FLOAT,pack:e=>ft(e).width},height:{count:1,type:p.HALF_FLOAT,pack:e=>ft(e).height},offset:{count:2,type:p.HALF_FLOAT,pack:({offsetX:e,offsetY:t})=>[x(e),-x(t)]},scale:{count:2,type:p.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:e,scaleY:t})=>[e,t]},angle:{count:1,type:p.UNSIGNED_BYTE,pack:({angle:e})=>xe(e)}})},ir=class extends It{constructor(){super(...arguments),this.vertexSpec=te}};var ee=class{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0,this.pathLength=0}},L={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:p.SHORT,count:2,packPrecisionFactor:Y,pack:({scaleInfo:e},{tileInfo:t})=>D(e,t)}},attributes:{id:{type:p.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:p.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:p.UNSIGNED_BYTE,count:1},color:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>M(e)},offset:{type:p.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[mt(e,16),mt(t,16)]},normal:{type:p.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:e,normalY:t})=>[mt(e,16),mt(t,16)]},halfWidth:{type:p.HALF_FLOAT,count:1,pack:({width:e})=>x(.5*e)},referenceHalfWidth:{type:p.HALF_FLOAT,count:1,pack:({referenceWidth:e})=>x(.5*e)}}},re=class{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0,this.pathLength=0}},sr=65535,R=class extends T{constructor(t,r,i,s){super(t,r,i,s),this.vertexSpec=L,this._currentWrite=new re,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:sr,textured:!1},this._tessParams=new ee,this._initializeTessellator()}writeLineVertices(t,r,i){let s=this._getLines(r);s!=null&&this._writeVertices(t,i,s)}_initializeTessellator(){this._lineTessellator=new Ye(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(t,r,i){let s=i??k.fromFeatureSetReaderCIM(r);s&&this._writeGeometry(t,r,s)}_writeGeometry(t,r,i,s){t.recordStart(this.instanceId,this.attributeLayout,s),this.writeLineVertices(t,i,r),t.recordEnd()}_getLines(t){return Je(t,Pt(this.evaluatedMeshParams))}_writeVertices(t,r,i){let{_currentWrite:s,_tessellationOptions:o,evaluatedMeshParams:n}=this,{width:a,capType:c,joinType:u,miterLimit:l,hasSizeVV:f}=n,d=x(.5*a);o.halfWidth=d,o.capType=er(c),o.joinType=rr(u),o.miterLimit=l;let h=!f;s.out=t,s.id=r.getDisplayId(),s.vertexCount=0,s.indexCount=0,s.vertexFrom=t.vertexCount(),s.vertexBounds=h&&d<_e?0:1;for(let{line:m,start:y,pathLength:_}of i)o.initialDistance=y%sr,s.pathLength=_,this._lineTessellator.tessellate(m,o,h)}_writeTesselatedVertex(t,r,i,s,o,n,a,c,u,l,f){let{out:d,id:h,vertexBounds:m,pathLength:y}=this._currentWrite;return this.hasEffects&&d.recordBounds(t,r,m,m),this._tessParams.extrusionOffsetX=a,this._tessParams.extrusionOffsetY=c,this._tessParams.normalX=u,this._tessParams.normalY=l,this._tessParams.directionX=o,this._tessParams.directionY=n,this._tessParams.distance=f,this._tessParams.pathLength=y,this._writeVertex(d,h,t,r,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(t,r,i){let{out:s}=this._currentWrite;s.indexEnsureSize(3),s.indexWrite(t),s.indexWrite(r),s.indexWrite(i),this._currentWrite.indexCount+=3}};var ie={createComputedParams:e=>e,optionalAttributes:L.optionalAttributes,attributes:S(g({},L.attributes),{bitset:{type:p.UNSIGNED_BYTE,count:1,pack:e=>0},color:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>M(e)}})},dt={createComputedParams:e=>e,optionalAttributes:L.optionalAttributes,attributes:S(g({},L.attributes),{bitset:{type:p.UNSIGNED_BYTE,count:1,pack:e=>z([[Tt,!0]])},color:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>M(e)}})},Q=class extends R{constructor(){super(...arguments),this.vertexSpec=dt}},ot=class e extends st{constructor(t,r,i,s){super(t,r,i,s),this.vertexSpec=ie,this._lineMeshWriter=this._createOutlineWriter(t,r,i,s)}_createOutlineWriter(t,r,i,s){return new Q(t,r,i,s)}_write(t,r,i){let s=i?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(s);o&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,r,o),this._lineMeshWriter.writeLineVertices(t,k.fromOptimizedCIM(o,"esriGeometryPolyline"),r),t.recordEnd())}_clip(t){return t?zt(t,Pt(this.evaluatedMeshParams)):null}ensurePacked(t,r,i){super.ensurePacked(t,r,i),this._lineMeshWriter.ensurePacked(t,r,i)}enqueueRequest(t,r,i){super.enqueueRequest(t,r,i),this._lineMeshWriter.enqueueRequest(t,r,i)}loadDependencies(){return E(this,null,function*(){yield Promise.all([W(e.prototype,this,"loadDependencies").call(this),this._lineMeshWriter.loadDependencies()])})}};var Ct=te,Zr=dt,qr={createComputedParams:e=>e,optionalAttributes:Ct.optionalAttributes,attributes:S(g({},Ct.attributes),{bitset:{type:p.UNSIGNED_BYTE,count:1,pack:e=>Kt(e)},aux1:{count:1,type:p.HALF_FLOAT,pack:e=>ft(e).width},aux2:{count:1,type:p.HALF_FLOAT,pack:e=>ft(e).height},aux3:{count:2,type:p.HALF_FLOAT,pack:({offsetX:e,offsetY:t})=>[x(e),x(t)]},aux4:{count:2,type:p.UNSIGNED_BYTE,pack:({scaleX:e,scaleY:t})=>[e*ct,t*ct]}})},Qr={createComputedParams:e=>e,optionalAttributes:Ct.optionalAttributes,attributes:S(g({},Ct.attributes),{color:Zr.attributes.color,bitset:{type:p.UNSIGNED_BYTE,count:1,pack:e=>z([[Tt,!0]])},aux1:{count:1,type:p.HALF_FLOAT,pack:e=>x(.5*e.width)},aux2:{count:1,type:p.HALF_FLOAT,pack:e=>x(.5*e.referenceWidth)},aux3:{count:2,type:p.HALF_FLOAT,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[e,t]},aux4:{count:2,type:p.UNSIGNED_BYTE,packTessellation:({normalX:e,normalY:t})=>[e*ct+Zt,t*ct+Zt]}})},se=class extends Q{constructor(){super(...arguments),this.vertexSpec=Qr}},or=class e extends ot{constructor(){super(...arguments),this.vertexSpec=qr}_createOutlineWriter(t,r,i,s){return new se(t,r,i,s)}_write(t,r,i){let s=i?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(s);if(!o)return;let n=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,n),this._writeGeometry(t,r,o),this._lineMeshWriter.writeLineVertices(t,k.fromOptimizedCIM(o,"esriGeometryPolyline"),r),t.recordEnd()}ensurePacked(t,r,i){super.ensurePacked(t,r,i),this._lineMeshWriter.ensurePacked(t,r,i)}enqueueRequest(t,r,i){super.enqueueRequest(t,r,i),this._lineMeshWriter.enqueueRequest(t,r,i)}loadDependencies(){return E(this,null,function*(){yield Promise.all([W(e.prototype,this,"loadDependencies").call(this),this._lineMeshWriter.loadDependencies()])})}};var Jr=()=>yt.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.fill.GradientSizeHelper"),oe=class{constructor(t,r){this._size=t,this._sizeUnits=r,this._relativeSize=null}get relativeSize(){return this._relativeSize??=this.calculateRelativeSize(),this._relativeSize}calculateRelativeSize(){if(this._sizeUnits===H.Relative){let t=Math.min(this._size/100,1);return[t,t]}return this.calculateRelativeSizeFromAbsolute()}},xt=class extends oe{constructor(t,r,i,s){super(r,i),this.rotationMatrix00=1,this.rotationMatrix01=0,this.rotationMatrix10=0,this.rotationMatrix11=1,this.bounds={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0},this.rotationMatrix00=Math.cos(s),this.rotationMatrix01=-Math.sin(s),this.rotationMatrix10=-this.rotationMatrix01,this.rotationMatrix11=this.rotationMatrix00;let{bounds:o,rotationMatrix00:n,rotationMatrix01:a,rotationMatrix10:c,rotationMatrix11:u}=this;t.forEachVertex((l,f)=>{let d=l*n+f*a,h=l*c+f*u;o.xmin=Math.min(o.xmin,d),o.ymin=Math.min(o.ymin,h),o.xmax=Math.max(o.xmax,d),o.ymax=Math.max(o.ymax,h)}),this.center=[(o.xmin+o.xmax)/2,(o.ymin+o.ymax)/2]}},ne=class extends xt{constructor(t,r,i,s){super(t,r,i,s),this.method="linear"}getRelativePosition(t,r){let{rotationMatrix00:i,rotationMatrix01:s,bounds:o}=this,{xmin:n,xmax:a}=o;return[(t*i+r*s-n)/(a-n),0]}calculateRelativeSizeFromAbsolute(){let{_size:t,bounds:r}=this,{xmin:i,xmax:s}=r;return[x(t)/(s-i),0]}},ae=class extends xt{constructor(t,r,i,s){super(t,r,i,s),this.method="rectangular"}getRelativePosition(t,r){let{bounds:i,center:s,rotationMatrix00:o,rotationMatrix01:n,rotationMatrix10:a,rotationMatrix11:c}=this,u=t*a+r*c,l=t*o+r*n-s[0],f=u-s[1];return[l*(2/(i.xmax-i.xmin)),-f*(2/(i.ymax-i.ymin))]}calculateRelativeSizeFromAbsolute(){let{_size:t,bounds:r}=this,{xmin:i,ymin:s,xmax:o,ymax:n}=r;return[x(2*t)/(o-i),x(2*t)/(n-s)]}},ce=class extends xt{constructor(t,r,i){super(t,r,i,0),this.method="circular";let{xmin:s,xmax:o,ymin:n,ymax:a}=this.bounds,c=o-s,u=a-n;this.radius=Math.sqrt(c*c+u*u)/2}getRelativePosition(t,r){let{center:i,radius:s}=this;return[(t-i[0])/s,-((r-i[1])/s)]}calculateRelativeSizeFromAbsolute(){let{_size:t}=this;return[x(t)/this.radius,0]}};function nr(e,t){if(e==null)return null;let r=he(t.angle),i=t.gradientSize,s=t.gradientSizeUnits;switch(t.gradientMethod.toLowerCase()){case"linear":return new ne(e,i,s,r);case"rectangular":return new ae(e,i,s,r);case"circular":return new ce(e,i,s);default:return Jr().errorOnce(`Gradient fill method "${t.gradientMethod}" currently unsupported.`),null}}var jr={createComputedParams:e=>e,optionalAttributes:q.optionalAttributes,attributes:S(g({},q.attributes),{bitset:{type:p.UNSIGNED_BYTE,count:1,pack:({gradientSizeUnits:e,gradientType:t})=>{let r=0;return e===H.Absolute&&(r|=C(qt.isAbsolute)),t.toLowerCase()==="discrete"&&(r|=C(qt.isDiscrete)),r}},tlbr:{count:4,type:p.UNSIGNED_SHORT,pack:({sprite:e})=>{let{rect:t,width:r,height:i}=e,s=t.x+P+K,o=t.y+P;return[s,o,s+r-2*K,o+i]}},relativePosition:{count:2,type:p.HALF_FLOAT,packTessellation:({gradientStats:e},t,r,i)=>e?.getRelativePosition(r,i)??[0,0]},relativeGradientSize:{count:2,type:p.HALF_FLOAT,packTessellation:({gradientStats:e})=>e?.relativeSize??[1,1]},gradientMethod:{count:1,type:p.UNSIGNED_BYTE,pack:({gradientMethod:e})=>{switch(e.toLowerCase()){case"rectangular":return vt.rectangular;case"circular":return vt.circular;default:return vt.linear}}}})},ar=class extends O{constructor(){super(...arguments),this.vertexSpec=jr}get _preventEffectClipping(){return!0}createTesselationParams(t){return{gradientStats:nr(t.readGeometryForDisplay(),this.evaluatedMeshParams)}}_write(t,r,i){let s=i?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(s);if(!o)return;let n=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,n),this._writeGeometry(t,r,o),t.recordEnd()}};var $r={optionalAttributes:G.optionalAttributes,createComputedParams:e=>e,attributes:g(g({},G.attributes),ie.attributes)},Kr={optionalAttributes:G.optionalAttributes,createComputedParams:e=>e,attributes:g(g({},G.attributes),dt.attributes)},le=class extends Q{constructor(){super(...arguments),this.vertexSpec=Kr}},cr=class e extends ot{constructor(){super(...arguments),this.vertexSpec=$r}_createOutlineWriter(t,r,i,s){return new le(t,r,i,s)}_write(t,r,i){let s=i?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(s);if(!o)return;let n=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,n),this._writeGeometry(t,r,o),this._lineMeshWriter.writeLineVertices(t,k.fromOptimizedCIM(o,"esriGeometryPolyline"),r),t.recordEnd()}ensurePacked(t,r,i){super.ensurePacked(t,r,i),this._lineMeshWriter.ensurePacked(t,r,i)}enqueueRequest(t,r,i){super.enqueueRequest(t,r,i),this._lineMeshWriter.enqueueRequest(t,r,i)}loadDependencies(){return E(this,null,function*(){yield Promise.all([W(e.prototype,this,"loadDependencies").call(this),this._lineMeshWriter.loadDependencies()])})}};var ti={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:p.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:p.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.UNSIGNED_BYTE,count:1},offset:{type:p.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}},lr=class extends T{constructor(){super(...arguments),this.vertexSpec=ti}_write(t,r){t.recordStart(this.instanceId,this.attributeLayout);let i=r.getDisplayId();if(r.geometryType==="esriGeometryPoint"){let s=r.readXForDisplay(),o=r.readYForDisplay();this._writeQuad(t,i,s,o)}else r.geometryType==="esriGeometryMultipoint"&&r.readGeometryForDisplay()?.forEachVertex((o,n)=>{o>=0&&o<=512&&n>=0&&n<=512&&this._writeQuad(t,i,o,n)});t.recordEnd()}_writeQuad(t,r,i,s){let o=t.vertexCount();this._writeVertex(t,r,i,s),t.indexWrite(o+0),t.indexWrite(o+1),t.indexWrite(o+2),t.indexWrite(o+1),t.indexWrite(o+3),t.indexWrite(o+2)}};var nt=class{static getPlacement(t,r,i,s,o,n){let a=ke(i);return a?(r===-1&&t.invertY(),a.execute(t,i,s,o,n)):null}};var pr=96,Gt=class{constructor(t){let{offsetX:r,offsetY:i,postAngle:s,fontSize:o,haloSize:n,outlineSize:a,scaleFactor:c,transforms:u}=t;if(this.offsetX=r,this.offsetY=i,this.postAngle=s,this.fontSize=Math.min(o,pr),this.haloSize=n??0,this.outlineSize=a??0,this.transforms=u,u&&u.infos.length>1){let l=kt(o,s,!1,r,i,u,!1);this.fontSize=Math.min(l.size,pr);let f=l.size/o;this.haloSize*=f,this.outlineSize*=f,this.postAngle=l.rotation,this.offsetX=l.offsetX,this.offsetY=l.offsetY}c&&(this.fontSize*=c,this.offsetX*=c,this.offsetY*=c)}};var ei=28,V=[4,4],Bt=[16,4],ri={topLeft:Bt,topRight:Bt,bottomLeft:Bt,bottomRight:Bt},Wt=[4,2],A=[4,6],ur={topLeft:Wt,topRight:Wt,bottomLeft:A,bottomRight:A},hr={topLeft:Wt,topRight:A,bottomLeft:Wt,bottomRight:A},ii={topLeft:A,topRight:A,bottomLeft:V,bottomRight:V},si={topLeft:V,topRight:V,bottomLeft:A,bottomRight:A},oi={topLeft:A,topRight:V,bottomLeft:A,bottomRight:V},ni={topLeft:V,topRight:A,bottomLeft:V,bottomRight:A},ai={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:p.UNSIGNED_SHORT,count:2,packPrecisionFactor:Y,packTessellation:({minZoom:e,maxZoom:t})=>[e||0,t||ei]},clipAngle:{type:p.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:e})=>ci(e||0)},referenceSymbol:{type:p.BYTE,count:4,packPrecisionFactor:1,packTessellation:(e,t)=>{let r=e.isLineLabel||!e.referenceBounds,i=we(r?"center":t.horizontalAlignment),s=Ee(r?"middle":t.verticalAlignment),{offsetX:o,offsetY:n,size:a}=r?{offsetX:0,offsetY:0,size:0}:e.referenceBounds;return[x(o),-x(n),Math.round(x(a)),i+1<<2|s+1]}}},attributes:{pos:{type:p.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:p.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:e,mapAligned:t})=>z([[Ge,e],[Be,!!t]])},offset:{type:p.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:e})=>{let{bottomLeft:t,bottomRight:r,topLeft:i,topRight:s}=e;return[i,s,t,r]}}},textureUV:{type:p.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:e})=>{let{bottomLeft:t,bottomRight:r,topLeft:i,topRight:s}=e;return[i,s,t,r]}}},color:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:e})=>e},fontSize:{type:p.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:e})=>Math.round(x(e))},referenceSize:{type:p.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:e},{referenceSize:t})=>Math.round(x(t??e))},outlineColor:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>M(e)},haloColor:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:e})=>M(e)},outlineAndHaloSize:{type:p.UNSIGNED_SHORT,count:2,packPrecisionFactor:4,packTessellation:({outlineSize:e,haloSize:t})=>[Math.round(x(e)),Math.round(x(t))]}}},mr=class extends T{constructor(){super(...arguments),this.vertexSpec=ai,this._textMeshParamsPropsInitialized=!1}ensurePacked(t,r,i){super.ensurePacked(t,r,i),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new Gt(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(t,r,i){let s=this._getShaping();if(!s)return;let o=r.getDisplayId();if(this.evaluatedMeshParams.placement!=null)return this._writePlacedTextMarkers(t,r,s,i);if(i?.nextPath())return i.nextPoint(),this._writeGlyphs(t,o,i.x,i.y,s,0);if(r.geometryType==="esriGeometryPolygon"){let c=r.readCentroidForDisplay();if(!c)return;let[u,l]=c.coords;return this._writeGlyphs(t,o,u,l,s,0)}if(r.geometryType==="esriGeometryMultipoint")return void r.readGeometryForDisplay()?.forEachVertex((u,l)=>this._writeGlyphs(t,o,u,l,s,0));let n=r.readXForDisplay(),a=r.readYForDisplay();return this._writeGlyphs(t,o,n,a,s,0)}_writePlacedTextMarkers(t,r,i,s){let o=s??k.fromFeatureSetReaderCIM(r);if(!o)return;let n=-1,a=nt.getPlacement(o,n,this.evaluatedMeshParams.placement,x(1),t.id,it());if(!a)return;let c=r.getDisplayId(),u=a.next();for(;u!=null;){let l=u.tx,f=-u.ty,d=-u.getAngle();this._writeGlyphs(t,c,l,f,i,d),u=a.next()}}_getShaping(t){let r=this._textMeshTransformProps,i=this.evaluatedMeshParams;if(!i.glyphs?.glyphs.length)return null;let s=x(r.fontSize),o=x(r.offsetX),n=x(r.offsetY),a=Ot(x(i.lineWidth),Se,Me),c=ye*Ot(i.lineHeightRatio,.25,4);return ze(i.glyphs,{scale:s/ge,angle:r.postAngle,xOffset:o,yOffset:n,horizontalAlignment:i.horizontalAlignment,verticalAlignment:t||i.verticalAlignment,maxLineWidth:a,lineHeight:c,decoration:i.decoration,borderLineSizePx:x(i.boxBorderLineSize),hasBackground:!!i.boxBackgroundColor,useCIMAngleBehavior:i.useCIMAngleBehavior})}_writeGlyphs(t,r,i,s,o,n,a,c){let u=this.evaluatedMeshParams,l=this._textMeshTransformProps,f=x(l.fontSize),d=l.haloSize,h=l.outlineSize,m=x(l.offsetX),y=x(l.offsetY),[_,v]=D(u.scaleInfo,this.getTileInfo());n!==0&&o.setRotation(n);let w=o.bounds,U=i+w.x+m,I=s+w.y-y,J=2*(u.minPixelBuffer?u.minPixelBuffer/f:1),F=Math.max(w.width,w.height)*J;o.textBox&&(t.recordStart(this.instanceId,this.attributeLayout,o.glyphs[0].textureBinding),t.recordBounds(U,I,F,F),this._writeTextBox(t,r,i,s,o.textBox,a,c),t.recordEnd());for(let B of o.glyphs){t.recordStart(this.instanceId,this.attributeLayout,B.textureBinding),t.recordBounds(U,I,F,F);let{texcoords:j,offsets:$}=B;this._writeQuad(t,r,i,s,g({texcoords:j,offsets:$,fontSize:f,haloSize:d,outlineSize:h,color:M(u.color),isBackground:!1,referenceBounds:a,minZoom:_,maxZoom:v},c)),t.recordEnd()}n!==0&&o.setRotation(-n)}_writeTextBox(t,r,i,s,o,n,a){let c=this.evaluatedMeshParams,{fontSize:u,haloSize:l,outlineSize:f}=this._textMeshTransformProps,{boxBackgroundColor:d,boxBorderLineColor:h}=c,m=g({isBackground:!0,fontSize:u,haloSize:l,outlineSize:f,referenceBounds:n},a);d&&(this._writeQuad(t,r,i,s,g({texcoords:ri,offsets:o.main,color:M(d)},m)),h||(this._writeQuad(t,r,i,s,g({texcoords:ii,offsets:o.top,color:M(d)},m)),this._writeQuad(t,r,i,s,g({texcoords:si,offsets:o.bot,color:M(d)},m)),this._writeQuad(t,r,i,s,g({texcoords:oi,offsets:o.left,color:M(d)},m)),this._writeQuad(t,r,i,s,g({texcoords:ni,offsets:o.right,color:M(d)},m)))),h&&(this._writeQuad(t,r,i,s,g({texcoords:ur,offsets:o.top,color:M(h)},m)),this._writeQuad(t,r,i,s,g({texcoords:ur,offsets:o.bot,color:M(h)},m)),this._writeQuad(t,r,i,s,g({texcoords:hr,offsets:o.left,color:M(h)},m)),this._writeQuad(t,r,i,s,g({texcoords:hr,offsets:o.right,color:M(h)},m)))}_writeQuad(t,r,i,s,o){let n=t.vertexCount();this._writeVertex(t,r,i,s,o),t.indexWrite(n+0),t.indexWrite(n+1),t.indexWrite(n+2),t.indexWrite(n+1),t.indexWrite(n+3),t.indexWrite(n+2)}},ci=e=>Math.round(e*(254/360));var li={createComputedParams:e=>e,optionalAttributes:L.optionalAttributes,attributes:S(g({},L.attributes),{bitset:{type:p.UNSIGNED_BYTE,count:1,pack:({gradientMethod:e,gradientSizeUnits:t,gradientType:r})=>z([[wt.isAlongLine,e.toLowerCase()==="alongline"],[wt.isAbsoluteSize,t===H.Absolute],[wt.isDiscrete,r.toLowerCase()==="discrete"]])},tlbr:{type:p.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{let{rect:t,width:r,height:i}=e,s=t.x+P+K,o=t.y+P;return[s,o,s+r-2*K,o+i]}},accumulatedDistance:{type:p.UNSIGNED_SHORT,count:1,packTessellation:({distance:e})=>e},gradientSize:{type:p.HALF_FLOAT,count:1,pack:({gradientSize:e,gradientSizeUnits:t})=>t===H.Relative?e/100:x(e)},totalLength:{type:p.HALF_FLOAT,count:1,packTessellation:({pathLength:e})=>e},segmentDirection:{type:p.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]}})},fr=class extends R{get _preventEffectClipping(){return!0}constructor(t,r,i,s){super(t,r,i,s),this.vertexSpec=li,this._tessellationOptions.textured=!0}_write(t,r,i){let s=i??k.fromFeatureSetReaderCIM(r);if(!s)return;let{sprite:o}=this.evaluatedMeshParams;this._writeGeometry(t,r,s,o?.textureBinding)}};var pi={createComputedParams:e=>e,optionalAttributes:L.optionalAttributes,attributes:S(g({},L.attributes),{bitset:{type:p.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:e,shouldScaleDash:t,isSDF:r})=>z([[bt,e],[Ie,t],[Ce,r]])},tlbr:{type:p.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{let{rect:t,width:r,height:i}=e,s=t.x+P,o=t.y+P;return[s,o,s+r,o+i]}},accumulatedDistance:{type:p.UNSIGNED_SHORT,count:1,packTessellation:({distance:e})=>e},segmentDirection:{type:p.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]},offsetAlongLine:{type:p.HALF_FLOAT,count:1,pack:({offsetAlongLine:e})=>x(e)},capType:{type:p.UNSIGNED_BYTE,count:1,pack:({capType:e})=>{switch(e){case N.Butt:case"butt":return 0;case N.Square:case"square":return 1;case N.Round:case"round":return 2;default:return 0}}}})},dr=class extends R{constructor(t,r,i,s){super(t,r,i,s),this.vertexSpec=pi,this._tessellationOptions.textured=!0}_write(t,r,i){let s=i??k.fromFeatureSetReaderCIM(r);if(!s)return;let{sprite:o}=this.evaluatedMeshParams;this._writeGeometry(t,r,s,o?.textureBinding)}};var Nt=class e{static from(t){return"width"in t?this.fromSimpleMeshParams(t):this.fromComplexMeshParams(t)}static fromSimpleMeshParams(t){let r=new e(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects),{type:i,width:s,height:o,angle:n,alignment:a,outlineSize:c,referenceSize:u,sprite:l,overrideOutlineColor:f}=t;return r.rawWidth=x(s),r.rawHeight=x(o),r.angle=n,r.alignment=a,r.outlineSize=x(c),r.referenceSize=x(u),r.overrideOutlineColor=f,r.offsetX=x(t.offsetX),r.offsetY=x(t.offsetY),i!=="simple"||l.sdf||(r.rawWidth=l.width,r.rawHeight=l.height),r._computeSize(t,!1),r}static fromComplexMeshParams(t){let r=new e(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects),{alignment:i,transforms:s,size:o,scaleX:n,anchorX:a,anchorY:c,angle:u,colorLocked:l,frameHeight:f,widthRatio:d,offsetX:h,offsetY:m,outlineSize:y,referenceSize:_,scaleFactor:v,sizeRatio:w,isAbsoluteAnchorPoint:U,rotateClockwise:I,scaleSymbolsProportionally:J,sprite:F}=t;if(s&&s.infos.length>0){let $=kt(o,u,I,h,m,s);o=$.size,u=$.rotation,h=$.offsetX,m=$.offsetY,I=!1}v&&(o*=v,h*=v,m*=v);let B=n*(F.width/F.height);r.alignment=i,r.rawHeight=x(o),r.rawWidth=r.rawHeight*B,r.referenceSize=x(_),r.sizeRatio=w,r.sdfDecodeCoeff=(F.sdfDecodeCoeff??1)*w,r.angle=u,r.rotateClockwise=I,r.anchorX=a,r.anchorY=c,r.offsetX=x(h),r.offsetY=x(m),U&&o&&(F.sdf?r.anchorX=a/(o*d):r.anchorX=a/(o*B),r.anchorY=c/o);let j=J&&f?o/f:1;return r.outlineSize=y===0||isNaN(y)?0:x(y)*j,r.scaleSymbolsProportionally=J,r.colorLocked=l,r._computeSize(t,!0),r}constructor(t,r,i,s,o,n,a){this.sprite=t,this.color=r,this.outlineColor=i,this.minPixelBuffer=s,this.placement=o,this.scaleInfo=n,this.effects=a,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.sdfDecodeCoeff=1,this.alignment=St.SCREEN,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(t,r){let{sprite:i,hasSizeVV:s}=t,o=!!i.sdf,n=i.sdfPaddingRatio??.5,{rawWidth:a,rawHeight:c,sizeRatio:u,outlineSize:l}=this,f=i.rect,d=a*u,h=c*u,m=0,y=0;if(o){let I=1/(1-n);if(d*=I,h*=I,s)this.computedWidth=d,this.computedHeight=h;else{let J=r&&a>c?d:a,F=c,B=l+2*1;this.computedWidth=Math.min(J+B,d),this.computedHeight=Math.min(F+B,h);let j=Math.max(i.width,i.height)/Math.max(d,h);m=(this.computedWidth-d)*j,y=(this.computedHeight-h)*j}}else this.computedWidth=d*(f.width/i.width),this.computedHeight=h*(f.height/i.height),m=2*P,y=2*P;let _=f.x+P-m/2,v=f.y+P-y/2,w=_+i.width+m,U=v+i.height+y;this.texXmin=xr(_),this.texYmin=xr(v),this.texXmax=yr(w),this.texYmax=yr(U),this.computedWidth*=(this.texXmax-this.texXmin)/(w-_),this.computedHeight*=(this.texYmax-this.texYmin)/(U-v),this.anchorX*=d/this.computedWidth,this.anchorY*=h/this.computedHeight}};function xr(e,t=1e-7){let r=Math.ceil(e);return r-e<t?r:Math.floor(e)}function yr(e,t=1e-7){let r=Math.floor(e);return e-r<t?r:Math.ceil(e)}var ui=3.14159265359/180,hi=128/Math.PI;function mi(e,t){return e%=t,Math.abs(e>=0?e:e+t)}function fi(e){return mi(e*hi,256)}function di(e,t,r,i,s=!1){let o=ve(),n=s?1:-1;return Pe(o),(t||r)&&Te(o,o,[t,-r]),i&&be(o,o,n*ui*-i),o}var xi={createComputedParams:e=>Nt.from(e),optionalAttributes:{zoomRange:{type:p.SHORT,count:2,packPrecisionFactor:Y,pack:({scaleInfo:e},{tileInfo:t})=>D(e,t)}},attributes:{pos:{type:p.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:p.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.UNSIGNED_BYTE,count:1,pack:({sprite:e,alignment:t,scaleSymbolsProportionally:r,overrideOutlineColor:i,colorLocked:s})=>{let o=0;return e.sdf&&(o|=C(tt.bitset.isSDF)),t===St.MAP&&(o|=C(tt.bitset.isMapAligned)),r&&(o|=C(tt.bitset.scaleSymbolsProportionally)),i&&(o|=C(tt.bitset.overrideOutlineColor)),s&&(o|=C(tt.bitset.colorLocked)),o}},offset:{type:p.HALF_FLOAT,count:2,packAlternating:{count:4,pack:({angle:e,computedWidth:t,computedHeight:r,anchorX:i,anchorY:s,offsetX:o,offsetY:n,rotateClockwise:a})=>{let c=di(0,o,n,-e,a),u=-(.5+i)*t,l=-(.5-s)*r,f=[u,l],d=[u+t,l],h=[u,l+r],m=[u+t,l+r];return at(f,f,c),at(d,d,c),at(h,h,c),at(m,m,c),[f,d,h,m]}}},textureUV:{type:p.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:e,texXmin:t,texYmax:r,texYmin:i})=>[[t,i],[e,i],[t,r],[e,r]]}},color:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>M(e)},outlineColor:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>M(e)},sizing:{type:p.UNSIGNED_BYTE,count:4,pack:({rawWidth:e,rawHeight:t,outlineSize:r,referenceSize:i})=>{let s=Math.max(e,t);return[Dt(s,128),Dt(r,128),Dt(i,128),0]}},placementAngle:{type:p.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:e})=>fi(e)},sdfDecodeCoeff:{type:p.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sdfDecodeCoeff:e})=>e}}},gr=class extends T{constructor(){super(...arguments),this.vertexSpec=xi}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(t,r,i){let s=this.evaluatedMeshParams.sprite?.textureBinding,o=r.getDisplayId();t.recordStart(this.instanceId,this.attributeLayout,s);let n=this.evaluatedMeshParams.minPixelBuffer,a=Math.max(this.evaluatedMeshParams.computedWidth,n),c=Math.max(this.evaluatedMeshParams.computedHeight,n),u=-this.evaluatedMeshParams.anchorX*this.evaluatedMeshParams.computedWidth,l=this.evaluatedMeshParams.anchorY*this.evaluatedMeshParams.computedHeight,f=this.evaluatedMeshParams.offsetX+u,d=-this.evaluatedMeshParams.offsetY+l;if(this.evaluatedMeshParams.placement!=null)this._writePlacedMarkers(t,r,i,a,c);else if(i?.nextPath()){i.nextPoint();let h=i.x,m=i.y;t.recordBounds(h+f,m+d,a,c),this._writeQuad(t,o,h,m)}else if(r.geometryType==="esriGeometryPolygon"){let h=r.readCentroidForDisplay();if(!h)return;let[m,y]=h.coords;t.recordBounds(m+f,y+d,a,c),this._writeQuad(t,o,m,y)}else if(r.geometryType==="esriGeometryPoint"){let h=r.readXForDisplay(),m=r.readYForDisplay();t.recordBounds(h+f,m+d,a,c),this._writeQuad(t,o,h,m)}else r.readGeometryForDisplay()?.forEachVertex((m,y)=>{t.recordBounds(m+f,y+d,a,c),Math.abs(m)>1024||Math.abs(y)>1024||this._writeQuad(t,o,m,y)});t.recordEnd()}_writePlacedMarkers(t,r,i,s,o){let n=i??k.fromFeatureSetReaderCIM(r)?.clone();if(!n)return;let a=-1,c=nt.getPlacement(n,a,this.evaluatedMeshParams.placement,x(1),t.id,it());if(!c)return;let u=r.getDisplayId(),l=c.next(),f=this.evaluatedMeshParams.offsetX,d=-this.evaluatedMeshParams.offsetY;for(;l!=null;){let h=l.tx,m=-l.ty;if(Math.abs(h)>1024||Math.abs(m)>1024){l=c.next();continue}let y=-l.getAngle();t.recordBounds(h+f,m+d,s,o),this._writeQuad(t,u,h,m,y),l=c.next()}}_writeQuad(t,r,i,s,o){let n=t.vertexCount(),a=o==null?null:{placementAngle:o};this._writeVertex(t,r,i,s,a),t.indexWrite(n+0),t.indexWrite(n+1),t.indexWrite(n+2),t.indexWrite(n+1),t.indexWrite(n+3),t.indexWrite(n+2)}};var yi={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:p.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:p.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.UNSIGNED_BYTE,count:1,pack:e=>0},offset:{type:p.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:e})=>{let t=x(e),r=-t/2,i=-t/2;return[[r,i],[r+t,i],[r,i+t],[r+t,i+t]]}}},texCoords:{type:p.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:p.UNSIGNED_BYTE,count:2,pack:({size:e})=>[e,e]},referenceSize:{type:p.UNSIGNED_BYTE,count:1,pack:({size:e})=>x(e)},zoomRange:{type:p.UNSIGNED_BYTE,count:2,pack:({scaleInfo:e},{tileInfo:t})=>D(e,t)}}},_r=class extends T{constructor(){super(...arguments),this.vertexSpec=yi}_write(t,r){let i=r.getDisplayId(),s=this.evaluatedMeshParams.minPixelBuffer,o=Math.max(x(this.evaluatedMeshParams.size),s),n,a;if(r.geometryType==="esriGeometryPoint")n=r.readXForDisplay(),a=r.readYForDisplay();else{let u=r.readCentroidForDisplay();if(!u)return;n=u?.coords[0],a=u?.coords[1]}t.recordStart(this.instanceId,this.attributeLayout),t.recordBounds(n,a,o,o);let c=t.vertexCount();this._writeVertex(t,i,n,a),t.indexWrite(c+0),t.indexWrite(c+1),t.indexWrite(c+2),t.indexWrite(c+1),t.indexWrite(c+3),t.indexWrite(c+2),t.recordEnd()}};export{D as a,C as b,M as c,Lt as d,T as e,tr as f,st as g,It as h,ir as i,R as j,ot as k,or as l,ar as m,cr as n,lr as o,ei as p,mr as q,fr as r,dr as s,gr as t,_r as u};
