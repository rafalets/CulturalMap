import{a as T}from"./chunk-PWU2QHPV.js";import{a as R}from"./chunk-6JJCXUHW.js";import{a as k}from"./chunk-J5MXC6AL.js";import{r as D}from"./chunk-HHDFN2GK.js";var y,m;function N(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function S(e){return e!=null&&!isNaN(e)&&isFinite(e)}function q(e){return e.valueExpression?y.Expression:e.field&&typeof e.field=="string"?y.Field:y.Unknown}function K(e,t){let n=t||q(e),a=e.valueUnit||"unknown";return n===y.Unknown?m.Constant:e.stops?m.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?m.ClampedLinear:a==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?m.Proportional:m.Additive:m.Identity:m.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(y||(y={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(m||(m={}));var U=()=>D.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),g=e=>U().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),w=()=>U().error("Use of arcade expressions requires an arcade context"),M=new T,z=Math.PI,ie=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function A(e,t,n){let a="visualVariables"in e&&e.visualVariables?e.visualVariables.find(c=>c.type==="color"):e;if(!a)return;if(a.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void g("ColorVariable");let r=typeof t=="number",i=r?null:t,s=i?.attributes,o=r?t:null,l=a.field,{ipData:p,hasExpression:v}=a.cache,u=a.cache.compiledFunc;if(!l&&!v){let c=a.stops;return c&&c[0]&&c[0].color}if(typeof o!="number")if(v){if(n?.arcade==null)return void w();let c={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},d=n.arcade.arcadeUtils,h=d.getViewInfo(c),x=d.createExecContext(i,h,n.timeZone);if(!u){let F=d.createSyntaxTree(a.valueExpression);u=d.createFunction(F),a.cache.compiledFunc=u}o=d.executeFunction(u,x)}else s&&(o=s[l]);let f=a.normalizationField,b=s!=null&&f!=null?parseFloat(s[f]):void 0;if(o!=null&&(!f||r||!isNaN(b)&&b!==0)){isNaN(b)||r||(o/=b);let c=C(o,p);if(c){let d=c[0],h=c[1],x=d===h?a.stops[d].color:k.blendColors(a.stops[d].color,a.stops[h].color,c[2],n?.color);return new k(x)}}}function L(e,t,n){let a="visualVariables"in e&&e.visualVariables?e.visualVariables.find(c=>c.type==="opacity"):e;if(!a)return;if(a.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void g("OpacityVariable");let r=typeof t=="number",i=r?null:t,s=i?.attributes,o=r?t:null,l=a.field,{ipData:p,hasExpression:v}=a.cache,u=a.cache.compiledFunc;if(!l&&!v){let c=a.stops;return c&&c[0]&&c[0].opacity}if(typeof o!="number")if(v){if(n?.arcade==null)return void w();let c={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},d=n.arcade.arcadeUtils,h=d.getViewInfo(c),x=d.createExecContext(i,h,n.timeZone);if(!u){let F=d.createSyntaxTree(a.valueExpression);u=d.createFunction(F),a.cache.compiledFunc=u}o=d.executeFunction(u,x)}else s&&(o=s[l]);let f=a.normalizationField,b=s!=null&&f!=null?parseFloat(s[f]):void 0;if(o!=null&&(!f||r||!isNaN(b)&&b!==0)){isNaN(b)||r||(o/=b);let c=C(o,p);if(c){let d=c[0],h=c[1];if(d===h)return a.stops[d].opacity;{let x=a.stops[d].opacity;return x+(a.stops[h].opacity-x)*c[2]}}}}function O(e,t,n){let a="visualVariables"in e&&e.visualVariables?e.visualVariables.find(b=>b.type==="rotation"):e;if(!a)return;if(a.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void g("RotationVariable");let r=a.axis||"heading",i=r==="heading"&&a.rotationType==="arithmetic"?90:0,s=r==="heading"&&a.rotationType==="arithmetic"?-1:1,o=typeof t=="number"?null:t,l=o?.attributes,p=a.field,{hasExpression:v}=a.cache,u=a.cache.compiledFunc,f=0;if(!p&&!v)return f;if(v){if(n?.arcade==null)return void w();let b={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},c=n.arcade.arcadeUtils,d=c.getViewInfo(b),h=c.createExecContext(o,d,n.timeZone);if(!u){let x=c.createSyntaxTree(a.valueExpression);u=c.createFunction(x),a.cache.compiledFunc=u}f=c.executeFunction(u,h)}else l&&(f=l[p]||0);return f=typeof f!="number"||isNaN(f)?null:i+s*f,f}function P(e,t,n){let a=typeof t=="number",r=a?null:t,i=r?.attributes,s=a?t:null,{isScaleDriven:o}=e.cache,l=e.cache.compiledFunc;if(o){let v=n?.scale,u=n?.view;s=v==null||u==="3d"?Z(e):v}else if(!a)switch(e.inputValueType){case y.Expression:{if(n?.arcade==null)return void w();let v={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},u=n.arcade.arcadeUtils,f=u.getViewInfo(v),b=u.createExecContext(r,f,n.timeZone);if(!l){let c=u.createSyntaxTree(e.valueExpression);l=u.createFunction(c),e.cache.compiledFunc=l}s=u.executeFunction(l,b);break}case y.Field:i&&(s=i[e.field]);break;case y.Unknown:s=null}if(!S(s))return null;if(a||!e.normalizationField)return s;let p=i?parseFloat(i[e.normalizationField]):null;return S(p)&&p!==0?s/p:null}function Z(e){let t=null,n=null,a=e.stops;return a?(t=a[0].value,n=a[a.length-1].value):(t=e.minDataValue||0,n=e.maxDataValue||0),(t+n)/2}function E(e,t,n){let a="visualVariables"in e&&e.visualVariables?e.visualVariables.find(i=>i.type==="size"):e;if(!a)return;if(a.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void g("SizeVariable");let r=J(P(a,t,n),a,t,n,a.cache.ipData);return r==null||isNaN(r)?0:r}function V(e,t,n){return e==null?null:N(e)?E(e,t,n):S(e)?e:null}function I(e,t,n){return S(n)&&e>n?n:S(t)&&e<t?t:e}function W(e,t,n,a){return e+((V(t.minSize,n,a)||t.minDataValue)??0)}function $(e,t,n){let a=e.stops,r=a?.length&&a[0].size;return r==null&&(r=e.minSize),V(r,t,n)}function B(e,t,n,a){let r=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),i=V(t.minSize,n,a),s=V(t.maxSize,n,a),o=a?.shape;if(e<=t.minDataValue)return i;if(e>=t.maxDataValue)return s;if(i==null||s==null)return null;if(t.scaleBy==="area"&&o){let l=o==="circle",p=l?z*(i/2)**2:i*i,v=p+r*((l?z*(s/2)**2:s*s)-p);return l?2*Math.sqrt(v/z):Math.sqrt(v)}return i+r*(s-i)}function j(e,t,n,a){let r=a?.shape,i=e/t.minDataValue,s=V(t.minSize,n,a),o=V(t.maxSize,n,a),l=null;return l=r==="circle"?2*Math.sqrt(i*(s/2)**2):r==="square"||r==="diamond"||r==="image"?Math.sqrt(i*s**2):i*s,I(l,s,o)}function G(e,t,n,a,r){let[i,s,o]=C(e,r);if(i===s)return V(t.stops?.[i].size,n,a);{let l=V(t.stops?.[i].size,n,a);return l+(V(t.stops?.[s].size,n,a)-l)*o}}function H(e,t,n,a){let r=(a?.resolution??1)*R[t.valueUnit],i=V(t.minSize,n,a),s=V(t.maxSize,n,a),{valueRepresentation:o}=t,l=null;return l=o==="area"?2*Math.sqrt(e/z)/r:o==="radius"||o==="distance"?2*e/r:e/r,I(l,i,s)}function J(e,t,n,a,r){switch(t.transformationType){case m.Additive:return W(e,t,n,a);case m.Constant:return $(t,n,a);case m.ClampedLinear:return B(e,t,n,a);case m.Proportional:return j(e,t,n,a);case m.Stops:return G(e,t,n,a,r);case m.RealWorldSize:return H(e,t,n,a);case m.Identity:return e;case m.Unknown:return null}}function re(e,t,n){let{isScaleDriven:a}=e.cache;if(!(a&&n==="3d"||t))return null;let r={scale:t,view:n},i=V(e.minSize,M,r),s=V(e.maxSize,M,r);if(i!=null||s!=null){if(i>s){let o=s;s=i,i=o}return{minSize:i,maxSize:s}}}function le(e,t,n){if(!e.visualVariables)return;let a=[],r=[],i=[],s=[],o=[];for(let l of e.visualVariables)switch(l.type){case"color":r.push(l);break;case"opacity":i.push(l);break;case"rotation":o.push(l);break;case"size":s.push(l)}return r.forEach(l=>{let p=A(l,t,n);a.push({variable:l,value:p})}),i.forEach(l=>{let p=L(l,t,n);a.push({variable:l,value:p})}),o.forEach(l=>{let p=O(l,t,n);a.push({variable:l,value:p})}),s.forEach(l=>{let p=E(l,t,n);a.push({variable:l,value:p})}),a.filter(l=>l.value!=null)}function C(e,t){if(!t)return;let n=0,a=t.length-1;return t.some((r,i)=>e<r?(a=i,!0):(n=i,!1)),[n,a,(e-t[n])/(t[a]-t[n])]}function se(e,t,n){let a=["proportional","proportional","proportional"];for(let r of e){let i=r.useSymbolValue?"symbol-value":E(r,t,n);switch(r.axis){case"width":a[0]=i;break;case"depth":a[1]=i;break;case"height":a[2]=i;break;case"width-and-depth":a[0]=i,a[1]=i;break;case"all":case void 0:case null:a[0]=i,a[1]=i,a[2]=i;break;default:r.axis}}return a}export{m as a,N as b,q as c,K as d,ie as e,A as f,L as g,O as h,E as i,V as j,J as k,re as l,le as m,se as n};
