import{b as Cr}from"./chunk-OI2D6VTT.js";import{b as L,d as _,g as M,i as J}from"./chunk-XIZXEWWA.js";import{a as Nr,b as K}from"./chunk-EDAGF7R6.js";import{b as d}from"./chunk-6EWMYOA7.js";import{b as Er,f as Rr}from"./chunk-IDLNQPT7.js";import{c as R,k as C}from"./chunk-B57IWIA2.js";import{a as z}from"./chunk-NOQEJXLK.js";import{a as H,q as v}from"./chunk-DJW5LMRG.js";import{a as S,d as I}from"./chunk-ALWV3RJ2.js";import{a as V}from"./chunk-7C6Z24SS.js";import{e as Pr,r as Y,t as yr,x as Fr,y as W}from"./chunk-5WKDXHVH.js";import{B as Ar,a as gr,f as O,g as U,i as $}from"./chunk-7B2UKJ5N.js";import{a as h}from"./chunk-NHSDW26F.js";import{g as k}from"./chunk-NMAGYK3Q.js";import{e as Tr}from"./chunk-NTVLK3P2.js";import{f as ar,o as ir,r as q}from"./chunk-VOFKUGRY.js";import{B as ur,D as fr,U as mr,ka as pr,u as lr,x as cr}from"./chunk-IG66NQHW.js";import{a as sr}from"./chunk-ARRCN5K3.js";import{r as er}from"./chunk-HHDFN2GK.js";var ct="Projection may be possible after calling projection.load().";function A(r,t,n,e){r.error(`Failed to project from (wkid:${t.wkid}) to (wkid:${n.wkid}).${e?" ":""}${e}`)}function Or(r,t,n,e,o,i){return B(N.TO_PCPF,R.fromTypedArray(r),T.NORMAL,C.fromTypedArray(t),n,C.fromTypedArray(e),o,R.fromTypedArray(i))?i:null}function Sr(r,t,n,e,o,i){return B(N.FROM_PCPF,R.fromTypedArray(r),T.NORMAL,C.fromTypedArray(t),n,C.fromTypedArray(e),o,R.fromTypedArray(i))?i:null}function Mr(r,t,n,e){return k(r,t,0,n,e,0)?n:null}function hr(r,t,n,e){return k(r,t,0,n,e,0)?n:null}function Q(r,t,n){return v(m,n),_(t,r,m),q(m)&&J(t,t),t}function X(r,t,n){return H(m,n),Cr(t,r,m),q(m)&&J(t,t,4),t}function ut(r,t,n,e){let o=t===T.NORMAL;return vr(r,t,n,(i,a)=>{let s=Math.cos(ar(i));a[0]=o?s:1/s,a[1]=1},e)}function ft(r,t,n,e){let o=t===T.NORMAL;return vr(r,t,n,(i,a)=>{let s=Math.cosh(-i/sr.radius);a[0]=1,a[1]=o?s:1/s},e)}function vr(r,t,n,e,o){let i=t===T.NORMAL?3:4,a=[0,0];for(let s=0,u=1;s<r.length;s+=i,u+=3){e(n[u],a);let l=r[s]*a[0],f=r[s+1]*a[1],c=r[s+2],P=1/Math.sqrt(l*l+f*f+c*c);o[s]=l*P,o[s+1]=f*P,o[s+2]=c*P,i===4&&(o[s+3]=r[s+3])}return o}function _r(r,t,n,e,o,i){if(!B(N.TO_PCPF,R.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),T.TANGENT,C.fromTypedArray(t),n,C.fromTypedArray(e),o,R.fromTypedArray(i,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let a=3;a<r.length;a+=4)i[a]=r[a];return i}function xr(r,t,n,e,o,i){if(!B(N.FROM_PCPF,R.fromTypedArray(r,16),T.TANGENT,C.fromTypedArray(t),n,C.fromTypedArray(e),o,R.fromTypedArray(i,16)))return null;for(let a=3;a<r.length;a+=4)i[a]=r[a];return i}var T,N;function dr(r,t,n,e,o){switch(d(e,n,x,e),r===N.FROM_PCPF&&O(x,x),t){case T.NORMAL:return v(o,x);case T.TANGENT:return H(o,x)}}function B(r,t,n,e,o,i,a,s){if(!t)return;let u=e.count;if(Ur(o))for(let l=0;l<u;l++)i.getVec(l,b),t.getVec(l,F),W(F,F,dr(r,n,b,a,m)),s.setVec(l,F);else for(let l=0;l<u;l++){i.getVec(l,b),t.getVec(l,F);let f=Tr(e.get(l,1)),c=Math.cos(f);n===T.TANGENT!=(r===N.TO_PCPF)&&(c=1/c),dr(r,n,b,a,m),r===N.TO_PCPF?(m[0]*=c,m[1]*=c,m[2]*=c,m[3]*=c,m[4]*=c,m[5]*=c):(m[0]*=c,m[3]*=c,m[6]*=c,m[1]*=c,m[4]*=c,m[7]*=c),W(F,F,m),yr(F,F),s.setVec(l,F)}return s}function Ur(r){return r.isWGS84||cr(r)||ur(r)||fr(r)}(function(r){r[r.NORMAL=0]="NORMAL",r[r.TANGENT=1]="TANGENT"})(T||(T={})),function(r){r[r.TO_PCPF=0]="TO_PCPF",r[r.FROM_PCPF=1]="FROM_PCPF"}(N||(N={}));var b=h(),F=h(),x=S(),m=V();var g=()=>er.getLogger("esri.geometry.support.meshUtils.vertexSpaceConversion");function vt(r,t,{vertexSpace:n,spatialReference:e}){if(n.type==="georeferenced"){let l=r;if(!z(t,l,e))return!1;let{origin:f}=n;return Pr(r,l,f),!0}let o=K(e),i=r;if(!z(t,i,o))return!1;let{origin:a}=n,s=jr;if(!d(e,a,s,o))return!1;let u=O(jr,s);return u!=null&&(Fr(r,i,u),!0)}function _t(r,t,n){let{vertexSpace:e,transform:o,vertexAttributes:i}=r,a=Er(e)?o:null,s=D(r.spatialReference,n,E.SOURCE_AND_TARGET);if(Rr(e,t)&&(!a||Ar(a.localMatrix,I))&&j(s)){let{position:u,normal:l,tangent:f}=i,c=n?.allowBufferReuse;return{position:c?u:u.slice(),normal:c?l:l?.slice(),tangent:c?f:f?.slice()}}switch(r.vertexSpace.type){case"local":return t.type==="local"?Dr(r,r.vertexSpace,t.origin,n):Lr(r,r.vertexSpace,t.origin,n);case"georeferenced":return t.type==="local"?br(r,r.vertexSpace,t.origin,n):Vr(r,r.vertexSpace,t.origin,n)}}function Vr({vertexAttributes:r,transform:t,spatialReference:n},{origin:e},o,i){let a=D(n,i,E.SOURCE_AND_TARGET),s=e||!j(a)?gr(p,t?.localMatrix??I):null;s&&tr(s,n,i,E.SOURCE_AND_TARGET);let{position:u,normal:l,tangent:f}=s?rr(r,s):r,c=i?.allowBufferReuse,P=c?u:new Float64Array(u.length),y=u;if(e&&(y=M(P,y,e)),o){let G=Y(Gr,o);y=M(P,y,G)}return{position:y!==r.position||c?y:y.slice(),normal:l!==r.normal||c?l:l?.slice(),tangent:f!==r.tangent||c?f:f?.slice()}}function Z(r,t){return t?.useEllipsoid&&lr(r)?Nr:K(r)}function Lr({spatialReference:r,vertexAttributes:t,transform:n},{origin:e},o,i){let a=Z(r,i);if(!d(r,e,p,a))return A(g(),r,a),null;n&&U(p,p,n.localMatrix),tr(p,r,i,E.SOURCE);let s=new Float64Array(t.position.length),u=qr(t.position,p,r,s,a);if(!u)return null;let l=kr(u,r,s,a,t.normal,p);if(t.normal&&!l)return null;let f=$r(u,r,s,a,t.tangent,p);if(t.tangent&&!f)return null;if(o){let c=Y(Gr,o);M(u,u,c)}return{position:u,normal:l,tangent:f}}function br({vertexAttributes:r,spatialReference:t,transform:n},{origin:e},o,i){let a=Z(t,i);if(!d(t,o,p,a))return A(g(),t,a),null;let s=1/D(t,i,E.TARGET);$(p,p,[s,s,s]);let u=O(w,p),{position:l,normal:f,tangent:c}=Br(r,e,n),P=new Float64Array(l.length),y=Yr(l,t,u,P,a);if(!y)return null;let G=v(zr,u),nr=Wr(f,l,t,P,a,G,f!==r.normal?f:void 0);if(!nr&&f)return null;let or=Ir(c,l,t,P,a,G,c!==r.tangent?c:void 0);return!or&&c?null:{position:y,normal:nr,tangent:or}}function Br(r,t,n){if(!t)return r;if(!n){let{position:o,normal:i,tangent:a}=r;return{position:M(new Float64Array(o.length),o,t),tangent:a,normal:i}}let e=rr(r,n.localMatrix);return M(e.position,e.position,t),e}function Dr({vertexAttributes:r,spatialReference:t,transform:n},{origin:e},o,i){let a=Z(t,i);if(!d(t,e,p,a))return A(g(),t,a),null;if(n&&U(p,p,n.localMatrix),!d(t,o,w,a))return A(g(),a,t),null;O(w,w);let s=U(p,w,p);return tr(s,t,i,E.SOURCE_AND_TARGET),rr(r,s)}function rr(r,t){let n=new Float64Array(r.position.length);L(n,r.position,t);let e=r.normal?new Float32Array(r.normal.length):null,o=r.tangent?new Float32Array(r.tangent.length):null;return e&&r.normal&&Q(r.normal,e,t),o&&r.tangent&&X(r.tangent,o,t),{position:n,normal:e,tangent:o}}function qr(r,t,n,e,o){L(e,r,t);let i=new Float64Array(r.length);return hr(e,o,i,n)?i:(A(g(),o,n),null)}function kr(r,t,n,e,o,i){if(o==null)return null;let a=new Float32Array(o.length);return Q(o,a,i),Sr(a,r,t,n,e,a)?a:(A(g(),e,t),null)}function $r(r,t,n,e,o,i){if(o==null)return null;let a=new Float32Array(o.length);return X(o,a,i),xr(a,r,t,n,e,a)?a:(A(g(),e,t),null)}function tr(r,t,n,e){let o=D(t,n,e);j(o)||$(r,r,[o,o,o])}function D(r,t,n){let e=!!(n&E.SOURCE),o=!!(n&E.TARGET),i=t?.sourceUnit,a=t?.targetUnit;if(!i&&!a)return 1;let s=wr(i,r);e||!i||j(s)||(g().warn("source unit conversion not supported"),s=1);let u=1/wr(a,r);return o||!a||j(u)||(g().warn("target unit conversion not supported"),u=1),s*u}function j(r){return ir(r,1)}function Yr(r,t,n,e,o){let i=Mr(r,t,e,o);if(!i)return A(g(),t,o),null;let a=new Float64Array(i.length);return L(a,i,n),a}function Wr(r,t,n,e,o,i,a){if(r==null)return null;let s=a??new Float32Array(r.length);return Or(r,t,n,e,o,s)?(_(s,s,i),s):(A(g(),n,o),null)}function Ir(r,t,n,e,o,i,a){if(r==null)return null;let s=a??new Float32Array(r.length);return _r(r,t,n,e,o,s)?(_(s,s,i,4),s):(A(g(),n,o),null)}function wr(r,t){if(r==null)return 1;let n=pr(t);return 1/mr(n,"meters",r)}var p=S(),w=S(),zr=V(),Gr=h(),jr=S(),E;(function(r){r[r.NONE=0]="NONE",r[r.SOURCE=1]="SOURCE",r[r.TARGET=2]="TARGET",r[r.SOURCE_AND_TARGET=3]="SOURCE_AND_TARGET"})(E||(E={}));export{ct as a,A as b,Or as c,Sr as d,Mr as e,hr as f,Q as g,X as h,ut as i,ft as j,_r as k,xr as l,T as m,vt as n,_t as o,wr as p};
