import{j as _}from"./chunk-FWCA6KJ3.js";import{f as v}from"./chunk-A7C26EZ4.js";import"./chunk-AZKP3OCM.js";import"./chunk-S52JRLJC.js";import"./chunk-W5OI4BJ2.js";import"./chunk-DBZKWPEX.js";import"./chunk-AYSSTKZP.js";import{a as y,d as j,f as P}from"./chunk-PSIELDY2.js";import"./chunk-RWCIDBNQ.js";import"./chunk-2NH7HOKA.js";import"./chunk-Y7MZCJ2F.js";import"./chunk-TKZJUAKL.js";import"./chunk-B57IWIA2.js";import{g as L,p as l}from"./chunk-3BZAI7HK.js";import"./chunk-LNYBTIG7.js";import"./chunk-HM5RIVQC.js";import"./chunk-SKMO433W.js";import"./chunk-2FO7ARYZ.js";import"./chunk-DJW5LMRG.js";import"./chunk-QXXXCEV5.js";import"./chunk-TCGGI7DC.js";import"./chunk-ALWV3RJ2.js";import"./chunk-7C6Z24SS.js";import{d as h,n as f,o as g}from"./chunk-5WKDXHVH.js";import"./chunk-PTZYZULI.js";import"./chunk-KZKWOEFD.js";import"./chunk-7B2UKJ5N.js";import"./chunk-RSDQHAJX.js";import{a as c,b as p}from"./chunk-NHSDW26F.js";import"./chunk-BCREO4Q5.js";import"./chunk-VOFKUGRY.js";import{H as x}from"./chunk-WMHJC7XF.js";import"./chunk-OVHPPCBL.js";import"./chunk-FNXQZPHT.js";import"./chunk-3TQOUBNU.js";import{u as w}from"./chunk-D2LVMNOU.js";import{a as E}from"./chunk-QGVBCWUY.js";import"./chunk-HHDFN2GK.js";import"./chunk-47GHT6OF.js";import{f as u}from"./chunk-VTHXE323.js";var I=1e3;function S(t,s,o){let n=L(),e=n;return f(e,e,t,.5),f(e,e,s,.5),n[3]=g(e,t),h(e,e,o),n}var b=class{constructor(){this._idToComponent=new Map,this._components=new _(t=>t.bounds),this._edges=new _(t=>t.bounds),this._tmpLineSegment=y(),this._tmpP1=c(),this._tmpP2=c(),this._tmpP3=c(),this.remoteClient=null}fetchCandidates(t,s){return u(this,null,function*(){yield Promise.resolve(),w(s),yield this._ensureEdgeLocations(t,s);let o=[];return this._edges.forEachNeighbor(n=>(this._addCandidates(t,n,o),o.length<I),t.bounds),{result:{candidates:o}}})}_ensureEdgeLocations(t,s){return u(this,null,function*(){let o=[];if(this._components.forEachNeighbor(i=>{if(i.info==null){let{id:a,uid:r}=i;o.push({id:a,uid:r})}return!0},t.bounds),!o.length)return;let n={components:o},e=yield this.remoteClient.invoke("fetchAllEdgeLocations",n,s??{});for(let i of e.components)this._setFetchEdgeLocations(i)})}add(t){return u(this,null,function*(){let s=new A(t.id,t.bounds);return this._idToComponent.set(s.id,s),this._components.add([s]),{result:{}}})}remove(t){return u(this,null,function*(){let s=this._idToComponent.get(t.id);if(s){let o=[];this._edges.forEachNeighbor(n=>(n.component===s&&o.push(n),!0),s.bounds),this._edges.remove(o),this._components.remove([s]),this._idToComponent.delete(s.id)}return{result:{}}})}_setFetchEdgeLocations(t){let s=this._idToComponent.get(t.id);if(s==null||t.uid!==s.uid)return;let o=v.createView(t.locations),n=new Array(o.count),e=c(),i=c();for(let d=0;d<o.count;d++){o.position0.getVec(d,e),o.position1.getVec(d,i);let m=S(e,i,t.origin),T=new C(s,d,m);n[d]=T}this._edges.add(n);let{objectIds:a,origin:r}=t;s.info={locations:o,objectIds:a,origin:r}}_addCandidates(t,s,o){let{info:n}=s.component,{origin:e,objectIds:i}=n,a=n.locations,r=a.position0.getVec(s.index,this._tmpP1),d=a.position1.getVec(s.index,this._tmpP2);h(r,r,e),h(d,d,e);let m=i[a.componentIndex.get(s.index)];this._addEdgeCandidate(t,m,r,d,o),V(t,m,r,o),V(t,m,d,o)}_addEdgeCandidate(t,s,o,n,e){if(!t.returnEdge)return;let i=t.bounds,a=j(o,n,this._tmpLineSegment),r=P(a,i,this._tmpP3);l(t.bounds,r)&&e.push({type:"edge",objectId:s,target:p(r),distance:g(i,r),start:p(o),end:p(n)})}};b=E([x("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],b);var Y=b;function V(t,s,o,n){if(!t.returnVertex||!l(t.bounds,o))return;let e=t.bounds;n.push({type:"vertex",objectId:s,target:p(o),distance:g(e,o)})}var A=(()=>{class t{constructor(o,n){this.id=o,this.bounds=n,this.info=null,this.uid=++t.uid}}return t.uid=0,t})(),C=class{constructor(s,o,n){this.component=s,this.index=o,this.bounds=n}};export{Y as default};
