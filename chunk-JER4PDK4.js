import{A as Xe,B as te,e as He,k as Ze,n as $e,s as ee,t as We,u as Je,v as U,y as Qe}from"./chunk-TBX4IK4K.js";import{b as Te,c as De,d as je,e as Ge}from"./chunk-EISGDP6C.js";import{B as qe,f as Me,h as N,m as Ne,n as Ue,o as Ve,p as Be,r as ze,u as K,v as ke}from"./chunk-G3YWARR2.js";import{b as Re}from"./chunk-4MCLOZGW.js";import{o as A,u as M}from"./chunk-3D4Y6BLC.js";import{a as Y,b as Ae}from"./chunk-45BQJH7U.js";import{a as w}from"./chunk-RWCIDBNQ.js";import{f as Q}from"./chunk-ONYJLWAD.js";import{b as J}from"./chunk-6EWMYOA7.js";import{a as X}from"./chunk-NIYDRLW4.js";import{a as G}from"./chunk-NOQEJXLK.js";import{a as W}from"./chunk-ALWV3RJ2.js";import{b as Ie,c as Z,d as we,x as $}from"./chunk-5WKDXHVH.js";import{m as H}from"./chunk-SU5S5XU7.js";import{c as Fe,f as Le}from"./chunk-PTZYZULI.js";import{a as D}from"./chunk-7B2UKJ5N.js";import{i as xe}from"./chunk-JR22Z7I2.js";import{A as Pe,B as Oe,D as _e,I as Se,d as be,t as fe,v as ge,x as ve}from"./chunk-TRZXSDYA.js";import{a as j}from"./chunk-J5MXC6AL.js";import{a as v,i as Ee}from"./chunk-NHSDW26F.js";import{g as Ce}from"./chunk-NMAGYK3Q.js";import{g as me,h as he,k as ye}from"./chunk-E62WHYYG.js";import{C as pe,l as de}from"./chunk-D2LVMNOU.js";import{r as ue}from"./chunk-HHDFN2GK.js";import{a as le,b as ce,f as I}from"./chunk-VTHXE323.js";var R=class{constructor(e,t){this.renderer=e,this.symbol=t}};function dt(r,e){if(r.symbol!=null)return r.symbol;let t=e?.renderer;return t!=null&&t.type!=="dot-density"?t.getSymbol(r,e):null}function wt(r,e){let t=dt(r,e);if(t==null)return null;let a=e?.renderer,s=new R(a,t);if(a==null||!("visualVariables"in a)||!a.visualVariables)return s;let i=H(a,r,e)??[],o=["proportional","proportional","proportional"];for(let{variable:n,value:u}of i)switch(n.type){case"color":s.color=u.toRgba();break;case"size":if(n.target==="outline")s.outlineSize=u;else{let l=n.axis,c=n.useSymbolValue?"symbol-value":u;switch(l){case"width":o[0]=c;break;case"depth":o[1]=c;break;case"height":o[2]=c;break;case"width-and-depth":o[0]=o[1]=c;break;default:o[0]=o[1]=o[2]=c}}break;case"opacity":s.opacity=u;break;case"rotation":switch(n.axis){case"tilt":s.tilt=u;break;case"roll":s.roll=u;break;default:s.heading=u}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}function pt(r,e){return I(this,null,function*(){return r.symbol!=null?r.symbol:e?.renderer?.getSymbolAsync(r,e)??null})}function At(r,e){return I(this,null,function*(){let t=yield pt(r,e);if(!t)return null;let a=e?.renderer,s=new R(a,t);if(!a||!("visualVariables"in a)||!a.visualVariables)return s;let i=H(a,r,e)??[],o=["proportional","proportional","proportional"];for(let{variable:n,value:u}of i)if(n.type==="color")s.color=j.toUnitRGBA(u);else if(n.type==="size")if(n.target==="outline")s.outlineSize=u;else{let l=n.axis,c=n.useSymbolValue?"symbol-value":u;l==="width"?o[0]=c:l==="depth"?o[1]=c:l==="height"?o[2]=c:o[0]=o[1]=l==="width-and-depth"?c:o[2]=c}else n.type==="opacity"?s.opacity=u:n.type==="rotation"&&n.axis==="tilt"?s.tilt=u:n.type==="rotation"&&n.axis==="roll"?s.roll=u:n.type==="rotation"&&(s.heading=u);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s})}function Rt(r,e=0){let t=r[e];return typeof t=="number"&&isFinite(t)?t:null}function Tt(r){for(let e=0;e<3;e++){let t=r[e];if(typeof t=="number")return isFinite(t)?t:0}return 0}var Mt=1.2,Nt=Le;function qt(r){switch(r){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Ye(r,e){let t=(a,s,i=!1)=>new Ge(a.map(o=>{let n=s(o.tesselation);return i&&qe(n),new je([new De(new Te(n))],o.minScreenSpaceRadius)}));switch(r){case"sphere":return t([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],a=>ze(e,.5,a,!0));case"cube":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>Ue(e,1));case"cone":return t(re,a=>K(e,1,.5,a,!1),!0);case"inverted-cone":return t(re,a=>K(e,1,.5,a,!0),!0);case"cylinder":return t(re,a=>ke(e,1,.5,a,[0,0,1],[0,0,.5]));case"tetrahedron":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>Be(e,1),!0);case"diamond":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>Ve(e,1),!0);default:return}}var re=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];var f=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new T}},x=class extends f{constructor(e){super(e),this.estimated=!0}},V=class extends f{constructor(e,t){super(t),this.numComplexities=e}},B=class extends x{constructor(e,t){super(t),this.numComplexities=e}},T=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};var bt=new x({});function tr(r){return r.type==="web-style"?bt:Ke(r.symbolLayers.toArray().map(e=>se(r,e)))}function Ke(r){let e=0,t=0,a=0,s=!1,i=0,o=new T;for(let n of r)n!=null&&(e+=n.verticesPerFeature,t+=n.verticesPerCoordinate,a+=n.drawCallsPerFeature,o.bytesPerFeature+=n.memory.bytesPerFeature,o.bytesPerFeatureLabel+=n.memory.bytesPerFeatureLabel,o.resourceBytes+=n.memory.resourceBytes,o.draped.bytesPerFeature+=n.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=n.memory.bytesPerFeatureLabel,s=s||n.estimated,++i);return s?new B(i,{verticesPerFeature:e,verticesPerCoordinate:t,drawCallsPerFeature:a,memory:o}):new V(i,{verticesPerFeature:e,verticesPerCoordinate:t,drawCallsPerFeature:a,memory:o})}function rr(r){let e=Ke(r);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}var ae={};function se(r,e){let t=ft(r,e),a=Ae(e)?2:0;switch(e.type){case"extrude":return new f({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:a,memory:t});case"fill":if(r.type==="mesh-3d")return new f({drawCallsPerFeature:a,memory:t});if(e.outline!=null&&e.outline.size>0)return new f({verticesPerFeature:-12,verticesPerCoordinate:9,memory:t});case"water":return new f({verticesPerFeature:-6,verticesPerCoordinate:3,memory:t});case"line":return new f({verticesPerFeature:-6,verticesPerCoordinate:6,memory:t});case"object":return e.resource?.href?new x({verticesPerFeature:100,memory:t}):ce(le({},gt(e.resource?.primitive??xe)),{memory:t});case"path":{let s=0,i=0;switch(e.profile){case"circle":s=10;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join){case"round":i=3;break;case"miter":case"bevel":i=1;break;default:return}let o=2*s,n=s*i*2,u=n+o,l=-2*n-o;switch(e.cap){case"none":break;case"butt":case"square":l+=2*(s-1);break;case"round":l+=2*(s*2*2+s);break;default:return}return new f({verticesPerFeature:l,verticesPerCoordinate:u,memory:t})}case"text":case"icon":return new f({verticesPerFeature:6,memory:t});default:return}}function ft(r,e){let t=r.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?h.EXTRUDE_EDGES:h.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?h.FILL_OUTLINE:h.FILL;case"water":return h.FILL;case"line":return e.join==="round"?h.LINE_ROUND:h.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return h.PATH_ROUND_CIRCLE;case"quad":return h.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return h.PATH_MITER_CIRCLE;case"quad":return h.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return t?h.OBJECT_POINT:h.OBJECT_POLYGON;case"icon":case"text":return t?h.ICON_POINT:h.ICON_POLYGON;default:return}}function gt(r){let e=ae[r];if(e)return e;let t=vt(Ye(r,new Re({},{spherical:!0,doublePrecisionRequiresObfuscation:!0})).levels);return ae[r]=new f({verticesPerFeature:t}),ae[r]}function vt(r){return r.reduce((e,t,a)=>e+t.numVertices*(1/10**a),0)/r.reduce((e,t,a)=>e+1/10**a,0)}var h={ICON_POINT:{bytesPerFeature:2346.460896195398,bytesPerFeatureLabel:3484.7516349999996,resourceBytes:0,draped:{bytesPerFeature:2007.3528529826217,bytesPerFeatureLabel:3522.702025}},ICON_POLYGON:{bytesPerFeature:3677.214053765355,bytesPerFeatureLabel:3502.5355950000003,resourceBytes:0,draped:{bytesPerFeature:3030.3700096053935,bytesPerFeatureLabel:3550.247175}},OBJECT_POINT:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992,resourceBytes:0,draped:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992}},OBJECT_POLYGON:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001,resourceBytes:0,draped:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001}},LINE_MITER:{bytesPerFeature:3252.89170349711,bytesPerFeatureLabel:3554.3931949999997,resourceBytes:0,draped:{bytesPerFeature:2843.5793737736867,bytesPerFeatureLabel:3538.2547083333334}},LINE_ROUND:{bytesPerFeature:3384.080501909172,bytesPerFeatureLabel:3522.6055950000004,resourceBytes:0,draped:{bytesPerFeature:2833.1897218657587,bytesPerFeatureLabel:3532.0680950000005}},PATH_MITER_CIRCLE:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998,resourceBytes:0,draped:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998}},PATH_ROUND_CIRCLE:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955,resourceBytes:0,draped:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955}},PATH_MITER_QUAD:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925,resourceBytes:0,draped:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925}},PATH_ROUND_QUAD:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997,resourceBytes:0,draped:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997}},FILL:{bytesPerFeature:3419.9079008788176,bytesPerFeatureLabel:3564.2132483333335,resourceBytes:0,draped:{bytesPerFeature:2910.096178654882,bytesPerFeatureLabel:3554.8655816666665}},FILL_OUTLINE:{bytesPerFeature:5018.088812445781,bytesPerFeatureLabel:3524.8219616666665,resourceBytes:0,draped:{bytesPerFeature:4278.49006198517,bytesPerFeatureLabel:3532.068368333334}},EXTRUDE:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005,resourceBytes:0,draped:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005}},EXTRUDE_EDGES:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337,resourceBytes:0,draped:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337}}};function oe(r){return r.mapPositions!=null}function vr(r,e,t,a,s){let i=r.stageObject,o=i.geometries,n=0;for(let u of o){if(!oe(u))continue;let{update:l,averageGeometrySampledElevation:c}=tt(u,e,t,a,s);n+=c,l&&i.geometryVertexAttributeUpdated(u,w.POSITION)}return n/o.length}function Pr(r,e,t,a,s,i){let o=r.stageObject,n=e.centerPointInElevationSR,u=0;o.usesVerticalDistanceToGround?(a(n,b),We(o,b.verticalDistanceToGround),u=b.sampledElevation):(a(n,b),e.mode!=="absolute-height"&&(u=b.sampledElevation));let l=D(Pt,i??o.transformation),c=Z(et,l[12],l[13],l[14]);A.TESTS_DISABLE_OPTIMIZATIONS?(y[0]=n.x,y[1]=n.y,y[2]=b.z,J(n.spatialReference,y,l,s.spatialReference)&&(i?D(i,l):o.transformation=l)):s.setAltitudeOfTransformation(b.z,l);let d=ie/s.unitInMeters;return(Math.abs(l[12]-c[0])>=d||Math.abs(l[13]-c[1])>=d||Math.abs(l[14]-c[2])>=d)&&(i?D(i,l):o.transformation=l),u}var Pt=W();function Or(r,e,t,a,s){let i=r.graphics3DSymbolLayer.lodRenderer;if(i==null)return 0;let o=e.centerPointInElevationSR;a(o,b);let n=e.mode!=="absolute-height"?b.sampledElevation:0,u=i.instanceData,l=r.instanceIndex,c=Ot;u.getGlobalTransform(l,c);let d=Z(et,c[12],c[13],c[14]);A.TESTS_DISABLE_OPTIMIZATIONS?(y[0]=o.x,y[1]=o.y,y[2]=b.z,J(o.spatialReference,y,c,s.spatialReference)&&u.setGlobalTransform(l,c)):s.setAltitudeOfTransformation(b.z,c);let m=ie/s.unitInMeters;return(A.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(c[12]-d[0])>=m||Math.abs(c[13]-d[1])>=m||Math.abs(c[14]-d[2])>=m)&&u.setGlobalTransform(l,c),n}function _r(r,e,t,a,s){let i=r.stageObject,o=i.geometries;if(o.length===0)return 0;let n=0,u=null,l=0,c=!1;for(let d of o){if(!oe(d))continue;let m=d.attributes.get(w.POSITION);if(m!==u){let{update:p,averageGeometrySampledElevation:L}=tt(d,e,t,a,s);l=L,u=m,c=p}c&&i.geometryVertexAttributeUpdated(d,w.POSITION),n+=l}return n/o.length}var ie=.01,y=v(),g=v(),F=v(),Ot=W(),et=v(),b=new Je;function tt(r,e,t,a,s){let i=!1,o=r.transformation,n=e.requiresSampledElevationInfo;g[0]=o[12],g[1]=o[13],g[2]=o[14],r.invalidateBoundingInfo();let u=r.getMutableAttribute(w.POSITION),l=u.data,c=u.size,d=l.length/c,m=new Ze(r.mapPositions,t),p=0,L=0;for(let ne=0;ne<d;ne++){if(F[0]=l[p],F[1]=l[p+1],F[2]=l[p+2],a(m,b),n&&(L+=b.sampledElevation),A.TESTS_DISABLE_OPTIMIZATIONS)l[p]=m.array[m.offset],l[p+1]=m.array[m.offset+1],l[p+2]=b.z,Ce(l,t,p,l,s.spatialReference,p,1),l[p]-=g[0],l[p+1]-=g[1],l[p+2]-=g[2],i=!0;else{y[0]=l[p]+g[0],y[1]=l[p+1]+g[1],y[2]=l[p+2]+g[2],s.setAltitude(y,b.z),l[p]=y[0]-g[0],l[p+1]=y[1]-g[1],l[p+2]=y[2]-g[2];let q=ie/s.unitInMeters;(Math.abs(F[0]-l[p])>=q||Math.abs(F[1]-l[p+1])>=q||Math.abs(F[2]-l[p+2])>=q)&&(i=!0)}p+=c,m.offset+=3}return L/=d,{update:i,averageGeometrySampledElevation:L}}var rt=class{constructor(e,t,a){this.baseMaterial=e,this.edgeMaterial=t,this.hasSlicePlane=a}},at=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,t,a,s,i,o,n,u=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=a,this._uniqueMaterials=s,this._sharedResource=i,this.elevationAligner=o,this.elevationContext=n,this._edgeState=u,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;let t=e.stage;t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){if(!this._stageLayer)return;let e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,t){let{stageObject:a,_edgeState:s,_stageLayer:i}=this;if(s==null)return;let o=st(s.baseMaterial);s.edgeMaterial.objectTransparency!==o&&(s.edgeMaterial.objectTransparency=o,this.resetEdgeObject(t)),i.stage.renderer.withEdgeView(n=>n.updateAllComponentOpacities(a,[e]))}updateHighlights(e){}slicePlaneEnabledChanged(e,t){let{stageObject:a,_edgeState:s,_stageLayer:i}=this;s!=null&&i.stage.renderer.withEdgeView(o=>{o.updateAllComponentMaterials(a,s.edgeMaterial,e,!t),s.hasSlicePlane=e})}setVisibility(e){let{_edgeState:t,stageObject:a,_stageLayer:s}=this;s!=null&&this.visible!==e&&(this._visible=e,a.visible=e,e&&!this._addedToStage&&(s.add(a),this._addedToStage=!0),t!=null&&s.stage.renderer.withEdgeView(i=>{i.hasObject(a)?i.updateObjectVisibility(a,e):e&&this._addOrUpdateEdgeObject(t,i,!1)}))}get visible(){return this._visible}alignWithElevation(e,t,a,s){if(this.elevationAligner==null)return;a!=null&&Qe(this.elevationContext.featureExpressionInfoContext,a);let i=(o,n)=>$e(o,e,this.elevationContext,t,n);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,i,t),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,t,a){let s=(i,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,t),this.resetEdgeObject(a)}getCenterObjectSpace(e=v()){return Ie(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=be()){let t=this.stageObject.boundingVolumeObjectSpace;return Pe(e,t.min),Oe(e,t.max),e}computeAttachmentOrigin(e){let t=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++;else for(let a of this.stageObject.geometries)a.computeAttachmentOrigin(P)&&($(P,P,t),we(e.render.origin,e.render.origin,P),e.render.num++)}getProjectedBoundingBox(e,t,a,s,i){return I(this,null,function*(){let o=this.getBoundingBoxObjectSpace(i),n=_t,u=Se(o)?1:n.length;for(let c=0;c<u;c++){let d=n[c];_[0]=o[d[0]],_[1]=o[d[1]],_[2]=o[d[2]],$(_,_,this.stageObject.transformation),C[3*c]=_[0],C[3*c+1]=_[1],C[3*c+2]=_[2]}if(!e(C,0,u))return null;_e(o);let l=null;this.calculateRelativeScreenBounds&&(l=this.calculateRelativeScreenBounds());for(let c=0;c<3*u;c+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],C[c+d]),o[d+3]=Math.max(o[d+3],C[c+d]);l&&a.push({location:C.slice(c,c+3),screenSpaceBoundingRect:l})}if(t?.service&&this.elevationContext.mode!=="absolute-height"){fe(o,P);let c=this.elevationContext.mode==="relative-to-scene"?"scene":"ground",d=0;if(t.useViewElevation)d=t.service.getElevation(P[0],P[1],c)??0;else try{let m=Ne(o,t.service.spatialReference,t);d=(yield t.service.queryElevation(P[0],P[1],s,m,c))??0}catch{}ve(o,0,0,-this.alignedSampledElevation+d)}return o})}addObjectState(e){e.stateType===Q.Highlight&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightName)),e.stateType===Q.MaskOccludee&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){let{_edgeState:t,stageObject:a,_stageLayer:s,_visible:i}=this;t!=null&&s.stage.renderer.withEdgeView(o=>{i?this._addOrUpdateEdgeObject(t,o,e):o.removeObject(a)})}_addOrUpdateEdgeObject(e,t,a){let s=st(e.baseMaterial);e.edgeMaterial.objectTransparency=s,t.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!a).then(()=>this._stageLayer?.sync())}};function st(r){return r.parameters.transparent?Y.TRANSPARENT:Y.OPAQUE}var C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_=v(),P=v(),_t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];var ot=class{constructor(e,t=null){this.labelText=t,this.elevationOffset=e??0}};var z,it;(function(r){r[r.RecreateSymbol=0]="RecreateSymbol",r[r.RecreateGraphics=1]="RecreateGraphics",r[r.FastUpdate=2]="FastUpdate"})(z||(z={})),function(r){r[r.Slow=0]="Slow",r[r.Fast=1]="Fast",r[r.Mixed=2]="Mixed",r[r.Loading=3]="Loading",r[r.Undefined=4]="Undefined"}(it||(it={}));var k=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=O.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===O.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===O.FAILED?(t&&t(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=O.LOADED},a=>{throw this._loadError=a,this._abortController=null,this._loadStatus=O.FAILED,!pe(a)&&this.logger&&a.message&&this.logger.warn(a.message),a})),this._loader.then(e,t).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=de(this._abortController):this._loadStatus===O.LOADING&&(this._loadStatus=O.FAILED),this._loader=null}},O;(function(r){r[r.LOADING=0]="LOADING",r[r.LOADED=1]="LOADED",r[r.FAILED=2]="FAILED"})(O||(O={}));var S=()=>ue.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),nt=class extends k{constructor(e,t,a,s){super(a.schedule),this.symbol=e,this.symbolLayer=t,this._context=a,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.logger=S(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new te,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=lt(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}get usedMemory(){let e=this.complexity;return e==null?0:(this.draped?e.memory.draped:e.memory).bytesPerFeature}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;let t=this._drivenProperties,a=lt(e);return a.color!==t.color||a.opacity!==t.opacity||a.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||a.size!==t.size||a.rotation!==t.rotation}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,a,s){let i=e.projectionSuccess,o="polygons"in e?e.polygons:null,n=`${s} geometry failed to be created`;i?!this._logGeometryValidationWarnings(t,a,s)&&o&&o.length===0&&a==="rings"&&t.length>0&&t[0].length>2&&S().warnOncePerTick(`${n} (filled rings should use clockwise winding - try reversing the order of vertices)`):S().warnOncePerTick(`${n} (failed to project geometry to view spatial reference)`)}updateFocus(e,t){}_logGeometryValidationWarnings(e,t,a){let s=`${a} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(S().warnOncePerTick(`${s} (no ${t} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(S().warnOncePerTick(`${s} (${t} should be defined as a 2D array)`),!0)}_validateGeometry(e,t=null,a=null){if(t!=null&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+a+` symbol: ${e.type}`),!1;switch(e.type){case"point":{let s=e;if(!isFinite(s.x)||!isFinite(s.y))return S().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":ye(e)&&S().warnOnce("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return St}_defaultElevationInfoZ(){return Et}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t=new te){let a=e.geometry,s=this.getDefaultElevationInfo(a);t.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,t.mode=this.getGeometryElevationMode(a,s),t.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;let i=!this._elevationOptions.supportsOnTheGround&&t.mode==="on-the-ground";i&&(t.mode="relative-to-ground",t.offsetMeters=0);let o=i?Xe:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(o,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}updateTransform(e,t,a,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,t=ct){let a=this.draped?1:this._getLayerOpacity();return this._drivenProperties.opacity?a:e?a*e.a:t.hasIntrinsicColor?a:0}_getCombinedOpacityAndColor(e,t=ct){let a=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return N(null,a);let s=e!=null?j.toUnitRGB(e):Ee;return N(s,a)}_getVertexOpacityAndColor(e,t=null){let a=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,i=N(a,s);return t&&(i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t),i}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return se(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,a){switch(e){case"opacity":return this.layerOpacityChanged(t,a),!0;case"elevationInfo":{let s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,a,s)!==U.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,a);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,t,a){let s=U.UPDATE;return e.forEach(i=>{let o=t(i);if(o!=null){let n=i.graphic;this.setGraphicElevationContext(n,o.elevationContext),o.needsElevationUpdates=a(o.elevationContext.mode)}else s=U.RECREATE}),s}applyRendererDiff(e,t){return z.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;let t=this._fastUpdates.visualVariables,a=t.size?M(t.size.field,e):0,s=t.color?M(t.color.field,e):0,i=t.opacity?M(t.opacity.field,e):0;return Fe(a,s,i,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&S().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){let e=()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null});return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function lt(r){let e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1};return r&&"visualVariables"in r&&r.visualVariables&&r.visualVariables.forEach(t=>{switch(t.type){case"color":if(e.color=!0,t.stops)for(let a=0;a<t.stops.length;a++){let s=t.stops[a].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0;break;case"rotation":e.rotation=!0}}),e}var St={mode:"on-the-ground",offset:0,unit:"meters"},Et={mode:"absolute-height",offset:0,unit:"meters"},ct={hasIntrinsicColor:!1};function ua(r,e,t,a,s){if(ut(r,e))return null;t.localOrigin=Ct(r,e);let i=new He({geometries:[t],castShadow:!1,layerUid:r.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:i,sampledElevation:ee(i,e,r.elevationProvider,r.renderCoordsHelper,a)}}function da(r,e,t,a){return ut(e,t)?null:ee(r,t,e.elevationProvider,e.renderCoordsHelper,a)}function ut(r,e){let t=r.clippingExtent;return!!t&&(G(e,E,r.elevationProvider.spatialReference),!ge(t,E))}function pa(r,e,t){let a=r.elevationContext,s=t.spatialReference;G(e,E,s),a.centerPointInElevationSR=X(E[0],E[1],e.hasZ?E[2]:0,s??null)}function ma(r){switch(r.type){case"point":return r;case"polygon":case"extent":return Me(r);case"polyline":{let e=r.paths[0];if(!e||e.length===0)return null;let t=he(e,me(e)/2);return X(t[0],t[1],t[2],r.spatialReference)}case"mesh":return r.extent.center}return null}function Ct(r,e){return G(e,E,r.renderCoordsHelper.spatialReference),r.localOriginFactory.getOrigin(E)}var E=v();export{R as a,wt as b,At as c,Rt as d,Tt as e,Mt as f,Nt as g,qt as h,Ye as i,f as j,bt as k,tr as l,Ke as m,rr as n,ft as o,vt as p,oe as q,vr as r,Pr as s,Or as t,_r as u,rt as v,at as w,ot as x,z as y,it as z,k as A,O as B,nt as C,ua as D,da as E,pa as F,ma as G,Ct as H};
