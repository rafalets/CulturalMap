import{m as W,n as X}from"./chunk-Y3QXXHTY.js";import{p as E,q as B}from"./chunk-OZ3HM6MC.js";import{a as $}from"./chunk-JEGXFID4.js";import{a as k}from"./chunk-OGS2SUK5.js";import{a as F}from"./chunk-WNSGKHQ6.js";import{a as H,b as L,c as A}from"./chunk-R6GE4XRP.js";import{j as S}from"./chunk-I4M2OT5W.js";import{n as R}from"./chunk-NTVLK3P2.js";import{a as z}from"./chunk-WMQNRNIU.js";import{F as p}from"./chunk-E57FTRWF.js";import{f as q}from"./chunk-7EG726PT.js";import{d as n}from"./chunk-C7INQGWT.js";import{H as c,r as J}from"./chunk-WMHJC7XF.js";import{a as i}from"./chunk-QGVBCWUY.js";import{a as O,b as j,f as C}from"./chunk-VTHXE323.js";var l=class extends k.ClonableMixin(q){constructor(t){super(t),this.name=void 0,this.method="none",this.value=void 0,this.bandIds=void 0,this.renderer=void 0}};i([n({type:String,json:{write:{isRequired:!0}}})],l.prototype,"name",void 0),i([n({type:["raster-function-template","variable","none"],json:{write:{isRequired:!0}}}),F({rasterFunctionTemplate:"raster-function-template",variable:"variable",none:"none"})],l.prototype,"method",void 0),i([n({type:String,json:{write:{isRequired:!0}}})],l.prototype,"value",void 0),i([n({type:[J],json:{write:{isRequired:!0}}})],l.prototype,"bandIds",void 0),i([n({types:W,json:{write:!0,origins:{"web-scene":{types:X,write:{overridePolicy:t=>({enabled:t&&t.type!=="vector-field"&&t.type!=="flow"})}}}}})],l.prototype,"renderer",void 0),l=i([c("esri.renderers.support.RasterPresetRenderer")],l);var Y=l;var De=t=>{let r=class extends t{constructor(){super(...arguments),this.activePresetRendererName=null,this.presetRenderers=null}};return i([n({type:String,json:{name:"layerDefinition.activePresetRendererName",write:{allowNull:!0}}})],r.prototype,"activePresetRendererName",void 0),i([n({type:[Y],json:{name:"layerDefinition.presetRenderers",write:!0}})],r.prototype,"presetRenderers",void 0),r=i([c("esri.layers.mixins.RasterPresetRendererMixin")],r),r};function _(t,r,u){return C(this,null,function*(){let w=L(t),{rasterFunction:f,sourceJSON:U}=r||{},G=f?JSON.stringify(f.rasterFunctionDefinition||f):null,K=A(j(O({},w.query),{renderingRule:G,f:"json"})),m=H(K,u);t=w.path;let e=U||(yield p(t,m).then(a=>a.data)),Q=e.hasRasterAttributeTable?p(`${t}/rasterAttributeTable`,m):null,Z=e.hasColormap?p(`${t}/colormap`,m):null,ee=e.hasHistograms?p(`${t}/histograms`,m):null,te=e.currentVersion>=10.3?p(`${t}/keyProperties`,m):null,re=e.hasMultidimensions?p(`${t}/multidimensionalInfo`,m):null,s=yield Promise.allSettled([Q,Z,ee,te,re]),h=null;if(e.minValues&&e.minValues.length===e.bandCount){h=[];for(let a=0;a<e.minValues.length;a++)h.push({min:e.minValues[a],max:e.maxValues[a],avg:e.meanValues[a],stddev:e.stdvValues[a]})}let V=S.fromJSON(e.extent),I=Math.ceil(V.width/e.pixelSizeX-.1),D=Math.ceil(V.height/e.pixelSizeY-.1),y=z.fromJSON(e.spatialReference||e.extent.spatialReference),T=s[0].status==="fulfilled"?s[0].value?.data:null,ae=T?.features?.length?$.fromJSON(T):null,M=s[1].status==="fulfilled"?s[1].value?.data.colormap:null,ie=M?.length?M:null,N=s[2].status==="fulfilled"?s[2].value?.data.histograms:null,se=N?.[0]?.counts?.length?N:null,d=s[3].status==="fulfilled"?s[3].value?.data??{}:{},P=s[4].status==="fulfilled"?s[4].value?.data.multidimensionalInfo:null,v=P?.variables?.length?P:null;v&&v.variables.forEach(a=>{a.statistics?.length&&a.statistics.forEach(o=>{o.avg=o.mean,o.stddev=o.standardDeviation}),a.dimensions?.forEach(o=>{o.name!=="StdTime"||o.recurring||o.unit||(o.unit="ISO8601")})});let{defaultVariable:g,serviceDataType:b}=e;g&&g!==d.DefaultVariable&&(d.DefaultVariable=g),b?.includes("esriImageServiceDataTypeVector")&&!b.includes(d.DataType)&&(d.DataType=b.replace("esriImageServiceDataType",""));let x=e.noDataValue;e.noDataValues?.length&&e.noDataValues.some(a=>a!==x)&&(x=e.noDataValues);let oe=e.transposeInfo?new E({blockWidth:256,blockHeight:256,pyramidBlockWidth:256,pyramidBlockHeight:256,pyramidScalingFactor:2,compression:"lerc",origin:new R({x:e.extent.xmin,y:e.extent.ymax,spatialReference:y}),firstPyramidLevel:1,maximumPyramidLevel:Math.max(0,Math.round(Math.log(Math.max(I,D))/Math.LN2-8)),transposeInfo:e.transposeInfo}):void 0;return new B({width:I,height:D,bandCount:e.bandCount,extent:S.fromJSON(e.extent),spatialReference:y,pixelSize:new R({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:y}),pixelType:e.pixelType.toLowerCase(),statistics:h,attributeTable:ae,colormap:ie,histograms:se,keyProperties:d,noDataValue:x,multidimensionalInfo:v,storageInfo:oe})})}function ze(t,r,u){return _(t,{sourceJSON:r},u)}function Fe(t,r,u){return _(t,{rasterFunction:r},u)}function $e(t,r){t.attributeTable||(r.hasRasterAttributeTable=!1),t.histograms||(r.hasHistograms=!1),t.colormap||(r.hasColormap=!1),t.multidimensionalInfo||(r.hasMultidimensions=!1)}export{ze as a,Fe as b,$e as c,De as d};
