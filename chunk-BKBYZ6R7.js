import{c as q,g as Rn,h as _,l as en,r as Pn}from"./chunk-IB2IUO7T.js";import{h as B}from"./chunk-7N3ZKWML.js";import{j as O}from"./chunk-I4M2OT5W.js";import{n as T}from"./chunk-NTVLK3P2.js";import{a as tn}from"./chunk-WMQNRNIU.js";import{c as nn,d as v,e as C,f as dn,ia as z,k as wn,r as Mn}from"./chunk-IG66NQHW.js";import{t as $}from"./chunk-HHDFN2GK.js";import{t as yn}from"./chunk-47GHT6OF.js";import{a as V,b as Z,f as gn}from"./chunk-VTHXE323.js";var ln;function vn(n,t,o){return!Pn(n,t,o)}function I(n,t,o){let i=vn(n,t,o);if(i&&!q())throw new $("rasterprojectionhelper-project","projection engine is not loaded");return i}(function(n){n[n.None=0]="None",n[n.North=1]="North",n[n.South=2]="South",n[n.Both=3]="Both"})(ln||(ln={}));var Sn=(n,t,o,i=0)=>{if(o[0]===1)return[0,0];let s=1,e=-1,r=1,f=-1;for(let u=0;u<n.length;u+=2)isNaN(n[u])||(s=s>n[u]?n[u]:s,e=e>n[u]?e:n[u],r=r>n[u+1]?n[u+1]:r,f=f>n[u+1]?f:n[u+1]);let{cols:a,rows:l}=t,c=(e-s)/a/o[0],w=(f-r)/l/o[1],h=2*i,m=0,x=!1,p=[0,0];for(let u=0;u<a-3;u++){for(let M=0;M<l-3;M++){let y=u*l*2+2*M,g=(n[y]+n[y+4]+n[y+4*l]+n[y+4*l+4])/4,d=(n[y+1]+n[y+5]+n[y+4*l+1]+n[y+4*l+5])/4,R=Math.abs((g-n[y+2*l+2])/c),S=Math.abs((d-n[y+2*l+3])/w);if(R+S>m&&(m=R+S,p=[R,S]),h&&m>h){x=!0;break}}if(x)break}return p},On={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},D=32,J=4,on=J,rn=new Map,sn=new Map,X=500,An=39.37,Fn=96,K=null;function rt(){return gn(this,null,function*(){K&&q()||(q()||(yield Rn()),K=yield import("./chunk-UOZE5XHP.js"))})}function qn(n,t,o){return I(n.spatialReference,t),o?en(t,n.spatialReference,n):en(n.spatialReference,t,n)}function st(n,t,o,i=null){let s=n.spatialReference;if(!s||!t||s.equals(t))return n;I(s,t,i);let e=o.center,r=new O({xmin:e.x-n.x/2,xmax:e.x+n.x/2,ymin:e.y-n.y/2,ymax:e.y+n.y/2,spatialReference:s}),f=_(r,t,i),a=j(t);return f==null||a!=null&&f.width>=a?Y(n,s,t):{x:f.width,y:f.height}}function Y(n,t,o){let i=z(t)/z(o);return{x:n.x*i,y:n.y*i}}function cn(n,t,o){let{spatialReference:i}=o;if(!i||!t||i.equals(t))return n;if(i.isGeographic&&t.isGeographic)return Y(n,i,t);if(I(i,t),!K)throw new $("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:s,y:e}=n,r=(s+e)/2*z(i),f=1;r>30&&(f=30/r,s*=f,e*=f);let a=256,l=s*a/2,c=e*a/2,{x:w,y:h}=o.center,m=[];for(let P=0;P<=a;P++)m.push([w-l,h-c+P*e]);for(let P=1;P<=a;P++)m.push([w-l+P*s,h+c]);for(let P=1;P<=a;P++)m.push([w+l,h+c-P*e]);for(let P=1;P<a;P++)m.push([w+l-P*s,h-c]);m.push(m[0]);let x=new B({rings:[m],spatialReference:i}),p=_(x,t);if(!p)return Y(n,i,t);let u=p.extent,M=j(t);if(u==null||M!=null&&u.width>=M)return Y(n,i,t);let y=K.planarArea(p),g=s*e*a*a,d=Math.sqrt(y/g)/f,R={x:u.width/f/a,y:u.height/f/a},S={x:s*d,y:e*d},E=R.x*R.y;return Math.abs(E-S.x*S.y)/E<.1?R:S}function fn(n,t){return(typeof n=="number"?n:(n.x+n.y)/2)*z(t)*Fn*An}function at(n,t){let{pixelSize:o,extent:i}=n;return fn(cn(o,t,i),t)}function k(n,t=.01){return z(n)?t/z(n):0}function bn(n,t,o=null,i=!0){let s=n.spatialReference;if(s.equals(t))return n;I(s,t,o);let e=_(n,t,o);return i&&e&&Cn([n],[e],s,t),e}function Cn(n,t,o,i){let s=U(o,!0),e=U(i,!0),r=k(o,X),f=k(i,X);if(r&&s!=null&&e!=null)for(let a=0;a<n.length;a++){let l=t[a];if(!l)continue;let{x:c}=n[a],{x:w}=l;w>=e[1]-f&&Math.abs(c-s[0])<r?l.x-=e[1]-e[0]:w<=e[0]+f&&Math.abs(c-s[1])<r&&(l.x+=e[1]-e[0])}}function Bn(n){let{inSR:t,outSR:o,datumTransformation:i,preferPE:s}=n;if(t.equals(o)){let{points:e}=mn(n,null);return e}return t.isWebMercator&&o.isWGS84||t.isWGS84&&o.isWebMercator?Dn(n):I(t,o,i)&&s&&(t.isGeographic||L(t)!=null)?Gn(n):Yn(n)}function Yn(n){let{points:t}=mn(n,null),{inSR:o,outSR:i,datumTransformation:s}=n,e=t.map(f=>new T(f[0],f[1],o)),r=_(e,i,s);return s&&Cn(e,r,o,i),r.map(f=>f?[f.x,f.y]:[NaN,NaN])}function Gn(n){let{inSR:t,outSR:o,datumTransformation:i}=n,s=L(t),{points:e,mask:r}=mn(n,s);if(!t.isGeographic){let a=t.wkid?C.coordsys(t.wkid):C.fromString(t.isGeographic?v.PE_TYPE_GEOGCS:v.PE_TYPE_PROJCS,t.wkt2||t.wkt);nn.projToGeog(a,e.length,e)}if(i!=null&&i.steps.length){let a;if(o.isGeographic&&(a=e.map(([c])=>c>179.9955?1:c<-179.9955?-1:0)),i.steps.forEach(c=>{let w=c.wkid?C.geogtran(c.wkid):C.fromString(v.PE_TYPE_GEOGTRAN,c.wkt);dn.geogToGeog(w,e.length,e,null,c.isInverse?v.PE_TRANSFORM_2_TO_1:v.PE_TRANSFORM_1_TO_2)}),a)for(let c=0;c<e.length;c++){let w=a[c],h=e[c][0],m=h>179.9955?1:h<-179.9955?-1:0;w&&m&&w!==m&&(e[c][0]=w>0?h+360:h-360)}}if(!o.isGeographic){let a=L(o,!0),l=a!=null&&a.isEnvelope?[a.bbox[1],a.bbox[3]]:[-90,90];Jn(e,l);let c=o.wkid?C.coordsys(o.wkid):C.fromString(o.isGeographic?v.PE_TYPE_GEOGCS:v.PE_TYPE_PROJCS,o.wkt2||o.wkt);nn.geogToProj(c,e.length,e)}let f=e;if(r&&e.length!==r.length){f=[];for(let a=0,l=0;a<r.length;a++)r[a]?f.push(e[l++]):f.push([NaN,NaN])}return f}function Dn(n){let{cols:t,rows:o,xres:i,yres:s,usePixelCenter:e,inSR:r,outSR:f}=n,{xmin:a,ymax:l}=n;e&&(a+=i/2,l-=s/2);let c=[],w=[],h=Math.max(t,o);for(let x=0;x<h;x++){let p=a+i*Math.min(t,x),u=l-s*Math.min(o,x),M=_(new T({x:p,y:u,spatialReference:r}),f);x<=t&&c.push(M.x),x<=o&&w.push(M.y)}let m=[];for(let x=0;x<t;x++)for(let p=0;p<o;p++)m.push([c[x],w[p]]);return m}function L(n,t=!1){let o=n.wkid||n.wkt2||n.wkt;if(!o||n.isGeographic)return null;if(o=String(o),rn.has(o)){let r=rn.get(o);return t?r?.gcs:r?.pcs}let i=n.wkid?C.coordsys(n.wkid):C.fromString(n.isGeographic?v.PE_TYPE_GEOGCS:v.PE_TYPE_PROJCS,n.wkt2||n.wkt),s=En(i,k(n,1e-4)),e=En(i,0,!0);return rn.set(o,{pcs:s,gcs:e}),t?e:s}function En(n,t=0,o=!1){let i=wn.generate(n),s=o?n.horizonGcsGenerate():n.horizonPcsGenerate();if(!i||!s?.length)return null;let e=!1,r=s.find(u=>u.getInclusive()===1&&u.getKind()===1);if(!r){if(r=s.find(u=>u.getInclusive()===1&&u.getKind()===0),!r)return null;e=!0}let f=o?0:(i.getNorthPoleLocation()===2?1:0)|(i.getSouthPoleLocation()===2?2:0),a=i.isPannableRectangle(),l=r.getCoord();if(e)return{isEnvelope:e,isPannable:a,vertices:l,coef:null,bbox:[l[0][0]-t,l[0][1]-t,l[1][0]+t,l[1][1]+t],poleLocation:f};let c=0,w=[],[h,m]=l[0],[x,p]=l[0];for(let u=0,M=l.length;u<M;u++){c++,c===M&&(c=0);let[y,g]=l[u],[d,R]=l[c];if(R===g)w.push([y,d,g,R,2]);else{let S=(d-y)/(R-g||1e-4),E=y-S*g;g<R?w.push([S,E,g,R,0]):w.push([S,E,R,g,1])}h=h<y?h:y,m=m<g?m:g,x=x>y?x:y,p=p>g?p:g}return{isEnvelope:!1,isPannable:a,vertices:l,coef:w,bbox:[h,m,x,p],poleLocation:f}}function mn(n,t){let o=[],{cols:i,rows:s,xres:e,yres:r,usePixelCenter:f}=n,{xmin:a,ymax:l}=n;if(f&&(a+=e/2,l-=r/2),t==null){for(let m=0;m<i;m++)for(let x=0;x<s;x++)o.push([a+e*m,l-r*x]);return{points:o}}let c=new Uint8Array(i*s);if(t.isEnvelope){let{bbox:[m,x,p,u]}=t;for(let M=0,y=0;M<i;M++){let g=a+e*M,d=t.isPannable||g>=m&&g<=p;for(let R=0;R<s;R++,y++){let S=l-r*R;d&&S>=x&&S<=u&&(o.push([g,S]),c[y]=1)}}return{points:o,mask:c}}let w=t.coef,h=[];for(let m=0;m<s;m++){let x=l-r*m,p=[],u=[];for(let y=0;y<w.length;y++){let[g,d,R,S,E]=w[y];if(x===R&&R===S)p.push(g),p.push(d),u.push(2),u.push(2);else if(x>=R&&x<=S){let P=g*x+d;p.push(P),u.push(E)}}let M=p;if(p.length>2){let y=u[0]===2?0:u[0],g=p[0];M=[];for(let d=1;d<u.length;d++)u[d]===2&&d!==u.length-1||(u[d]!==y&&(M.push(y===0?Math.min(g,p[d-1]):Math.max(g,p[d-1])),y=u[d],g=p[d]),d===u.length-1&&M.push(u[d]===0?Math.min(g,p[d]):Math.max(g,p[d])));M.sort((d,R)=>d-R)}else p[0]>p[1]&&(M=[p[1],p[0]]);h.push(M)}for(let m=0,x=0;m<i;m++){let p=a+e*m;for(let u=0;u<s;u++,x++){let M=l-r*u,y=h[u];if(y.length===2)p>=y[0]&&p<=y[1]&&(o.push([p,M]),c[x]=1);else if(y.length>2){let g=!1;for(let d=0;d<y.length;d+=2)if(p>=y[d]&&p<=y[d+1]){g=!0;break}g&&(o.push([p,M]),c[x]=1)}}}return{points:o,mask:c}}function Jn(n,t){let[o,i]=t;for(let s=0;s<n.length;s++){let e=n[s][1];(e<o||e>i)&&(n[s]=[NaN,NaN])}}function jn(n,t){let o=j(n[0].spatialReference);if(n.length<2||o==null||(t=t??k(n[0].spatialReference),(n=n.filter(f=>f.width>t)).length===1))return n[0];let{xmin:i,xmax:s,ymin:e,ymax:r}=n[0];for(let f=1;f<n.length;f++){let a=n[f];s=a.xmax+o*f,e=Math.min(e,a.ymin),r=Math.max(r,a.ymax)}return new O({xmin:i,xmax:s,ymin:e,ymax:r,spatialReference:n[0].spatialReference})}function _n(n,t,o=null,i=!0){let s=n.spatialReference;if(s.equals(t))return n;let e=xn(n),r=j(s,!0),f=j(t);if(e===0||r==null||f==null){let l=un(n,t,o,i);if(r==null&&f!=null&&Math.abs(l.width-f)<k(t)&&q()){let c=L(s);if(c!=null&&c.poleLocation===ln.None&&n.width<(c.bbox[2]-c.bbox[0])/2)return Xn(n,t)||l}return l}let a=n.clone().normalize();if(a.length===1&&n.xmax<r&&n.xmax-r/2>k(s)){let{xmin:l,xmax:c}=n;for(let w=0;w<=e;w++){let h=w===0?l:-r/2,m=w===e?c-r*w:r/2;a[w]=new O({xmin:h,xmax:m,ymin:n.ymin,ymax:n.ymax,spatialReference:s})}}return jn(a.map(l=>un(l,t,o,i)).filter(yn))}function lt(n,t,o){if(n.type==="extent"){let{xmin:i,ymin:s,xmax:e,ymax:r,spatialReference:f}=n;n=new B({rings:[[[i,r],[e,r],[e,s],[i,s],[i,r]]],spatialReference:f})}return n.spatialReference.equals(t)?n:(I(n.spatialReference,t,o),_(n,t,o))}function Xn(n,t){let o=j(t);if(o==null)return null;let{xmin:i,ymin:s,xmax:e,ymax:r}=n,f=n.spatialReference,a=new B({spatialReference:f,rings:[[[i,s],[e,s],[e,r],[i,r],[i,s]]]}),l=_(a,t);if(l.rings.length!==2||!l.rings[0].length||!l.rings[1].length)return null;let{rings:c}=l,w=k(f),h=new O({spatialReference:t});for(let m=0;m<2;m++){i=e=c[m][0][0],s=r=c[m][0][1];for(let x=0;x<c[m].length;x++)i=i>c[m][x][0]?c[m][x][0]:i,e=e<c[m][x][0]?c[m][x][0]:e,s=s>c[m][x][1]?c[m][x][1]:s,r=r<c[m][x][1]?c[m][x][1]:r;if(m===0)h.ymin=s,h.ymax=r,h.xmin=i,h.xmax=e;else if(h.ymin=Math.min(h.ymin,s),h.ymax=Math.max(h.ymax,r),Math.abs(e-o/2)<w)h.xmin=i,h.xmax=h.xmax+o;else{if(!(Math.abs(i+o/2)<w))return null;h.xmax=e+o}}return h}function un(n,t,o=null,i=!0,s=!0){let e=n.spatialReference;if(e.equals(t)||!t)return n;I(e,t,o);let r=_(n,t,o);if(s&&t.isWebMercator&&r&&(r.ymax=Math.min(20037508342787e-6,r.ymax),r.ymin=Math.max(-20037508342787e-6,r.ymin),r.ymin>=r.ymax))return null;if(!i||!r)return r;let f=U(e,!0),a=U(t,!0);if(f==null||a==null)return r;let l=k(e,.001),c=k(e,X),w=k(t,.001);if(Math.abs(r.xmin-a[0])<w&&Math.abs(r.xmax-a[1])<w){let h=Math.abs(n.xmin-f[0]),m=Math.abs(f[1]-n.xmax);if(h<l&&m>c){r.xmin=a[0];let x=[];x.push(new T(n.xmax,n.ymin,e)),x.push(new T(n.xmax,(n.ymin+n.ymax)/2,e)),x.push(new T(n.xmax,n.ymax,e));let p=x.map(u=>bn(u,t,o)).filter(u=>!isNaN(u?.x)).map(u=>u.x);r.xmax=Math.max.apply(null,p)}if(m<l&&h>c){r.xmax=a[1];let x=[];x.push(new T(n.xmin,n.ymin,e)),x.push(new T(n.xmin,(n.ymin+n.ymax)/2,e)),x.push(new T(n.xmin,n.ymax,e));let p=x.map(u=>bn(u,t,o)).filter(u=>!isNaN(u?.x)).map(u=>u.x);r.xmin=Math.min.apply(null,p)}}else{let h=k(t,.001);Math.abs(r.xmin-a[0])<h&&(r.xmin=a[0]),Math.abs(r.xmax-a[1])<h&&(r.xmax=a[1])}return r}function j(n,t=!1){if(!n)return null;let o=t?20037508342787e-6:20037508342788905e-9;return n.isWebMercator?2*o:n.wkid&&n.isGeographic?360:2*On[n.wkid]||null}function U(n,t=!1){if(n.isGeographic)return[-180,180];let o=j(n,t);return o!=null?[-o/2,o/2]:null}function kn(n,t,o,i){let s=(n-t)/o;return s-Math.floor(s)!=0?s=Math.floor(s):i&&(s-=1),s}function xn(n,t=!1){let o=j(n.spatialReference);if(o==null)return 0;let i=t?0:-(o/2),s=k(n.spatialReference),e=!t&&Math.abs(n.xmax-o/2)<s?o/2:n.xmax,r=!t&&Math.abs(n.xmin+o/2)<s?-o/2:n.xmin;return kn(e,i,o,!0)-kn(r,i,o,!1)}function ct(n){let t=n.storageInfo.origin.x,o=j(n.spatialReference,!0);if(o==null)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};let i=o/2,{nativePixelSize:s,storageInfo:e,extent:r}=n,{maximumPyramidLevel:f,blockWidth:a,pyramidScalingFactor:l}=e,c=s.x,w=[],h=n.transform!=null&&n.transform.type==="gcs-shift",m=t+(h?0:i),x=h?o-t:i-t;for(let p=0;p<=f;p++){let u=(r.xmax-t)/c/a,M=u-Math.floor(u)==0?u:Math.ceil(u),y=x/c/a,g=y-Math.floor(y)==0?y:Math.ceil(y),d=Math.floor(m/c/a),R=Math.round(m/c)%a,S=(a-Math.round(x/c)%a)%a;w.push({resolutionX:c,blockWidth:a,datasetColumnCount:M,worldColumnCountFromOrigin:g,leftMargin:R,rightPadding:S,originColumnOffset:d}),c*=l}return{originX:t,halfWorldWidth:i,pyramidsInfo:w,hasGCSSShiftTransform:h}}function Kn(n){if(!n||n.isGeographic)return n;let t=String(n.wkid||n.wkt2||n.wkt),o;return sn.has(t)?o=sn.get(t):(o=(n.wkid?C.coordsys(n.wkid):C.fromString(v.PE_TYPE_PROJCS,n.wkt2||n.wkt)).getGeogcs().getCode(),sn.set(t,o)),new tn({wkid:o})}function ft(n){let t=n.isAdaptive&&n.spacing==null,o=n.spacing||[D,D],i=an(n),s={cols:i.size[0]+1,rows:i.size[1]+1},e=i.outofBoundPointCount>0&&i.outofBoundPointCount<i.offsets.length/2,r=i.outofBoundPointCount===i.offsets.length/2||t&&e?[0,0]:Sn(i.offsets,s,o,on),f=(r[0]+r[1])/2,a=n.projectedExtent.spatialReference,l=n.srcBufferExtent.spatialReference;if(t&&(e||f>on)&&(vn(a,l,n.datumTransformation)&&(a.isGeographic||L(a)),o=[J,J],i=an(Z(V({},n),{spacing:o})),s={cols:i.size[0]+1,rows:i.size[1]+1},r=Sn(i.offsets,s,o,on)),i.error=r,o[0]>1&&(i.coefficients=Nn(i.offsets,s,e)),n.includeGCSGrid&&!a.isGeographic&&!a.isWebMercator)if(l.isGeographic)i.gcsGrid={offsets:i.offsets,coefficients:i.coefficients,spacing:o};else{let c=L(a);if(c!=null&&!c.isEnvelope){let w=Kn(a),h=_n(n.projectedExtent,w),{offsets:m}=an(Z(V({},n),{srcBufferExtent:h,spacing:o})),x=Nn(m,s,e);i.gcsGrid={offsets:m,coefficients:x,spacing:o}}}return i}function an(n){let{projectedExtent:t,srcBufferExtent:o,pixelSize:i,datumTransformation:s,rasterTransform:e}=n,r=t.spatialReference,f=o.spatialReference,a=I(r,f),{xmin:l,ymin:c,xmax:w,ymax:h}=t,m=j(f),x=m!=null&&(n.hasWrapAround||e?.type==="gcs-shift"),p=n.spacing||[D,D],u=p[0]*i.x,M=p[1]*i.y,y=p[0]===1,g=Math.ceil((w-l)/u-.1/p[0])+(y?0:1),d=Math.ceil((h-c)/M-.1/p[1])+(y?0:1),R=Bn({cols:g,rows:d,xmin:l,ymax:h,xres:u,yres:M,inSR:r,outSR:f,datumTransformation:s,preferPE:p[0]<=J,usePixelCenter:y}),S=[],E,P=0,G=y?-1:NaN,{xmin:N,xmax:A,ymax:H,width:Wn,height:zn}=o,In=k(f,X),Ln=m!=null&&N>0&&A>m/2,hn=!1;if(a){let W=L(r);hn=W!=null&&W.poleLocation>0}for(let W=0;W<g;W++){let Q=[];for(let F=0;F<d;F++){let b=R[W*d+F];if(x&&b[0]>A&&b[0]>m/2-In?b[0]-=m:x&&W===0&&b[0]<0&&Ln&&!e&&(b[0]+=m),!b||isNaN(b[0])||isNaN(b[1]))S.push(G),S.push(G),Q.push(null),P++;else{if(e){let pn=e.inverseTransform(new T({x:b[0],y:b[1],spatialReference:f}));b=[pn.x,pn.y]}Q.push(b),W>0&&x&&E[F]&&b[0]<E[F][0]&&(b[0]+=m,hn&&b[0]>A&&b[0]>m&&(b[0]-=m)),S.push((b[0]-N)/Wn),S.push((H-b[1])/zn)}}E=Q}return{offsets:S,error:null,coefficients:null,outofBoundPointCount:P,spacing:p,size:y?[g,d]:[g-1,d-1]}}function Nn(n,t,o){let{cols:i,rows:s}=t,e=new Float32Array((i-1)*(s-1)*2*6),r=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),f=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let a=0;a<i-1;a++){for(let l=0;l<s-1;l++){let c=a*s*2+2*l,w=n[c],h=n[c+1],m=n[c+2],x=n[c+3];c+=2*s;let p=n[c],u=n[c+1],M=n[c+2],y=n[c+3],g=0,d=12*(l*(i-1)+a);for(let R=0;R<3;R++)e[d++]=r[g++]*w+r[g++]*m+r[g++]*M;g=0;for(let R=0;R<3;R++)e[d++]=r[g++]*h+r[g++]*x+r[g++]*y;g=0;for(let R=0;R<3;R++)e[d++]=f[g++]*w+f[g++]*p+f[g++]*M;g=0;for(let R=0;R<3;R++)e[d++]=f[g++]*h+f[g++]*u+f[g++]*y}if(o)for(let l=0;l<e.length;l++)isNaN(e[l])&&(e[l]=-1)}return e}function Un(n,t){let o=n.clone().normalize();return o.length===1?o[0]:jn(o,t)}function ut(n){let{spatialReference:t}=n,o=Mn(t);if(!o)return n;let[i,s]=o.valid,e=s-i,r=0;if(n.xmin<i){let f=i-n.xmin;r=Math.ceil(f/e)}else if(n.xmin>s){let f=n.xmin-s;r=-Math.ceil(f/e)}return new O({spatialReference:n.spatialReference,xmin:n.xmin+r*e,ymin:n.ymin,xmax:n.xmax+r*e,ymax:n.ymax})}function mt(n,t,o){let{storageInfo:i,pixelSize:s}=t,e=0,r=!1,{pyramidResolutions:f}=i,a=i.tileInfo.format?.toLowerCase()==="mixed"?Math.max(1,Math.min(3,i.tileInfo.dpi/96)):1,l=(n.x+n.y)/2/a;if(f!=null&&f.length){let x=f[f.length-1],p=(x.x+x.y)/2,u=(s.x+s.y)/2;if(l<=u)e=0;else if(l>=p)e=f.length,r=l/p>8;else{let y,g=u;for(let d=1;d<=f.length;d++){if(y=(f[d-1].x+f[d-1].y)/2,l<=y){l===y?e=d:o==="down"?(e=d-1,r=l/g>8):e=o==="up"||l-g>y-l||l/g>2?d:d-1;break}g=y}}let M=e===0?s:f[e-1];return r&&Math.min(M.x,M.y)*z(t.spatialReference)>19567&&(r=!1),{pyramidLevel:e,pyramidResolution:new T({x:M.x,y:M.y,spatialReference:t.spatialReference}),excessiveReading:r}}let c=Math.log(n.x/s.x)/Math.LN2,w=Math.log(n.y/s.y)/Math.LN2,h=t.storageInfo.maximumPyramidLevel||0;e=o==="down"?Math.floor(Math.min(c,w)):o==="up"?Math.ceil(Math.max(c,w)):Math.round((c+w)/2),e<0?e=0:e>h&&(r=e>h+3,e=h);let m=2**e;return{pyramidLevel:e,pyramidResolution:new T({x:m*t.nativePixelSize.x,y:m*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:r}}function Tn(n,t,o=!1){let{pixelSize:i,extent:s}=n,e=qn(s,t,!1),r=_n(Un(s,(i.x+i.y)/16),t,e);return o||xn(r)===0?r:un(s,t,e)}function xt(n,t,o){let i=o?.tileSize??512,s=o?.alignGlobalDatasetWithAGOL??!0,e=!!o?.limitToSrcResolution,{extent:r,spatialReference:f,pixelSize:a}=n,l=cn(a,t,r);if(l==null)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};let c=(l.x+l.y)/2,w=fn(c,t),h=t.isGeographic?256/i*2958287637958547e-7:256/i*591657527591555e-6,m=n.dataType==="vector-magdir"||n.dataType==="vector-uv",x=Tn(n,t,!0),p=Math.min(Math.ceil(Math.log(Math.min(n.width,n.height)/32)/Math.LN2),Math.ceil(Math.log(h/2/w)/Math.LN2));if(!m&&s&&(t.isGeographic||t.isWebMercator)){let P=j(t);if(m=xn(x)>0||P!=null&&x.width>P/4,!m&&P!=null){let G=-1;if(p<3)G=2**p*c*i;else if(n.storageInfo){let{maximumPyramidLevel:A=0,pyramidScalingFactor:H=2}=n.storageInfo;G=H**A*c*i}let N=Math.ceil(P/G);m=N===1||N===2&&P/2-x.xmax<G}}let u,M=w,y=1.001,g=Math.min(2,Math.max(1.414,n.storageInfo?.pyramidScalingFactor||2));if(m){M=h;let P=t.isGeographic?1341104507446289e-21:.29858214164761665,G=fn(P,t),N=t.isGeographic?4326:3857;u=cn({x:P,y:P},f,Tn(n,new tn({wkid:N}),!0)),u.x*=M/G,u.y*=M/G}else{u={x:a.x,y:a.y};let P=0;for(;M<h*(y/2)&&P<p;)P++,M*=g,u.x*=g,u.y*=g;Math.max(M,h)/Math.min(M,h)<=y&&(M=h)}let d=[M],R=[{x:u.x,y:u.y}],S=70.5310735,E=Math.min(S,w)/y;for(;M>=E;)M/=g,u.x/=g,u.y/=g,d.push(M),R.push({x:u.x,y:u.y});if(e){let P=.001*a.x,G=R.findIndex(N=>N.x>=a.x-P&&N.x<=a.x+P);G>-1?(R.length=G+1,d.length=G+1):(G=R.findIndex(N=>N.x<=a.x+P),G>0&&(R.length=G,d.length=G))}return{projectedPixelSize:l,scales:d,srcResolutions:R,isCustomTilingScheme:!m}}export{vn as a,rt as b,qn as c,st as d,at as e,bn as f,_n as g,lt as h,j as i,xn as j,ct as k,ft as l,ut as m,mt as n,Tn as o,xt as p};
