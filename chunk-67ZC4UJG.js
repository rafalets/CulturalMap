import{a as E}from"./chunk-QJADLTFR.js";import{g as d,h as T}from"./chunk-X7QUUHRV.js";import{L as y,d as l}from"./chunk-C7INQGWT.js";import{H as g}from"./chunk-WMHJC7XF.js";import{a as c}from"./chunk-QGVBCWUY.js";import{b as u,r as m}from"./chunk-HHDFN2GK.js";import{a as p}from"./chunk-47GHT6OF.js";var _=-1,o=class extends y{constructor(t){super(t),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=p("mapview-transitions-duration"),this.effects=[]}set effect(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(v(t))}catch(e){this._transitionTo([]),m.getLogger(this).warn("Invalid Effect",{effect:t,error:e})}}}get final(){return this._final}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(t){this._updateForScale(t)}get transitioning(){return this._to!==null}canTransitionTo(t){try{return this.scale>0&&S(this._current,v(t),this.scale)}catch{return!1}}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e)}endTransition(){this._applyTimeTransition(this.duration)}_transitionTo(t){this.scale>0&&S(this._current,t,this.scale)?(this._final=t,this._to=u(t),O(this._current,this._to,this.scale),this._from=u(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?u(this._current[0].effects):[])}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;let e=Math.min(1,this._time/this.duration);for(let r=0;r<this._current.length;r++){let f=this._current[r],n=this._from[r],a=this._to[r];f.scale=F(n.scale,a.scale,e);for(let i=0;i<f.effects.length;i++){let h=f.effects[i],s=n.effects[i],w=a.effects[i];h.interpolate(s,w,e)}}e===1&&(this._current=this._final,this._set("effects",this._current[0]?u(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(t){if(this._set("scale",t),this._current.length===0)return;let e=this._current,r=this._current.length-1,f,n,a=1;if(e.length===1||t>=e[0].scale)n=f=e[0].effects;else if(t<=e[r].scale)n=f=e[r].effects;else for(let i=0;i<r;i++){let h=e[i],s=e[i+1];if(h.scale>=t&&s.scale<=t){a=(t-h.scale)/(s.scale-h.scale),f=h.effects,n=s.effects;break}}for(let i=0;i<this.effects.length;i++)this.effects[i].interpolate(f[i],n[i],a)}};function v(t){let e=E(t)||[];return I(e)?[{scale:_,effects:e}]:e}function S(t,e,r){return!t[0]?.effects||!e[0]?.effects?!0:!((t[0]?.scale===_||e[0]?.scale===_)&&(t.length>1||e.length>1)&&r<=0)&&d(t[0].effects,e[0].effects)}function O(t,e,r){let f=t.length>e.length?t:e,n=t.length>e.length?e:t,a=n[n.length-1],i=a?.scale??r,h=a?.effects??[];for(let s=n.length;s<f.length;s++)n.push({scale:i,effects:[...h]});for(let s=0;s<f.length;s++)n[s].scale=n[s].scale===_?r:n[s].scale,f[s].scale=f[s].scale===_?r:f[s].scale,T(n[s].effects,f[s].effects)}function F(t,e,r){return t+(e-t)*r}function I(t){let e=t[0];return!!e&&"type"in e}c([l()],o.prototype,"_to",void 0),c([l()],o.prototype,"duration",void 0),c([l({value:""})],o.prototype,"effect",null),c([l({readOnly:!0})],o.prototype,"effects",void 0),c([l({readOnly:!0})],o.prototype,"final",null),c([l({readOnly:!0})],o.prototype,"hasEffects",null),c([l({value:0})],o.prototype,"scale",null),c([l({readOnly:!0})],o.prototype,"transitioning",null),o=c([g("esri.layers.effects.EffectView")],o);export{o as a};
