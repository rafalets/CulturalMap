import{b as N}from"./chunk-Y6FO2W3O.js";import{f as O,g as R}from"./chunk-SP2CO3KX.js";import{i as H}from"./chunk-EY7OVTAY.js";import{a as $,b as V,m as Z}from"./chunk-YO56ZRXD.js";import"./chunk-4D3QHJI2.js";import"./chunk-E2J2V7JN.js";import{a as F,b as U,c as E,d as W}from"./chunk-IPGHBSHO.js";import"./chunk-XPXAET6Q.js";import{f as D}from"./chunk-JH4RD366.js";import"./chunk-7Y6S2GNA.js";import"./chunk-VOB6IBIW.js";import"./chunk-63B3IOWG.js";import"./chunk-PTZYZULI.js";import"./chunk-KZKWOEFD.js";import"./chunk-LNVVFNTC.js";import"./chunk-RCDSCJMH.js";import"./chunk-QJADLTFR.js";import"./chunk-X7QUUHRV.js";import"./chunk-7B2UKJ5N.js";import"./chunk-RSDQHAJX.js";import"./chunk-JR22Z7I2.js";import{d as C}from"./chunk-3QNSJ5HY.js";import"./chunk-UNVICPIE.js";import"./chunk-BGICKEJR.js";import"./chunk-TRZXSDYA.js";import"./chunk-OGS2SUK5.js";import"./chunk-TVHRLNTK.js";import"./chunk-JA3EMS2I.js";import"./chunk-HKHTIKVW.js";import"./chunk-XFESK2YB.js";import"./chunk-IJBTA53P.js";import"./chunk-ZHUXSQTN.js";import"./chunk-YLZWDFCJ.js";import"./chunk-TLMADEUL.js";import"./chunk-WNSGKHQ6.js";import{a as j}from"./chunk-J5MXC6AL.js";import{a as x}from"./chunk-OLOKUDVI.js";import"./chunk-RJWOVI3M.js";import"./chunk-AZS4Q4RE.js";import"./chunk-QEBUS3TL.js";import"./chunk-NHSDW26F.js";import"./chunk-CNQVGGE6.js";import"./chunk-JGD7UKVF.js";import"./chunk-J372WZPB.js";import"./chunk-6XFS4U2F.js";import"./chunk-XPRVY6JT.js";import"./chunk-7N3ZKWML.js";import"./chunk-E62WHYYG.js";import"./chunk-QDTU3MWT.js";import"./chunk-BCREO4Q5.js";import"./chunk-3SDSCSDJ.js";import"./chunk-I4M2OT5W.js";import"./chunk-NTVLK3P2.js";import"./chunk-WMQNRNIU.js";import"./chunk-HD52PWPC.js";import"./chunk-EIPVFA6F.js";import"./chunk-VOFKUGRY.js";import"./chunk-IG66NQHW.js";import"./chunk-ARRCN5K3.js";import"./chunk-UAKHZRKN.js";import"./chunk-HAHX77IL.js";import"./chunk-LB5YQINJ.js";import"./chunk-EKMHQEJY.js";import"./chunk-VACZNAP3.js";import"./chunk-JKNCWG7E.js";import"./chunk-KTE5HCNJ.js";import"./chunk-F7VRLFCB.js";import"./chunk-7IPIJKWU.js";import"./chunk-7R33MKVL.js";import"./chunk-ISSJ3A6Y.js";import"./chunk-VDKRSX77.js";import"./chunk-WUA6PW3I.js";import"./chunk-E57FTRWF.js";import"./chunk-U4J5SECU.js";import"./chunk-7EG726PT.js";import"./chunk-C7INQGWT.js";import"./chunk-WMHJC7XF.js";import"./chunk-NJEWDTYF.js";import"./chunk-N3SDOFND.js";import"./chunk-OVHPPCBL.js";import"./chunk-FNXQZPHT.js";import"./chunk-3TQOUBNU.js";import"./chunk-D2LVMNOU.js";import"./chunk-SNFOAZZQ.js";import"./chunk-QGVBCWUY.js";import{t as T}from"./chunk-HHDFN2GK.js";import"./chunk-47GHT6OF.js";import{a as z,b as k,f as A}from"./chunk-VTHXE323.js";var Q="picture-fill",Y="picture-marker",_="simple-fill",tt="simple-line",et="simple-marker",nt="text",ot="Aa",at=$.size,P=$.maxSize,it=$.maxOutlineSize,I=$.lineWidth,G=225,lt=document.createElement("canvas");function J(e,t,s){if(e.type==="polygon"){let o=e.extent,u=o.width===0?1:o.width,r=o.height===0?1:o.height;e=O({originPosition:"upperLeft",scale:[u/t,r/s],translate:[o.xmin,o.ymax]},{},e);let c="";for(let l=0;l<e.rings.length;l++){let a=e.rings[l];for(let h=0;h<a.length;h++){let p=a[h][0],d=a[h][1],n="";h===0?(n=`M${p.toString()} ${d.toString()}`,c!==""&&(n=` ${n}`),c+=n):h===a.length-1?(n=`l${p.toString()} ${d.toString()} Z`,c!==""&&(n=` ${n}`),c+=n):(n=`l${p.toString()} ${d.toString()}`,c!==""&&(n=` ${n}`),c+=n)}}return c}if(e.type==="polyline"){let o=e.extent,u=o.width===0?1:o.width,r=o.height===0?1:o.height;e=R({originPosition:"upperLeft",scale:[u/t,r/s],translate:[o.xmin,o.ymax]},{},e);let c="";for(let l=0;l<e.paths.length;l++){let a=e.paths[l];for(let h=0;h<a.length;h++){let p=a[h][0],d=a[h][1],n="";h===0?(n=`M${p.toString()} ${d.toString()}`,c!==""&&(n=` ${n}`),c+=n):(n=`l${p.toString()} ${d.toString()}`,c!==""&&(n=` ${n}`),c+=n)}}return c}return""}function X(e,t){let s=lt.getContext("2d"),o=[];t&&(t.weight&&o.push(t.weight),t.size&&o.push(t.size+"px"),t.family&&o.push(t.family)),s.font=o.join(" ");let{width:u,actualBoundingBoxLeft:r,actualBoundingBoxRight:c,actualBoundingBoxAscent:l,actualBoundingBoxDescent:a}=s.measureText(e);return{width:Math.ceil(Math.max(u,r+c)),height:Math.ceil(l+a),x:Math.floor(r),y:Math.floor((l-a)/2)}}function L(e){let t=e?.size;return{width:t!=null&&typeof t=="object"&&"width"in t?x(t.width):null,height:t!=null&&typeof t=="object"&&"height"in t?x(t.height):null}}function st(e,t){return A(this,null,function*(){let s=t.fill,o=e.color;if(s?.type==="pattern"&&o&&e.type!==Q){let u=yield U(s.src,o.toCss(!0));s.src=u,t.fill=s}})}function rt(e,t,s,o){return A(this,null,function*(){if(!("font"in e)||!e.font||t.shape.type!=="text")return;try{yield N(e.font)}catch{}let{width:u,height:r}=L(o);if(!/[\uE600-\uE6FF]/.test(t.shape.text)){let{width:c,height:l,x:a,y:h}=X(t.shape.text,{weight:t.font?.weight,size:t.font?.size,family:t.font?.family});s[0]=u??c,s[1]=r??l,t.shape.x=a,t.shape.y=h;let p="angle"in e?e.angle:null;if(o?.rotation!=null&&(p=(p??0)+o.rotation),p){let d=p*(Math.PI/180),n=Math.abs(Math.sin(d)),i=Math.abs(Math.cos(d));s[1]=s[0]*n+s[1]*i}}})}function ht(e,t,s,o,u){if(e.haloColor!=null&&e.haloSize!=null){u.masking??=s.map(()=>[]);let r=x(e.haloSize);o[0]+=r,o[1]+=r,s.unshift([k(z({},t),{fill:null,stroke:{color:e.haloColor,width:2*r,join:"round",cap:"round"}})]),u.masking.unshift([{shape:{type:"rect",x:0,y:0,width:o[0]+2*C,height:o[1]+2*C},fill:[255,255,255],stroke:null},k(z({},t),{fill:[0,0,0,0],stroke:null})])}e.backgroundColor==null&&e.borderLineColor==null||(o[0]+=2*C,o[1]+=2*C,s.unshift([{shape:{type:"rect",x:0,y:0,width:o[0],height:o[1]},fill:e.backgroundColor,stroke:{color:e.borderLineColor,width:x(e.borderLineSize)}}]),u.masking?.unshift([]))}function K(e,t){return e>t?"dark":"light"}function ct(e,t){let s=typeof t?.size=="number"?t?.size:null,o=s!=null?x(s):null,u=t?.maxSize!=null?x(t.maxSize):null,r="angle"in e?e.angle:null;t?.rotation!=null&&(r=(r??0)+t.rotation);let c=F(e),l=E(e);mt(e,245)!=="dark"||t?.ignoreWhiteSymbols||(l=k(z({width:.75},l),{color:"#bdc3c7"}));let a=null,h={shape:null,fill:c,stroke:l,offset:[0,0]};l?.width&&(l.width=Math.min(l.width,it));let p=l?.width||0,d=t?.size!=null&&(t?.scale==null||t?.scale),n=0,i=0,M=!1;switch(e.type){case et:{let f=e.style,{width:g,height:m}=L(t),b=g===m&&g!=null?g:o??Math.min(x(e.size),u||P);if(t?.useMarkerSymbolSize===!0&&g!==null&&m!==null){let y=Math.min(x(e.size),u||P);b=y>g&&y>m?Math.min(g,m):y}switch(n=b,i=b,f){case"circle":h.shape={type:"circle",cx:0,cy:0,r:.5*b},d||(n+=p,i+=p);break;case"cross":h.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[n,.5*i]},{command:"M",values:[.5*n,0]},{command:"L",values:[.5*n,i]}]};break;case"diamond":h.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[.5*n,0]},{command:"L",values:[n,.5*i]},{command:"L",values:[.5*n,i]},{command:"Z",values:[]}]},d||(n+=p,i+=p);break;case"square":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,0]},{command:"L",values:[n,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},d||(n+=p,i+=p),r&&(M=!0);break;case"triangle":h.shape={type:"path",path:[{command:"M",values:[.5*n,0]},{command:"L",values:[n,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},d||(n+=p,i+=p),r&&(M=!0);break;case"x":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,i]},{command:"M",values:[n,0]},{command:"L",values:[0,i]}]},r&&(M=!0);break;case"path":h.shape={type:"path",path:e.path||""},d||(n+=p,i+=p),r&&(M=!0),d=!0}break}case tt:{let{width:f,height:g}=L(t),m=W(l).reduce((S,v)=>S+v,0),b=m&&Math.ceil(I/m),y=g??o??p,w=f??(m*b||I);if(d=!0,t?.geometry?.type==="polyline"&&t?.geometry?.extent){n=w,i=g??n;let S=1e3,v=.15*S;a=[n,i],i=a[0]>a[1]?S*a[1]/a[0]:S,n=a[0]>a[1]?S:S*a[0]/a[1],l?.width&&(l.width=l.width*S/(a[1]>a[0]?a[1]:a[0]),l.width>v&&(l.width=v)),h.shape={type:"path",path:J(t.geometry,n,i)}}else n=t?.maxSize!=null?Math.min(w,t.maxSize):w,i=y,l&&(l.width=y),h.shape={type:"path",path:[{command:"M",values:[y/2,i/2]},{command:"L",values:[n-y/2,i/2]}]};break}case Q:case _:{let f=typeof t?.symbolConfig=="object"&&!!t?.symbolConfig?.isSquareFill,{width:g,height:m}=L(t);n=!f&&g!==m||g==null?o??at:g,i=!f&&g!==m||m==null?n:m,d||(n+=p,i+=p),d=!0,t?.geometry?.extent&&t?.geometry?.type==="polygon"?(a=[n,i],i=a[0]>a[1]?1e3*a[1]/a[0]:1e3,n=a[0]>a[1]?1e3:1e3*a[0]/a[1],h.shape={type:"path",path:J(t.geometry,n,i)}):h.shape=f?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,0]},{command:"L",values:[n,i]},{command:"L",values:[0,i]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:V.fill[0];break}case Y:{let f=Math.min(x(e.width),u||P),g=Math.min(x(e.height),u||P),{width:m,height:b}=L(t),y=m===b&&m!=null?m:o??Math.max(f,g),w=e.width/e.height;n=w<=1?Math.ceil(y*w):y,i=w<=1?y:Math.ceil(y/w),h.shape={type:"image",x:-Math.round(n/2),y:-Math.round(i/2),width:n,height:i,src:e.url||""},r&&(M=!0);break}case nt:{let f=e,g=t?.overrideText||f.text||ot,m=f.font,{width:b,height:y}=L(t),w=y??o??Math.min(x(m.size),u||P),{width:S,height:v}=X(g,{weight:m.weight,size:w,family:m.family}),B=/[\uE600-\uE6FF]/.test(g);n=b??(B?w:S),i=B?w:v;let q=.5*(B?w:v);B&&(q+=5),h.shape={type:"text",text:g,x:f.xoffset||0,y:f.yoffset||q,align:"middle",alignBaseline:f.verticalAlignment,decoration:m&&m.decoration,rotated:f.rotated,kerning:f.kerning},h.font=m&&{size:w,style:m.style,decoration:m.decoration,weight:m.weight,family:m.family};break}}return{shapeDescriptor:h,size:[n,i],outputSize:a,renderOptions:{node:t?.node,scale:d,opacity:t?.opacity,rotations:[r],useRotationSize:M,effectView:t?.effectView,ariaLabel:t?.ariaLabel}}}function vt(e,t){return A(this,null,function*(){let{shapeDescriptor:s,size:o,renderOptions:u,outputSize:r}=ct(e,t);if(!s.shape)throw new T("symbolPreview: renderPreviewHTML2D","symbol not supported.");yield st(e,s),yield rt(e,s,o,t);let c=[[s]];if(typeof t?.symbolConfig=="object"&&t?.symbolConfig?.applyColorModulation){let a=.6*o[0];c.unshift([k(z({},s),{offset:[-a,0],fill:Z(s.fill,-.3)})]),c.push([k(z({},s),{offset:[a,0],fill:Z(s.fill,.3)})]),o[0]+=2*a,u.scale=!1}e.type==="text"&&ht(e,s,c,o,u);let l=H(c,o,u);if(r&&l){let a=l.nodeName.toLowerCase()==="img"?l:l.firstChild;a.nodeName.toLowerCase()==="svg"&&a.setAttribute("viewBox",`0 0 ${o[0].toString()} ${o[1].toString()}`),a.setAttribute("width",r[0].toString()),a.setAttribute("height",r[1].toString()),r.length>2&&(a.style.setProperty("padding-left",r[2]?.toString()+"px"),a.style.setProperty("padding-right",r[2]?.toString()+"px"),a.style.setProperty("padding-top",r[3]?.toString()+"px"),a.style.setProperty("padding-bottom",r[3]?.toString()+"px"),a.style.setProperty("box-sizing","border-box"))}return l})}function mt(e,t=G){let s=F(e),o=E(e),u=!s||"type"in s?null:new j(s),r=o?.color?new j(o?.color):null,c=u?K(D(u),t):null,l=r?K(D(r),t):null;return l?c?c===l?c:t>=G?"light":"dark":l:c}export{mt as getContrastingBackgroundTheme,ct as getRenderSymbolParameters,vt as previewSymbol2D};
