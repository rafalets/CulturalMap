import{a as u}from"./chunk-QXNVQZT7.js";import{r as w,t as g}from"./chunk-HHDFN2GK.js";var T=()=>w.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder"),d=class{constructor(){this._includedModules=new Map}include(e,n){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,n),e(this.builder,n))}},v=class extends d{constructor(){super(...arguments),this.vertex=new l,this.fragment=new l,this.attributes=new S,this.varyings=new $,this.extensions=new h,this.outputs=new m}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e,n=!1){let t=this.extensions.generateSource(e),i=this.attributes.generateSource(e),a=this.varyings.generateSource(e),s=e==="vertex"?this.vertex:this.fragment,o=s.uniforms.generateSource(),c=s.code.generateSource(),y=s.main.generateSource(n),E=e==="vertex"?L:I,A=s.constants.generateSource(),F=this.outputs.generateSource(e);return`#version 300 es
${t.join(`
`)}
${E}
${A.join(`
`)}
${o.join(`
`)}
${i.join(`
`)}
${a.join(`
`)}
${F.join(`
`)}
${c.join(`
`)}
${y.join(`
`)}`}generateBind(e){let n=new Map;this.vertex.uniforms.entries.forEach(a=>{let s=a.bind[u.Bind];s&&n.set(a.name,s)}),this.fragment.uniforms.entries.forEach(a=>{let s=a.bind[u.Bind];s&&n.set(a.name,s)});let t=Array.from(n.values()),i=t.length;return a=>{for(let s=0;s<i;++s)t[s](e,a)}}generateBindPass(e){let n=new Map;this.vertex.uniforms.entries.forEach(a=>{let s=a.bind[u.Pass];s&&n.set(a.name,s)}),this.fragment.uniforms.entries.forEach(a=>{let s=a.bind[u.Pass];s&&n.set(a.name,s)});let t=Array.from(n.values()),i=t.length;return(a,s)=>{for(let o=0;o<i;++o)t[o](e,a,s)}}generateBindDraw(e){let n=new Map;this.vertex.uniforms.entries.forEach(a=>{let s=a.bind[u.Draw];s&&n.set(a.name,s)}),this.fragment.uniforms.entries.forEach(a=>{let s=a.bind[u.Draw];s&&n.set(a.name,s)});let t=Array.from(n.values()),i=t.length;return(a,s,o)=>{for(let c=0;c<i;++c)t[c](e,o,a,s)}}},f=class{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(let n of e)this._add(n);return this._stage}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new g(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else T().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},_=class{constructor(e){this._stage=e,this._bodies=new Array}add(e){return this._bodies.push(e),this._stage}generateSource(e){if(this._bodies.length>0)return[`void main() {
 ${this._bodies.join(`
`)||""} 
}`];if(e)throw new g("Shader does not contain main function body.");return[]}},p=class{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}},l=class extends d{constructor(){super(...arguments),this.uniforms=new f(this),this.main=new _(this),this.code=new p(this),this.constants=new b(this)}get builder(){return this}},S=class{constructor(){this._entries=new Array}add(e,n){this._entries.push([e,n])}generateSource(e){return e==="fragment"?[]:this._entries.map(n=>`in ${n[1]} ${n[0]};`)}},$=class{constructor(){this._entries=new Map}add(e,n){this._entries.has(e)?T().warn(`Ignoring duplicate varying ${n} ${e}`):this._entries.set(e,n)}generateSource(e){let n=new Array;return this._entries.forEach((t,i)=>n.push(e==="vertex"?`out ${t} ${i};`:`in ${t} ${i};`)),n}},h=class r{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){let n=e==="vertex"?r.ALLOWLIST_VERTEX:r.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(t=>n.includes(t)).map(t=>`#extension ${t} : enable`)}};h.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],h.ALLOWLIST_VERTEX=[];var m=class r{constructor(){this._entries=new Map}add(e,n,t=0){let i=this._entries.get(t);i?.name!==e||i?.type!==n?this._entries.set(t,{name:e,type:n}):T().warn(`Fragment shader output location ${t} occupied`)}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:r.DEFAULT_NAME,type:r.DEFAULT_TYPE});let n=new Array;return this._entries.forEach((t,i)=>n.push(`layout(location = ${i}) out ${t.type} ${t.name};`)),n}};m.DEFAULT_TYPE="vec4",m.DEFAULT_NAME="fragColor";var b=class r{constructor(e){this._stage=e,this._entries=new Set}add(e,n,t){let i="ERROR_CONSTRUCTOR_STRING";switch(n){case"float":i=r._numberToFloatStr(t);break;case"int":i=r._numberToIntStr(t);break;case"bool":i=t.toString();break;case"vec2":i=`vec2(${r._numberToFloatStr(t[0])},                            ${r._numberToFloatStr(t[1])})`;break;case"vec3":i=`vec3(${r._numberToFloatStr(t[0])},                            ${r._numberToFloatStr(t[1])},                            ${r._numberToFloatStr(t[2])})`;break;case"vec4":i=`vec4(${r._numberToFloatStr(t[0])},                            ${r._numberToFloatStr(t[1])},                            ${r._numberToFloatStr(t[2])},                            ${r._numberToFloatStr(t[3])})`;break;case"ivec2":i=`ivec2(${r._numberToIntStr(t[0])},                             ${r._numberToIntStr(t[1])})`;break;case"ivec3":i=`ivec3(${r._numberToIntStr(t[0])},                             ${r._numberToIntStr(t[1])},                             ${r._numberToIntStr(t[2])})`;break;case"ivec4":i=`ivec4(${r._numberToIntStr(t[0])},                             ${r._numberToIntStr(t[1])},                             ${r._numberToIntStr(t[2])},                             ${r._numberToIntStr(t[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${n}(${Array.prototype.map.call(t,a=>r._numberToFloatStr(a)).join(", ")})`}return this._entries.add(`const ${n} ${e} = ${i};`),this._stage}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}},I=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp int;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump int;
  precision mediump sampler2D;
#endif`,L=`precision highp float;
precision highp sampler2D;`;export{v as a};
