import{a as F}from"./chunk-WNSGKHQ6.js";import{a as w}from"./chunk-WUA6PW3I.js";import{f as z}from"./chunk-7EG726PT.js";import{d as g}from"./chunk-C7INQGWT.js";import{H as C}from"./chunk-WMHJC7XF.js";import{a as y}from"./chunk-QGVBCWUY.js";import{r as S}from"./chunk-HHDFN2GK.js";var I=new w({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),B=new w({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"}),v=class extends z{constructor(a){super(a),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(a){this.classificationMethod==="standard-deviation"&&this._set("standardDeviationInterval",a)}set definedInterval(a){this.classificationMethod==="defined-interval"&&this._set("definedInterval",a)}};y([F({classBreaksDef:"class-breaks-definition"})],v.prototype,"type",void 0),y([g({json:{write:!0}})],v.prototype,"breakCount",void 0),y([g({json:{write:!0}})],v.prototype,"classificationField",void 0),y([g({type:String,json:{read:I.read,write:I.write}})],v.prototype,"classificationMethod",void 0),y([g({json:{write:!0}})],v.prototype,"normalizationField",void 0),y([g({json:{read:B.read,write:B.write}})],v.prototype,"normalizationType",void 0),y([g({value:null,json:{write:!0}})],v.prototype,"standardDeviationInterval",null),y([g({value:null,json:{write:!0}})],v.prototype,"definedInterval",null),v=y([C("esri.rest.support.ClassBreaksDefinition")],v);var X=v;var D=()=>S.getLogger("esri.rest.support.generateRendererUtils");function x(a,s){return Number(a.toFixed(s))}function ee(a){let s=j(a),n=[],f=s.uniqueValues.length;for(let i=0;i<f;i++){let d=s.uniqueValues[i],c=s.valueFrequency[i],u=d.toString();n.push({value:d,count:c,label:u})}return{uniqueValues:n}}function te(a,s){let{normalizationTotal:n}=a;return{classBreaks:T(a,s),normalizationTotal:n}}function T(a,s){let n=a.definition,{classificationMethod:f,normalizationType:i,definedInterval:d}=n,c=n.breakCount??1,u=[],l=a.values;if(l.length===0)return[];l=l.sort((r,t)=>r-t);let[p,h]=s??[l.at(0),l.at(-1)];if(f==="equal-interval")if(l.length>=c){let r=(h-p)/c,t=p;for(let e=1;e<c;e++){let o=x(p+e*r,6);u.push({minValue:t,maxValue:o,label:V(t,o,i)}),t=o}u.push({minValue:t,maxValue:h,label:V(t,h,i)})}else l.forEach(r=>{u.push({minValue:r,maxValue:r,label:V(r,r,i)})});else if(f==="natural-breaks"){let r=j(l),t=a.valueFrequency||r.valueFrequency,e=E(r.uniqueValues,t,c),o=p;for(let m=1;m<c;m++)if(r.uniqueValues.length>m){let b=x(r.uniqueValues[e[m]],6);u.push({minValue:o,maxValue:b,label:V(o,b,i)}),o=b}u.push({minValue:o,maxValue:h,label:V(o,h,i)})}else if(f==="quantile")if(l.length>=c&&p!==h){let r=p,t=Math.ceil(l.length/c),e=0;for(let o=1;o<c;o++){let m=t+e-1;m>l.length&&(m=l.length-1),m<0&&(m=0),u.push({minValue:r,maxValue:l[m],label:V(r,l[m],i)}),r=l[m],e+=t,t=Math.ceil((l.length-e)/(c-o))}u.push({minValue:r,maxValue:h,label:V(r,h,i)})}else{let r=-1;for(let t=0;t<l.length;t++){let e=l[t];e!==r&&(r=e,u.push({minValue:r,maxValue:e,label:V(r,e,i)}),r=e)}}else if(f==="standard-deviation"){let r=R(l),t=U(l,r);if(t===0)u.push({minValue:l[0],maxValue:l[0],label:V(l[0],l[0],i)});else{let e=L(p,h,c,r,t)*t,o=0,m=p;for(let M=c;M>=1;M--){let k=x(r-(M-.5)*e,6);u.push({minValue:m,maxValue:k,label:V(m,k,i)}),m=k,o++}let b=x(r+.5*e,6);u.push({minValue:m,maxValue:b,label:V(m,b,i)}),m=b,o++;for(let M=1;M<=c;M++)b=o===2*c?h:x(r+(M+.5)*e,6),u.push({minValue:m,maxValue:b,label:V(m,b,i)}),m=b,o++}}else if(f==="defined-interval"){if(!d)return u;let[r,t]=s??[l.at(0),l.at(-1)],e=Math.ceil((t-r)/d),o=r;for(let m=1;m<e;m++){let b=x(r+m*d,6);u.push({minValue:o,maxValue:b,label:V(o,b,i)}),o=b}u.push({minValue:o,maxValue:t,label:V(o,t,i)})}return u}function V(a,s,n){let f=null;return f=a===s?n&&n==="percent-of-total"?a+"%":a.toString():n&&n==="percent-of-total"?a+"% - "+s+"%":a+" - "+s,f}function j(a){let s=[],n=[],f=Number.MIN_VALUE,i=1,d=-1;for(let c=0;c<a.length;c++){let u=a[c];u===f?(i++,n[d]=i):u!==null&&(s.push(u),f=u,i=1,n.push(i),d++)}return{uniqueValues:s,valueFrequency:n}}function E(a,s,n){let f=a.length,i=[];n>f&&(n=f);for(let c=0;c<n;c++)i.push(Math.round(c*f/n-1));i.push(f-1);let d=N(i,a,s,n);return _(d.mean,d.sdcm,i,a,s,n)&&(d=N(i,a,s,n)),i}function N(a,s,n,f){let i=[],d=[],c=[],u=0,l=[],p=[];for(let e=0;e<f;e++){let o=q(e,a,s,n);l.push(o.sbMean),p.push(o.sbSdcm),u+=p[e]}let h,r=u,t=!0;for(;t||u<r;){t=!1,i=[];for(let e=0;e<f;e++)i.push(a[e]);for(let e=0;e<f;e++)for(let o=a[e]+1;o<=a[e+1];o++)if(h=s[o],e>0&&o!==a[e+1]&&Math.abs(h-l[e])>Math.abs(h-l[e-1]))a[e]=o;else if(e<f-1&&a[e]!==o-1&&Math.abs(h-l[e])>Math.abs(h-l[e+1])){a[e+1]=o-1;break}r=u,u=0,d=[],c=[];for(let e=0;e<f;e++){d.push(l[e]),c.push(p[e]);let o=q(e,a,s,n);l[e]=o.sbMean,p[e]=o.sbSdcm,u+=p[e]}}if(u>r){for(let e=0;e<f;e++)a[e]=i[e],l[e]=d[e],p[e]=c[e];u=r}return{mean:l,sdcm:p}}function _(a,s,n,f,i,d){let c=0,u=0,l=0,p=0,h=!0;for(let r=0;r<2&&h;r++){r===0&&(h=!1);for(let t=0;t<d-1;t++)for(;n[t+1]+1!==n[t+2];){n[t+1]=n[t+1]+1;let e=q(t,n,f,i);l=e.sbMean,c=e.sbSdcm;let o=q(t+1,n,f,i);if(p=o.sbMean,u=o.sbSdcm,!(c+u<s[t]+s[t+1])){n[t+1]=n[t+1]-1;break}s[t]=c,s[t+1]=u,a[t]=l,a[t+1]=p,h=!0}for(let t=d-1;t>0;t--)for(;n[t]!==n[t-1]+1;){n[t]=n[t]-1;let e=q(t-1,n,f,i);l=e.sbMean,c=e.sbSdcm;let o=q(t,n,f,i);if(p=o.sbMean,u=o.sbSdcm,!(c+u<s[t-1]+s[t])){n[t]=n[t]+1;break}s[t-1]=c,s[t]=u,a[t-1]=l,a[t]=p,h=!0}}return h}function L(a,s,n,f,i){let d=Math.max(f-a,s-f)/i/n;return d=d>=1?1:d>=.5?.5:.25,d}function R(a){let s=0;for(let n=0;n<a.length;n++)s+=a[n];return s/=a.length,s}function U(a,s){let n=0;for(let f=0;f<a.length;f++){let i=a[f];n+=(i-s)*(i-s)}return n/=a.length,Math.sqrt(n)}function q(a,s,n,f){let i=0,d=0;for(let l=s[a]+1;l<=s[a+1];l++){let p=f[l];i+=n[l]*p,d+=p}d<=0&&D().warn("Exception in Natural Breaks calculation");let c=i/d,u=0;for(let l=s[a]+1;l<=s[a+1];l++)u+=f[l]*(n[l]-c)**2;return{sbMean:c,sbSdcm:u}}export{X as a,ee as b,te as c};
