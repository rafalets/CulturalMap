import{a as l}from"./chunk-LVSL2E7G.js";import{h as s}from"./chunk-63B3IOWG.js";import{a as c}from"./chunk-D2LVMNOU.js";function d(e){return e.frameDurations.reduce((t,n)=>t+n,0)}function _(e){let{width:t,height:n}=e,o=e.frameDurations.reverse(),a=r=>{let i=e.frameDurations.length-1-r;return e.getFrame(i)};return{frameCount:e.frameCount,duration:e.duration,frameDurations:o,getFrame:a,width:t,height:n}}function F(e,t){let{width:n,height:o,getFrame:a}=e,r=t/e.duration,i=e.frameDurations.map(m=>m*r);return{frameCount:e.frameCount,duration:e.duration,frameDurations:i,getFrame:a,width:n,height:o}}function p(e,t){let{width:n,height:o,getFrame:a}=e,r=e.frameDurations.slice(),i=r.shift();return r.unshift(i+t),{frameCount:e.frameCount,duration:e.duration+t,frameDurations:r,getFrame:a,width:n,height:o}}function f(e,t){let{width:n,height:o,getFrame:a}=e,r=e.frameDurations.slice(),i=r.pop();return r.push(i+t),{frameCount:e.frameCount,duration:e.duration+t,frameDurations:r,getFrame:a,width:n,height:o}}var h=class{constructor(t,n,o,a){this._animation=t,this._repeatType=o,this._onFrameData=a,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let r=0;for(;n>r;)r+=this.timeToFrame,this.nextFrame();let i=this._animation.getFrame(this._currentFrame);this._onFrameData(i)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case s.None:this._currentFrame-=this._direction;break;case s.Loop:this._currentFrame=0;break;case s.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(this._currentFrame===-1)switch(this._repeatType){case s.None:this._currentFrame-=this._direction;break;case s.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case s.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];let t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}};function g(e,t,n,o){let a,{repeatType:r}=t;if(r==null&&(r=s.Loop),t.reverseAnimation===!0&&(e=_(e)),t.duration!=null&&(e=F(e,1e3*t.duration)),t.repeatDelay!=null){let i=1e3*t.repeatDelay;r===s.Loop?e=f(e,i):r===s.Oscillate&&(e=p(f(e,i/2),i/2))}if(t.startTimeOffset!=null)a=1e3*t.startTimeOffset;else if(t.randomizeStartTime!=null){let m=t.randomizeStartSeed!=null?t.randomizeStartSeed:82749913,u=l(n,m);a=u*d(e)}else a=0;return new h(e,a,r,o)}function S(e,t,n,o){let a=t.playAnimation==null||t.playAnimation,r=g(e,t,n,o),i,m=r.timeToFrame;function u(){i=a?setTimeout(()=>{r.nextFrame(),m=r.timeToFrame,u()},m):void 0}return u(),c(()=>a&&clearTimeout(i))}export{S as a};
