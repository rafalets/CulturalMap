import{a as q}from"./chunk-OA75I4GZ.js";import{a as R,b as V}from"./chunk-HGWE24UR.js";import{b as _}from"./chunk-XXED5BJG.js";import{f as N}from"./chunk-RBPJGXZM.js";import{c as f}from"./chunk-6T37AWU6.js";import{a as O}from"./chunk-JEGXFID4.js";import{b as h}from"./chunk-B5LBE5HD.js";import{k as Q}from"./chunk-BBB7KLHV.js";import{b as d}from"./chunk-R6GE4XRP.js";import{j as w}from"./chunk-I4M2OT5W.js";import{p as g}from"./chunk-IG66NQHW.js";import{h as D}from"./chunk-U4J5SECU.js";import{L as b,d as u}from"./chunk-C7INQGWT.js";import{H as F}from"./chunk-WMHJC7XF.js";import{B as c}from"./chunk-D2LVMNOU.js";import{a as n}from"./chunk-QGVBCWUY.js";import{t as y}from"./chunk-HHDFN2GK.js";import{a as S}from"./chunk-47GHT6OF.js";import{a as x,f as i}from"./chunk-VTHXE323.js";function I(e,t,r){return i(this,null,function*(){let s=d(e),p=yield N(s,f.from(t),x({},r)),o=p.data.extent;return!o||isNaN(o.xmin)||isNaN(o.ymin)||isNaN(o.xmax)||isNaN(o.ymax)?{count:p.data.count,extent:null}:{count:p.data.count,extent:w.fromJSON(o)}})}var a=class extends b{constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.gdbVersion=null,this.infoFor3D=null,this.pbfSupported=!1,this.queryAttachmentsSupported=!1,this.sourceSpatialReference=null,this.url=null}get parsedUrl(){return D(this.url)}execute(e,t){return i(this,null,function*(){let r=yield this.executeJSON(e,t);return this.featureSetFromJSON(e,r,t)})}executeJSON(e,t){return i(this,null,function*(){let r=this._normalizeQuery(e),s=e.outStatistics?.[0]!=null,p=S("featurelayer-pbf-statistics"),o=(!s||p)&&e.returnTrueCurves!==!0,l;if(this.pbfSupported&&o)try{l=yield q(this.url,r,t)}catch(m){if(m.name!=="query:parsing-pbf")throw m;this.pbfSupported=!1}return this.pbfSupported&&o||(l=yield _(this.url,r,t)),this._normalizeFields(l.fields),l})}featureSetFromJSON(e,t,r){return i(this,null,function*(){if(!this._queryIs3DObjectFormat(e)||this.infoFor3D==null||!t.features)return O.fromJSON(t);let{meshFeatureSetFromJSON:s}=yield c(import("./chunk-MVJAA6ZQ.js"),r);return s(e,this.infoFor3D,t)})}executeForCount(e,t){return R(this.url,this._normalizeQuery(e),t)}executeForExtent(e,t){return I(this.url,this._normalizeQuery(e),t)}executeForIds(e,t){return V(this.url,this._normalizeQuery(e),t)}executeRelationshipQuery(e,t){return i(this,null,function*(){let[{default:r},{executeRelationshipQuery:s}]=yield c(Promise.all([import("./chunk-Z7WXODAN.js"),import("./chunk-S63FHI6U.js")]),t);return e=r.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),s(this.url,e,t)})}executeRelationshipQueryForCount(e,t){return i(this,null,function*(){let[{default:r},{executeRelationshipQueryForCount:s}]=yield c(Promise.all([import("./chunk-Z7WXODAN.js"),import("./chunk-S63FHI6U.js")]),t);return e=r.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),s(this.url,e,t)})}executeAttachmentQuery(e,t){return i(this,null,function*(){let{executeAttachmentQuery:r,fetchAttachments:s,processAttachmentQueryResult:p}=yield c(import("./chunk-EV3OZ43C.js"),t),o=d(this.url);return p(o,yield this.queryAttachmentsSupported?r(o,e,t):s(o,e,t))})}executeAttributeBinsQuery(e,t){return i(this,null,function*(){let{executeAttributeBinsQuery:r}=yield c(import("./chunk-3YKRXXUW.js"),t);return r(this.parsedUrl,e,t)})}executeTopFeaturesQuery(e,t){return i(this,null,function*(){let{executeTopFeaturesQuery:r}=yield c(import("./chunk-FO6YXTQY.js"),t);return r(this.parsedUrl,e,this.sourceSpatialReference,t)})}executeForTopIds(e,t){return i(this,null,function*(){let{executeForTopIds:r}=yield c(import("./chunk-EAY4W7KM.js"),t);return r(this.parsedUrl,e,t)})}executeForTopExtents(e,t){return i(this,null,function*(){let{executeForTopExtents:r}=yield c(import("./chunk-IWKESMB5.js"),t);return r(this.parsedUrl,e,t)})}executeForTopCount(e,t){return i(this,null,function*(){let{executeForTopCount:r}=yield c(import("./chunk-A5ZKUIXF.js"),t);return r(this.parsedUrl,e,t)})}_normalizeQuery(e){let t=f.from(e);t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===e?t.clone():t,t.gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?h.from(e.dynamicDataSource):this.dynamicDataSource);let{infoFor3D:r}=this;if(r!=null&&this._queryIs3DObjectFormat(e)){if(t=t===e?t.clone():t,t.formatOf3DObjects=Q(r),!t.formatOf3DObjects)throw new y("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(t.outSpatialReference&&!g(t.outSpatialReference,this.sourceSpatialReference))throw new y("query:unsupported-out-spatial-reference","3D object feature services do not support projection of geometries");if(t.outFields==null||!t.outFields.includes("*")){t=t===e?t.clone():t,t.outFields==null&&(t.outFields=[]);let{originX:s,originY:p,originZ:o,translationX:l,translationY:m,translationZ:T,scaleX:j,scaleY:v,scaleZ:A,rotationX:J,rotationY:U,rotationZ:C,rotationDeg:z}=r.transformFieldRoles;t.outFields.push(s,p,o,l,m,T,j,v,A,J,U,C,z)}}return t}_normalizeFields(e){if(this.fieldsIndex!=null&&e!=null)for(let t of e){let r=this.fieldsIndex.get(t.name);r&&Object.assign(t,r.toJSON())}}_queryIs3DObjectFormat(e){return this.infoFor3D!=null&&e.returnGeometry===!0&&e.multipatchOption!=="xyFootprint"&&!e.outStatistics}};n([u({type:h})],a.prototype,"dynamicDataSource",void 0),n([u()],a.prototype,"fieldsIndex",void 0),n([u()],a.prototype,"gdbVersion",void 0),n([u()],a.prototype,"infoFor3D",void 0),n([u({readOnly:!0})],a.prototype,"parsedUrl",null),n([u()],a.prototype,"pbfSupported",void 0),n([u()],a.prototype,"queryAttachmentsSupported",void 0),n([u()],a.prototype,"sourceSpatialReference",void 0),n([u({type:String})],a.prototype,"url",void 0),a=n([F("esri.layers.graphics.sources.support.QueryTask")],a);var dt=a;export{dt as a};
