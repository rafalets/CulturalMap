import{i as D,j as pe}from"./chunk-EY7OVTAY.js";import{a as L,b as z,c as te,d as ae,e as le,f as se,g as ne,h as re,i as oe,j as ie,k as ce,l as j}from"./chunk-YO56ZRXD.js";import{b as X,e as T,f as Y,h as _,i as ee}from"./chunk-IPGHBSHO.js";import{b as K,c as Q}from"./chunk-JH4RD366.js";import{a as J}from"./chunk-GJHJGJCY.js";import{f as G,i as $}from"./chunk-JR22Z7I2.js";import{a as w}from"./chunk-OLOKUDVI.js";import{a as R}from"./chunk-VDKRSX77.js";import{r as A,t as H}from"./chunk-HHDFN2GK.js";import{a as E,b as V,f as P}from"./chunk-VTHXE323.js";var M=L.size,W=L.maxSize,Z=L.maxOutlineSize,ue=L.lineWidth,q=L.tallSymbolWidth;function C(e){let t=e.outline,n=e.material!=null?e.material.color:null,a=n!=null?n.toHex():null;if(t==null||"pattern"in t&&t.pattern!=null&&t.pattern.type==="style"&&t.pattern.style==="none")return e.type==="fill"&&a==="#ffffff"?{color:"#bdc3c7",width:.75}:null;let s=w(t.size)||0;return{color:"rgba("+(t.color!=null?t.color.toRgba():"255,255,255,1")+")",width:Math.min(s,Z),style:"pattern"in t&&t.pattern!=null&&t.pattern.type==="style"?T(t.pattern.style):null,join:"butt",cap:"patternCap"in t?t.patternCap:"butt"}}function me(e,t){return P(this,null,function*(){if(e.thumbnail?.url)return e.thumbnail.url;if(t.type==="icon"&&t?.resource?.href)return ee(t);let n=R("esri/images/Legend/legend3dsymboldefault.png");if(e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)){let a=yield J(e.styleOrigin,{portal:e.styleOrigin.portal}).catch(()=>null);if(a&&"thumbnail"in a&&a.thumbnail?.url)return a.thumbnail.url}return n})}function U(e,t=1){let n=e.a,a=Q(e),s=a.h,c=a.s/t,o=100-(100-a.v)/t,{r:h,g:y,b:i}=K({h:s,s:c,v:o});return[h,y,i,n]}function I(e){return e.type==="water"?e.color==null?null:e.color:e.material?.color==null?null:e.material.color}function r(e,t=0){let n=I(e);if(!n){if(e.type==="fill")return null;let s=Y.r,c=j(s,t);return[c,c,c,100]}let a=n.toRgba();for(let s=0;s<3;s++)a[s]=j(a[s],t);return a}function fe(e,t){return P(this,null,function*(){let n=e.style;return n==="none"?null:{type:"pattern",x:0,y:0,src:yield X(R(`esri/symbols/patterns/${n}.png`),t.toCss(!0)),width:5,height:5}})}function he(e){return e.outline?C(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function B(e,t){let n=I(e);if(!n)return null;let a="rgba(";return a+=j(n.r,t)+",",a+=j(n.g,t)+",",a+=j(n.b,t)+",",a+n.a+");"}function F(e,t){let n=B(e,t);return n?"pattern"in e&&e.pattern!=null&&e.pattern.type==="style"&&e.pattern.style==="none"?null:{color:n,width:Math.min(e.size?w(e.size):.75,Z),style:"pattern"in e&&e.pattern!=null&&e.pattern.type==="style"?T(e.pattern.style):null,cap:"cap"in e?e.cap:null,join:"join"in e?e.join==="miter"?w(2):e.join:null}:{}}function O(e,t,n){let a=n!=null?.75*n:0;return{type:"linear",x1:a?.25*a:0,y1:a?.5*a:0,x2:a||4,y2:a?.5*a:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function ye(e){let t=e.depth,n=e.height,a=e.width;return a!==0&&t!==0&&n!==0&&a===t&&a!=null&&n!=null&&a<n}function de(e,t,n){let a=[];if(!e)return a;switch(e.type){case"icon":{let o=t,h=t;switch(e.resource?.primitive??G){case"circle":a.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:r(e,0),stroke:C(e)});break;case"square":a.push({shape:{type:"path",path:[{command:"M",values:[0,h]},{command:"L",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,h]},{command:"Z",values:[]}]},fill:r(e,0),stroke:C(e)});break;case"triangle":a.push({shape:{type:"path",path:[{command:"M",values:[0,h]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,h]},{command:"Z",values:[]}]},fill:r(e,0),stroke:C(e)});break;case"cross":a.push({shape:{type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,h]},{command:"M",values:[0,.5*h]},{command:"L",values:[o,.5*h]}]},stroke:he(e)});break;case"x":a.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,h]},{command:"M",values:[o,0]},{command:"L",values:[0,h]}]},stroke:he(e)});break;case"kite":a.push({shape:{type:"path",path:[{command:"M",values:[0,.5*h]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*h]},{command:"L",values:[.5*o,h]},{command:"Z",values:[]}]},fill:r(e,0),stroke:C(e)})}break}case"object":switch(e.resource?.primitive??$){case"cone":{let s=O(r(e,0),r(e,-.6),n?q:t),c=re(t,n);a.push({shape:c[0],fill:s},{shape:c[1],fill:s});break}case"inverted-cone":{let s=r(e,0),c=O(s,r(e,-.6),t),o=oe(t);a.push({shape:o[0],fill:c},{shape:o[1],fill:s});break}case"cube":{let s=se(t,n);a.push({shape:s[0],fill:r(e,0)},{shape:s[1],fill:r(e,-.3)},{shape:s[2],fill:r(e,-.5)});break}case"cylinder":{let s=O(r(e,0),r(e,-.6),n?q:t),c=ne(t,n);a.push({shape:c[0],fill:s},{shape:c[1],fill:s},{shape:c[2],fill:r(e,0)});break}case"diamond":{let s=ie(t);a.push({shape:s[0],fill:r(e,-.3)},{shape:s[1],fill:r(e,0)},{shape:s[2],fill:r(e,-.3)},{shape:s[3],fill:r(e,-.7)});break}case"sphere":{let s=O(r(e,0),r(e,-.6));s.x1=0,s.y1=0,s.x2=.25*t,s.y2=.25*t,a.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:s});break}case"tetrahedron":{let s=ce(t);a.push({shape:s[0],fill:r(e,-.3)},{shape:s[1],fill:r(e,0)},{shape:s[2],fill:r(e,-.6)});break}}break}return a}function N(e){let t=typeof e?.size=="number"?e?.size:null;return t?w(t):null}function be(e){return e.type==="icon"?"multiply":"tint"}function ge(e,t){return P(this,null,function*(){let n=N(t),a=t?.maxSize?w(t.maxSize):null,s=t?.disableUpsampling??!1,c=e.symbolLayers,o=[],h=[],y=!1,i=0,d=0,v=0;c.forEach(l=>{if(l.type!=="icon"&&l.type!=="object")return;l&&l.type==="icon"&&(v=Math.max(l.size&&w(l.size),v));let p=l.type==="icon"?l.size&&w(l.size):0,u=n||p?Math.ceil(Math.min(n||p,a||W)):M,f=l.type==="icon"?l.angle:null;if(t?.rotation!=null&&(f=(f??0)+t.rotation),h.push(f),l?.resource?.href){let b=me(e,l).then(g=>{let x=l?.material?.color,S=be(l);return pe(g,u,x,S,s)}).then(g=>{let x=g.width,S=g.height;return i=Math.max(i,x),d=Math.max(d,S),f&&(y=!0),[{shape:{type:"image",x:0,y:0,width:x,height:S,src:g.url},fill:null,stroke:null}]});o.push(b)}else{let b=u;l.type==="icon"&&n&&(b=u*(p/v));let g=t?.symbolConfig==="tall"||t?.symbolConfig?.isTall||l.type==="object"&&ye(l);i=Math.max(i,g?q:b),d=Math.max(d,b),f&&l.resource?.primitive&&["square","triangle","x"].includes(l.resource?.primitive)&&(y=!0),o.push(Promise.resolve(de(l,b,g)))}});let m=yield Promise.allSettled(o),k=[];return m.forEach(l=>{l.status==="fulfilled"?k.push(l.value):l.reason&&A.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",l.reason)}),D(k,[i,d],{node:t?.node,scale:!1,opacity:t?.opacity,ariaLabel:t?.ariaLabel,rotations:h,useRotationSize:y})})}function ke(e,t){let n=e.symbolLayers,a=[],s=_(e),c=N(t),o=(t?.maxSize?w(t.maxSize):null)||Z,h,y=0,i=0;return n.forEach((d,v)=>{if(!d||d.type!=="line"&&d.type!=="path")return;let m=[];switch(d.type){case"line":{let k=F(d,0);if(k==null)break;let l=k?.width||0;v===0&&(h=l);let p=Math.min(c||l,o),u=v===0?p:c?p*(l/h):p,f=u>ue/2?2*u:ue;i=Math.max(i,u),y=Math.max(y,f),k.width=u,m.push({shape:{type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[y,.5*i]}]},stroke:k});break}case"path":{let k=Math.min(c||M,o),l=r(d,0),p=r(d,-.2),u=B(d,-.4),f=u?{color:u,width:1}:{};if(d.profile==="quad"){let b=d.width,g=d.height,x=te(b&&g?b/g:1,g===0,b===0),S=V(E({},f),{join:"bevel"});m.push({shape:x[0],fill:p,stroke:S},{shape:x[1],fill:p,stroke:S},{shape:x[2],fill:l,stroke:S})}else m.push({shape:z.pathSymbol3DLayer[0],fill:p,stroke:f},{shape:z.pathSymbol3DLayer[1],fill:l,stroke:f});i=Math.max(i,k),y=i}}a.push(m)}),Promise.resolve(D(a,[y,i],{node:t?.node,scale:s,opacity:t?.opacity,ariaLabel:t?.ariaLabel}))}function ve(e,t){return P(this,null,function*(){let n=e.type==="mesh-3d",a=e.symbolLayers,s=N(t),c=t?.maxSize?w(t.maxSize):null,o=s||M,h=[],y=0,i=0,d=!1;for(let v=0;v<a.length;v++){let m=a.at(v),k=[];if(!n||m.type==="fill"){switch(m.type){case"fill":{let l=Math.min(o,c||W);if(y=Math.max(y,l),i=Math.max(i,l),d=!0,n){let p=z.meshSymbol3DFill,u=B(m,-.4),f=u?{color:u,width:1,join:"round"}:{};k.push({shape:p[0],fill:r(m,0),stroke:f},{shape:p[1],fill:r(m,-.2),stroke:f},{shape:p[2],fill:r(m,-.6),stroke:f})}else{let p=r(m,0),u="pattern"in m?m.pattern:null,f=C(m),b=I(m);u!=null&&u.type==="style"&&u.style!=="solid"&&b&&(p=yield fe(u,b)),k.push({shape:z.fill[0],fill:p,stroke:f})}break}case"line":{let l=F(m,0);if(l==null)break;let p={stroke:l,shape:z.fill[0]};y=Math.max(y,M),i=Math.max(i,M),k.push(p);break}case"extrude":{let l=E({join:"round",width:1},F(m,-.4)),p=r(m,0),u=r(m,-.2),f=Math.min(o,c||W),b=ae(f);l.width=1,k.push({shape:b[0],fill:u,stroke:l},{shape:b[1],fill:u,stroke:l},{shape:b[2],fill:p,stroke:l});let g=M,x=.7*M+.5*f;y=Math.max(y,g),i=Math.max(i,x);break}case"water":{let l=I(m),p=U(l),u=U(l,2),f=U(l,3),b=le();d=!0,k.push({shape:b[0],fill:p},{shape:b[1],fill:u},{shape:b[2],fill:f});let g=Math.min(o,c||W);y=Math.max(y,g),i=Math.max(i,g);break}}h.push(k)}}return D(h,[y,i],{node:t?.node,scale:d,opacity:t?.opacity,ariaLabel:t?.ariaLabel})})}function Ee(e,t){if(e.symbolLayers.length===0)return Promise.reject(new H("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return ge(e,t);case"line-3d":return ke(e,t);case"polygon-3d":case"mesh-3d":return ve(e,t)}return Promise.reject(new H("symbolPreview: swatchInfo3D","symbol not supported."))}export{r as a,fe as b,N as c,Ee as d};
