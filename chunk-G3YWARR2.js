import{a as Ie,d as xe}from"./chunk-MIOOILW6.js";import{a as j,b as Gt,c as b}from"./chunk-XAHD7XBV.js";import{a as Q,b as vt,c as Ae,d as Me,f as Et}from"./chunk-ZWYEIB75.js";import{e as V,s as Oe,t as _t}from"./chunk-P64DWRJ7.js";import{a as C,b as St}from"./chunk-DBZKWPEX.js";import{a as X}from"./chunk-AYSSTKZP.js";import{a as we}from"./chunk-PTXLSCMJ.js";import{b as bt}from"./chunk-3D4Y6BLC.js";import{b as T}from"./chunk-TBHSFWI7.js";import{a as x}from"./chunk-RWCIDBNQ.js";import{d as fe,e as Nt}from"./chunk-TKZJUAKL.js";import{d as ue}from"./chunk-IDLNQPT7.js";import{a as ct}from"./chunk-NIYDRLW4.js";import{a as Rt}from"./chunk-3Q427ME6.js";import{a as q,b as ye,c as ut,d as ge}from"./chunk-3BZAI7HK.js";import{m as me,q as de,y as pe}from"./chunk-SKMO433W.js";import{a as ht,d as Lt}from"./chunk-ALWV3RJ2.js";import{a as ce,b as F,c as st,d as v,e as z,m as G,t as _,u as Tt,v as U,x as ot}from"./chunk-5WKDXHVH.js";import{a as ie,b as le,g as he}from"./chunk-PTZYZULI.js";import{b as oe,k as ae}from"./chunk-KZKWOEFD.js";import{a as Pt,k as re,l as ne,m as se}from"./chunk-7B2UKJ5N.js";import{a as Jt,p as Wt,q as Xt,r as Qt}from"./chunk-TRZXSDYA.js";import{v as ee}from"./chunk-IB2IUO7T.js";import{a as N,b as xt,c as Yt,e as Kt,i as $t,l as te}from"./chunk-NHSDW26F.js";import{e as kt}from"./chunk-7N3ZKWML.js";import{g as Zt,h as qt}from"./chunk-E62WHYYG.js";import{a as Ht}from"./chunk-3SDSCSDJ.js";import{ia as Bt}from"./chunk-IG66NQHW.js";function hr(r,e){if(r.type==="point")return k(r,e,!1);if(Ie(r))switch(r.type){case"extent":return k(r.center,e,!1);case"polygon":return k(r.centroid,e,!1);case"polyline":return k(Pe(r),e,!0);case"mesh":return k(ue(r.vertexSpace,r.spatialReference)??r.extent.center,e,!1);case"multipoint":return}else switch(r.type){case"extent":return k(Ee(r),e,!0);case"polygon":return k(Ge(r),e,!0);case"polyline":return k(Pe(r),e,!0);case"multipoint":return}}function Pe(r){let e=r.paths[0];if(!e||e.length===0)return null;let n=qt(e,Zt(e)/2);return ct(n[0],n[1],n[2],r.spatialReference)}function Ee(r){return ct(.5*(r.xmax+r.xmin),.5*(r.ymax+r.ymin),r.zmin!=null&&r.zmax!=null&&isFinite(r.zmin)&&isFinite(r.zmax)?.5*(r.zmax+r.zmin):void 0,r.spatialReference)}function Ge(r){let e=r.rings[0];if(!e||e.length===0)return null;let n=kt(r.rings,!!r.hasZ);return ct(n[0],n[1],n[2],r.spatialReference)}function k(r,e,n){let t=n?r:xe(r);return e&&r?ee(r,t,e)?t:null:t}function cr(r,e,n,t=0){if(r){e||(e=Ht());let s=r,l=.5*s.width*(n-1),a=.5*s.height*(n-1);return s.width<1e-7*s.height?l+=a/20:s.height<1e-7*s.width&&(a+=l/20),oe(e,s.xmin-l-t,s.ymin-a-t,s.xmax+l+t,s.ymax+a+t),e}return null}function ur(r,e,n=null){let t=le(he);return r!=null&&(t[0]=r[0],t[1]=r[1],t[2]=r[2]),e!=null?t[3]=e:r!=null&&r.length>3&&(t[3]=r[3]),n&&(t[0]*=n,t[1]*=n,t[2]*=n,t[3]*=n),t}function fr(r=$t,e,n,t=1){let s=new Array(3);if(e==null||n==null)s[0]=1,s[1]=1,s[2]=1;else{let l,a=0;for(let i=2;i>=0;i--){let c=r[i],o=c!=null,h=i===0&&!l&&!o,m=n[i],g;c==="symbol-value"||h?g=m!==0?e[i]/m:1:o&&c!=="proportional"&&isFinite(c)&&(g=m!==0?c/m:1),g!=null&&(s[i]=g,l=g,a=Math.max(a,Math.abs(g)))}for(let i=2;i>=0;i--)s[i]==null?s[i]=l:s[i]===0&&(s[i]=.001*a)}for(let l=2;l>=0;l--)s[l]/=t;return Kt(s)}function De(r){return r.isPrimitive!=null}function mr(r){return Ce(De(r)?[r.width,r.depth,r.height]:r)?null:"Symbol sizes may not be negative values"}function Ce(r){let e=n=>n==null||n>=0;return Array.isArray(r)?r.every(e):e(r)}function dr(r,e,n,t=ht()){return r&&se(t,t,-r/180*Math.PI),e&&re(t,t,e/180*Math.PI),n&&ne(t,t,n/180*Math.PI),t}function pr(r,e,n){if(n.minDemResolution!=null)return n.minDemResolution;let t=Bt(e),s=Wt(r)*t,l=Xt(r)*t,a=Qt(r)*(e.isGeographic?1:t);return s===0&&l===0&&a===0?n.minDemResolutionForPoints:.01*Math.max(s,l,a)}var ft;(function(r){function e(a,i){let c=a[i],o=a[i+1],h=a[i+2];return Math.sqrt(c*c+o*o+h*h)}function n(a,i){let c=a[i],o=a[i+1],h=a[i+2],m=1/Math.sqrt(c*c+o*o+h*h);a[i]*=m,a[i+1]*=m,a[i+2]*=m}function t(a,i,c){a[i]*=c,a[i+1]*=c,a[i+2]*=c}function s(a,i,c,o,h,m=i){(h=h||a)[m]=a[i]+c[o],h[m+1]=a[i+1]+c[o+1],h[m+2]=a[i+2]+c[o+2]}function l(a,i,c,o,h,m=i){(h=h||a)[m]=a[i]-c[o],h[m+1]=a[i+1]-c[o+1],h[m+2]=a[i+2]-c[o+2]}r.length=e,r.normalize=n,r.scale=t,r.add=s,r.subtract=l})(ft||(ft={}));var Y=ft,Dt=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],Ve=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],je=[0,0,1,0,1,1,0,1],Fe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],Ne=new Array(36);for(let r=0;r<6;r++)for(let e=0;e<6;e++)Ne[6*r+e]=r;var J=new Array(36);for(let r=0;r<6;r++)J[6*r]=0,J[6*r+1]=1,J[6*r+2]=2,J[6*r+3]=2,J[6*r+4]=3,J[6*r+5]=0;function vr(r,e){Array.isArray(e)||(e=[e,e,e]);let n=new Array(24);for(let t=0;t<8;t++)n[3*t]=Dt[t][0]*e[0],n[3*t+1]=Dt[t][1]*e[1],n[3*t+2]=Dt[t][2]*e[2];return new V(r,[[x.POSITION,new T(n,Fe,3,!0)],[x.NORMAL,new T(Ve,Ne,3)],[x.UV0,new T(je,J,2)]])}var Ct=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],ze=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],Ue=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],Be=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function Er(r,e){Array.isArray(e)||(e=[e,e,e]);let n=new Array(18);for(let t=0;t<6;t++)n[3*t]=Ct[t][0]*e[0],n[3*t+1]=Ct[t][1]*e[1],n[3*t+2]=Ct[t][2]*e[2];return new V(r,[[x.POSITION,new T(n,Ue,3,!0)],[x.NORMAL,new T(ze,Be,3)]])}var mt=b(-.5,0,-.5),dt=b(.5,0,-.5),pt=b(0,0,.5),yt=b(0,.5,0),K=j(),$=j(),et=j(),rt=j(),nt=j();z(K,mt,yt),z($,mt,dt),U(et,K,$),_(et,et),z(K,dt,yt),z($,dt,pt),U(rt,K,$),_(rt,rt),z(K,pt,yt),z($,pt,mt),U(nt,K,$),_(nt,nt);var Vt=[mt,dt,pt,yt],Ze=[0,-1,0,et[0],et[1],et[2],rt[0],rt[1],rt[2],nt[0],nt[1],nt[2]],qe=[0,1,2,3,1,0,3,2,1,3,0,2],ke=[0,0,0,1,1,1,2,2,2,3,3,3];function Gr(r,e){Array.isArray(e)||(e=[e,e,e]);let n=new Array(12);for(let t=0;t<4;t++)n[3*t]=Vt[t][0]*e[0],n[3*t+1]=Vt[t][1]*e[1],n[3*t+2]=Vt[t][2]*e[2];return new V(r,[[x.POSITION,new T(n,qe,3,!0)],[x.NORMAL,new T(Ze,ke,3)]])}function Dr(r,e,n,t,s={uv:!0}){let l=-Math.PI,a=2*Math.PI,i=-Math.PI/2,c=Math.PI,o=Math.max(3,Math.floor(n)),h=Math.max(2,Math.floor(t)),m=(o+1)*(h+1),g=C(3*m),M=C(3*m),I=C(2*m),y=[],f=0;for(let p=0;p<=h;p++){let S=[],u=p/h,P=i+u*c,L=Math.cos(P);for(let E=0;E<=o;E++){let B=E/o,w=l+B*a,D=Math.cos(w)*L,R=Math.sin(P),lt=-Math.sin(w)*L;g[3*f]=D*e,g[3*f+1]=R*e,g[3*f+2]=lt*e,M[3*f]=D,M[3*f+1]=R,M[3*f+2]=lt,I[2*f]=B,I[2*f+1]=u,S.push(f),++f}y.push(S)}let d=new Array;for(let p=0;p<h;p++)for(let S=0;S<o;S++){let u=y[p][S],P=y[p][S+1],L=y[p+1][S+1],E=y[p+1][S];p===0?(d.push(u),d.push(L),d.push(E)):p===h-1?(d.push(u),d.push(P),d.push(L)):(d.push(u),d.push(P),d.push(L),d.push(L),d.push(E),d.push(u))}let O=[[x.POSITION,new T(g,d,3,!0)],[x.NORMAL,new T(M,d,3,!0)]];return s.uv&&O.push([x.UV0,new T(I,d,2,!0)]),s.offset&&(O[0][0]=x.OFFSET,O.push([x.POSITION,new T(Float64Array.from(s.offset),Nt(d.length),3,!0)])),new V(r,O)}function Cr(r,e,n,t){let s=He(e,n,t);return new V(r,s)}function He(r,e,n){let t=r,s,l;if(n)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],l=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{let o=t*(1+Math.sqrt(5))/2;s=[-t,o,0,t,o,0,-t,-o,0,t,-o,0,0,-t,o,0,t,o,0,-t,-o,0,t,-o,o,0,-t,o,0,t,-o,0,-t,-o,0,t],l=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let o=0;o<s.length;o+=3)Y.scale(s,o,r/Y.length(s,o));let a={};function i(o,h){o>h&&([o,h]=[h,o]);let m=o.toString()+"."+h.toString();if(a[m])return a[m];let g=s.length;return s.length+=3,Y.add(s,3*o,s,3*h,s,g),Y.scale(s,g,r/Y.length(s,g)),g/=3,a[m]=g,g}for(let o=0;o<e;o++){let h=l.length,m=new Array(4*h);for(let g=0;g<h;g+=3){let M=l[g],I=l[g+1],y=l[g+2],f=i(M,I),d=i(I,y),O=i(y,M),p=4*g;m[p]=M,m[p+1]=f,m[p+2]=O,m[p+3]=I,m[p+4]=d,m[p+5]=f,m[p+6]=y,m[p+7]=O,m[p+8]=d,m[p+9]=f,m[p+10]=d,m[p+11]=O}l=m,a={}}let c=St(s);for(let o=0;o<c.length;o+=3)Y.normalize(c,o);return[[x.POSITION,new T(St(s),l,3,!0)],[x.NORMAL,new T(c,l,3,!0)]]}function Vr(r,e={}){let{normal:n,position:t,color:s,rotation:l,size:a,centerOffsetAndDistance:i,uvs:c,featureAttribute:o,objectAndLayerIdColor:h=null}=e,m=t?xt(t):N(),g=n?xt(n):Yt(0,0,1),M=s?[255*s[0],255*s[1],255*s[2],s.length>3?255*s[3]:255]:[255,255,255,255],I=a!=null&&a.length===2?a:[1,1],y=l!=null?[l]:[0],f=Nt(1),d=[[x.POSITION,new T(m,f,3,!0)],[x.NORMAL,new T(g,f,3,!0)],[x.COLOR,new T(M,f,4,!0)],[x.SIZE,new T(I,f,2)],[x.ROTATION,new T(y,f,1,!0)]];if(c&&d.push([x.UV0,new T(c,f,c.length)]),i!=null){let O=[i[0],i[1],i[2],i[3]];d.push([x.CENTEROFFSETANDDISTANCE,new T(O,f,4)])}if(o){let O=[o[0],o[1],o[2],o[3]];d.push([x.FEATUREATTRIBUTE,new T(O,f,4)])}return new V(r,d,null,bt.Point,h)}function Je(r,e,n,t,s=!0,l=!0){let a=0,i=e,c=r,o=b(0,a,0),h=b(0,a+c,0),m=b(0,-1,0),g=b(0,1,0);t&&(a=c,h=b(0,0,0),o=b(0,a,0),m=b(0,1,0),g=b(0,-1,0));let M=[h,o],I=[m,g],y=n+2,f=Math.sqrt(c*c+i*i);if(t)for(let u=n-1;u>=0;u--){let P=u*(2*Math.PI/n),L=b(Math.cos(P)*i,a,Math.sin(P)*i);M.push(L);let E=b(c*Math.cos(P)/f,-i/f,c*Math.sin(P)/f);I.push(E)}else for(let u=0;u<n;u++){let P=u*(2*Math.PI/n),L=b(Math.cos(P)*i,a,Math.sin(P)*i);M.push(L);let E=b(c*Math.cos(P)/f,i/f,c*Math.sin(P)/f);I.push(E)}let d=new Array,O=new Array;if(s){for(let u=3;u<M.length;u++)d.push(1),d.push(u-1),d.push(u),O.push(0),O.push(0),O.push(0);d.push(M.length-1),d.push(2),d.push(1),O.push(0),O.push(0),O.push(0)}if(l){for(let u=3;u<M.length;u++)d.push(u),d.push(u-1),d.push(0),O.push(u),O.push(u-1),O.push(1);d.push(0),d.push(2),d.push(M.length-1),O.push(1),O.push(2),O.push(I.length-1)}let p=C(3*y);for(let u=0;u<y;u++)p[3*u]=M[u][0],p[3*u+1]=M[u][1],p[3*u+2]=M[u][2];let S=C(3*y);for(let u=0;u<y;u++)S[3*u]=I[u][0],S[3*u+1]=I[u][1],S[3*u+2]=I[u][2];return[[x.POSITION,new T(p,d,3,!0)],[x.NORMAL,new T(S,O,3,!0)]]}function jr(r,e,n,t,s,l=!0,a=!0){return new V(r,Je(e,n,t,s,l,a))}function Fr(r,e,n,t,s,l,a){let i=s?Gt(s):b(1,0,0),c=l?Gt(l):b(0,0,0);a??=!0;let o=j();_(o,i);let h=j();G(h,o,Math.abs(e));let m=j();G(m,h,-.5),v(m,m,c);let g=b(0,1,0);Math.abs(1-Tt(o,g))<.2&&st(g,0,0,1);let M=j();U(M,o,g),_(M,M),U(g,M,o);let I=2*t+(a?2:0),y=t+(a?2:0),f=C(3*I),d=C(3*y),O=C(2*I),p=new Array(3*t*(a?4:2)),S=new Array(3*t*(a?4:2));a&&(f[3*(I-2)]=m[0],f[3*(I-2)+1]=m[1],f[3*(I-2)+2]=m[2],O[2*(I-2)]=0,O[2*(I-2)+1]=0,f[3*(I-1)]=f[3*(I-2)]+h[0],f[3*(I-1)+1]=f[3*(I-2)+1]+h[1],f[3*(I-1)+2]=f[3*(I-2)+2]+h[2],O[2*(I-1)]=1,O[2*(I-1)+1]=1,d[3*(y-2)]=-o[0],d[3*(y-2)+1]=-o[1],d[3*(y-2)+2]=-o[2],d[3*(y-1)]=o[0],d[3*(y-1)+1]=o[1],d[3*(y-1)+2]=o[2]);let u=(w,D,R)=>{p[w]=D,S[w]=R},P=0,L=j(),E=j();for(let w=0;w<t;w++){let D=w*(2*Math.PI/t);G(L,g,Math.sin(D)),G(E,M,Math.cos(D)),v(L,L,E),d[3*w]=L[0],d[3*w+1]=L[1],d[3*w+2]=L[2],G(L,L,n),v(L,L,m),f[3*w]=L[0],f[3*w+1]=L[1],f[3*w+2]=L[2],O[2*w]=w/t,O[2*w+1]=0,f[3*(w+t)]=f[3*w]+h[0],f[3*(w+t)+1]=f[3*w+1]+h[1],f[3*(w+t)+2]=f[3*w+2]+h[2],O[2*(w+t)]=w/t,O[2*w+1]=1;let R=(w+1)%t;u(P++,w,w),u(P++,w+t,w),u(P++,R,R),u(P++,R,R),u(P++,w+t,w),u(P++,R+t,R)}if(a){for(let w=0;w<t;w++){let D=(w+1)%t;u(P++,I-2,y-2),u(P++,w,y-2),u(P++,D,y-2)}for(let w=0;w<t;w++){let D=(w+1)%t;u(P++,w+t,y-1),u(P++,I-1,y-1),u(P++,D+t,y-1)}}let B=[[x.POSITION,new T(f,p,3,!0)],[x.NORMAL,new T(d,S,3,!0)],[x.UV0,new T(O,p,2,!0)]];return new V(r,B)}function zr(r,e,n,t,s,l){t=t||10,s=s==null||s,X(e.length>1);let a=[[0,0,0]],i=[],c=[];for(let o=0;o<t;o++){i.push([0,-o-1,-(o+1)%t-1]);let h=o/t*2*Math.PI;c.push([Math.cos(h)*n,Math.sin(h)*n])}return We(r,c,e,a,i,s,l)}function We(r,e,n,t,s,l,a=b(0,0,0)){let i=e.length,c=C(n.length*i*3+(6*t.length||0)),o=C(n.length*i*3+(t?6:0)),h=new Array,m=new Array,g=0,M=0,I=N(),y=N(),f=N(),d=N(),O=N(),p=N(),S=N(),u=N(),P=N(),L=N(),E=N(),B=N(),w=N(),D=me();st(P,0,1,0),z(y,n[1],n[0]),_(y,y),l?(v(u,n[0],a),_(f,u)):st(f,0,0,1),Te(y,f,P,P,O,f,Le),F(d,f),F(B,O);for(let A=0;A<t.length;A++)G(p,O,t[A][0]),G(u,f,t[A][2]),v(p,p,u),v(p,p,n[0]),c[g++]=p[0],c[g++]=p[1],c[g++]=p[2];o[M++]=-y[0],o[M++]=-y[1],o[M++]=-y[2];for(let A=0;A<s.length;A++)h.push(s[A][0]>0?s[A][0]:-s[A][0]-1+t.length),h.push(s[A][1]>0?s[A][1]:-s[A][1]-1+t.length),h.push(s[A][2]>0?s[A][2]:-s[A][2]-1+t.length),m.push(0),m.push(0),m.push(0);let R=t.length,lt=t.length-1;for(let A=0;A<n.length;A++){let Ut=!1;A>0&&(F(I,y),A<n.length-1?(z(y,n[A+1],n[A]),_(y,y)):Ut=!0,v(L,I,y),_(L,L),v(E,n[A-1],d),de(n[A],L,D),pe(D,ye(E,I),u)?(z(u,u,n[A]),_(f,u),U(O,L,f),_(O,O)):Te(L,d,B,P,O,f,Le),F(d,f),F(B,O)),l&&(v(u,n[A],a),_(w,u));for(let Z=0;Z<i;Z++)if(G(p,O,e[Z][0]),G(u,f,e[Z][1]),v(p,p,u),_(S,p),o[M++]=S[0],o[M++]=S[1],o[M++]=S[2],v(p,p,n[A]),c[g++]=p[0],c[g++]=p[1],c[g++]=p[2],!Ut){let Mt=(Z+1)%i;h.push(R+Z),h.push(R+i+Z),h.push(R+Mt),h.push(R+Mt),h.push(R+i+Z),h.push(R+i+Mt);for(let It=0;It<6;It++){let ve=h.length-6;m.push(h[ve+It]-lt)}}R+=i}let be=n[n.length-1];for(let A=0;A<t.length;A++)G(p,O,t[A][0]),G(u,f,t[A][1]),v(p,p,u),v(p,p,be),c[g++]=p[0],c[g++]=p[1],c[g++]=p[2];let wt=M/3;o[M++]=y[0],o[M++]=y[1],o[M++]=y[2];let At=R-i;for(let A=0;A<s.length;A++)h.push(s[A][0]>=0?R+s[A][0]:-s[A][0]-1+At),h.push(s[A][2]>=0?R+s[A][2]:-s[A][2]-1+At),h.push(s[A][1]>=0?R+s[A][1]:-s[A][1]-1+At),m.push(wt),m.push(wt),m.push(wt);let _e=[[x.POSITION,new T(c,h,3,!0)],[x.NORMAL,new T(o,m,3,!0)]];return new V(r,_e)}function Ur(r,e,n,t){X(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),X(e[0].length===3,"createPolylineGeometry(): malformed vertex"),X(n==null||n.length===e.length,"createPolylineGeometry: need same number of points and normals"),X(n==null||n[0].length===3,"createPolylineGeometry(): malformed normal");let s=Jt(3*e.length),l=new Array(2*(e.length-1)),a=0,i=0;for(let o=0;o<e.length;o++){for(let h=0;h<3;h++)s[a++]=e[o][h];o>0&&(l[i++]=o-1,l[i++]=o)}let c=[[x.POSITION,new T(s,l,3,!0)]];if(n){let o=C(3*n.length),h=0;for(let m=0;m<e.length;m++)for(let g=0;g<3;g++)o[h++]=n[m][g];c.push([x.NORMAL,new T(o,l,3,!0)])}return t&&c.push([x.COLOR,new T(t,fe(t.length/4),4)]),new V(r,c,null,bt.Line)}function Br(r,e,n,t,s,l=0){let a=new Array(18),i=[[-n,l,s/2],[t,l,s/2],[0,e+l,s/2],[-n,l,-s/2],[t,l,-s/2],[0,e+l,-s/2]],c=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let o=0;o<6;o++)a[3*o]=i[o][0],a[3*o+1]=i[o][1],a[3*o+2]=i[o][2];return new V(r,[[x.POSITION,new T(a,c,3,!0)]])}function Zr(r,e){let n=r.getMutableAttribute(x.POSITION).data;for(let t=0;t<n.length;t+=3){let s=n[t],l=n[t+1],a=n[t+2];st(tt,s,l,a),ot(tt,tt,e),n[t]=tt[0],n[t+1]=tt[1],n[t+2]=tt[2]}}function qr(r,e=r){let n=r.attributes,t=n.get(x.POSITION).data,s=n.get(x.NORMAL).data;if(s){let l=e.getMutableAttribute(x.NORMAL).data;for(let a=0;a<s.length;a+=3){let i=s[a+1];l[a+1]=-s[a+2],l[a+2]=i}}if(t){let l=e.getMutableAttribute(x.POSITION).data;for(let a=0;a<t.length;a+=3){let i=t[a+1];l[a+1]=-t[a+2],l[a+2]=i}}}function jt(r,e,n,t,s){return!(Math.abs(Tt(e,r))>s)&&(U(n,r,e),_(n,n),U(t,n,r),_(t,t),!0)}function Te(r,e,n,t,s,l,a){return jt(r,e,s,l,a)||jt(r,n,s,l,a)||jt(r,t,s,l,a)}var Le=.99619469809,tt=N();function Hr(r){return r.type==="point"}function Qr(r,e){return r==null&&(r=[]),r.push(e),r}function Yr(r,e){if(r==null)return null;let n=r.filter(t=>t!==e);return n.length===0?null:n}function Kr(r,e,n,t,s){gt[0]=r.get(e,0),gt[1]=r.get(e,1),gt[2]=r.get(e,2),we(gt,W,3),n.set(s,0,W[0]),t.set(s,0,W[1]),n.set(s,1,W[2]),t.set(s,1,W[3]),n.set(s,2,W[4]),t.set(s,2,W[5])}var gt=N(),W=new Float32Array(6);var Re=1e-5,Ft=class{constructor(e){this.options=new Ae,this._results=new zt,this.transform=new Oe,this.tolerance=Re,this.verticalOffset=null,this._ray=q(),this._rayEnd=N(),this._rayBeginTransformed=N(),this._rayEndTransformed=N(),this.viewingMode=e??Rt.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,n,t){this.resetWithRay(ge(e,n,this._ray),t)}resetWithRay(e,n){this.camera=n,e!==this._ray&&ut(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Rt.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,v(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,n,t,s,l){this.point=n,this.filterPredicate=s,this.tolerance=t??Re;let a=_t(this.verticalOffset);if(e&&e.length>0){let i=l?c=>{l(c)&&this.intersectObject(c)}:c=>{this.intersectObject(c)};for(let c of e){let o=c.getSpatialQueryAccelerator?.();o!=null?(a!=null?o.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,i,a):o.forEachAlongRay(this._ray.origin,this._ray.direction,i),this.options.selectionMode&&this.options.hud&&o.forEachDegenerateObject(i)):c.objects.forAll(h=>i(h))}}this.sortResults()}intersectObject(e){let n=e.geometries;if(!n)return;let t=e.effectiveTransformation,s=_t(this.verticalOffset);for(let l of n){if(!l.visible)continue;let{material:a,id:i}=l;if(!a.visible)continue;this.transform.setAndInvalidateLazyTransforms(t,l.transformation),ot(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),ot(this._rayEndTransformed,this.rayEnd,this.transform.inverse);let c=this.transform.transform;s!=null&&(s.objectTransform=this.transform),a.intersect(l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(o,h,m,g,M,I)=>{if(o>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,o))return;let y=g?this._results.hud:this._results,f=g?d=>{let O=new Me(e,i,m,I);d.set(Q.HUD,O,o,h,Lt,M)}:d=>d.set(Q.OBJECT,{object:e,geometryId:i,triangleNr:m},o,h,c,M);if((y.min.drapedLayerOrder==null||M>=y.min.drapedLayerOrder)&&(y.min.dist==null||o<y.min.dist)&&f(y.min),this.options.store!==vt.MIN&&(y.max.drapedLayerOrder==null||M<y.max.drapedLayerOrder)&&(y.max.dist==null||o>y.max.dist)&&f(y.max),this.options.store===vt.ALL)if(g){let d=new it(this._ray);f(d),this._results.hud.all.push(d)}else{let d=new H(this._ray);f(d),this._results.all.push(d)}}})}}sortResults(e=this._results.all){e.sort((n,t)=>n.dist!==t.dist?(n.dist??0)-(t.dist??0):n.drapedLayerOrder!==t.drapedLayerOrder?Se(n.drapedLayerOrder,t.drapedLayerOrder):Se(n.drapedLayerGraphicOrder,t.drapedLayerGraphicOrder))}};function Se(r,e){return(e??-Number.MAX_VALUE)-(r??-Number.MAX_VALUE)}function mn(r){return new Ft(r)}var zt=class{constructor(){this.min=new H(q()),this.max=new H(q()),this.hud={min:new it(q()),max:new it(q()),all:new Array},this.ground=new H(q()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},H=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(G(Ot,this.ray.direction,this.dist),ce(Ot)):null}withinDistance(e){return!!Et(this)&&this.distanceInRenderSpace<=e}getIntersectionPoint(e){return!!Et(this)&&(G(Ot,this.ray.direction,this.dist),v(e,this.ray.origin,Ot),!0)}getTransformedNormal(e){return F(at,this.normal),at[3]=0,ae(at,at,this.transformation),F(e,at),_(e,e)}constructor(e){this.intersector=Q.OBJECT,this.normal=N(),this.transformation=ht(),this._ray=q(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Q.OBJECT,ut(e,this._ray)}set(e,n,t,s,l,a,i){this.intersector=e,this.dist=t,F(this.normal,s??te),Pt(this.transformation,l??Lt),this.target=n,this.drapedLayerOrder=a,this.drapedLayerGraphicOrder=i}copy(e){ut(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,F(this.normal,e.normal),Pt(this.transformation,e.transformation)}},it=class extends H{constructor(){super(...arguments),this.intersector=Q.HUD}};function dn(r){return new H(r)}var Ot=N(),at=ie();export{Qr as a,Yr as b,Kr as c,mn as d,dn as e,hr as f,cr as g,ur as h,fr as i,mr as j,Ce as k,dr as l,pr as m,vr as n,Er as o,Gr as p,Dr as q,Cr as r,Vr as s,Je as t,jr as u,Fr as v,zr as w,We as x,Ur as y,Br as z,Zr as A,qr as B,Te as C,Hr as D};
