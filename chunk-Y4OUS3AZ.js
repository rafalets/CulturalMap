import{a as v,b as X,d as Y}from"./chunk-GWBRHLNH.js";import{h as T}from"./chunk-7N3ZKWML.js";import{i as V}from"./chunk-QDTU3MWT.js";import{a as O}from"./chunk-WMQNRNIU.js";import{U as L,t as K,y as Q}from"./chunk-IG66NQHW.js";import{i as J}from"./chunk-WMHJC7XF.js";import{t as C}from"./chunk-HHDFN2GK.js";function Z(e){if(!e)return null;let n=e.wkid;if(n)return Y[n];let t=e.wkt2??e.wkt;return t?re(t):null}function re(e){let n=X.exec(e);if(!n||n.length!==2)return null;let t=n[1].split(",");if(!t||t.length<3)return null;let h=parseFloat(t[1]),s=parseFloat(t[2]);return isNaN(h)||isNaN(s)?null:{a:h,f:s===0?0:1/s}}function U(e){let n=Z(e);if(oe(n))return n;let t=n.a*(1-n.f);return Object.assign(n,{b:t,eSq:1-(t/n.a)**2,radius:(2*n.a+t)/3,densificationRatio:1e4/((2*n.a+t)/3)})}function oe(e){return e!=null&&"b"in e&&"eSq"in e&&"radius"in e}function I(e,n,t){let{a:h,eSq:s}=U(t),i=Math.sqrt(s),a=Math.sin(n[1]*v),l=h*n[0]*v,o;return s>0?o=h*((1-s)*(a/(1-s*(a*a))-1/(2*i)*Math.log((1-i*a)/(1+i*a))))*.5:o=h*a,e[0]=l,e[1]=o,e}function E(e){return K(e)&&!!Z(e)}function ve(e,n="square-meters"){if(e.some(a=>!E(a.spatialReference)))throw new C("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");let t=[];for(let a=0;a<e.length;a++){let l=e[a],o=l.spatialReference,{radius:c,densificationRatio:p}=U(o),r=c*p;t.push(ce(l,r))}let h=[],s=[0,0],i=[0,0];for(let a=0;a<t.length;a++){let{rings:l,spatialReference:o}=t[a],c=0;for(let p=0;p<l.length;p++){let r=l[p];I(s,r[0],o),I(i,r[r.length-1],o);let d=i[0]*s[1]-s[0]*i[1];for(let m=0;m<r.length-1;m++)I(s,r[m+1],o),I(i,r[m],o),d+=i[0]*s[1]-s[0]*i[1];c+=d}c=L(c,"square-meters",n),h.push(c/-2)}return h}function Re(e,n="meters"){if(!e)throw new C("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some(h=>!E(h.spatialReference)))throw new C("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");let t=[];for(let h=0;h<e.length;h++){let s=e[h],{spatialReference:i}=s,a=s.type==="polyline"?s.paths:s.rings,l=0;for(let o=0;o<a.length;o++){let c=a[o],p=0;for(let r=1;r<c.length;r++){let d=c[r-1][0],m=c[r][0],M=c[r-1][1],g=c[r][1];if(M!==g||d!==m){let u=new P;_(u,[d,M],[m,g],i),p+=u.distance}}l+=p}l=L(l,"meters",n),t.push(l)}return t}function ce(e,n){if(e.type!=="polyline"&&e.type!=="polygon")throw new C("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");let{spatialReference:t}=e;if(!E(t))throw new C("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");let h=e.type==="polyline"?e.paths:e.rings,s=[],i=[0,0],a=new P;for(let o of h){let c=[];s.push(c),c.push([o[0][0],o[0][1]]);let p,r,d=o[0][0],m=o[0][1];for(let M=0;M<o.length-1;M++){if(p=o[M+1][0],r=o[M+1][1],d===p&&m===r)continue;let g=[d,m];_(a,[d,m],[p,r],t);let{azimuth:u,distance:R}=a,w=R/n;if(w>1){for(let A=1;A<=w-1;A++)B(i,g,u,A*n,t),c.push(i.slice());B(i,g,u,(R+Math.floor(w-1)*n)/2,t),c.push(i.slice())}B(i,g,u,R,t),c.push(i.slice()),d=i[0],m=i[1]}}let l=J(O,t);return e.type==="polyline"?new V({paths:s,spatialReference:l}):new T({rings:s,spatialReference:l})}var P=class{constructor(n=0,t=void 0,h=void 0){this.distance=n,this.azimuth=t,this.reverseAzimuth=h}};function B(e,n,t,h,s){let i=n[0],a=n[1],l=i*v,o=a*v,c=(t??0)*v,{a:p,b:r,f:d}=U(s),m=Math.sin(c),M=Math.cos(c),g=(1-d)*Math.tan(o),u=1/Math.sqrt(1+g*g),R=g*u,w=Math.atan2(g,M),A=u*m,k=A*A,b=1-k,f=b*(p*p-r*r)/(r*r),G=1+f/16384*(4096+f*(f*(320-175*f)-768)),F=f/1024*(256+f*(f*(74-47*f)-128)),z,S,y,q=h/(r*G),D=2*Math.PI;for(;Math.abs(q-D)>1e-12;)y=Math.cos(2*w+q),z=Math.sin(q),S=Math.cos(q),D=q,q=h/(r*G)+F*z*(y+F/4*(S*(2*y*y-1)-F/6*y*(4*z*z-3)*(4*y*y-3)));let x=R*z-u*S*M,N=Math.atan2(R*S+u*z*M,(1-d)*Math.sqrt(k+x*x)),j=d/16*b*(4+d*(4-3*b)),W=Math.atan2(z*m,u*S-R*z*M)-(1-j)*d*A*(q+j*z*(y+j*S*(2*y*y-1)));return e[0]=(l+W)/v,e[1]=N/v,e}function _(e,n,t,h){let s=n[0]*v,i=n[1]*v,a=t[0]*v,l=t[1]*v,{a:o,b:c,f:p,radius:r}=U(h),d=a-s,m=Math.atan((1-p)*Math.tan(i)),M=Math.atan((1-p)*Math.tan(l)),g=Math.sin(m),u=Math.cos(m),R=Math.sin(M),w=Math.cos(M),A,k,b,f,G,F,z,S,y,q,D=1e3,x=d;do{if(z=Math.sin(x),S=Math.cos(x),b=Math.sqrt(w*z*(w*z)+(u*R-g*w*S)*(u*R-g*w*S)),b===0)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;G=g*R+u*w*S,F=Math.atan2(b,G),y=u*w*z/b,k=1-y*y,f=G-2*g*R/k,isNaN(f)&&(f=0),q=p/16*k*(4+p*(4-3*k)),A=x,x=d+(1-q)*p*y*(F+q*b*(f+q*G*(2*f*f-1)))}while(Math.abs(x-A)>1e-12&&--D>0);if(D===0){let te=r,ne=Math.acos(Math.sin(i)*Math.sin(l)+Math.cos(i)*Math.cos(l)*Math.cos(a-s))*te,H=a-s,se=Math.sin(H)*Math.cos(l),ie=Math.cos(i)*Math.sin(l)-Math.sin(i)*Math.cos(l)*Math.cos(H),ae=Math.atan2(se,ie);return e.azimuth=ae/v,e.distance=ne,e.reverseAzimuth=void 0,e}let N=k*(o*o-c*c)/(c*c),j=N/1024*(256+N*(N*(74-47*N)-128)),W=c*(1+N/16384*(4096+N*(N*(320-175*N)-768)))*(F-j*b*(f+j/4*(G*(2*f*f-1)-j/6*f*(4*b*b-3)*(4*f*f-3)))),$=Math.atan2(w*Math.sin(x),u*R-g*w*Math.cos(x)),ee=Math.atan2(u*Math.sin(x),u*R*Math.cos(x)-g*w);return e.azimuth=$/v,e.distance=W,e.reverseAzimuth=ee/v,e}function ze(e){return E(e)?e:Q(e)?O.WGS84:null}export{E as a,ve as b,Re as c,P as d,B as e,_ as f,ze as g};
