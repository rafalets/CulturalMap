import{q as Mt}from"./chunk-IB6IQS7A.js";import{a as Oe}from"./chunk-XXED5BJG.js";import{Z as ve,_ as Jt,a as qt,c as zt,d as ee}from"./chunk-6SDD2S5F.js";import{c as We,d as Xt}from"./chunk-LZ2LEOYK.js";import{a as Zt,d as Qt}from"./chunk-PMOAKYXH.js";import{p as Yt}from"./chunk-AA5W2OSC.js";import{b as Kt}from"./chunk-2ZKDDIFZ.js";import{a as G}from"./chunk-FHBFWDFD.js";import{a as Bt}from"./chunk-6AT6XDV7.js";import{b as ot}from"./chunk-QYRRGSBK.js";import{c as Re}from"./chunk-6T37AWU6.js";import{b as kt}from"./chunk-4AIH3WFI.js";import{a as Rt}from"./chunk-E4VXIIFB.js";import{a as ue}from"./chunk-PWU2QHPV.js";import{c as At,e as Ee,f as Ct,g as Tt,h as Ft,j as ke,l as Et}from"./chunk-WUJRCGDY.js";import{A as Ht,B as Dt,a as Lt,b as me,c as Le,d as $e,e as Se,f as tt,g as $t,h as Z,i as it,j as st,m as St,n as Nt,q as Vt,r as Pt,s as Ot,t as rt,u as Ne,v as Ve,w as Pe,x as Wt,y as Ut,z as j}from"./chunk-HXMLP37S.js";import{a as xt}from"./chunk-CVRJ6GOM.js";import{J as jt}from"./chunk-HKHTIKVW.js";import{n as Fe}from"./chunk-NTVLK3P2.js";import{a as It}from"./chunk-WMQNRNIU.js";import{a as wt}from"./chunk-MDSLION2.js";import{c as J,d as O,e as H}from"./chunk-7ZYPJJID.js";import{g as m}from"./chunk-UAKHZRKN.js";import{g as ae}from"./chunk-HAHX77IL.js";import{a as pe}from"./chunk-IXCTZWTQ.js";import{b as et}from"./chunk-6PN3I333.js";import{a as gt}from"./chunk-VGD3XLDH.js";import{a as A,b as Ce,c as Te,d as vt,h as T}from"./chunk-LB5YQINJ.js";import{b as _t}from"./chunk-EKMHQEJY.js";import{e as ce}from"./chunk-JKNCWG7E.js";import{a as K}from"./chunk-ISSJ3A6Y.js";import{F as bt}from"./chunk-E57FTRWF.js";import{L as B,d as n}from"./chunk-C7INQGWT.js";import{H as M}from"./chunk-WMHJC7XF.js";import{B as ft,C as Ge,E as Q,H as yt,i as ht,l as W,u as oe}from"./chunk-D2LVMNOU.js";import{a as o}from"./chunk-QGVBCWUY.js";import{l as Qe,o as Ke,r as re,t as Je}from"./chunk-HHDFN2GK.js";import{h as Ye,t as Ae}from"./chunk-47GHT6OF.js";import{a as v,b as mt,f as g}from"./chunk-VTHXE323.js";var we=class extends qt{constructor(e){super(e),this.description=null,this.title=null}};o([n()],we.prototype,"description",void 0),o([n()],we.prototype,"title",void 0),we=o([M("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],we);var be=we;var Fi={base:"esri-feature-attachments"},q=class extends O{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new zt,this.headingLevel=2,this.viewModel=new be}initialize(){this._featureElementInfo=new ee,this.addHandles([A(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),T),A(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,T)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{attachmentsWidget:e}=this;return m("div",{class:Fi.base},this._featureElementInfo?.render(),e?.render())}_setupFeatureElementInfo(){let{description:e,title:t,headingLevel:i}=this;this._featureElementInfo?.set({description:e,title:t,headingLevel:i})}};o([n({readOnly:!0})],q.prototype,"attachmentsWidget",void 0),o([n()],q.prototype,"description",null),o([n()],q.prototype,"displayType",null),o([n()],q.prototype,"graphic",null),o([n()],q.prototype,"headingLevel",void 0),o([n()],q.prototype,"title",null),o([n({type:be})],q.prototype,"viewModel",void 0),q=o([M("esri.widgets.Feature.FeatureAttachments")],q);var Gt=q;var te=class extends B{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(A(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},T))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){let{created:e,graphic:t,destroyer:i}=this;e&&t&&(me({type:"content",value:i,event:{graphic:t}}),this._set("created",null))}_createContent(e){return g(this,null,function*(){let t=this.graphic;if(!t||!e)return;let i=me({type:"content",value:e,event:{graphic:t}});this._loadingPromise=i,this.notifyChange("state");let s=yield i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",s))})}};o([n({readOnly:!0})],te.prototype,"created",void 0),o([n()],te.prototype,"creator",void 0),o([n()],te.prototype,"destroyer",void 0),o([n({type:ue})],te.prototype,"graphic",void 0),o([n({readOnly:!0})],te.prototype,"state",null),te=o([M("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],te);var ne=te;var at="esri-feature-content",nt={base:at,loaderContainer:`${at}__loader-container`,loader:`${at}__loader`},he=class extends O{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(s=>{Le(s.href)&&!s.hasAttribute("target")&&s.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){return this.viewModel?.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){let e=this.viewModel?.state;return m("div",{class:nt.base},e==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return m("div",{class:nt.loaderContainer,key:"loader"},m("div",{class:nt.loader}))}_renderCreated(){let e=this.viewModel?.created;return e?e instanceof HTMLElement?m("div",{afterCreate:this._attachToNode,bind:e,key:e}):We(e)?m("div",{key:e},!e.destroyed&&e.render()):m("div",{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){let t=this;e.appendChild(t)}};o([n()],he.prototype,"creator",null),o([n()],he.prototype,"graphic",null),o([n({type:ne})],he.prototype,"viewModel",void 0),he=o([M("esri.widgets.Feature.FeatureContent")],he);var fe=he;var X=class extends B{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){let{expressionInfos:e,fieldInfos:t}=this,i=[];return t?.forEach(s=>{if(!(!s.hasOwnProperty("visible")||s.visible))return;let r=s.clone();r.label=Se(r,e),i.push(r)}),i}};o([n()],X.prototype,"attributes",void 0),o([n({type:[Et]})],X.prototype,"expressionInfos",void 0),o([n()],X.prototype,"description",void 0),o([n({type:[Ee]})],X.prototype,"fieldInfos",void 0),o([n({readOnly:!0})],X.prototype,"formattedFieldInfos",null),o([n()],X.prototype,"title",void 0),X=o([M("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],X);var le=X;var Ei=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function ei(e,t){if(typeof t!="string"||!t)return t;let i=Ei.find(p=>p.pattern.test(t));if(!i)return t;let s=t.match(i.pattern),r=s?.[2],a=Qe(Qe(i.label,{messages:e,hierPart:r}),{appName:i.appName}),d=i.target?` target="${i.target}"`:"",l=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${d} href="$1"${l}>${a}</a>`)}var Ue="esri-feature-fields",He={base:Ue,fieldHeader:`${Ue}__field-header`,fieldData:`${Ue}__field-data`,fieldDataDate:`${Ue}__field-data--date`},D=class extends O{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new le,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new ee,this.addHandles(A(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),T))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return m("div",{class:He.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(e,t){let{attributes:i}=this.viewModel,s=e.fieldName||"",r=e.label||s,a=i?i[s]==null?"":i[s]:"",d=!!e.format?.dateFormat,l=typeof a=="number"&&!d?this._forceLTR(a):ei(this.messagesURIUtils,a),p={[He.fieldDataDate]:d};return m("tr",{key:`fields-element-info-row-${s}-${t}`},m("th",{class:He.fieldHeader,innerHTML:r,key:`fields-element-info-row-header-${s}-${t}`}),m("td",{class:this.classes(He.fieldData,p),innerHTML:l,key:`fields-element-info-row-data-${s}-${t}`}))}_renderFields(){let{formattedFieldInfos:e}=this.viewModel;return e?.length?m("table",{class:G.table,summary:this.messages.fieldsSummary},m("tbody",null,e.map((t,i)=>this._renderFieldInfo(t,i)))):null}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};o([n()],D.prototype,"attributes",null),o([n()],D.prototype,"description",null),o([n()],D.prototype,"expressionInfos",null),o([n()],D.prototype,"fieldInfos",null),o([n()],D.prototype,"title",null),o([n({type:le,nonNullable:!0})],D.prototype,"viewModel",void 0),o([n(),H("esri/widgets/Feature/t9n/Feature")],D.prototype,"messages",void 0),o([n(),H("esri/widgets/support/t9n/uriUtils")],D.prototype,"messagesURIUtils",void 0),D=o([M("esri.widgets.Feature.FeatureFields")],D);var De=D;var ki="esri.widgets.Feature.support.relatedFeatureUtils",ti=()=>re.getLogger(ki),ii=new Map;function ye(e){if(!j(e))return null;let[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function Ri(e,t){if(!t.relationships)return null;let i=null,{relationships:s}=t;return s.some(r=>r.id===parseInt(e,10)&&(i=r,!0)),i}function Li({originRelationship:e,relationships:t,layerId:i}){return t.find(({relatedTableId:s,id:r})=>`${s}`===i&&r===e?.id)??null}function $i(e,t){let i=t.toLowerCase();for(let s in e)if(s.toLowerCase()===i)return e[s];return null}function si(e,t){let i=Ri(e,t);if(i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function ri(e,t){if(!t||!e)return;let{features:i,statsFeatures:s}=e,r=i?.value;t.relatedFeatures=r?r.features:[];let a=s?.value;t.relatedStatsFeatures=a?a.features:[]}function Si(e,t,i,s){let r=new Rt;return r.outFields=["*"],r.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),r.objectIds=[e.attributes[i.objectIdField]],r.gdbVersion=i.gdbVersion??null,r.historicMoment=i.historicMoment??null,i.queryRelatedFeatures?.(r,s)??Promise.resolve({})}function Ni(e,t,i){let s=0,r=[];for(;s<t.length;)r.push(`${e} IN (${t.slice(s,i+s)})`),s+=i;return r.join(" OR ")}function Vi(e){return e?Ye(e):void 0}function Pi(e){return e?Ye(e,(t,i)=>JSON.stringify(t.toJSON())===JSON.stringify(i.toJSON())):void 0}function Oi(e,t,i,s){return g(this,null,function*(){let r=i.layerId.toString(),{layerInfo:a,relation:d,relatedFields:l,outStatistics:p,url:c,sourceSpatialReference:u}=t,h=Vi(l),f=Pi(p);if(!a||!d)return null;let y=Li({originRelationship:d,relationships:a.relationships,layerId:r});if(y?.relationshipTableId&&y.keyFieldInRelationshipTable){let w=(yield Si(e,y,i,s))[e.attributes[i.objectIdField]];if(!w)return null;let x=w.features.map(b=>b.attributes[a.objectIdField]);if(f?.length&&a.supportsStatistics){let b=new Re;b.where=Ni(a.objectIdField,x,1e3),b.outFields=h,b.outStatistics=f,b.sourceSpatialReference=u;let E={features:Promise.resolve(w),statsFeatures:Oe(c,b)};return Q(E)}}let _=y?.keyField;if(_){let w=jt(Ui(a.fields,_)),x=$i(e.attributes,d.keyField),b=w?`${_}=${x}`:`${_}='${x}'`,E=i.historicMoment,L=i.gdbVersion,se=Oe(c,new Re({where:b,outFields:h,sourceSpatialReference:u,historicMoment:E,gdbVersion:L}),s),U=f?.length&&a.supportsStatistics?Oe(c,new Re({where:b,outFields:h,outStatistics:f,sourceSpatialReference:u}),s):null,de={features:se};return U&&(de.statsFeatures=U),Q(de)}return null})}function Wi(e,t){return bt(e,{query:{f:"json"},signal:t?.signal})}function oi({relatedInfos:e,layer:t},i){let s={};return e.forEach((r,a)=>{let{relation:d}=r;if(!d){let h=new Je("relation-required","A relation is required on a layer to retrieve related records.");throw ti().error(h),h}let{relatedTableId:l}=d;if(typeof l!="number"){let h=new Je("A related table ID is required on a layer to retrieve related records.");throw ti().error(h),h}let p=`${t.url}/${l}`,c=ii.get(p),u=c??Wi(p);c||ii.set(p,u),s[a]=u}),ft(Q(s),i)}function ai({graphic:e,relatedInfos:t,layer:i},s){let r={};return t.forEach((a,d)=>{a.layerInfo&&(r[d]=Oi(e,a,i,s))}),Q(r)}function ni({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields?.push(t),i.statisticType){let s=new kt({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics?.push(s)}}function Ui(e,t){if(e!=null){t=t.toLowerCase();for(let i of e)if(i&&i.name.toLowerCase()===t)return i}return null}var li={chartAnimation:!0},k=class extends B{constructor(e){super(e),this.abilities=v({},li),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return v(v({},li),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){let{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){let{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){let{mediaInfos:e,layer:t}=this,i=this.attributes??{},s=this.formattedAttributes??{},r=this.expressionAttributes??{},a=this.fieldInfoMap??new Map;return e?.map(d=>{let l=d?.clone();return l?(l.title=Z({attributes:i,fieldInfoMap:a,globalAttributes:s,expressionAttributes:r,layer:t,text:l.title}),l.caption=Z({attributes:i,fieldInfoMap:a,globalAttributes:s,expressionAttributes:r,layer:t,text:l.caption}),l.altText=Z({attributes:i,fieldInfoMap:a,globalAttributes:s,expressionAttributes:r,layer:t,text:l.altText}),l.type==="image"?l.value?(this._setImageValue({value:l.value,formattedAttributes:s,layer:t}),l.value.sourceURL?l:void 0):void 0:l.type==="pie-chart"||l.type==="line-chart"||l.type==="column-chart"||l.type==="bar-chart"?l.value?(this._setChartValue({value:l.value,chartType:l.type,attributes:i,formattedAttributes:s,layer:t,expressionAttributes:r}),l):void 0:null):null}).filter(Ae)??[]}_setImageValue(e){let t=this.fieldInfoMap??new Map,{value:i,formattedAttributes:s,layer:r}=e,{linkURL:a,sourceURL:d}=i;if(d){let l=st(d,r);i.sourceURL=it({formattedAttributes:s,template:l,fieldInfoMap:t})}if(a){let l=st(a,r);i.linkURL=it({formattedAttributes:s,template:l,fieldInfoMap:t})}}_setChartValue(e){let{value:t,attributes:i,formattedAttributes:s,chartType:r,layer:a,expressionAttributes:d}=e,{popupTemplate:l,relatedInfos:p}=this,{fields:c,normalizeField:u}=t,h=a;if(t.fields=$t(c,h),u&&(t.normalizeField=tt(u,h)),!c.some(y=>!!(s[y]!=null||j(y)&&p?.size)))return;let f=l?.fieldInfos??[];c.forEach((y,_)=>{let w=t.colors?.[_];if(j(y))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:f,fieldName:y,formattedAttributes:s,chartType:r,value:t,color:w})]);let x=this._getChartOption({value:t,attributes:i,chartType:r,formattedAttributes:s,expressionAttributes:d,fieldName:y,fieldInfos:f,color:w});t.series.push(x)})}_getRelatedChartInfos(e){let{fieldInfos:t,fieldName:i,formattedAttributes:s,chartType:r,value:a,color:d}=e,l=[],p=ye(i),c=p&&this.relatedInfos?.get(p.layerId.toString());if(!c)return l;let{relatedFeatures:u,relation:h}=c;if(!h||!u)return l;let{cardinality:f}=h;return u.forEach(y=>{let{attributes:_}=y;_&&Object.keys(_).forEach(w=>{w===p.fieldName&&l.push(this._getChartOption({value:a,attributes:_,formattedAttributes:s,fieldName:i,chartType:r,relatedFieldName:w,hasMultipleRelatedFeatures:u?.length>1,fieldInfos:t,color:d}))})}),f==="one-to-many"||f==="many-to-many"?l:[l[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){let{value:t,attributes:i,formattedAttributes:s,expressionAttributes:r,fieldName:a,relatedFieldName:d,fieldInfos:l,chartType:p,hasMultipleRelatedFeatures:c,color:u}=e,h=this.layer,f=this.fieldInfoMap??new Map,{normalizeField:y,tooltipField:_}=t,w=y?j(y)?i[ye(y).fieldName]:i[y]:null,x=$e(a)&&r&&r[a]!==void 0?r[a]:d&&i[d]!==void 0?i[d]:i[a]!==void 0?i[a]:s[a],b=new Tt({fieldName:a,color:u,value:x===void 0?null:x&&w?x/w:x});if(j(a)){let de=f.get(a.toLowerCase()),xi=_&&f.get(_.toLowerCase()),Ai=de?.fieldName??a,Xe=c&&_?ye(_).fieldName:xi?.fieldName??_,Ci=c&&Xe?i[Xe]:s[Xe]??de?.label??de?.fieldName??d,Ti=c&&d?i[d]:s[Ai];return b.tooltip=this._getTooltip({label:Ci,value:Ti,chartType:p}),b}let E=Vt(l,a),L=tt(a,h),se=_&&s[_]!==void 0?s[_]:Se(E||new Ee({fieldName:L}),this.popupTemplate?.expressionInfos),U=s[L];return b.tooltip=this._getTooltip({label:se,value:U,chartType:p}),b}};o([n()],k.prototype,"abilities",void 0),o([K("abilities")],k.prototype,"castAbilities",null),o([n()],k.prototype,"activeMediaInfoIndex",void 0),o([n({readOnly:!0})],k.prototype,"activeMediaInfo",null),o([n()],k.prototype,"attributes",void 0),o([n()],k.prototype,"description",void 0),o([n()],k.prototype,"fieldInfoMap",void 0),o([n()],k.prototype,"formattedAttributes",void 0),o([n()],k.prototype,"expressionAttributes",void 0),o([n({readOnly:!0})],k.prototype,"formattedMediaInfos",null),o([n()],k.prototype,"isAggregate",void 0),o([n()],k.prototype,"layer",void 0),o([n({readOnly:!0})],k.prototype,"formattedMediaInfoCount",null),o([n()],k.prototype,"mediaInfos",void 0),o([n()],k.prototype,"popupTemplate",void 0),o([n()],k.prototype,"relatedInfos",void 0),o([n()],k.prototype,"title",void 0),k=o([M("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],k);var z=k;var R="esri-feature-media",N={base:R,mediaContainer:`${R}__container`,mediaItemContainer:`${R}__item-container`,mediaItem:`${R}__item`,mediaItemText:`${R}__item-text`,mediaItemTitle:`${R}__item-title`,mediaItemCaption:`${R}__item-caption`,mediaNavigation:`${R}__item-navigation`,mediaPagination:`${R}__pagination`,mediaPaginationText:`${R}__pagination-text`,mediaPrevious:`${R}__previous`,mediaPreviousIconLTR:`${R}__previous-icon`,mediaPreviousIconRTL:`${R}__previous-icon--rtl`,mediaNext:`${R}__next`,mediaNextIconLTR:`${R}__next-icon`,mediaNextIconRTL:`${R}__next-icon--rtl`,mediaChart:`${R}__chart`,mediaPaginationButton:`${R}__pagination-button`,mediaPaginationIcon:`${R}__pagination-icon`,mediaChartRendered:`${R}__chart--rendered`},lt=15,ie="category",Ie="value",Hi="rgba(50, 50, 50, 1)",Di=250,Bi=500,ji=200,V=class extends O{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new z,this.messages=null,this._disposeChart=i=>{this._chartRootMap.get(i)?.dispose(),this._chartRootMap.delete(i)},this._createChart=i=>g(this,null,function*(){let{destroyed:s,viewModel:r}=this;if(s||!r||!i)return;let{createRoot:a}=yield import("./chunk-UDUD3MXZ.js"),d=yield a(i);this._chartRootMap.set(i,d),this._renderChart({mediaInfo:r.activeMediaInfo,root:d})})}initialize(){this._featureElementInfo=new ee,this.addHandles([A(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),T),A(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),T)])}loadDependencies(){return J({icon:()=>import("./chunk-QXDSJABL.js")})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return m("div",{bind:this,class:N.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){let{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,i=this._renderMediaText();return e?m("div",{class:N.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),m("div",{class:N.mediaNavigation},i,e>1?m("div",{class:N.mediaPagination},this._renderMediaPageButton("previous"),m("span",{class:N.mediaPaginationText},pe(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){let{activeMediaInfo:e}=this.viewModel;if(!e)return null;let t=e&&e.title?m("div",{class:N.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,i=e&&e.caption?m("div",{class:N.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return t||i?m("div",{class:N.mediaItemText,key:"media-text"},t,i):null}_renderImageMediaInfo(e){if(!e.value)return null;let{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:s}=this.viewModel,{value:r,refreshInterval:a,altText:d,title:l,type:p}=e,{sourceURL:c,linkURL:u}=r,h=Le(u??void 0)?"_blank":"_self",f=h==="_blank"?"noreferrer":"",y=a?t:null,_=y?y.timestamp:0,w=y?y.sourceURL:c,x=m("img",{alt:d||l,key:`media-${p}-${i}-${s}-${_}`,src:w??void 0});return(u?m("a",{href:u,rel:f,target:h,title:l},x):null)??x}_renderChartMediaInfo(e){let{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return m("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:N.mediaChart,key:`media-${e.type}-${t}-${i}`})}_renderMediaInfoType(){let{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){let{activeMediaInfo:e}=this.viewModel;return e?m("div",{class:N.mediaItemContainer,key:"media-container"},m("div",{class:N.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;let t=e==="previous",i=t?this.messages.previous:this.messages.next,s=t?"chevron-left":"chevron-right",r=t?"media-previous":"media-next",a=t?this._previous:this._next;return m("button",{"aria-label":i,bind:this,class:N.mediaPaginationButton,key:r,onclick:a,tabIndex:0,title:i,type:"button"},m("calcite-icon",{class:N.mediaPaginationIcon,icon:s,scale:"s"}))}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;let{isAggregate:e,layer:t}=this.viewModel;return e&&t?.featureReduction&&"renderer"in t.featureReduction?t.featureReduction.renderer:t?.renderer}_getSeriesColors(e){return g(this,null,function*(){let{colorAm5:t}=yield import("./chunk-EQIQHQIC.js"),i=new Map;return e.forEach(s=>{s.color&&i.set(s,t(s.color.toCss(!0)))}),i})}_getRendererColors(){return g(this,null,function*(){let{colorAm5:e}=yield import("./chunk-EQIQHQIC.js"),t=new Map,i=this._getRenderer(),s="default";if(!i)return t;let r=yield Qt(i);return r.delete(s),Array.from(r.values()).every(a=>a?.length===1)&&Array.from(r.keys()).forEach(a=>{let d=r.get(a)?.[0]?.toCss(!0);d&&t.set(a,e(d))}),t})}_handleMediaKeyup(e){let{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!Yt()}_getChartAnimationMS(){return this._canAnimateChart()?Di:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?Bi:0}_renderChart(e){return g(this,null,function*(){let{root:t,mediaInfo:i}=e,{value:s,type:r}=i,{ResponsiveThemeAm5:a,DarkThemeAm5:d,AnimatedThemeAm5:l,ColorSetAm5:p,ThemeAm5:c,esriChartColorSet:u}=yield import("./chunk-EQIQHQIC.js"),h=c.new(t);h.rule("ColorSet").set("colors",u),h.rule("ColorSet").set("reuse",!0);let f=[a.new(t),h];wt()&&f.push(d.new(t)),this._canAnimateChart()&&f.push(l.new(t)),t.setThemes(f);let y=yield this._getRendererColors(),_=yield this._getSeriesColors(s.series),w=p.new(t,{}),x=_.get(s.series[0]),b=x?{lineSettings:{stroke:x}}:void 0,E=s.series.map((L,se)=>{let U=_.get(L)||y.get(L.fieldName)||w.getIndex(se);return v({[ie]:L.tooltip,[Ie]:L.value,columnSettings:{fill:U,stroke:U}},b)}).filter(L=>r!=="pie-chart"||L.value!=null&&L.value>0);r==="pie-chart"?this._createPieChart(e,E):this._createXYChart(e,E)})}_getDirection(){return ae(this.container)?"rtl":"ltr"}_customizeChartTooltip(e,t="horizontal"){return g(this,null,function*(){let{colorAm5:i}=yield import("./chunk-EQIQHQIC.js");e.setAll({pointerOrientation:t}),e.get("background")?.setAll({stroke:i(Hi)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:ji})})}_createPieChart(e,t){return g(this,null,function*(){let{TooltipAm5:i}=yield import("./chunk-EQIQHQIC.js"),{PieChartAm5:s,PieSeriesAm5:r}=yield import("./chunk-5FGA3SGC.js"),{mediaInfo:a,root:d}=e,{title:l}=a,p=5,c=a?.altText||a?.title||"",u=d.container.children.push(s.new(d,{ariaLabel:c,focusable:!0,paddingBottom:p,paddingTop:p,paddingLeft:p,paddingRight:p})),h=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,f=i.new(d,{labelText:h}),y=u.series.push(r.new(d,{name:l,valueField:Ie,categoryField:ie,tooltip:f}));y.ticks.template.set("forceHidden",!0),y.labels.template.set("forceHidden",!0),y.slices.template.states.create("active",{shiftRadius:p}),this._customizeChartTooltip(f),y.slices.template.setAll({ariaLabel:h,focusable:!0,templateField:"columnSettings"}),y.data.setAll(t),y.appear(this._getChartSeriesAnimationMS()),u.appear(this._getChartAnimationMS()),u.root.dom.classList.toggle(N.mediaChartRendered,!0)})}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t,i){return g(this,null,function*(){let{TooltipAm5:s,ScrollbarAm5:r}=yield import("./chunk-EQIQHQIC.js"),{CategoryAxisAm5:a,AxisRendererXAm5:d,ValueAxisAm5:l,AxisRendererYAm5:p,ColumnSeriesAm5:c}=yield import("./chunk-WBGWA2T3.js"),{mediaInfo:u,root:h}=t,{value:f,title:y}=u;e.setAll({wheelX:"panX",wheelY:"zoomX"});let _=e.xAxes.push(a.new(h,{renderer:d.new(h,{inversed:ae(this.container)}),categoryField:ie}));_.get("renderer").labels.template.setAll({forceHidden:!0});let w=e.yAxes.push(l.new(h,{renderer:p.new(h,{inside:!1}),min:this._getMinSeriesValue(f.series)}));w.get("renderer").labels.template.setAll({direction:this._getDirection()});let x="{categoryX}",b=s.new(h,{labelText:x}),E=e.series.push(c.new(h,{name:y,xAxis:_,yAxis:w,valueYField:Ie,categoryXField:ie,tooltip:b}));this._customizeChartTooltip(b),E.columns.template.setAll({ariaLabel:x,focusable:!0,templateField:"columnSettings"}),f.series.length>lt&&e.set("scrollbarX",r.new(h,{orientation:"horizontal"})),_.data.setAll(i),E.data.setAll(i),E.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createBarChart(e,t,i){return g(this,null,function*(){let{TooltipAm5:s,ScrollbarAm5:r}=yield import("./chunk-EQIQHQIC.js"),{CategoryAxisAm5:a,AxisRendererXAm5:d,ValueAxisAm5:l,AxisRendererYAm5:p,ColumnSeriesAm5:c}=yield import("./chunk-WBGWA2T3.js"),{mediaInfo:u,root:h}=t,{value:f,title:y}=u;e.setAll({wheelX:"panY",wheelY:"zoomY"});let _=e.yAxes.push(a.new(h,{renderer:p.new(h,{inversed:!0}),categoryField:ie}));_.get("renderer").labels.template.setAll({forceHidden:!0});let w=e.xAxes.push(l.new(h,{renderer:d.new(h,{inside:!1,inversed:ae(this.container)}),min:this._getMinSeriesValue(f.series)}));w.get("renderer").labels.template.setAll({direction:this._getDirection()});let x="{categoryY}",b=s.new(h,{labelText:x}),E=e.series.push(c.new(h,{name:y,xAxis:w,yAxis:_,valueXField:Ie,categoryYField:ie,tooltip:b}));this._customizeChartTooltip(b,"vertical"),E.columns.template.setAll({ariaLabel:x,focusable:!0,templateField:"columnSettings"}),f.series.length>lt&&e.set("scrollbarY",r.new(h,{orientation:"vertical"})),_.data.setAll(i),E.data.setAll(i),E.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createLineChart(e,t,i){return g(this,null,function*(){let{TooltipAm5:s,ScrollbarAm5:r}=yield import("./chunk-EQIQHQIC.js"),{CategoryAxisAm5:a,AxisRendererXAm5:d,ValueAxisAm5:l,AxisRendererYAm5:p,LineSeriesAm5:c}=yield import("./chunk-WBGWA2T3.js"),{root:u,mediaInfo:h}=t,{value:f,title:y}=h;e.setAll({wheelX:"panX",wheelY:"zoomX"});let _=e.xAxes.push(a.new(u,{renderer:d.new(u,{inversed:ae(this.container)}),categoryField:ie}));_.get("renderer").labels.template.setAll({forceHidden:!0});let w=e.yAxes.push(l.new(u,{renderer:p.new(u,{inside:!1}),min:this._getMinSeriesValue(f.series)}));w.get("renderer").labels.template.setAll({direction:this._getDirection()});let x="{categoryX}",b=i[0]?.lineSettings?.stroke,E=s.new(u,{getFillFromSprite:!b,labelText:x});b&&E.get("background")?.setAll({fill:b});let L=e.series.push(c.new(u,{name:y,xAxis:_,yAxis:w,valueYField:Ie,categoryXField:ie,tooltip:E}));L.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(E,"vertical"),f.series.length>lt&&e.set("scrollbarX",r.new(u,{orientation:"horizontal"})),_.data.setAll(i),L.data.setAll(i),L.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createXYChart(e,t){return g(this,null,function*(){let{XYChartAm5:i,XYCursorAm5:s}=yield import("./chunk-WBGWA2T3.js"),{root:r,mediaInfo:a}=e,{type:d}=a,l=a?.altText||a?.title||"",p=r.container.children.push(i.new(r,{ariaLabel:l,focusable:!0,panX:!0,panY:!0}));p.set("cursor",s.new(r,{})),d==="column-chart"&&(yield this._createColumnChart(p,e,t)),d==="bar-chart"&&(yield this._createBarChart(p,e,t)),d==="line-chart"&&(yield this._createLineChart(p,e,t)),p.root.dom.classList.toggle(N.mediaChartRendered,!0)})}_clearMediaRefreshTimer(){let{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){let t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();let{activeMediaInfo:e}=this.viewModel;e?.type==="image"&&e?.refreshInterval>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){let{refreshInterval:t,value:i}=e,s=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);let r=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},s);this._refreshTimer=r}_getImageSource(e,t){let i=e.includes("?")?"&":"?",[s,r=""]=e.split("#");return`${s}${i}timestamp=${t}${r?"#":""}${r}`}};o([n()],V.prototype,"_refreshIntervalInfo",void 0),o([n()],V.prototype,"attributes",null),o([n()],V.prototype,"activeMediaInfoIndex",null),o([n()],V.prototype,"description",null),o([n()],V.prototype,"fieldInfoMap",null),o([n()],V.prototype,"layer",null),o([n()],V.prototype,"mediaInfos",null),o([n()],V.prototype,"popupTemplate",null),o([n()],V.prototype,"relatedInfos",null),o([n()],V.prototype,"title",null),o([n({type:z})],V.prototype,"viewModel",void 0),o([n(),H("esri/widgets/Feature/t9n/Feature")],V.prototype,"messages",void 0),V=o([M("esri.widgets.Feature.FeatureMedia")],V);var Be=V;function ge(e,t,i,s){let r=null,a=1e3;typeof t=="number"?(a=t,s=i):(r=t??null,a=i);let d,l=0,p=()=>{l=0,e.apply(s,d)},c=(...u)=>{r&&r.apply(s,u),d=u,a?l||(l=setTimeout(p,a)):p()};return c.remove=()=>{l&&(clearTimeout(l),l=0)},c.forceUpdate=()=>{l&&(clearTimeout(l),p())},c.hasPendingUpdates=()=>!!l,c}var qi="esri.widgets.Feature.support.arcadeFeatureUtils",dt=()=>re.getLogger(qi);function di(e){return typeof e=="string"?Ve(Ne(e)):Array.isArray(e)?zi(e):e?.declaredClass==="esri.arcade.Dictionary"?Zi(e):e}function zi(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?Ve(Ne(t)):t}</li>`).join("")}</ul>`}function Zi(e){let t=e.keys().map(i=>{let s=e.field(i);return`<tr><th>${i}</th><td>${typeof s=="string"?Ve(Ne(s)):s}</td></tr>`}).join("");return`<table class="${G.table}">${t}</table>`}function pt(){return g(this,null,function*(){let[e,t]=yield Promise.all([import("./chunk-YFAQZGG6.js"),import("./chunk-ZB4NGSMJ.js")]);return{executor:e,syntaxUtils:t}})}function Xi(e){return"createQuery"in e&&"queryFeatures"in e}function Yi(s){return g(this,arguments,function*({graphic:e,view:t,options:i}){let{isAggregate:r,layer:a}=e;if(!r||!a||t?.type!=="2d")return[];let d=yield t.whenLayerView(a);if(!Xi(d))return[];let l=d.createQuery(),p=e.getObjectId();l.aggregateIds=p!=null?[p]:[];let{features:c}=yield d.queryFeatures(l,i);return c})}function Qi({layer:e,aggregatedFeatures:t,interceptor:i}){let{fields:s,objectIdField:r,geometryType:a,spatialReference:d,displayField:l}=e;return new Bt(mt(v({fields:s,objectIdField:r,geometryType:a,spatialReference:d,displayField:l,interceptor:i},e.type==="feature"?{templates:e.templates,typeIdField:e.typeIdField,types:e.types}:null),{source:t}))}function Ki(e){let t=e.declaredClass==="esri.views.3d.layers.VoxelGraphic";return e.isAggregate?"popup-feature-reduction":t?"popup-voxel":"popup"}function pi(e){return{scale:e?.scale,timeProperties:{currentStart:e?.timeExtent?.start,currentEnd:e?.timeExtent?.end,startIncluded:!0,endIncluded:!0}}}function Ji(e){return{$voxel:e}}function Gi(e,t,i,s,r){return g(this,null,function*(){let a=null;if(r.has("$aggregatedfeatures")){let d=yield Yi({graphic:e,view:t,options:i}),l=e.sourceLayer||e.layer;a=Qi({layer:l,aggregatedFeatures:d,interceptor:s})}return{vars:{$feature:e,$aggregatedFeatures:a,$view:pi(t)},[Symbol.dispose]:()=>a?.[Symbol.dispose]()}})}function es(e,t,i,s){let r=(e.sourceLayer||e.layer)??void 0;return{$feature:e,$layer:r!=null&&Mt(r)?r:r?.type==="scene"&&r.associatedLayer!=null?r.associatedLayer:void 0,$map:t,$datastore:r?.url,$userInput:i,$graph:r?.type==="knowledge-graph-sublayer"?r?.parentCompositeLayer?.knowledgeGraph:void 0,$view:pi(s)}}function ts(p,c){return g(this,arguments,function*(e,{graphic:t,map:i,location:s,view:r,options:a,interceptor:d,arcadeExecutor:l}){switch(e){case"popup":return{vars:es(t,i,s,r),[Symbol.dispose](){}};case"popup-feature-reduction":{let u=new Set(l.variablesUsed);return yield Gi(t,r,a,d,u)}case"popup-voxel":return{vars:Ji(t),[Symbol.dispose](){}};default:throw new Error(`Unexpected profile name ${e}`)}})}function ct(r){return g(this,arguments,function*({expressionInfo:e,arcade:{executor:t,syntaxUtils:i},graphic:s}){let a=e?.expression;if(!a)return null;let d=Ki(s),l=t.createArcadeProfile(d),p;try{p=yield t.createArcadeExecutor(a,l)}catch(h){return dt().error("arcade-executor-error",{error:h,expressionInfo:e}),null}let c=new Set;return p.variablesUsed.includes("$view")&&(i.scriptUsesViewProperties(p.syntaxTree,["scale"])&&c.add("view-scale"),i.scriptUsesViewProperties(p.syntaxTree,["timeProperties"])&&c.add("view-time-extent")),{dependencies:c,evaluate(E){return g(this,arguments,function*({graphic:h,interceptor:f,location:y,map:_,options:w,spatialReference:x,view:b}){let L=yield ts(d,{graphic:h,map:_,location:y,view:b,options:w,interceptor:f,arcadeExecutor:p}),se={abortSignal:w?.signal??void 0,interceptor:f??void 0,rawOutput:!0,spatialReference:x??void 0,timeZone:b?.timeZone,console(...U){dt().info(...U)}};try{return yield p.executeAsync(L.vars,se)}catch(U){return void dt().error("arcade-execution-error",{error:U,graphic:h,expressionInfo:e})}finally{L[Symbol.dispose]()}})}}})}function ci(e,t){return g(this,null,function*(){if(!e?.length)return{dependencies:new Set,expressions:new Map};let i=yield pt(),s=new Set,r=new Map;for(let a of e){let d=yield ct({expressionInfo:a,arcade:i,graphic:t});r.set(`expression/${a.name}`,d),d?.dependencies.forEach(l=>s.add(l))}return{dependencies:s,expressions:r}})}var ui=1,P=class extends B{constructor(e){super(e),this._compileTask=null,this._evaluateTask=null,this.expressionInfo=null,this.graphic=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._createVM=()=>{let t=this.contentElement?.type;this.contentElementViewModel?.destroy();let i=t==="fields"?new le:t==="media"?new z:t==="text"?new ne:null;this._set("contentElementViewModel",i)},this._compileThrottled=ge(this._startCompile,()=>this.notifyChange("state"),ui,this),this._evaluateThrottled=ge(this._startEvaluate,()=>this.notifyChange("state"),ui,this),this.addHandles([A(()=>[this.expressionInfo,this.graphic],()=>this._compileThrottled(),T),A(()=>[this.contentElement],()=>this._createVM(),T),Ce(()=>{if(!this._compileTask?.finished)return null;let t=this._compileTask.value,i=t?.dependencies;return[t,this.spatialReference,this.map,this.view,i?.has("view-scale")?this.view?.scale:null,i?.has("view-time-extent")?this.view?.timeExtent?.start:null,i?.has("view-time-extent")?this.view?.timeExtent?.end:null]},([t])=>this._evaluateThrottled(t))])}initialize(){this.addHandles([this._compileThrottled,this._evaluateThrottled])}destroy(){this._compileTask=W(this._compileTask),this._evaluateTask=W(this._evaluateTask),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null)}get contentElement(){return this._evaluateTask?.value}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){let{contentElement:e,contentElementViewModel:t}=this;return this._compileThrottled.hasPendingUpdates()||this._evaluateThrottled.hasPendingUpdates()||!this._compileTask?.finished||!this._evaluateTask?.finished?"loading":e||t?"ready":"disabled"}get map(){return this.view?.map??null}set map(e){this._override("map",e)}_startCompile(){this._evaluateTask=W(this._evaluateTask),this._compileTask=W(this._compileTask),this._compileTask=ce(e=>g(this,null,function*(){let{expressionInfo:t,graphic:i}=this;if(!t||!i)return null;let s=yield pt();oe(e);let r=yield ct({expressionInfo:t,arcade:s,graphic:i});return oe(e),r}))}_startEvaluate(e){this._evaluateTask=W(this._evaluateTask),this._evaluateTask=ce(t=>g(this,null,function*(){let{graphic:i}=this;if(!e||!i)return null;let{interceptor:s,spatialReference:r,map:a,location:d,view:l}=this,p=yield e.evaluate({graphic:i,interceptor:s,location:d,map:a,options:{signal:t},spatialReference:r,view:l});oe(t);let c=p;if(!c||c.declaredClass!=="esri.arcade.Dictionary")return null;let u=yield c.castAsJsonAsync(t);oe(t);let h=u?.type,f=h==="media"?Ft.fromJSON(u):h==="text"?ke.fromJSON(u):h==="fields"?Ct.fromJSON(u):null;return f.type==="media"&&!f.mediaInfos||f.type==="fields"&&!f.fieldInfos||f.type==="text"&&!f.text?null:f}))}};o([n()],P.prototype,"_compileTask",void 0),o([n()],P.prototype,"_evaluateTask",void 0),o([n({type:At})],P.prototype,"expressionInfo",void 0),o([n({type:ue})],P.prototype,"graphic",void 0),o([n({readOnly:!0})],P.prototype,"contentElement",null),o([n({readOnly:!0})],P.prototype,"contentElementViewModel",void 0),o([n()],P.prototype,"interceptor",void 0),o([n({type:Fe})],P.prototype,"location",void 0),o([n()],P.prototype,"spatialReference",null),o([n({readOnly:!0})],P.prototype,"state",null),o([n()],P.prototype,"map",null),o([n()],P.prototype,"view",void 0),P=o([M("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],P);var Me=P;var mi="esri-feature",hi={base:`${mi}-expression`,loadingSpinnerContainer:`${mi}__loading-container`},je=class extends O{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new Me}initialize(){this.addHandles(A(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),T))}loadDependencies(){return J({loader:()=>import("./chunk-JHM3YD5O.js")})}destroy(){this._destroyContentWidget()}render(){let{state:e}=this.viewModel;return m("div",{class:hi.base},e==="loading"?this._renderLoading():e==="disabled"?null:this._contentWidget?.render())}_renderLoading(){return m("div",{class:hi.loadingSpinnerContainer,key:"loading-container"},m("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){let{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){let{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t?.type;this._destroyContentWidget();let s=e?i==="fields"?new De({viewModel:e}):i==="media"?new Be({viewModel:e}):i==="text"?new fe({viewModel:e}):null:null;this._contentWidget=s,this.scheduleRender()}};o([n({type:Me})],je.prototype,"viewModel",void 0),je=o([M("esri.widgets.Feature.FeatureExpression")],je);var fi=je;var qe,ze="esri-feature",xe=`${ze}-relationship`,Y={base:xe,listContainer:`${xe}__list`,listItem:`${xe}__list-item`,listItemHidden:`${xe}__list-item--hidden`,listContainerQuerying:`${xe}__list--querying`,featureObserver:`${ze}__feature-observer`,stickySpinnerContainer:`${ze}__sticky-loading-container`,loadingSpinnerContainer:`${ze}__loading-container`},yi={title:!0,description:!0},$=qe=class extends O{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.flowItems=null,this.flowType="feature-relationship",this.headingLevel=2,this.viewModel=new ve,this.messages=null,this.messagesCommon=null,this.visibleElements=v({},yi),this._increaseFeaturePage=()=>{let{state:i,showAllEnabled:s,relatedFeatures:r,featuresPerPage:a,featurePage:d}=this.viewModel;i==="ready"&&s&&r.length>=a*d&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new ee,this.addHandles([A(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),T),A(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),Te(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return J({chip:()=>import("./chunk-KUULEAF3.js"),icon:()=>import("./chunk-QXDSJABL.js"),list:()=>import("./chunk-QV3363IT.js"),"list-item":()=>import("./chunk-PXFXZ5UQ.js"),loader:()=>import("./chunk-JHM3YD5O.js"),notice:()=>import("./chunk-RIKTH4T2.js")})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=ht(this._featureElementInfo)}get displayShowAllButton(){let{showAllEnabled:e,featureCount:t,displayCount:i,state:s,allCategoriesCount:r}=this.viewModel;return!e&&s==="ready"&&(!!r&&(r>i||i===0)||!!t&&(t>i||i===0))}get displayListItems(){let{relatedFeatureViewModels:e,allCategoriesCount:t}=this.viewModel;return this.displayShowAllButton||!!e.length||!!t}get allItemsDescription(){let{messages:e}=this,{featureCount:t,allCategories:i,allCategoriesCount:s}=this.viewModel;return pe(e?.numberRecords,{number:et(i?s:t)})}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){let{activeCategory:e,title:t}=this.viewModel;return e?.name??t}set title(e){this.viewModel.title=e}castVisibleElements(e){return v(v({},yi),e)}render(){let{state:e}=this.viewModel;return m("div",{class:this.classes(Y.base,G.widget)},this._featureElementInfo?.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_selectCategory(e){return g(this,null,function*(){let{flowItems:t,featureVisibleElements:i,viewModel:s}=this;t&&(s.activeCategory=e,s.showAllEnabled=!0,t.push(new qe({flowItems:t,featureVisibleElements:i,visibleElements:{title:!1,description:!1},viewModel:s})))})}_selectRecord(e){return g(this,null,function*(){let{flowItems:t,featureVisibleElements:i}=this;if(!t)return;e.abilities={relationshipContent:!0};let{default:s}=yield import("./chunk-QGB7PDCM.js");t.push(new s({flowItems:t,flowType:this.flowType,viewModel:e,visibleElements:i}))})}_showAllRecords(){let{flowItems:e}=this;if(!e)return;let{viewModel:t,featureVisibleElements:i}=this;t.showAllEnabled=!0;let s=new qe({flowItems:e,featureVisibleElements:i,visibleElements:{title:!1,description:!1},viewModel:t});e.push(s)}_renderStickyLoading(){return this.viewModel.state==="querying"?m("div",{class:Y.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return m("calcite-loader",{inline:!0,label:""})}_renderLoading(){return m("div",{class:Y.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return m("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){let e=ae(this.container)?"chevron-left":"chevron-right";return m("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderCategory(e){let{count:t,name:i,value:s}=e,r=et(t);return m("calcite-list-item",{class:Y.listItem,disabled:!t,key:s,label:i,onCalciteListItemSelect:()=>this._selectCategory(e)},m("calcite-chip",{label:r,scale:"s",slot:"content-end"},r),this._renderChevronIconNode())}_renderRelatedFeature(e){let{itemDescriptionFieldName:t}=this.viewModel,i=e.title;e.description=t&&e.formattedAttributes?.global[t];let s=e.state==="loading";return m("calcite-list-item",{class:this.classes(Y.listItem,{[Y.listItemHidden]:s}),description:Ke(e.description??""),key:e.uid,label:Ke(i),onCalciteListItemSelect:()=>this._selectRecord(e)},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?m("calcite-list-item",{description:this.allItemsDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this._showAllRecords()},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return m("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},m("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return m("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Y.featureObserver,key:"feature-observer"})}_renderList(){let{relatedFeatureViewModels:e,categories:t}=this.viewModel;return m("calcite-list",{displayMode:"flat",label:this.messages?.relatedFeaturesList},t?.map(i=>this._renderCategory(i))??e.toArray().map(i=>this._renderRelatedFeature(i)),this._renderShowAllListItem())}_renderRelatedFeatures(){let{displayListItems:e}=this,{state:t}=this.viewModel;return m("div",{class:this.classes(Y.listContainer,{[Y.listContainerQuerying]:t==="querying"}),key:"list-container"},e?this._renderList():t==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return m("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},m("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){let{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e?.forEach(i=>{this.addHandles(A(()=>[i.title,i.state],()=>this.scheduleRender(),T),t)}),this.scheduleRender()}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,s=t.title&&this.title;this._featureElementInfo?.set({description:i,title:s,headingLevel:e})}_handleRelatedFeatureObserverChange(){return g(this,null,function*(){this._unobserveRelatedFeatureObserver();let{state:e,showAllEnabled:t}=this.viewModel;yield yt(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)})}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};o([n()],$.prototype,"_relatedFeatureIntersectionObserverNode",void 0),o([n({readOnly:!0})],$.prototype,"displayShowAllButton",null),o([n({readOnly:!0})],$.prototype,"displayListItems",null),o([n({readOnly:!0})],$.prototype,"allItemsDescription",null),o([n()],$.prototype,"description",null),o([n()],$.prototype,"featureVisibleElements",void 0),o([n()],$.prototype,"flowItems",void 0),o([n()],$.prototype,"flowType",void 0),o([n()],$.prototype,"headingLevel",void 0),o([n()],$.prototype,"title",null),o([n({type:ve})],$.prototype,"viewModel",void 0),o([n(),H("esri/widgets/Feature/t9n/Feature")],$.prototype,"messages",void 0),o([n(),H("esri/t9n/common")],$.prototype,"messagesCommon",void 0),o([n()],$.prototype,"visibleElements",void 0),o([K("visibleElements")],$.prototype,"castVisibleElements",null),$=qe=o([M("esri.widgets.Feature.FeatureRelationship")],$);var gi=$;var Ze=class{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=s=>{}),this.preRequestCallback||(this.preLayerQueryCallback=s=>{})}};var _e,_i=1,vi="content-view-models",wi="relationship-view-models",is="association-view-models",bi={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0,utilityNetworkAssociationsContent:!0},I=_e=class extends xt.IdentifiableMixin(B){constructor(e){super(e),this._error=null,this._graphicChangedTask=null,this._evaluateExpressionAttributesTask=null,this._associationVMAbortController=null,this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=v({},bi),this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._graphicChangedThrottled=ge(this._graphicChanged,()=>this.notifyChange("waitingForContent"),_i,this),this._isAllowedContentType=t=>{let{abilities:i}=this;return t.type==="attachments"&&!!i.attachmentsContent||t.type==="custom"&&!!i.customContent||t.type==="fields"&&!!i.fieldsContent||t.type==="media"&&!!i.mediaContent||t.type==="text"&&!!i.textContent||t.type==="expression"&&!!i.expressionContent||t.type==="relationship"&&!!i.relationshipContent||t.type==="utility-network-associations"&&!!i.utilityNetworkAssociationsContent},this._evaluateExpressionAttributesThrottled=ge(this._evaluateExpressionAttributes,()=>this.notifyChange("waitingForContent"),_i,this),this.addHandles([A(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),T),Ce(()=>{if(!this._graphicChangedTask?.finished||this._graphicChangedTask.value==null)return null;let t=this._graphicChangedTask.value,i=t?.expressionInfos?.dependencies;return[t,i?.has("view-scale")?this.view?.scale:null,i?.has("view-time-extent")?this.view?.timeExtent?.start:null,i?.has("view-time-extent")?this.view?.timeExtent?.end:null]},([t])=>this._evaluateExpressionAttributesThrottled(t))])}initialize(){this.addHandles([this._graphicChangedThrottled,this._evaluateExpressionAttributesThrottled])}destroy(){this._clear(),this._graphicChangedTask=W(this._graphicChangedTask),this._evaluateExpressionAttributesTask=W(this._evaluateExpressionAttributesTask),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return this.graphic!=null?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return Ot(rt(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Lt(this.graphic)}castAbilities(e){return v(v({},bi),e)}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?.clone()??null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get timeZone(){return this.view?.timeZone??gt}set timeZone(e){this._overrideIfSome("timeZone",e)}get map(){return this.view?.map||null}set map(e){this._override("map",e)}get waitingForContent(){let{_graphicChangedThrottled:e,_evaluateExpressionAttributesThrottled:t,_graphicChangedTask:i,_evaluateExpressionAttributesTask:s,_associationVMAbortController:r}=this;return e.hasPendingUpdates()||t.hasPendingUpdates()||i!=null&&!i.finished||s!=null&&!s.finished||!!r}setActiveMedia(e,t){let i=this.contentViewModels[e];i instanceof z&&i.setActiveMedia(t)}nextMedia(e){let t=this.contentViewModels[e];t instanceof z&&t.next()}previousMedia(e){let t=this.contentViewModels[e];t instanceof z&&t.previous()}updateGeometry(){return g(this,null,function*(){let{graphic:e,spatialReference:t,_sourceLayer:i}=this;yield i?.load();let s=i?.objectIdField;if(!s||!e||!i)return;let r=e?.attributes?.[s];if(r==null)return;let a=[r];if(!e.geometry){let d=yield Wt({layer:i,graphic:e,outFields:[],objectIds:a,returnGeometry:!0,spatialReference:t}),l=d?.geometry;l&&(e.geometry=l)}})}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){this._evaluateExpressionAttributesTask=W(this._evaluateExpressionAttributesTask),this._graphicChangedTask=W(this._graphicChangedTask),this._graphicChangedTask=ce(e=>g(this,null,function*(){this._error=null,this._clear();let{graphic:t}=this;try{if(!t)return null;let{_sourceLayer:i,_effectivePopupTemplate:s}=this,r=this.spatialReference;yield Ut({graphic:t,popupTemplate:s,layer:i,spatialReference:r},{signal:e});let[{value:a},{value:d}]=yield Q([this._getContent(),this._getTitle()]),[,{value:l}]=yield Q([this._checkForRelatedFeatures({signal:e}),ci(s?.expressionInfos,t)]);return{expressionInfos:l,content:a,title:d}}catch(i){throw Ge(i)||(this._error=i,re.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:t,popupTemplate:this._effectivePopupTemplate})),i}}))}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):e.type==="relationship"?this._compileRelationship(e,t):e.type==="utility-network-associations"?this._compileUtilityNetworkAssociation(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)).filter(Ae):typeof e=="string"?this._compileText(new ke({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(wi),this.removeHandles(vi),this.contentViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("contentViewModels",[])}_matchesFeature(e,t){let i=e?.graphic?.getObjectId(),s=t?.getObjectId();return i!=null&&s!=null&&i===s}_setRelatedFeaturesViewModels({relatedFeatureViewModels:e,relatedFeatures:t,map:i}){let{view:s,spatialReference:r,timeZone:a}=this;t?.filter(Boolean).forEach(d=>{e.some(l=>this._matchesFeature(l,d))||e.add(new _e({abilities:{relationshipContent:!1},map:i,view:s,spatialReference:r,timeZone:a,graphic:d}))}),e.forEach(d=>{t?.find(p=>this._matchesFeature(d,p))||e.remove(d)})}_setExpressionContentVM(e,t){let i=this.formattedAttributes,{contentElement:s,contentElementViewModel:r}=e,a=s?.type;r&&a&&(a==="fields"&&(this._createFieldsFormattedAttributes({contentElement:s,contentElementIndex:t,formattedAttributes:i}),r.set(this._createFieldsVMParams(s,t))),a==="media"&&(this._createMediaFormattedAttributes({contentElement:s,contentElementIndex:t,formattedAttributes:i}),r.set(this._createMediaVMParams(s,t))),a==="text"&&r.set(this._createTextVMParams(s)))}_compileRelationship(e,t){let{displayCount:i,orderByFields:s,relationshipId:r,title:a,description:d}=e,{_sourceLayer:l,graphic:p,map:c}=this;if(!St(l))return;let u=new ve(v({displayCount:i,graphic:p,orderByFields:s,relationshipId:r,layer:l,map:c},this._compileTitleAndDesc({title:a,description:d})));return this.contentViewModels[t]=u,this.addHandles(Te(()=>u.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(u)),wi),e}_matchesGlobalFeature(e,t){let i=e?.association.globalId,s=t?.association.globalId;return i!=null&&s!=null&&i===s}_setUpUtilityNetworkAssociationsViewModels(e,t,i){return g(this,null,function*(){let{view:s,spatialReference:r,timeZone:a}=this;e.forEach((l,p)=>{let c=t.get(p);c?l.forEach(u=>{c.find(h=>this._matchesGlobalFeature(u,h))||(l.remove(u),l.length===0&&e.delete(p))}):(l.removeAll(),e.delete(p))}),t.forEach((l,p)=>{let c=e.get(p)||new _t;l?.filter(Boolean).forEach(u=>{c.some(h=>this._matchesGlobalFeature(h,u))||c.add({association:u.association,featureViewModel:new _e({abilities:{utilityNetworkAssociationsContent:!1},map:i,view:s,spatialReference:r,timeZone:a,graphic:u.feature}),terminalName:u.terminalName})}),e.set(p,c)});let d=new AbortController;this._associationVMAbortController=d,yield this._sortListObjectsByTitle(e,{signal:d.signal}),this._associationVMAbortController===d&&(this._associationVMAbortController=null)})}_sortListObjectsByTitle(e,t){return g(this,null,function*(){for(let i of e.values()){let s=i.map(r=>vt(()=>r.featureViewModel.state==="ready",t?.signal));yield Promise.all(s),i.sort(this._compareByFeatureTitle)}})}_compareByFeatureTitle(e,t){let i=ot(e.featureViewModel),s=ot(t.featureViewModel);return i.localeCompare(s,void 0,{numeric:!0})}_compileUtilityNetworkAssociation(e,t){let{displayCount:i,title:s,description:r,associationTypes:a}=e,{_sourceLayer:d,graphic:l,map:p}=this;if(!Nt(d))return;let c=new Kt(v({graphic:l,displayCount:i,associationTypes:a,layer:d,map:p},this._compileTitleAndDesc({title:s,description:r})));return this.contentViewModels[t]=c,this.addHandles([A(()=>c.associationFeatures.values(),()=>this._setUpUtilityNetworkAssociationsViewModels(c.associationViewModels,c.associationFeatures,c.map))],is),e}_compileExpression(e,t){let{expressionInfo:i}=e,{graphic:s,map:r,spatialReference:a,view:d,location:l}=this,p=new Me({expressionInfo:i,graphic:s,interceptor:_e.interceptor,map:r,spatialReference:a,view:d,location:l});return this.contentViewModels[t]=p,this.addHandles(A(()=>p.contentElementViewModel,()=>this._setExpressionContentVM(p,t),T),vi),e}_compileAttachments(e,t){let{graphic:i}=this,{description:s,title:r,orderByFields:a}=e;return this.contentViewModels[t]=new be(v({graphic:i,orderByFields:a},this._compileTitleAndDesc({title:r,description:s}))),e}_compileCustom(e,t){let{graphic:i}=this,{creator:s,destroyer:r}=e;return this.contentViewModels[t]=new ne({graphic:i,creator:s,destroyer:r}),e}_compileTitleAndDesc({title:e,description:t}){let{_fieldInfoMap:i,_sourceLayer:s,graphic:r,formattedAttributes:a}=this,d=r?.attributes,l=this._expressionAttributes,p=a.global;return{title:Z({attributes:d,fieldInfoMap:i,globalAttributes:p,expressionAttributes:l,layer:s,text:e}),description:Z({attributes:d,fieldInfoMap:i,globalAttributes:p,expressionAttributes:l,layer:s,text:t})}}_createFieldsVMParams(e,t){let i=this._effectivePopupTemplate,s=this.formattedAttributes,r=v(v({},s?.global),s?.content[t]),a=e?.fieldInfos||i?.fieldInfos,d=a?.filter(({fieldName:u})=>!!u&&($e(u)||j(u)||r.hasOwnProperty(u))),l=i?.expressionInfos,{description:p,title:c}=e;return v({attributes:r,expressionInfos:l,fieldInfos:d},this._compileTitleAndDesc({title:c,description:p}))}_compileFields(e,t){let i=e.clone(),s=new le(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=s,i.fieldInfos=s.formattedFieldInfos.slice(),i}_createMediaVMParams(e,t){let{abilities:i,graphic:s,_fieldInfoMap:r,_effectivePopupTemplate:a,relatedInfos:d,_sourceLayer:l,_expressionAttributes:p}=this,c=this.formattedAttributes,u=s?.attributes??{},{description:h,mediaInfos:f,title:y}=e;return v({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:u,isAggregate:s?.isAggregate,layer:l,fieldInfoMap:r,formattedAttributes:v(v({},c?.global),c?.content[t]),expressionAttributes:p,mediaInfos:f,popupTemplate:a,relatedInfos:d},this._compileTitleAndDesc({title:y,description:h}))}_compileMedia(e,t){let i=e.clone(),s=new z(this._createMediaVMParams(e,t));return i.mediaInfos=s.formattedMediaInfos.slice(),this.contentViewModels[t]=s,i}_createTextVMParams(e){let{graphic:t,_fieldInfoMap:i,_sourceLayer:s,_expressionAttributes:r}=this;if(e&&e.text){let a=t?.attributes??{},d=this.formattedAttributes?.global??{};e.text=Z({attributes:a,fieldInfoMap:i,globalAttributes:d,expressionAttributes:r,layer:s,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){let i=e.clone();return this.contentViewModels[t]=new ne(this._createTextVMParams(i)),i}_compileLastEditInfo(){let{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i,timeZone:s}=this;if(!e)return;let{lastEditInfoEnabled:r}=e,a=t?.editFieldsInfo;return r&&a?Pt(a,i?.attributes,s,t):void 0}_compileTitle(e){let{_fieldInfoMap:t,_sourceLayer:i,graphic:s,_expressionAttributes:r}=this,a=s?.attributes??{},d=this.formattedAttributes?.global??{};return Z({attributes:a,fieldInfoMap:t,globalAttributes:d,expressionAttributes:r,layer:i,text:e})}_getTitle(){return g(this,null,function*(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?me({type:"title",value:e?.title,event:{graphic:t}}):null})}_getContent(){return g(this,null,function*(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?me({type:"content",value:e?.content,event:{graphic:t}}):null})}_evaluateExpressionAttributes({title:e,content:t,expressionInfos:i}){this._evaluateExpressionAttributesTask=W(this._evaluateExpressionAttributesTask),this._evaluateExpressionAttributesTask=ce(s=>g(this,null,function*(){let{graphic:r,map:a,view:d,spatialReference:l,location:p}=this;try{if(!r)return;let c;if(i!=null){let u=[];for(let[h,f]of i.expressions.entries())f!=null?u.push(f.evaluate({graphic:r,interceptor:_e.interceptor,location:p,map:a,options:{signal:s},spatialReference:l,view:d}).then(y=>[h,di(y)]).catch(()=>[h,void 0])):u.push(Promise.resolve([h,void 0]));c=Object.fromEntries(yield Promise.all(u)),oe(s)}this._expressionAttributes=c,this._graphicExpressionAttributes=v(v({},r.attributes),c),this._set("formattedAttributes",this._createFormattedAttributes(t)),this._set("title",this._compileTitle(e)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(t)||null)}catch(c){Ge(c)||(this._error=c,re.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:c,graphic:r,popupTemplate:this._effectivePopupTemplate}))}}))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){let{_effectivePopupTemplate:s,graphic:r,relatedInfos:a,_sourceLayer:d,_fieldInfoMap:l,_graphicExpressionAttributes:p,timeZone:c}=this;i.content[t]=Pe({fieldInfos:s?.fieldInfos,graphic:r,attributes:v(v({},p),e.attributes),layer:d,fieldInfoMap:l,relatedInfos:a,timeZone:c})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){let{graphic:s,relatedInfos:r,_sourceLayer:a,_fieldInfoMap:d,_graphicExpressionAttributes:l,timeZone:p}=this;i.content[t]=Pe({fieldInfos:e.fieldInfos,graphic:s,attributes:v(v({},l),e.attributes),layer:a,fieldInfoMap:d,relatedInfos:r,timeZone:p})}}_createFormattedAttributes(e){let{_effectivePopupTemplate:t,graphic:i,relatedInfos:s,_sourceLayer:r,_fieldInfoMap:a,_graphicExpressionAttributes:d,timeZone:l}=this,p=t?.fieldInfos,c={global:Pe({fieldInfos:p,graphic:i,attributes:d,layer:r,fieldInfoMap:a,relatedInfos:s,timeZone:l}),content:[]};return Array.isArray(e)&&e.forEach((u,h)=>{u.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:u,contentElementIndex:h,formattedAttributes:c}),u.type==="media"&&this._createMediaFormattedAttributes({contentElement:u,contentElementIndex:h,formattedAttributes:c})}),c}_checkForRelatedFeatures(e){let{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,rt(i),e)}_queryRelatedInfos(e,t,i){return g(this,null,function*(){let{relatedInfos:s,_sourceLayer:r}=this;s.clear();let a=r?.associatedLayer!=null?yield r?.associatedLayer.load(i):r;if(!a||!e||!t.filter(c=>!!c.fieldName&&j(c.fieldName))?.length)return;t.forEach(c=>this._configureRelatedInfo(c,a));let l=yield oi({relatedInfos:s,layer:a},i);Object.keys(l).forEach(c=>{let u=s.get(c.toString()),h=l[c]?.value;u&&h&&(u.layerInfo=h.data)});let p=yield ai({graphic:e,relatedInfos:s,layer:a},i);Object.keys(p).forEach(c=>{ri(p[c]?.value,s.get(c.toString()))})})}_configureRelatedInfo(e,t){let{relatedInfos:i}=this,s=ye(e.fieldName||"");if(!s)return;let{layerId:r,fieldName:a}=s;if(!r)return;let d=i.get(r.toString())||si(r,t);d&&(ni({relatedInfo:d,fieldName:a,fieldInfo:e}),this.relatedInfos.set(r,d))}};I.interceptor=new Ze(Ht,Dt),o([n()],I.prototype,"_error",void 0),o([n()],I.prototype,"_graphicChangedTask",void 0),o([n()],I.prototype,"_evaluateExpressionAttributesTask",void 0),o([n()],I.prototype,"_associationVMAbortController",void 0),o([n({readOnly:!0})],I.prototype,"_effectivePopupTemplate",null),o([n({readOnly:!0})],I.prototype,"_fieldInfoMap",null),o([n({readOnly:!0})],I.prototype,"_sourceLayer",null),o([n()],I.prototype,"abilities",void 0),o([K("abilities")],I.prototype,"castAbilities",null),o([n({readOnly:!0})],I.prototype,"content",void 0),o([n({readOnly:!0})],I.prototype,"contentViewModels",void 0),o([n()],I.prototype,"description",void 0),o([n({type:Boolean})],I.prototype,"defaultPopupTemplateEnabled",void 0),o([n({readOnly:!0})],I.prototype,"isTable",null),o([n({readOnly:!0})],I.prototype,"state",null),o([n({readOnly:!0})],I.prototype,"formattedAttributes",void 0),o([n({type:ue,value:null})],I.prototype,"graphic",null),o([n({readOnly:!0})],I.prototype,"lastEditInfo",void 0),o([n({type:Fe})],I.prototype,"location",void 0),o([n({readOnly:!0})],I.prototype,"relatedInfos",void 0),o([n({type:It})],I.prototype,"spatialReference",null),o([n()],I.prototype,"timeZone",null),o([n({readOnly:!0})],I.prototype,"title",void 0),o([n()],I.prototype,"map",null),o([n({readOnly:!0})],I.prototype,"waitingForContent",null),o([n()],I.prototype,"view",void 0),I=_e=o([M("esri.widgets.Feature.FeatureViewModel")],I);var ut=I;var S="esri-feature",C={base:S,container:`${S}__size-container`,title:`${S}__title`,main:`${S}__main-container`,btn:`${S}__button`,icon:`${S}__icon`,content:`${S}__content`,contentNode:`${S}__content-node`,contentNodeText:`${S}__content-node--text`,contentElement:`${S}__content-element`,text:`${S}__text`,lastEditedInfo:`${S}__last-edited-info`,fields:`${S}__fields`,fieldHeader:`${S}__field-header`,fieldData:`${S}__field-data`,fieldDataDate:`${S}__field-data--date`,loadingSpinnerContainer:`${S}__loading-container`};var Ii=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>We(i)&&!i.destroyed?m("div",{class:C.contentNode,key:i},i.render()):i instanceof HTMLElement?m("div",{afterCreate:this._attachToNode,bind:i,class:C.contentNode,key:i}):Xt(i)?m("div",{afterCreate:this._attachToNode,bind:i.domNode,class:C.contentNode,key:i}):null}_attachToNode(i){let s=this;i.appendChild(s)}};return t=o([M("esri.widgets.Feature.support.FeatureContentMixin")],t),t};var Mi={title:!0,content:!0,lastEditedInfo:!0},F=class extends Ii(O){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowType="feature",this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements=v({},Mi),this.viewModel=new ut}initialize(){this.addHandles(A(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),T))}loadDependencies(){return J({notice:()=>import("./chunk-RIKTH4T2.js"),loader:()=>import("./chunk-JHM3YD5O.js")})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get title(){return this.viewModel.title}castVisibleElements(e){return v(v({},Mi),e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){let{state:e}=this.viewModel,t=m("div",{class:C.container,key:"container"},this._renderTitle(),e==="error"?this._renderError():e==="loading"?this._renderLoading():this._renderContentContainer());return m("div",{class:this.classes(C.base,G.widget)},t)}_renderError(){let{messagesCommon:e,messages:t,visibleElements:i}=this;return m("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?m("div",{key:"error-title",slot:"title"},e.errorMessage):null,m("div",{key:"error-message",slot:"message"},t.loadingError))}_renderLoading(){return m("div",{class:C.loadingSpinnerContainer,key:"loading-container"},m("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){let{visibleElements:e}=this;return e.content?m("div",{class:C.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){let{visibleElements:e,title:t}=this;return e.title?m(Zt,{class:C.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){let e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?m("div",{class:C.contentNode,key:`${t}-content-elements`},e.map(this._renderContentElement,this)):null;if(typeof e=="string"){let i=this._contentWidgets[0];return!i||i.destroyed?null:m("div",{class:this.classes(C.contentNode,C.contentNodeText),key:`${t}-content`},i.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){let{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content?.[e.type])return null;switch(e.type){case"attachments":return this._renderAttachments(t);case"custom":return this._renderCustom(e,t);case"fields":return this._renderFields(t);case"media":return this._renderMedia(t);case"text":return this._renderText(e,t);case"expression":return this._renderExpression(t);case"relationship":return this._renderRelationship(t);case"utility-network-associations":return this._renderAssociation(t);default:return null}}_renderAttachments(e){let t=this._contentWidgets[e];if(!t||t.destroyed)return null;let{state:i,attachmentInfos:s}=t.viewModel;return i==="loading"||s.length>0?m("div",{class:this.classes(C.contentElement),key:this._buildKey("attachments-element",e)},t.render()):null}_renderRelationship(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?m("div",{class:C.contentElement,key:this._buildKey("relationship-element",e)},t.render()):null}_renderAssociation(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?m("div",{class:C.contentElement,key:this._buildKey("utility-network-association-element",e)},t.render()):null}_renderExpression(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&t.viewModel.contentElement?m("div",{class:C.contentElement,key:this._buildKey("expression-element",e)},t.render()):null}_renderCustom(e,t){let{creator:i}=e,s=this._contentWidgets[t];return!s||s.destroyed?null:i?m("div",{class:C.contentElement,key:this._buildKey("custom-element",t)},s.render()):null}_renderFields(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:m("div",{class:C.contentElement,key:this._buildKey("fields-element",e)},t.render())}_renderMedia(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:m("div",{class:C.contentElement,key:this._buildKey("media-element",e)},t.render())}_renderLastEditInfo(){let{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;let{date:s,user:r}=i,a=i.type==="edit"?r?t.lastEditedByUser:t.lastEdited:r?t.lastCreatedByUser:t.lastCreated,d=pe(a,{date:s,user:r});return m("div",{class:this.classes(C.lastEditedInfo,C.contentElement),key:"edit-info-element"},d)}_renderText(e,t){let i=e.text,s=this._contentWidgets[t];return!s||s.destroyed?null:i?m("div",{class:this.classes(C.contentElement,C.text),key:this._buildKey("text-element",t)},s.render()):null}_buildKey(e,...t){return`${e}__${this.viewModel?.graphic?.uid||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();let{headingLevel:e,visibleElements:t,flowItems:i,viewModel:s}=this,r=s?.content,{contentViewModels:a}=s;if(Array.isArray(r))r.forEach((d,l)=>{if(d.type==="attachments"&&(this._contentWidgets[l]=new Gt({displayType:d.displayType,headingLevel:t.title&&e<6?e+1:e,viewModel:a[l]})),d.type==="fields"&&(this._contentWidgets[l]=new De({viewModel:a[l]})),d.type==="media"&&(this._contentWidgets[l]=new Be({viewModel:a[l]})),d.type==="text"&&(this._contentWidgets[l]=new fe({viewModel:a[l]})),d.type==="custom"&&(this._contentWidgets[l]=new fe({viewModel:a[l]})),d.type==="expression"&&(this._contentWidgets[l]=new fi({viewModel:a[l]})),d.type==="relationship"){let p=new gi({flowItems:i,featureVisibleElements:t,viewModel:a[l]});this._contentWidgets[l]=p}if(d.type==="utility-network-associations"){let p=u=>g(this,null,function*(){let{viewModel:h,listType:f,title:y}=u;if(!i)return;h.activeAssociationType=f;let{default:_}=yield import("./chunk-BCYYTRAQ.js"),w=new _({viewModel:h,parentFeatureViewModel:s,listType:f,title:y,featureVisibleElements:t,description:s.title,flowItems:i});i.push(w)}),c=new Jt({flowItems:i,onSelectAssociationType:p,parentFeatureViewModel:s,featureVisibleElements:t,viewModel:a[l]});this._contentWidgets[l]=c}},this);else{let d=a[0];d&&!d.destroyed&&(this._contentWidgets[0]=new fe({viewModel:d}))}this.scheduleRender()}};o([n()],F.prototype,"flowType",void 0),o([n()],F.prototype,"graphic",null),o([n()],F.prototype,"defaultPopupTemplateEnabled",null),o([n()],F.prototype,"flowItems",void 0),o([n()],F.prototype,"headingLevel",void 0),o([n({readOnly:!0})],F.prototype,"isTable",null),o([n()],F.prototype,"icon",null),o([n()],F.prototype,"label",null),o([n()],F.prototype,"location",null),o([n(),H("esri/widgets/Feature/t9n/Feature")],F.prototype,"messages",void 0),o([n(),H("esri/t9n/common")],F.prototype,"messagesCommon",void 0),o([n()],F.prototype,"spatialReference",null),o([n()],F.prototype,"timeZone",null),o([n({readOnly:!0})],F.prototype,"title",null),o([n()],F.prototype,"visibleElements",void 0),o([K("visibleElements")],F.prototype,"castVisibleElements",null),o([n()],F.prototype,"map",null),o([n()],F.prototype,"view",null),o([n({type:ut})],F.prototype,"viewModel",void 0),F=o([M("esri.widgets.Feature")],F);var wl=F;export{ge as a,ut as b,C as c,Ii as d,wl as e};
