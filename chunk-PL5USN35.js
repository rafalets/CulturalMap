import{a as v}from"./chunk-ITHMAVAM.js";import{a as M}from"./chunk-FQTXYWH5.js";import"./chunk-KLXERNY4.js";import{a as _,b}from"./chunk-JVGM2LBA.js";import"./chunk-YNINCQ45.js";import{a as k,b as N}from"./chunk-L755QJ73.js";import"./chunk-3BDL2KTL.js";import"./chunk-LNVVFNTC.js";import{e as E,f as G,g as V}from"./chunk-MBE3KZ4V.js";import"./chunk-EWGQ3XHW.js";import{b as L}from"./chunk-S7QYPX7J.js";import"./chunk-X7QUUHRV.js";import"./chunk-7B2UKJ5N.js";import"./chunk-RSDQHAJX.js";import"./chunk-OLOKUDVI.js";import"./chunk-RJWOVI3M.js";import"./chunk-R6GE4XRP.js";import{n as C,o as g}from"./chunk-MDL4XPLR.js";import{b as D}from"./chunk-LDPKBMTU.js";import{a as p,b as f,d as n,g as y}from"./chunk-ILKINAL7.js";import{a as P}from"./chunk-HVKMTRIC.js";import{c as j}from"./chunk-AZS4Q4RE.js";import"./chunk-QEBUS3TL.js";import"./chunk-IB2IUO7T.js";import"./chunk-MS3KE2OO.js";import"./chunk-NHSDW26F.js";import"./chunk-NMAGYK3Q.js";import"./chunk-GWBRHLNH.js";import"./chunk-XPRVY6JT.js";import"./chunk-7N3ZKWML.js";import"./chunk-E62WHYYG.js";import"./chunk-QDTU3MWT.js";import"./chunk-BCREO4Q5.js";import"./chunk-3SDSCSDJ.js";import"./chunk-I4M2OT5W.js";import{k as I}from"./chunk-NTVLK3P2.js";import{a as A}from"./chunk-WMQNRNIU.js";import"./chunk-HD52PWPC.js";import"./chunk-EIPVFA6F.js";import"./chunk-VOFKUGRY.js";import{p as T}from"./chunk-IG66NQHW.js";import"./chunk-ARRCN5K3.js";import"./chunk-ZTJLFKGG.js";import{d as w}from"./chunk-LB5YQINJ.js";import"./chunk-EKMHQEJY.js";import"./chunk-VACZNAP3.js";import"./chunk-JKNCWG7E.js";import"./chunk-SLAWDKDA.js";import"./chunk-KTE5HCNJ.js";import"./chunk-F7VRLFCB.js";import"./chunk-7R33MKVL.js";import"./chunk-ISSJ3A6Y.js";import"./chunk-VDKRSX77.js";import"./chunk-WUA6PW3I.js";import{B as O}from"./chunk-E57FTRWF.js";import{h as W,o as S}from"./chunk-U4J5SECU.js";import"./chunk-7EG726PT.js";import"./chunk-C7INQGWT.js";import"./chunk-WMHJC7XF.js";import"./chunk-NJEWDTYF.js";import"./chunk-N3SDOFND.js";import"./chunk-OVHPPCBL.js";import"./chunk-FNXQZPHT.js";import"./chunk-3TQOUBNU.js";import"./chunk-D2LVMNOU.js";import"./chunk-SNFOAZZQ.js";import"./chunk-QGVBCWUY.js";import{t as d}from"./chunk-HHDFN2GK.js";import"./chunk-47GHT6OF.js";import{f as s}from"./chunk-VTHXE323.js";var ie=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map(a=>a.toLowerCase());function Xe(a,e,o){return s(this,null,function*(){o??={},ne(a,e),yield w(()=>!e.updatingFromView),yield e.load(),yield z(e),yield _(e),yield q(a,e);let t=e.portalItem,{json:r,jsonContext:i}=yield J(e,t,a.origin);return b(i,{errorName:`${a.name}:save`},o),yield Q(e,t),yield Ie(a,e,t,r,i),yield Promise.all([e.updateItemThumbnail(),v(e.resourceReferences,i)]),t})}function J(a,e,o){return s(this,null,function*(){let t=D(e,o,!0),r=a.write({},t);return yield Promise.all(t.resources.pendingOperations),{json:r,jsonContext:t}})}function Ye(a,e,o,t){return s(this,null,function*(){t??={};let r=se(a,o);yield w(()=>!e.updatingFromView),yield e.load(),yield z(e),yield _(e),yield q(a,e);let{json:i,jsonContext:l}=yield J(e,r,a.origin);b(l,{errorName:`${a.name}:save`},t),yield ue(e,r);let c=e.getThumbnailState();return(yield Pe(a,e,r,i,l,t))&&(e.resourceReferences.portalItem=r),e.restoreThumbnailFromState(c),yield Promise.all([e.updateItemThumbnail(),v(e.resourceReferences,l)]),r})}function ne(a,e){if(!e.portalItem)throw new d(`${a.name}:portal-item-not-set`,"Portal item to save to has not been set on the WebMap");H(a,e.portalItem)}function H(a,e){if(e.type!==a.itemType)throw new d(`${a.name}:portal-item-wrong-type`,`Portal item needs to have type "${a.itemType}"`)}function q(a,e){return s(this,null,function*(){if(a.name==="linkchart")return;if(!e.basemap?.baseLayers.length)throw new d(`${a.name}:save`,"Map does not have a valid basemap with a base layer.");let o=null;if(yield w(()=>{let t=V(e.initialViewProperties,e.basemap);return o=t.spatialReference,!t.updating}),!T(o,e.initialViewProperties.spatialReference))throw new d(`${a.name}:save`,"The spatial reference of the basemap is not compatible with the one from the map.",{expected:e.initialViewProperties.spatialReference,actual:o})})}function se(a,e){let o=P.from(e);return o.id&&(o=o.clone(),o.id=null),o.type||(o.type=a.itemType),o.portal||(o.portal=j.getDefault()),H(a,o),o}function z(a){let e=[];return a.basemap&&e.push(a.basemap.load()),a.ground&&e.push(a.ground.load()),Promise.allSettled(e).then(()=>{})}function Q(a,e){return s(this,null,function*(){e.extent=yield ve(a.portalItem,a.initialViewProperties.viewpoint.targetGeometry),yield me(a,e)})}var le=y.JSAPI,X="CollectorDisabled",B="Collector",x="Data Editing",Y="OfflineDisabled",K="Offline",Z="Workforce Project",ee="Workforce Worker",ae="Workforce Dispatcher",pe="Offline Map Areas",ce="FieldMapsDisabled",$=y.DEVELOPER_BASEMAP,F="UtilityNetwork",U="IPS";function ue(a,e){return s(this,null,function*(){n(e,X),n(e,ce),n(e,y.METADATA),n(e,Y),n(e,pe),n(e,ae),n(e,Z),n(e,ee),yield Q(a,e)})}function me(a,e){return s(this,null,function*(){p(e,le),yield de(a),we(a,e),ye(a,e),he(a,e),ge(a,e),_e(a,e),be(a,e),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((o,t,r)=>r.indexOf(o)===t))})}function de(a){let e=R(a).map(o=>o.load()).toArray();return Promise.allSettled(e).then(()=>{})}function R(a){return a.allLayers.concat(a.allTables)}function oe(a){return R(a).some(e=>e.loaded&&g(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&(e.type!=="subtype-group"||e.sublayers.some(o=>o.editingEnabled)))}function fe(a){return R(a).filter(e=>e.type!=="group").every(e=>e.loaded&&Se(a,e))}function we(a,e){f(e,X)||f(e,Z)||f(e,ee)||f(e,ae)||!oe(a)?n(e,B):p(e,B)}function ye(a,e){oe(a)?p(e,x):n(e,x)}function he(a,e){!f(e,Y)&&fe(a)?p(e,K):n(e,K)}function ge(a,e){E(a.basemap)?p(e,$):n(e,$)}function _e(a,e){a.utilityNetworks?.length?p(e,F):n(e,F)}function be(a,e){a.ipsInfo?p(e,U):n(e,U)}function ve(a,e){return s(this,null,function*(){let o=e.clone().normalize(),t;if(o.length>1)for(let r of o)t?r.width>t.width&&(t=r):t=r;else t=o[0];return Re(a,t)})}function Re(a,e){return s(this,null,function*(){let o=e.spatialReference;if(o.isWGS84)return e.clone();if(o.isWebMercator)return I(e);let{getGeometryServiceURL:t}=yield import("./chunk-KCQRGOVV.js"),r=yield t(a),i=new k({geometries:[e],outSpatialReference:A.WGS84});return(yield N(r,i))[0]})}function We(a){return C(a)||a.type==="map-notes"||a.type==="route"}function Se(a,e){return g(e)&&e.capabilities.operations.supportsSync||We(e)&&!e.portalItem||Oe(e)&&!Te(e)&&e.spatialReference.equals(a.initialViewProperties.spatialReference)}function Oe(a){return(a.type==="tile"||a.type==="vector-tile")&&(a.capabilities.operations.supportsExportTiles||Ae(a)||G(a))}function Te(a){return a.type==="vector-tile"&&Object.keys(a.sourceNameToSource).length>1}function Ae(a){return a.type==="tile"&&O(a.url)&&ie.some(e=>a.url?.toLowerCase().includes("/"+e+"/"))}function Ie(a,e,o,t,r){return s(this,null,function*(){yield o.update({data:t}),te(a,e,o,t,r)})}function Pe(a,e,o,t,r,i){return s(this,null,function*(){let l=e.portalItem,c={item:l,authenticated:!(!l?.id||!l.portal.user)},u=o.portal;yield u.signIn();let{copyAllowed:m,itemReloaded:h}=yield Ce(c,u);if(c.authenticated||=h,!m)throw new d(`${a.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");let re=yield Le(o,c,t,i);return e.portalItem=o,te(a,e,o,t,r),re})}function Ce(a,e){return s(this,null,function*(){let{item:o,authenticated:t}=a;return o?.id&&o.typeKeywords?.includes("useOnly")?o.portal.portalHostname!==e.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(t||(yield o.reload()),{copyAllowed:o.itemControl==="admin"||o.itemControl==="update",itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}})}function Le(a,e,o,t){return s(this,null,function*(){let r=a.portal,{item:i}=e,{folder:l,copyAllResources:c}=t,u=!1;if(c&&i?.id&&S(i.portal.url,r.url)&&parseInt(i.portal.currentVersion,10)>=2023){let{total:m}=yield i.fetchResources();u=!!m}if(u){let m=yield i.copy({copyResources:"all",folder:l});a.id=m.id,a.portal=m.portal;let h=a.toJSON();yield a.load(),a.read(h),yield a.update({data:o})}else yield r.user.addItem({item:a,folder:l,data:o});return u})}function te(a,e,o,t,r){L.prototype.read.call(e,{version:t.version,authoringApp:t.authoringApp,authoringAppVersion:t.authoringAppVersion},{origin:a.origin,ignoreDefaults:!0,url:o.itemUrl?W(o.itemUrl):void 0}),M(r),e.resourceInfo=t}export{J as createJSON,Le as initializeNewItem,Ce as isCopyAllowed,Xe as save,Ye as saveAs};
