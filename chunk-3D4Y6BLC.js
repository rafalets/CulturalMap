import{a as C}from"./chunk-L7NOU4T2.js";import{a as D}from"./chunk-44A27HB7.js";import{a as A}from"./chunk-QXNVQZT7.js";import{a as c}from"./chunk-RWCIDBNQ.js";import{g as nt}from"./chunk-3BZAI7HK.js";import{a as ot}from"./chunk-DJW5LMRG.js";import{a as z}from"./chunk-ALWV3RJ2.js";import{a as at}from"./chunk-7C6Z24SS.js";import{c as st}from"./chunk-5WKDXHVH.js";import{a as x}from"./chunk-6JJCXUHW.js";import{a as k,b as J,c as K,g as Q,h as $,i as tt,k as et,l as rt,m as it}from"./chunk-7B2UKJ5N.js";import{a as j,c as N}from"./chunk-NHSDW26F.js";import{a as S,d as I,e as Z}from"./chunk-J372WZPB.js";import{b as E,d as X,f as h}from"./chunk-VOFKUGRY.js";import{F as G,L as q,d as l}from"./chunk-C7INQGWT.js";import{H as Y}from"./chunk-WMHJC7XF.js";import{a as n}from"./chunk-QGVBCWUY.js";import{i as w}from"./chunk-47GHT6OF.js";var g=class{constructor(){this.id=G()}};var F;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(F||(F={}));function zt(t){return Math.abs(t*t*t)}function lt(t,e,r){let s=r.parameters;return M.scale=Math.min(s.divisor/(e-s.offset),1),M.factor=zt(t),M}function ct(t,e){return X(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function At(t,e,r){let s=lt(t,e,r);return s.minScaleFactor=0,ct(1,s)}function Gt(t,e,r,s){s.scale=At(t,e,r),s.factor=0,s.minScaleFactor=r.minScaleFactor}function qt(t,e,r=[0,0]){let s=Math.min(Math.max(e.scale,e.minScaleFactor),1);return r[0]=t[0]*s,r[1]=t[1]*s,r}function ut(t,e,r,s){return ct(t,lt(e,r,s))}var Xt={curvatureDependent:{min:{curvature:h(10),tiltAngle:h(12),scaleFallOffFactor:.5},max:{curvature:h(70),tiltAngle:h(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var M={scale:0,factor:0,minScaleFactor:0};var Zt=nt();function Qt(t,e,r,s,i){let a=(r.screenLength||0)*t.pixelRatio;i!=null&&(a=ut(a,s,e,i));let p=a*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return E(p*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function P(t,e){let r=!1;for(let s in e){let i=e[s];i!==void 0&&(Array.isArray(i)?Array.isArray(t[s])&&w(i,t[s])||(t[s]=i.slice(),r=!0):t[s]!==i&&(r=!0,t[s]=i))}return r}var $t={multiply:1,ignore:2,replace:3,tint:4};var pt=new Map([[c.POSITION,0],[c.NORMAL,1],[c.NORMALCOMPRESSED,1],[c.UV0,2],[c.COLOR,3],[c.COLORFEATUREATTRIBUTE,3],[c.SIZE,4],[c.TANGENT,4],[c.CENTEROFFSETANDDISTANCE,5],[c.SYMBOLCOLOR,5],[c.FEATUREATTRIBUTE,6],[c.INSTANCEFEATUREATTRIBUTE,6],[c.INSTANCECOLOR,7],[c.OBJECTANDLAYERIDCOLOR,7],[c.INSTANCEOBJECTANDLAYERIDCOLOR,7],[c.ROTATION,8],[c.INSTANCEMODEL,8],[c.INSTANCEMODELNORMAL,12],[c.INSTANCEMODELORIGINHI,11],[c.INSTANCEMODELORIGINLO,15]]);var ft=class extends g{constructor(e,r){super(),this.type=F.Material,this.supportsEdges=!1,this._renderPriority=0,this.vertexAttributeLocations=pt,this._pp0=N(0,0,1),this._pp1=N(0,0,0),this._parameters=new r,P(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){P(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(e){return this.visible&&this.parameters.renderOccluded===e}get hasEmissions(){return!1}intersectDraped(e,r,s,i,a,p){return this._pp0[0]=this._pp1[0]=i[0],this._pp0[1]=this._pp1[1]=i[1],this.intersect(e,r,s,this._pp0,this._pp1,a)}},v;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(v||(v={}));var dt=class extends C{constructor(){super(...arguments),this.renderOccluded=v.Occlude,this.isDecoration=!1}};var mt=class extends D{constructor(e,r,s){super(e,"vec4",A.Pass,(i,a,p)=>i.setUniform4fv(e,r(a,p)),s)}};var St=class extends D{constructor(e,r,s){super(e,"float",A.Pass,(i,a,p)=>i.setUniform1fv(e,r(a,p)),s)}};var o=class extends q{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};n([l()],o.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),n([l()],o.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),n([l()],o.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),n([l()],o.prototype,"DECONFLICTOR_SHOW_GRID",void 0),n([l()],o.prototype,"LABELS_SHOW_BORDER",void 0),n([l()],o.prototype,"TEXT_SHOW_BASELINE",void 0),n([l()],o.prototype,"TEXT_SHOW_BORDER",void 0),n([l()],o.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),n([l()],o.prototype,"OVERLAY_SHOW_CENTER",void 0),n([l()],o.prototype,"SHOW_POI",void 0),n([l()],o.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),n([l()],o.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),n([l()],o.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),n([l()],o.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),n([l()],o.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),n([l()],o.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),n([l()],o.prototype,"I3S_TREE_SHOW_TILES",void 0),n([l()],o.prototype,"I3S_SHOW_MODIFICATIONS",void 0),n([l()],o.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),n([l()],o.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),n([l()],o.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),n([l()],o.prototype,"LINE_WIREFRAMES",void 0),o=n([Y("esri.views.3d.support.debugFlags")],o);var Et=new o;var f,ht;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(f||(f={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(ht||(ht={}));var T=class{constructor(e){this.field=e}},U=class extends T{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[f.Undefined,f.Undefined,f.Undefined]}},H=class extends T{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},V=class extends T{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}};var W=class{};function _(t){return t!=null}function u(t,e){t&&t.push(e)}function Dt(t,e,r,s=z()){let i=t||0,a=e||0,p=r||0;return i!==0&&it(s,s,-i/180*Math.PI),a!==0&&et(s,s,a/180*Math.PI),p!==0&&rt(s,s,p/180*Math.PI),s}function d(t,e,r,s,i){let a=t.minSize,p=t.maxSize;if(t.useSymbolValue){let R=s.symbolSize[r];return e.minSize[r]=R,e.maxSize[r]=R,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=f.DefinedSize,!0}if(_(t.field))return _(t.stops)?t.stops.length===2&&S(t.stops[0].size)&&S(t.stops[1].size)?(vt(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=f.DefinedSize,!0):(u(i,"Could not convert size info: stops only supported with 2 elements"),!1):S(a)&&S(p)&&_(t.minDataValue)&&_(t.maxDataValue)?(vt(a,p,t.minDataValue,t.maxDataValue,e,r),e.type[r]=f.DefinedSize,!0):t.valueUnit==="unknown"?(u(i,"Could not convert size info: proportional size not supported"),!1):x[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/x[t.valueUnit],e.type[r]=f.DefinedSize,!0):(u(i,"Could not convert size info: scale-dependent size not supported"),!1);if(!_(t.field)){if(t.stops?.[0]&&S(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=f.DefinedSize,!0;if(S(a))return e.minSize[r]=a,e.maxSize[r]=a,e.offset[r]=a,e.factor[r]=0,e.type[r]=f.DefinedSize,!0}return u(i,"Could not convert size info: unsupported variant of sizeInfo"),!1}function vt(t,e,r,s,i,a){let p=Math.abs(s-r)>0?(e-t)/(s-r):0;i.minSize[a]=p>0?t:e,i.maxSize[a]=p>0?e:t,i.offset[a]=t-r*p,i.factor[a]=p}function Ct(t,e,r,s){if(t.normalizationField||t.valueRepresentation)return u(s,"Could not convert size info: unsupported property"),null;if(!Z(t.field))return u(s,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return u(s,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new U(t.field);let i;switch(t.axis){case"width":return i=d(t,e.size,0,r,s),i?e:null;case"height":return i=d(t,e.size,2,r,s),i?e:null;case"depth":return i=d(t,e.size,1,r,s),i?e:null;case"width-and-depth":return i=d(t,e.size,0,r,s),i&&d(t,e.size,1,r,s),i?e:null;case null:case void 0:case"all":return i=d(t,e.size,0,r,s),i=i&&d(t,e.size,1,r,s),i=i&&d(t,e.size,2,r,s),i?e:null;default:return u(s,`Could not convert size info: unknown axis "${t.axis}""`),null}}function gt(t,e,r){for(let i=0;i<3;++i){let a=e.unitInMeters;t.type[i]===f.DefinedSize&&(a*=e.modelSize[i],t.type[i]=f.DefinedScale),t.minSize[i]=t.minSize[i]/a,t.maxSize[i]=t.maxSize[i]/a,t.offset[i]=t.offset[i]/a,t.factor[i]=t.factor[i]/a}let s;if(t.type[0]!==f.Undefined)s=0;else if(t.type[1]!==f.Undefined)s=1;else{if(t.type[2]===f.Undefined)return u(r,"No size axis contains a valid size or scale"),!1;s=2}for(let i=0;i<3;++i)t.type[i]===f.Undefined&&(t.minSize[i]=t.minSize[s],t.maxSize[i]=t.maxSize[s],t.offset[i]=t.offset[s],t.factor[i]=t.factor[s],t.type[i]=t.type[s]);return!0}function _t(t,e,r){t[4*e]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function Ft(t,e,r){if(t.normalizationField)return u(r,"Could not convert color info: unsupported property"),null;if(I(t.field)){if(!t.stops)return u(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return u(r,"Could not convert color info: too many color stops"),null;e.color=new H(t.field);let s=t.stops;for(let i=0;i<8;++i){let a=s[Math.min(i,s.length-1)];e.color.values[i]=a.value,_t(e.color.colors,i,a.color)}}}else{if(!(t.stops&&t.stops.length>=0))return u(r,"Could not convert color info: no field and no colors/stops"),null;{let s=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let i=0;i<8;i++)e.color.values[i]=1/0,_t(e.color.colors,i,s)}}return e}function Lt(t,e,r){if(t.normalizationField)return u(r,"Could not convert opacity info: unsupported property"),null;if(I(t.field)){if(!t.stops)return u(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return u(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new V(t.field);let s=t.stops;for(let i=0;i<8;++i){let a=s[Math.min(i,s.length-1)];e.opacity.values[i]=a.value,e.opacity.opacityValues[i]=a.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return u(r,"Could not convert opacity info: no field and no opacities/stops"),null;{let s=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let i=0;i<8;i++)e.opacity.values[i]=1/0,e.opacity.opacityValues[i]=s}}return e}function b(t,e,r){let s=r===2&&t.rotationType==="arithmetic";e.offset[r]=s?90:0,e.factor[r]=s?-1:1,e.type[r]=1}function Nt(t,e,r){if(!I(t.field))return u(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return u(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return b(t,e.rotation,0),e;case"roll":return b(t,e.rotation,1),e;case null:case void 0:case"heading":return b(t,e.rotation,2),e;default:return u(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}var Ot=class{constructor(e,r=[1,1,1],s=[1,1,1],i=1,a=[0,0,0],p=[1,1,1],R=[0,0,0]){this.supports=e,this.modelSize=r,this.symbolSize=s,this.unitInMeters=i,this.anchor=a,this.scale=p,this.rotation=R}};function yt(t,e,r){if(!t)return null;let s=t.reduce((i,a)=>{if(!i)return i;if(a.valueExpression)return u(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(a.type){case"size":return e.supports.size?Ct(a,i,e,r):i;case"color":return e.supports.color?Ft(a,i,r):i;case"opacity":return e.supports.opacity?Lt(a,i,r):null;case"rotation":return e.supports.rotation?Nt(a,i,r):i;default:return null}},new W);return!(t.length>0&&s)||s.size||s.color||s.opacity||s.rotation?s?.size&&!gt(s.size,e,r)?null:s:null}var B=class{constructor(e,r,s){this.visualVariables=e,this.materialParameters=r,this.requiresShaderTransformation=s}};function Ue(t,e){if(!t||Et.TESTS_DISABLE_FAST_UPDATES)return null;let r=yt(t.visualVariables,e);return r?new B(r,Rt(r,e),!!r.size):null}function He(t,e,r){if(!e||!t)return!1;let s=t.visualVariables,i=yt(e.visualVariables,r);return!!i&&!!(L(s.size,i.size,"size")&&L(s.color,i.color,"color")&&L(s.rotation,i.rotation,"rotation")&&L(s.opacity,i.opacity,"opacity"))&&(t.visualVariables=i,t.materialParameters=Rt(i,r),t.requiresShaderTransformation=!!i.size,!0)}function L(t,e,r){if(!!t!=!!e||t&&t.field!==e?.field)return!1;if(t&&r==="rotation"){let s=t,i=e;for(let a=0;a<3;a++)if(s.type[a]!==i.type[a]||s.offset[a]!==i.offset[a]||s.factor[a]!==i.factor[a])return!1}return!0}var y=class extends C{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}};function Rt(t,e){let r=new y(t);return r.vvSize&&(r.vvSymbolAnchor=e.anchor,K(O),Dt(e.rotation[2],e.rotation[0],e.rotation[1],O),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||at(),ot(r.vvSymbolRotationMatrix,O)),r}function Ve(t,e,r){if(!t.vvSize)return r;k(m,r);let s=t.vvSymbolRotationMatrix;J(O,s[0],s[1],s[2],0,s[3],s[4],s[5],0,s[6],s[7],s[8],0,0,0,0,1),Q(m,m,O);for(let i=0;i<3;++i){let a=t.vvSize.offset[i]+e[0]*t.vvSize.factor[i];Tt[i]=E(a,t.vvSize.minSize[i],t.vvSize.maxSize[i])}return tt(m,m,Tt),$(m,m,t.vvSymbolAnchor),m}function We(t,e,r){if(!e.vvSize)return st(t,1,1,1),t;for(let s=0;s<3;++s){let i=e.vvSize.offset[s]+r[0]*e.vvSize.factor[s];t[s]=E(i,e.vvSize.minSize[s],e.vvSize.maxSize[s])}return t}function Be(t,e){let r=t==null?0:e.attributes[t];return typeof r=="number"&&isFinite(r)?r:0}var m=z(),Tt=j(),O=z();var It=class extends y{constructor(){super(...arguments),this.renderOccluded=v.Occlude,this.isDecoration=!1}},qe=8;export{g as a,F as b,pt as c,ct as d,Gt as e,qt as f,Qt as g,P as h,$t as i,ft as j,v as k,dt as l,mt as m,St as n,Et as o,Ot as p,Ue as q,He as r,Ve as s,We as t,Be as u,It as v,qe as w};
