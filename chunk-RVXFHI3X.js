import{a as S}from"./chunk-GK3RYCKG.js";import{L as y}from"./chunk-X7BNFUFQ.js";import{b as M}from"./chunk-VOB6IBIW.js";import{c as N}from"./chunk-VOFKUGRY.js";import{r as b}from"./chunk-HHDFN2GK.js";var z=()=>b.getLogger("esri.symbols.cim.rasterizingUtils"),U=32,$=t=>t==="vertical"||t==="horizontal"||t==="cross"||t==="esriSFSCross"||t==="esriSFSVertical"||t==="esriSFSHorizontal";function K(t,i,n){let r=i.style,a=N(Math.ceil(n)),o=$(r)?8*a:16*a,e=2*a;t.width=o,t.height=o;let s=t.getContext("2d");s.strokeStyle="#ffffff",s.lineWidth=a,s.beginPath(),r!=="vertical"&&r!=="cross"&&r!=="esriSFSCross"&&r!=="esriSFSVertical"||(s.moveTo(o/2,-e),s.lineTo(o/2,o+e)),r!=="horizontal"&&r!=="cross"&&r!=="esriSFSCross"&&r!=="esriSFSHorizontal"||(s.moveTo(-e,o/2),s.lineTo(o+e,o/2)),r!=="backward-diagonal"&&r!=="diagonal-cross"&&r!=="esriSFSDiagonalCross"&&r!=="esriSFSBackwardDiagonal"||(s.moveTo(-e,-e),s.lineTo(o+e,o+e),s.moveTo(o-e,-e),s.lineTo(o+e,e),s.moveTo(-e,o-e),s.lineTo(e,o+e)),r!=="forward-diagonal"&&r!=="diagonal-cross"&&r!=="esriSFSForwardDiagonal"&&r!=="esriSFSDiagonalCross"||(s.moveTo(o+e,-e),s.lineTo(-e,o+e),s.moveTo(e,-e),s.lineTo(-e,e),s.moveTo(o+e,o-e),s.lineTo(o-e,o+e)),s.stroke();let h=s.getImageData(0,0,t.width,t.height),l=new Uint8Array(h.data),f;for(let c=0;c<l.length;c+=4)f=l[c+3]/255,l[c]=l[c]*f,l[c+1]=l[c+1]*f,l[c+2]=l[c+2]*f;return[l,t.width,t.height,a]}function Q(t){t.length%2==1&&(t=[...t,...t]);let i=t.reduce((c,u)=>c+u,0),n=Math.round(i*4),r=1,a=new Float32Array(n*r),o=0,e=0,s=.5,h=!0;for(let c of t){for(o=e,e+=c*4;s<=e;){let u=s-.5,m=Math.min(Math.abs(s-o),Math.abs(s-e));a[u]=h?-m:m,s++}h=!h}let l=a.length,f=new Uint8Array(4*l);for(let c=0;c<l;++c){let u=a[c]/4;S(u/64*.5+.5,f,4*c)}return[f,n,r]}function X(t,i){t==null&&(t=[]);let n=i==="Butt",r=i==="Square",a=!n&&!r;t.length%2==1&&(t=[...t,...t]);let o=15.5,e=2*o,s=0;for(let d of t)s+=d;let h=Math.round(s*o),l=new Float32Array(h*e),f=.5*o,c=0,u=0,m=.5,x=!0;for(let d of t){for(c=u,u+=d*o;m<=u;){let p=.5;for(;p<e;){let A=(p-.5)*h+m-.5,g=a?(p-o)*(p-o):Math.abs(p-o);l[A]=x?n?Math.max(Math.max(c+f-m,g),Math.max(m-u+f,g)):g:a?Math.min((m-c)*(m-c)+g,(m-u)*(m-u)+g):r?Math.min(Math.max(m-c,g),Math.max(u-m,g)):Math.min(Math.max(m-c+f,g),Math.max(u+f-m,g)),p++}m++}x=!x}let v=l.length,I=new Uint8Array(4*v);for(let d=0;d<v;++d){let p=(a?Math.sqrt(l[d]):l[d])/o;S(p,I,4*d)}return[I,h,e]}function Y(t,i){let{colorRamp:n,gradientType:r}=i,a=n.type==="CIMFixedColorRamp",o=i.interval||M.CIMGradientFill.interval,e=T(n);return a&&(e=D(e,o)),r==="Discrete"||a?L(t,e,o):E(t,e)}var F;function Z(t,i){let{colorRamp:n,gradientType:r}=i,a=T(n),o=n.type==="CIMFixedColorRamp";if(r==="Continuous"&&!o)return C(t,a);let e=i.interval??M.CIMGradientFill.interval;if(o)return C(t,D(a,e));let s=[];F??=document.createElement("canvas"),R(F,a,e,1,0);let h=F.getContext("2d").getImageData(0,0,e,1).data;for(let l=0,f=0;l<e;l++,f=4*l){let c=[h[f+0],h[f+1],h[f+2],h[f+3]];s.push({offset:l/e,color:c}),s.push({offset:(l+1)/e,color:c})}return C(t,s)}function T(t){let i=[];switch(t.type){case"CIMPolarContinuousColorRamp":case"CIMLinearContinuousColorRamp":{t.type==="CIMPolarContinuousColorRamp"&&z().warnOnce("CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.");let n=t;i.push({offset:0,color:[n.fromColor[0],n.fromColor[1],n.fromColor[2],n.fromColor[3]/255]}),i.push({offset:1,color:[n.toColor[0],n.toColor[1],n.toColor[2],n.toColor[3]/255]});break}case"CIMFixedColorRamp":{let n=t,r=1/(n.colors.length-1),a=0;for(let o of n.colors)i.push({offset:a,color:[o[0],o[1],o[2],o[3]/255]}),a+=r;break}case"CIMMultipartColorRamp":{let n=t,r=n.weights.reduce((o,e)=>o+e,0),a=0;for(let o=0;o<n.colorRamps.length;o++){let e=n.colorRamps[o],s=n.weights[o],h=T(e);for(let l of h)i.push({offset:(a+l.offset*s)/r,color:l.color});a+=s}break}default:z().error(`Color ramp "${t.type}" currently unsupported.`)}return i}function D(t,i){let n=[],r=(t.length-1)/(i-1);for(let a=0;a<i;a++){let o=t[Math.round(a*r)].color;n.push({offset:a/i,color:o}),n.push({offset:(a+1)/i,color:o})}return n}function E(t,i){return R(t,i,U,1,y),k(t)}function L(t,i,n){return R(t,i,n,1,y),k(t)}function C(t,i,n=0){for(let{offset:r,color:a}of i)t.addColorStop(Math.min(Math.max(r,n),1-n),`rgba(${a[0]}, ${a[1]}, ${a[2]}, ${a[3]})`)}function R(t,i,n,r,a){let o=n+2*a;t.width=o,t.height=r;let e=(a+1)/o,s=t.getContext("2d",{willReadFrequently:!0});if(i.length>0){let h=s.createLinearGradient(0,0,o,r);C(h,i,e),s.fillStyle=h}else s.fillStyle="rgba(128, 128, 128, 1)";s.fillRect(0,0,o,r)}function k(t){let{width:i,height:n}=t,r=t.getContext("2d").getImageData(0,0,i,n),a=new Uint8Array(r.data);for(let o=0;o<a.length;o+=4){let e=a[o+3]/255;a[o]*=e,a[o+1]*=e,a[o+2]*=e}return[a,i,n]}function V(t){let i=t[0]?.[0]?.[0]??0,n=t[0]?.[0]?.[1]??0,r={ymin:n,xmin:i,ymax:n,xmax:i,width:0,height:0};for(let a=0;a<t.length;a++){let o=t[a];for(let e=0;e<o.length;e++){let s=o[e][0],h=o[e][1];s<r.xmin&&(r.xmin=s),s>r.xmax&&(r.xmax=s),h<r.ymin&&(r.ymin=h),h>r.ymax&&(r.ymax=h)}}return r.width=Math.abs(r.xmax-r.xmin),r.height=Math.abs(r.ymax-r.ymin),r}function _(t,i){let n=V(t),r=n.width===0?1:n.width,a=n.height===0?1:n.height,o=[];for(let e=0;e<t.length;e++){let s=t[e],h=[];for(let l=0;l<s.length;l++){let f=Math.round(s[l][0]-n.xmin),c=Math.round(s[l][1]-n.ymin);if(f=i.xmin+f*i.width/r,c=i.ymin+c*i.height/a,isNaN(f)||isNaN(c))throw new Error("Scaled shape has NaN values");h.push([f,c])}o.push(h)}return o}function oo(t,i,n){let r=[];for(let a=0;a<t.length;a++){let o=t[a],e=[];for(let s=0;s<o.length;s++){let h=o[s][0]+i,l=o[s][1]+n;if(isNaN(h)||isNaN(l))throw new Error("Scaled shape has NaN values");e.push([h,l])}r.push(e)}return r}export{K as a,Q as b,X as c,Y as d,Z as e,_ as f,oo as g};
