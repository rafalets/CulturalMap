import{a as Ft}from"./chunk-PMOAKYXH.js";import{o as _t}from"./chunk-AA5W2OSC.js";import{a as Te,b as xe}from"./chunk-2ZKDDIFZ.js";import{a as y}from"./chunk-FHBFWDFD.js";import{a as ut,f as Ae}from"./chunk-CBJBOHLC.js";import{b as Ie}from"./chunk-VGCEVKYN.js";import{a as yt}from"./chunk-6N6OLOP3.js";import{a as Ce}from"./chunk-E4VXIIFB.js";import{a as se}from"./chunk-PWU2QHPV.js";import{a as dt}from"./chunk-WUJRCGDY.js";import{C as ft,a as mt,f as pt,m as ht}from"./chunk-HXMLP37S.js";import{b as ct}from"./chunk-NHQ2XIW3.js";import{a as lt}from"./chunk-CVRJ6GOM.js";import{a as Qe}from"./chunk-OGS2SUK5.js";import{O as gt,S as ne,T as bt,V as vt,a as st,b as G,c as nt,d as ie,e as K,f as ae,g as Fe,h as we}from"./chunk-HKHTIKVW.js";import{h as rt,v as ot}from"./chunk-MDL4XPLR.js";import{a as it,d as at}from"./chunk-J372WZPB.js";import{b as Ge}from"./chunk-VOFKUGRY.js";import{c as te,d as j,e as z}from"./chunk-7ZYPJJID.js";import{g as l}from"./chunk-UAKHZRKN.js";import{g as be,h as ve,i as _e}from"./chunk-HAHX77IL.js";import{a as ye}from"./chunk-IXCTZWTQ.js";import{b as Q,c as Ye,d as Je,e as Xe,f as et}from"./chunk-5TW726OD.js";import{c as fe}from"./chunk-VGD3XLDH.js";import{a as D,c as ge,h as N}from"./chunk-LB5YQINJ.js";import{b as P}from"./chunk-EKMHQEJY.js";import{c as We,d as $}from"./chunk-7IPIJKWU.js";import{a as Ke}from"./chunk-7R33MKVL.js";import{a as ee}from"./chunk-ISSJ3A6Y.js";import{a as tt}from"./chunk-VDKRSX77.js";import{L as X,d as o}from"./chunk-C7INQGWT.js";import{H as q}from"./chunk-WMHJC7XF.js";import{D as Y,M as J,i as Ze}from"./chunk-D2LVMNOU.js";import{a as n}from"./chunk-QGVBCWUY.js";import{f as Ue,l as pe,o as he,p as W,r as He,t as g}from"./chunk-HHDFN2GK.js";import{t as Z}from"./chunk-47GHT6OF.js";import{a as T,b as Be,f as A}from"./chunk-VTHXE323.js";var Me="esri-feature-element-info",Oe={base:Me,title:`${Me}__title`,description:`${Me}__description`},B=class extends j{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return l("div",{class:Oe.base},this._renderTitle(),this._renderDescription())}_renderTitle(){let{title:e}=this;return e?l(Ft,{class:Oe.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){let{description:e}=this;return e?l("div",{class:Oe.description,innerHTML:e,key:"description"}):null}};n([o()],B.prototype,"description",void 0),n([o()],B.prototype,"headingLevel",void 0),n([o()],B.prototype,"title",void 0),B=n([q("esri.widgets.Feature.support.FeatureElementInfo")],B);var wt=B;var Le="esri-feature-utility-network-associations",At=`${Le}__loading-container`,re={base:Le,listContainer:`${Le}__list`,loadingContainer:At,loadingContainerSticky:`${At}--sticky`},I=class extends j{constructor(e,t){super(e,t),this._featureElementInfo=null,this.onSelectAssociationType=()=>{},this.flowType="feature-utility-network-associations",this.flowItems=null,this.parentFeatureViewModel=null,this.headingLevel=5,this.viewModel=new xe,this.messages=null,this.messagesCommon=null,this.visibleElements=new Te}initialize(){this._featureElementInfo=new wt,this.addHandles([D(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),N)])}loadDependencies(){return te({icon:()=>import("./chunk-QXDSJABL.js"),list:()=>import("./chunk-QV3363IT.js"),"list-item":()=>import("./chunk-PXFXZ5UQ.js"),loader:()=>import("./chunk-JHM3YD5O.js"),notice:()=>import("./chunk-RIKTH4T2.js")})}destroy(){this._featureElementInfo=Ze(this._featureElementInfo)}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{state:e}=this.viewModel;return l("div",{class:this.classes(re.base,y.widget)},this._featureElementInfo?.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderAssociationNotFound():this._renderContent())}_renderStickyLoading(){return this.viewModel.state==="querying"?l("div",{class:re.loadingContainerSticky,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return l("calcite-loader",{inline:!0,label:this.messagesCommon.loading})}_renderLoading(){return l("div",{class:re.loadingContainer,key:"loading-container"},this._renderLoadingIcon())}_renderAssociationNotFound(){return l("calcite-notice",{icon:"exclamation-mark-triangle",key:"association-not-found",kind:"danger",open:!0,scale:"s",width:"full"},l("div",{slot:"message"},this.messages?.noAssociations))}_renderAssociationType(e){let{viewModel:t}=this,i=this._getAssociationTypeTitle(e);return l("calcite-list-item",{description:he(e.description),key:`association-type-${e.type}`,label:he(i),value:e.type,onCalciteListItemSelect:()=>this.onSelectAssociationType({viewModel:t,listType:e,title:i})},l("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderAssociations(e){let{viewModel:t}=this;return t.source==="featureForm"||t.getFeatureCountForAssociationType(e.type)>0?this._renderAssociationType(e):void 0}_renderContent(){let{messages:e,viewModel:t}=this,{state:i,associationTypes:a}=t;return l("div",{class:re.listContainer,key:"list-container"},i==="ready"?l("div",null,l("calcite-list",{displayMode:"flat",label:e?.associationsList},a.map(s=>this._renderAssociations(s)))):null,this._renderStickyLoading())}_getAssociationTypeTitle(e){let{messages:t}=this;if(e.title)return e.title;switch(e.type){case"attachment":return t.associationsAttachments;case"connectivity":return t.associationsConnectivity;case"structure":return t.associationsStructure;case"content":return t.associationsContents;case"container":return t.associationsContainer}}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,a=t.title&&this.title;this._featureElementInfo?.set({description:i,title:a,headingLevel:e})}};n([o({constructOnly:!0})],I.prototype,"onSelectAssociationType",void 0),n([o()],I.prototype,"flowType",void 0),n([o()],I.prototype,"flowItems",void 0),n([o()],I.prototype,"parentFeatureViewModel",void 0),n([o()],I.prototype,"featureVisibleElements",void 0),n([o()],I.prototype,"description",null),n([o()],I.prototype,"headingLevel",void 0),n([o()],I.prototype,"title",null),n([o({type:xe})],I.prototype,"viewModel",void 0),n([o(),z("esri/widgets/Feature/t9n/Feature")],I.prototype,"messages",void 0),n([o(),z("esri/t9n/common")],I.prototype,"messagesCommon",void 0),n([o({type:Te,nonNullable:!0})],I.prototype,"visibleElements",void 0),I=n([q("esri.widgets.Feature.FeatureUtilityNetworkAssociations")],I);var Li=I;var It={editing:!1,operations:{add:!0,update:!0,delete:!0}},Ct=P.ofType(yt),C=class extends X{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities=T({},It),this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new Ct,this.fileInfos=new P,this.graphic=null,this.mode="view",this.orderByFields=null,this.filesEnabled=!1,this.addHandles(D(()=>this.graphic,()=>this._graphicChanged(),N))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return T(T({},It),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){let{graphic:e}=this;if(!e)return!1;let t=e.layer||e.sourceLayer;return t?.loaded&&"capabilities"in t&&t.capabilities&&"attachment"in t.capabilities&&t.capabilities.attachment&&"supportsResize"in t.capabilities.attachment&&t.capabilities.attachment.supportsResize||!1}getAttachments(){return A(this,null,function*(){let{_attachmentLayer:e,attachmentInfos:t,orderByFields:i}=this;if(!e||typeof e.queryAttachments!="function")throw new g("invalid-layer","getAttachments(): A valid layer is required.");let a=this._getObjectId();if(typeof a!="number")throw new g("invalid-object-id","getAttachments(): Numeric object id is required");let s=i?.map(f=>`${f.field} ${f.order==="descending"?"DESC":"ASC"}`),r=new Ie({objectIds:[a],returnMetadata:!0,orderByFields:s}),d=[],u=e.queryAttachments(r).then(f=>f[a]||d).catch(()=>d);this._getAttachmentsPromise=u,this.notifyChange("state");let c=yield u;return t.destroyAll(),c.length&&t.addMany(c),this._getAttachmentsPromise=null,this.notifyChange("state"),c})}addAttachment(i){return A(this,arguments,function*(e,t=this.graphic){let{_attachmentLayer:a,attachmentInfos:s,capabilities:r}=this;if(!t)throw new g("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new g("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!r.operations?.add)throw new g("invalid-capabilities","addAttachment(): add capabilities are required.");if(!a||typeof a.addAttachment!="function")throw new g("invalid-layer","addAttachment(): A valid layer is required.");let d=a.addAttachment(t,e).then(c=>this._queryAttachment(c.objectId,t)),u=yield d;return s.add(u),u})}deleteAttachment(e){return A(this,null,function*(){let{_attachmentLayer:t,attachmentInfos:i,graphic:a,capabilities:s}=this;if(!e)throw new g("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations?.delete)throw new g("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new g("invalid-layer","deleteAttachment(): A valid layer is required.");if(!a)throw new g("invalid-graphic","deleteAttachment(): A graphic is required.");let r=t.deleteAttachments(a,[e.id]).then(()=>e),d=yield r;return i.remove(d),d.destroy(),d})}updateAttachment(i){return A(this,arguments,function*(e,t=this.activeAttachmentInfo){let{_attachmentLayer:a,attachmentInfos:s,graphic:r,capabilities:d}=this;if(!e)throw new g("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new g("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!d.operations?.update)throw new g("invalid-capabilities","updateAttachment(): Update capabilities are required.");let u=s.indexOf(t);if(!a||typeof a.updateAttachment!="function")throw new g("invalid-layer","updateAttachment(): A valid layer is required.");if(!r)throw new g("invalid-graphic","updateAttachment(): A graphic is required.");let c=a.updateAttachment(r,t.id,e).then(b=>this._queryAttachment(b.objectId)),f=yield c;return s.splice(u,1,f),f})}commitFiles(){return A(this,null,function*(){return yield Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()})}addFile(e,t){if(!e||!t)return null;let i={file:e,form:t};return this.fileInfos.add(i),i}updateFile(e,t,i=this.activeFileInfo){if(!e||!t||!i)return null;let a=this.fileInfos.indexOf(i);return a>-1&&this.fileInfos.splice(a,1,{file:e,form:t}),this.fileInfos.items[a]}deleteFile(e){let t=this.fileInfos.find(i=>i.file===e);return t?(this.fileInfos.remove(t),t):null}_queryAttachment(e,t){return A(this,null,function*(){let{_attachmentLayer:i}=this;if(!e||!i?.queryAttachments)throw new g("invalid-attachment-id","Could not query attachment.");let a=this._getObjectId(t);if(typeof a!="number")throw new g("invalid-object-id","getAttachments(): Numeric object id is required");let s=new Ie({objectIds:[a],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return i.queryAttachments(s).then(r=>r[a][0])})}_getObjectId(e=this.graphic){return e?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>this.attachmentInfos.destroyAll()))}_setAttachmentLayer(){let{graphic:e}=this,t=mt(e);this._attachmentLayer=t?t.type==="scene"&&t.associatedLayer!=null?t.associatedLayer:t:null}};n([o()],C.prototype,"capabilities",void 0),n([ee("capabilities")],C.prototype,"castCapabilities",null),n([o()],C.prototype,"activeAttachmentInfo",void 0),n([o()],C.prototype,"activeFileInfo",void 0),n([o({readOnly:!0,type:Ct})],C.prototype,"attachmentInfos",void 0),n([o()],C.prototype,"fileInfos",void 0),n([o({type:se})],C.prototype,"graphic",void 0),n([o()],C.prototype,"mode",void 0),n([o({type:[dt]})],C.prototype,"orderByFields",void 0),n([o({readOnly:!0})],C.prototype,"state",null),n([o()],C.prototype,"filesEnabled",void 0),n([o({readOnly:!0})],C.prototype,"supportsResizeAttachments",null),C=n([q("esri.widgets.Attachments.AttachmentsViewModel")],C);var ke=C;function Ee(e){let t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function Tt(e){let t=tt("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}var U={close:"esri-icon-close",collapse:"esri-icon-collapse",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",handleVertical:"esri-icon-handle-vertical",icon:"esri-icon",left:"esri-icon-left",locateCircled:"esri-icon-locate-circled",noticeTriangle:"esri-icon-notice-triangle",pause:"esri-icon-pause",play:"esri-icon-play",plus:"esri-icon-plus",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",search:"esri-icon-search",swap:"esri-icon-swap",table:"esri-icon-table",trash:"esri-icon-trash",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomToObject:"esri-icon-zoom-to-object"};var xt={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},h="esri-attachments",m={base:h,loaderContainer:`${h}__loader-container`,loader:`${h}__loader`,fadeIn:`${h}--fade-in`,container:`${h}__container`,containerList:`${h}__container--list`,containerPreview:`${h}__container--preview`,actions:`${h}__actions`,deleteButton:`${h}__delete-button`,addAttachmentButton:`${h}__add-attachment-button`,errorMessage:`${h}__error-message`,items:`${h}__items`,item:`${h}__item`,itemButton:`${h}__item-button`,itemMask:`${h}__item-mask`,itemMaskIcon:`${h}__item-mask--icon`,itemImage:`${h}__image`,itemImageResizable:`${h}__image--resizable`,itemLabel:`${h}__label`,itemFilename:`${h}__filename`,itemChevronIcon:`${h}__item-chevron-icon`,itemLink:`${h}__item-link`,itemLinkOverlay:`${h}__item-link-overlay`,itemLinkOverlayIcon:`${h}__item-link-overlay-icon`,itemEditIcon:`${h}__item-edit-icon`,itemAddIcon:`${h}__item-add-icon`,itemAddButton:`${h}__item-add-button`,formNode:`${h}__form-node`,fileFieldset:`${h}__file-fieldset`,fileLabel:`${h}__file-label`,fileName:`${h}__file-name`,fileInput:`${h}__file-input`,metadata:`${h}__metadata`,metadataFieldset:`${h}__metadata-fieldset`,progressBar:`${h}__progress-bar`},Se=window.CSS,_=class extends j{constructor(e,t){super(e,t),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements=T({},xt),this._supportsImageOrientation=Se&&Se.supports&&Se.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(e){return e?.viewModel||(e=T({viewModel:new ke},e)),e}initialize(){this.addHandles([ge(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),ge(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),D(()=>this.viewModel?.mode,()=>this._modeChanged(),N)])}loadDependencies(){return te({icon:()=>import("./chunk-QXDSJABL.js")})}get capabilities(){return this.viewModel.capabilities}set capabilities(e){this.viewModel.capabilities=e}get effectiveDisplayType(){let{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return"attachment"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return T(T({},xt),e)}addAttachment(){let{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new g("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){let{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new g("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){let{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new g("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}addFile(){let e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){let{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}deleteFile(e){let t=this.viewModel.deleteFile(e||this.viewModel.activeFileInfo?.file);return this.viewModel.mode="view",t}render(){let{submitting:e,viewModel:t}=this,{state:i}=t;return l("div",{class:this.classes(m.base,y.widget)},e?this._renderProgressBar():null,i==="loading"?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){let{error:e,visibleElements:t}=this;return e&&t.errorMessage?l("div",{class:m.errorMessage,key:"error-message"},e.message):null}_renderAttachments(){let{activeFileInfo:e,mode:t,activeAttachmentInfo:i}=this.viewModel;return t==="add"?this._renderAddForm():t==="edit"?this._renderDetailsForm(i||e):this._renderAttachmentContainer()}_renderLoading(){return l("div",{class:m.loaderContainer,key:"loader"},l("div",{class:m.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?l("div",{class:m.progressBar,key:"progress-bar"}):null}_renderAddForm(){let{submitting:e,selectedFile:t}=this,i=e||!t,a=this.visibleElements.cancelAddButton?l("button",{bind:this,class:this.classes(y.button,y.buttonTertiary,y.buttonSmall,y.buttonHalf,e&&y.buttonDisabled),disabled:e,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?l("button",{class:this.classes(y.button,y.buttonSecondary,y.buttonSmall,y.buttonHalf,{[y.buttonDisabled]:i}),disabled:i,type:"submit"},this.messages.add):null,r=t?l("span",{class:m.fileName,key:"file-name"},t.name):null,d=l("form",{afterCreate:_e,afterRemoved:ve,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},l("fieldset",{class:m.fileFieldset},r,l("label",{class:this.classes(m.fileLabel,y.button,y.buttonSecondary)},t?this.messages.changeFile:this.messages.selectFile,l("input",{bind:this,class:m.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),s,a);return l("div",{class:m.formNode,key:"add-form-container"},d)}_renderDetailsForm(e){let{visibleElements:t,viewModel:i,selectedFile:a,submitting:s}=this,{capabilities:r}=i,d=s||!a,u,c,f,b;a?(u=a.type,c=a.name,f=a.size):e&&"file"in e?(u=e.file.type,c=e.file.name,f=e.file.size):e&&"contentType"in e&&(u=e.contentType,c=e.name,f=e.size,b=e.url);let F=r.editing&&r.operations?.delete&&t.deleteButton?l("button",{bind:this,class:this.classes(y.button,y.buttonSmall,y.buttonTertiary,m.deleteButton,{[y.buttonDisabled]:s}),disabled:s,key:"delete-button",onclick:S=>this._submitDeleteAttachment(S,e),type:"button"},this.messages.delete):void 0,w=r.editing&&r.operations?.update&&t.updateButton?l("button",{class:this.classes(y.button,y.buttonSmall,y.buttonThird,{[y.buttonDisabled]:d}),disabled:d,key:"update-button",type:"submit"},this.messages.update):void 0,v=this.visibleElements.cancelUpdateButton?l("button",{bind:this,class:this.classes(y.button,y.buttonSmall,y.buttonTertiary,y.buttonThird,{[y.buttonDisabled]:s}),disabled:s,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,x=r.editing&&r.operations?.update?l("fieldset",{class:m.fileFieldset,key:"file"},l("span",{class:m.fileName,key:"file-name"},c),l("label",{class:this.classes(m.fileLabel,y.button,y.buttonSecondary)},this.messages.changeFile,l("input",{bind:this,class:m.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,M=l("fieldset",{class:m.metadataFieldset,key:"size"},l("label",null,_t(this.messagesUnits,f??0))),O=l("fieldset",{class:m.metadataFieldset,key:"content-type"},l("label",null,u)),L=b!=null?l("a",{class:m.itemLink,href:b,rel:"noreferrer",target:"_blank"},this._renderImageMask(e,400),l("div",{class:m.itemLinkOverlay},l("span",{class:m.itemLinkOverlayIcon},l("calcite-icon",{icon:"launch"})))):this._renderImageMask(e,400),k=l("form",{afterCreate:_e,afterRemoved:ve,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:S=>this._submitUpdateAttachment(S,e)},l("div",{class:m.metadata},M,O),x,l("div",{class:m.actions},F,v,w));return l("div",{class:m.formNode,key:"edit-form-container"},L,k)}_renderImageMask(e,t){return e?"file"in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,t):null}_renderGenericImageMask(e,t){let{supportsResizeAttachments:i}=this.viewModel,a=Tt(t),s={[m.itemImageResizable]:i};return l("div",{class:this.classes(m.itemMaskIcon,m.itemMask),key:a},l("img",{alt:e,class:this.classes(s,m.itemImage),src:a,title:e}))}_renderImageMaskForAttachment(e,t){let{supportsResizeAttachments:i}=this.viewModel;if(!e)return null;let{contentType:a,name:s,url:r}=e;if(!i||!Ee(a))return this._renderGenericImageMask(s,a);let d=this._getCSSTransform(e),u=d?{transform:d,"image-orientation":"none"}:{},c=`${r}${r?.includes("?")?"&":"?"}w=${t}`,f={[m.itemImageResizable]:i};return l("div",{class:this.classes(m.itemMask),key:c},l("img",{alt:s,class:this.classes(f,m.itemImage),src:c,styles:u,title:s}))}_renderFile(e){let{file:t}=e;return l("li",{class:m.item,key:t},l("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:m.itemButton,key:"details-button",onclick:()=>this._startEditFile(e),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(e),l("label",{class:m.itemLabel},l("span",{class:m.itemFilename},t.name||this.messages.noTitle),l("span",{"aria-hidden":"true",class:this.classes(m.itemChevronIcon,be(this.container)?U.left:U.right)}))))}_renderAttachmentInfo({attachmentInfo:e,displayType:t}){let{viewModel:i,effectiveDisplayType:a}=this,{capabilities:s,supportsResizeAttachments:r}=i,{contentType:d,name:u,url:c}=e,f=this._renderImageMask(e,t==="list"?48:400),b=s.editing?l("span",{"aria-hidden":"true",class:this.classes(m.itemChevronIcon,be(this.container)?U.left:U.right)}):null,F=[f,a==="preview"&&r&&Ee(d)?null:l("label",{class:m.itemLabel},l("span",{class:m.itemFilename},u||this.messages.noTitle),b)],w=s.editing?l("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:m.itemButton,"data-attachment-info-id":e.id,key:"details-button",onclick:()=>this._startEditAttachment(e),title:this.messages.attachmentDetails,type:"button"},F):l("a",{class:m.itemButton,href:c??void 0,key:"details-link",rel:"noreferrer",target:"_blank"},F);return l("li",{class:m.item,key:e},w)}_renderAttachmentContainer(){let{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:a,capabilities:s,fileInfos:r}=t,d=!!a?.length,u=!!r?.length,c={[m.containerList]:e!=="preview",[m.containerPreview]:e==="preview"},f=s.editing&&s.operations?.add&&i.addButton?l("button",{bind:this,class:this.classes(y.button,y.buttonTertiary,m.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},l("span",{"aria-hidden":"true",class:this.classes(m.itemAddIcon,U.plus)}),this.messages.add):void 0,b=d?l("ul",{class:m.items,key:"attachments-list"},a.toArray().map(v=>this._renderAttachmentInfo({attachmentInfo:v,displayType:e}))):void 0,F=u?l("ul",{class:m.items,key:"file-list"},r.toArray().map(v=>this._renderFile(v))):void 0,w=u||d?void 0:l("div",{class:y.empty},this.messages.noAttachments);return l("div",{class:this.classes(m.container,c),key:"attachments-container"},b,F,w,f)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){let t=e.target,i=t.files?.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),t&&("file"in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),t&&"file"in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){let{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}_startEditFile(e){let{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){let{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?`rotate(${t.rotation}deg)`:"",t.mirrored?"scaleX(-1)":""].join(" "):""}};n([o()],_.prototype,"capabilities",null),n([o()],_.prototype,"displayType",void 0),n([o({readOnly:!0})],_.prototype,"effectiveDisplayType",null),n([o()],_.prototype,"graphic",null),n([o()],_.prototype,"icon",null),n([o()],_.prototype,"label",null),n([o(),z("esri/widgets/Attachments/t9n/Attachments")],_.prototype,"messages",void 0),n([o(),z("esri/core/t9n/Units")],_.prototype,"messagesUnits",void 0),n([o({readOnly:!0})],_.prototype,"selectedFile",void 0),n([o({readOnly:!0})],_.prototype,"submitting",void 0),n([o({readOnly:!0})],_.prototype,"error",void 0),n([o({type:ke})],_.prototype,"viewModel",void 0),n([o()],_.prototype,"visibleElements",void 0),n([ee("visibleElements")],_.prototype,"castVisibleElements",null),_=n([q("esri.widgets.Attachments")],_);var ba=_;var jt=fe,qe={date:null,time:null,timeZoneOffset:null},Ea=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]),zt="latn";var Bt=e=>"valueAsDate"in e;function R(e){return{locale:Ke(),numberingSystem:zt,zone:e??jt}}function Lt(e,t){return e==null?null:$.fromMillis(e,R(t))}function Ut(e,t){if(e==null||!at(e)||e===""){if(t){let a=$.local({zone:t});return{date:null,time:null,timeZoneOffset:a.isValid?a.offset.toString():null}}return qe}let i=$.fromISO(e,{setZone:!0});return{date:i.toFormat(G,R()),time:i.toFormat(st.HMS_MS,R()),timeZoneOffset:i.offset.toString()}}function Sa(e,t){if(e==null||!it(e)||isNaN(e))return qe;let i=Lt(e,t);return i?{date:i.toFormat(G,R(t)),time:i.toFormat(nt,R(t))}:qe}function $e(e){switch(e.type){case"date":default:return Q("short-date-short-time");case"date-only":return Q("short-date");case"time-only":return Q("short-time");case"timestamp-offset":return Be(T({},Q("short-date-short-time")),{timeZone:void 0,timeZoneName:"short"})}}function kt(e,t,i){if(!e||t==null)return null;switch(e.type){case"date":return Ye(t,i);case"date-only":return Je(t,i);case"time-only":return Xe(t,i);case"timestamp-offset":return et(t,i);default:return null}}function qa(e){let{dateComponent:t,defaultTimeZone:i,timeComponent:a,timeZoneComponent:s,oldValue:r}=e;if(!t?.value)return null;let{year:d,month:u,day:c}=$.fromFormat(t.value,G),{hour:f,minute:b,second:F,millisecond:w}=De(a,fe)??$.now(),v=Ut(r,i),x=s?.value?parseInt(s.value,10):v.timeZoneOffset!=null?parseInt(v.timeZoneOffset,10):new Date().getTimezoneOffset(),M=We.instance(x),O=$.fromObject({year:d,month:u,day:c,hour:f,minute:b,second:F,millisecond:w},{zone:M});return O.isValid?O.toISO({includeOffset:!0}):null}function Da(e){let{dateComponent:t,timeComponent:i,timeZone:a,max:s,min:r,oldValue:d}=e,u=De(t,a),c=!!e.applyRange;if(!u)return null;let f=null;if(i?.value!=null){let F=De(i,a),w=Date.now(),v=s!=null&&s<w?s:w,x=$.fromMillis(v,R(a)),M=u||x,{year:O,month:L,day:k}=M,{hour:S,minute:H,second:ue,millisecond:ce}=F||x;f=M.set({year:O,month:L,day:k,hour:S,minute:H,second:ue,millisecond:ce})}else{let F=Lt(Ot({value:d??Date.now(),max:s,min:r}),a),{year:w,month:v,day:x}=u,{hour:M,minute:O,second:L,millisecond:k}=F;c=!0,f=u.set({year:w,month:v,day:x,hour:M,minute:O,second:L,millisecond:k})}if(!f.isValid)return null;let b=f.toMillis();return c?Ot({value:b,max:s,min:r}):b}function De(e,t){if(e?.value==null||Array.isArray(e.value))return null;let i=null;return i=Bt(e)?$.fromFormat(e.value,G,R(t)):K(e.value),i?.isValid?i:null}function Mt(e){let{max:t,min:i,value:a}=e;return!isNaN(a)&&!(t!=null&&a>t)&&!(i!=null&&a<i)}function Ot(e){let{max:t,min:i,value:a}=e;return t!=null&&i!=null?Ge(a,i,t):t!=null&&a>t?t:i!=null&&a<i?i:a}function Ht(e){if(!e)return"";let t=e.split(".").at(0);if(!t||t.length<1)throw new g("invalid time-only field",`Cannot parse valid time-only field value from ${e}`);let i=t.split(":"),a=new Array(3);for(let s=0;s<3;s++){let r=i.at(s)??"";a[s]=r.padStart(2,"0")}return a.join(":")}function $a(e,t){switch(t){case"date":return e.getTime();case"date-only":return e.toISODate();case"time-only":return Ht(e.toISOTime(!0,!1));case"timestamp-offset":return e.toISOString(!1);default:return null}}function Va(e){return!!e&&typeof e=="object"&&"getTime"in e&&"toISOString"in e&&"timeZone"in e}function Et(e){let{type:t,range:i,value:a}=e;if(a==null||!i||a===i.min||a===i.max)return!0;if(t==="date")return Mt({value:a,min:i.min,max:i.max});let{rawMax:s,rawMin:r}=i,d=null,u=null,c=null;switch(t){case"date-only":d=ie(s),u=ie(r),c=ie(a);break;case"time-only":d=K(s),u=K(r),c=K(a);break;case"timestamp-offset":d=ae(s),u=ae(r),c=ae(a)}return!c||Mt({value:c.valueOf(),min:u?.valueOf(),max:d?.valueOf()})}var oe,V;(function(e){e.Text="text",e.Number="number",e.Date="date",e.Unsupported="unsupported"})(oe||(oe={})),function(e){e.CANNOT_BE_EMPTY="input-validation-error::cannot-be-empty",e.TOO_SHORT="length-validation-error::too-short",e.TOO_LONG="length-validation-error::too-long"}(V||(V={}));var Ua=(e,t)=>{if(!e)return!0;let{operations:i}=e;switch(t){case"INSERT":return i.supportsAdd;case"UPDATE":case"DELETE":return i.supportsUpdate;default:return!0}};function Ha(e,t){let{dataType:i,domain:a,field:s,maxLength:r,minLength:d,range:u,required:c}=t;if(e==null)return c?V.CANNOT_BE_EMPTY:null;if(i==="text"&&typeof e=="string"){if(d>-1&&e.length<d)return V.TOO_SHORT;if(r>-1&&e.length>r)return V.TOO_LONG}return i!=="date"||Et({type:s.type,range:u,value:e})?a?we(s,e,a):vt(s,e)??we(s,e):ne.OUT_OF_RANGE}function Za(e,t){return!(!St(e)||!St(t))||e===t}function St(e){return e==null||e===""}function Qa({dataType:e,field:t,input:i}){if(e===oe.Date)return-1;let s=le(t.length);if(!i||!Ae(i))return s;let r=le(i.maxLength);return r===-1?s:s===-1?r:Math.min(s,r)}function Ga({dataType:e,field:t,input:i}){if(e===oe.Date||!i||!Ae(i))return-1;let s=le(i.minLength);if(s<0)return-1;let r=le(t.length);return r>-1&&r<s?-1:s}function le(e){return typeof e=="number"&&e>-1?e:-1}var Ve={type:"number"},Ne={type:"number",intlOptions:{notation:"scientific"}};function Re(e){return e>=1e7||e<=-1e7}function qt(e,t){return e.max!=null&&e.min!=null?t.outsideRange:e.max!=null?t.outsideRangeMax:t.outsideRangeMin}var Ka=e=>e&&!Number.isNaN(e.valueOf());function Dt(e){let{attributes:t,sourceLayer:i}=e??{},a=i&&"displayField"in i?i.displayField:null,s=a?t?.[a]:null,r=s!=null?JSON.stringify(s):null,d=e?.getObjectId()?.toString();return r||d||""}var Zt=e=>e?.type==="field",Vt=e=>e?.type==="group",Qt=e=>e?.type==="relationship",hs=e=>e.type==="text",Gt=e=>e.type==="utilityNetworkAssociations",fs=e=>!Vt(e)&&e.group!=null,Pe=e=>e.reduce((t,i)=>Vt(i)?[...t,...i.inputs]:[...t,i],[]),ys=e=>Pe(e).filter(Zt),gs=e=>Pe(e).filter(Qt),bs=e=>Pe(e).filter(Gt),vs=e=>e!=null&&($t(e,"combo-box")||$t(e,"radio-buttons")),$t=(e,t)=>e!=null&&e.input?.type===t,_s=({domain:e,inputType:t="text-box",dataType:i})=>i==="number"&&t==="text-box"&&(!e||e.type!=="coded-value");function Fs(e,t){let{title:i,feature:a}=e??{};return i||(a?Dt(a):null)||t||""}function ws(e){let{attributes:t,fieldsIndex:i,label:a,timeZone:s}=e;if(!t||typeof t!="object")return a;let r=Object.keys(t).filter(c=>W(a,c)),d=r.map(c=>t[c]),u=r.map(c=>i.get(c)).filter(Z);return Jt(a,Yt({values:d,fields:u,timeZone:s}))}var de="expression/",Kt="expr/",Wt="field/";function As(e){let[t,i]=e.split(de);return t===""&&i?i:(He.getLogger("esri.widgets.FeatureForm/featureFormUtils").error("extractExpressionNameFromString:invalid-input",`The string ${e} is not a valid expression reference of the form '${de}/expressionName'`),"")}function Is(e){return`${de}${e}`}function Cs(e){return`${Wt}${e}`}function Ts(e){return e.startsWith(de)}function xs(e){return e.startsWith(Kt)}function Yt(e){let{fields:t,values:i}=e,a=e.timeZone??void 0,s=t.map((r,d)=>{let u=i[d];if(r.domain&&r.domain.type==="coded-value"){let c=r.domain.codedValues.find(f=>f.code===u);c?.name&&(u=c.name)}return(ct(r)||gt(r))&&(u=kt(r,u,T({timeZone:a},$e(r)))),[r.name,u]});return Object.fromEntries(s)}function Jt(e,t){return pe(pe(e,i=>`{${i.toLowerCase()}}`),Object.fromEntries(Object.entries(t).map(([i,a])=>[i.toLowerCase(),a])))}var Ms=e=>{let t={typeFieldName:null,types:[]};return e&&(rt(e)?(t.typeFieldName=e.parent?.subtypeField,t.types=e.parent?.subtypes??[]):e.type==="subtype-group"||e.type==="feature"&&e.subtypes?.length?(t.typeFieldName=e.subtypeField,t.types=e.subtypes??[]):"types"in e&&e.types&&(t.typeFieldName=e.typeIdField,t.types=e.types.map(({id:i,name:a,domains:s})=>({code:i,name:a,domains:s}))),t.typeFieldName!=null&&(t.typeFieldName=e.getField(t.typeFieldName)?.name??t.typeFieldName)),t},Os=(e,t,i)=>{let{dataType:a,error:s,minLength:r}=e,d=t?.validationErrors;if(!d||!s)return null;if(s===V.CANNOT_BE_EMPTY)return d.cannotBeNull;if(s===Fe.VALUE_OUT_OF_RANGE||s===ne.OUT_OF_RANGE){let{field:u,range:c}=e,f={type:"date",intlOptions:T({timeZone:u.type==="date"&&i?i:void 0},$e(u))},b=qt(c,d);return ye(b,c,{format:{max:a==="date"?f:c.max!=null&&Re(c.max)?Ne:Ve,min:a==="date"?f:c.min!=null&&Re(c.min)?Ne:Ve}})}return s===Fe.INVALID_CODED_VALUE?d.invalidCodedValue:s===bt.INVALID_TYPE?d.invalidType:s===V.TOO_SHORT?ye(d.tooShort,{min:r}):(V.TOO_LONG,null)},Ls=e=>{if(!e)return;let t=e.layer,i=t&&"geometryType"in t?t.geometryType:void 0,a=e.geometry?.type;return a==="polyline"||i==="polyline"?"line":a==="mesh"||i==="mesh"||i==="multipatch"?"cube":a==="multipoint"||i==="multipoint"?"point":a||i||"table"},Nt=e=>{let t=[];if(e.formTemplate){let{description:i,title:a}=e.formTemplate;e.fields?.forEach(s=>{let r=a&&W(a,s.name),d=i&&W(i,s.name);(r||d)&&t.push(s.name)})}return t};function ks(e,t){let i=t??("formTemplate"in e&&e.formTemplate);return i?(i.elements?.filter(ut)??[]).some(({fieldName:a})=>!e.fieldsIndex.get(a)):!1}function Es(e,t){return e==null||t.onValue!==e&&t.offValue!==e}function Ss(e,t){switch(t.objectType){case"any":return!0;case"null":return e==null;case"code":return e===t.codedValue?.code;case"range":return e!=null&&t.minValue!=null&&t.maxValue!=null&&+e>=t.minValue&&+e<=t.maxValue;default:return t.objectType,!1}}function qs(e,t,i){let a=ot(e),s=a?.find(d=>d.code===i);if(!s)return!1;let r=a?.find(d=>d.code===t);return!Ue(s.defaultValues,r?.defaultValues)&&Object.values(s.defaultValues).some(d=>d!=null)}var je=100,p=class extends Qe.ClonableMixin(lt.IdentifiableMixin(X)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.activeCategory=null,this.allCategories=null,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{let{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{let{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{let{_queryPageAbortController:t}=this;t&&t.abort(),this._queryPageAbortController=null},this._queryController=()=>A(this,null,function*(){this._cancelQuery();let t=new AbortController;this._queryAbortController=t,yield Y(this._query()),this._queryAbortController===t&&(this._queryAbortController=null)}),this._queryFeatureCountController=()=>A(this,null,function*(){this._loaded=!1,this._cancelQueryFeatureCount();let t=new AbortController;this._queryFeatureCountAbortController=t,yield Y(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null),this._loaded=!0}),this._queryPageController=()=>A(this,null,function*(){let t=new AbortController;this._queryPageAbortController=t,yield Y(this._queryPage()),this._queryPageAbortController===t&&(this._queryPageAbortController=null)}),this._queryDebounced=J(this._queryController,je),this._queryFeatureCountDebounced=J(this._queryFeatureCountController,je),this._queryPageDebounced=J(this._queryPageController,je),this._query=()=>A(this,null,function*(){let{_queryAbortController:t,relatedFeatures:i}=this;this.featureCount&&(this.relatedLayer?.type!=="subtype-group"||this.activeCategory)&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,i.destroyAll(),this.destroyed||i.addMany(this._sliceFeatures(yield this._queryRelatedFeatures({signal:t?.signal}))))}),this.addHandles([D(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount,this.activeCategory],()=>this._queryDebounced(),N),D(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),D(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery,this.activeCategory],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){let{featuresPerPage:t,featureCount:i}=this,a=1,s=Math.ceil(i/t)||1;this._set("featurePage",Math.min(Math.max(e,a),s))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){let{orderByFields:e,relatedLayer:t}=this;return e&&t?.loaded?e.map(i=>{let a=i.clone();return a.field=pt(i.field,t),a}):e??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&this.relationshipId!=null&&typeof this.objectId=="number"}get canQuery(){let e=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&this.relationshipId!=null&&this.objectId!=null&&e?.supportsCount&&e?.supportsPagination)}get allCategoriesCount(){return this.allCategories?.length??0}get categories(){let{allCategories:e}=this;return this.showAllEnabled?e:e?.slice(0,this.displayCount)??null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e??3,0),10))}get displayCount(){return this._get("displayCount")}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new P}get relatedLayer(){let{layer:e,map:t,relationship:i}=this;if(!e?.loaded||!t||!i)return null;let a=e.type==="subtype-sublayer"&&e.parent&&ht(e.parent)?e.parent:e;return ft(t,a,i)??null}get relatedLayerKeyField(){let{relatedLayer:e,relationshipId:t}=this;return e?.loaded&&t!=null?e.relationships?.find(i=>i.id===t)?.keyField:null}get relatedLayerKeyFields(){let{relatedLayer:e}=this;return e?.loaded?e.relationships?.map(t=>t.keyField).filter(Z)??[]:[]}get relationship(){let{relationshipId:e,layer:t}=this;return e!=null&&t?.loaded?t.relationships?.find(({id:i})=>i===e)??null:null}get relationshipKey(){let{relationshipKeyField:e}=this;return(e&&this.graphic?.attributes?.[e])??null}get relationshipKeyField(){return this.relationship?.keyField||null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new P}get state(){let{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:i,canQuery:a,_loaded:s,canLoad:r}=this;return t||r&&!s?"loading":e||i?"querying":a?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find(t=>t.getObjectId()===e)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.destroyAll()}_queryFeatureCount(){return A(this,null,function*(){let{layer:e,relatedLayer:t}=this;yield e?.load(),yield t?.load();let{_queryFeatureCountAbortController:i,activeCategory:a,canQuery:s,objectId:r,relatedLayerKeyField:d,relationshipId:u,relationshipKey:c,supportsCacheHint:f}=this;if(!s||!e||!t||r==null)return this._set("featureCount",0),void this._set("allCategories",null);if(t?.type==="subtype-group"&&!a){if(this._set("featureCount",0),this._destroyRelatedFeatureViewModels(),this.featurePage=1,this.relatedFeatures.destroyAll(),d&&c!=null){let{default:x}=yield import("./chunk-OBSU5CHJ.js"),{uniqueValueInfos:M}=yield x({layer:t,sqlWhere:`${d} = '${c}'`,field:t.subtypeField,signal:i?.signal}),O=M.map(({count:L,value:k})=>{let S=t.subtypes?.find(H=>H.code===k)?.name;return k!=null&&S?{count:L,value:k,name:S}:void 0}).filter(Z);this._set("allCategories",O)}return}let{historicMoment:b,gdbVersion:F}=e,w=new Ce({cacheHint:f,gdbVersion:F,historicMoment:b,relationshipId:u,returnGeometry:!1,objectIds:[r],where:this._getRelationshipWhereClause(t)}),v=yield e.queryRelatedFeaturesCount(w,{signal:i?.signal});this._set("allCategories",null),this._set("featureCount",v[r]||0)})}_getRelationshipWhereClause(e){let{activeCategory:t}=this,i=e.createQuery(),a="subtypeField"in e?e.subtypeField:void 0,s=t&&a?`${a} = ${t.value}`:void 0,r=i.where;return r&&s?`(${r}) AND (${s})`:r??s}_sliceFeatures(e){let{showAllEnabled:t,displayCount:i}=this;return t?e:i?e.slice(0,i):[]}_queryPage(){return A(this,null,function*(){let{relatedFeatures:e,featurePage:t,showAllEnabled:i,_queryPageAbortController:a,featureCount:s}=this;!i||t<2||!s||this.relatedLayer?.type==="subtype-group"&&!this.activeCategory||e.addMany(yield this._queryRelatedFeatures({signal:a?.signal}))})}_queryRelatedFeatures(e){return A(this,null,function*(){let{displayCount:t,featureCount:i,featurePage:a,featuresPerPage:s,layer:r,orderByFieldsFixedCasing:d,relatedLayer:u,relatedLayerKeyFields:c,relationshipId:f,showAllEnabled:b,supportsCacheHint:F}=this,{canQuery:w,objectId:v}=this;if(!w||!r||!u||v==null)return[];let x=b?((a-1)*s+i)%i:0,M=b?s:t,O=u.objectIdField,L="subtypeField"in u?u.subtypeField:void 0,k=[...d.map(E=>E.field),...Nt(u),...c,O,L].filter(Xt),S=d.map(E=>`${E.field} ${E.order}`),{historicMoment:H,gdbVersion:ue}=r,ce=new Ce({orderByFields:S,start:x,num:M,outFields:k,cacheHint:F,historicMoment:H,gdbVersion:ue,relationshipId:f,returnGeometry:!1,objectIds:[v],where:this._getRelationshipWhereClause(u)}),Rt=yield r.queryRelatedFeatures(ce,{signal:e?.signal}),me=Rt[v]?.features||[];return u.type==="subtype-group"&&L?me.forEach(E=>{let Pt=E.attributes[L],ze=u.findSublayerForSubtypeCode?.(Pt);E.sourceLayer=ze,E.layer=ze}):me.forEach(E=>{E.sourceLayer=u,E.layer=u}),me})}};function Xt(e){return e!=null&&e!==""}n([o()],p.prototype,"_loaded",void 0),n([o()],p.prototype,"_queryAbortController",void 0),n([o()],p.prototype,"_queryPageAbortController",void 0),n([o()],p.prototype,"_queryFeatureCountAbortController",void 0),n([o({value:1})],p.prototype,"featurePage",null),n([o()],p.prototype,"featuresPerPage",void 0),n([o({readOnly:!0})],p.prototype,"orderByFieldsFixedCasing",null),n([o({readOnly:!0})],p.prototype,"supportsCacheHint",null),n([o({readOnly:!0})],p.prototype,"canLoad",null),n([o({readOnly:!0})],p.prototype,"canQuery",null),n([o()],p.prototype,"activeCategory",void 0),n([o({readOnly:!0})],p.prototype,"allCategories",void 0),n([o({readOnly:!0})],p.prototype,"allCategoriesCount",null),n([o({readOnly:!0})],p.prototype,"categories",null),n([o()],p.prototype,"description",void 0),n([o({value:3})],p.prototype,"displayCount",null),n([o({type:se})],p.prototype,"graphic",void 0),n([o({readOnly:!0})],p.prototype,"itemDescriptionFieldName",null),n([o()],p.prototype,"layer",void 0),n([o()],p.prototype,"map",void 0),n([o({readOnly:!0})],p.prototype,"objectId",null),n([o({readOnly:!0})],p.prototype,"objectIdField",null),n([o()],p.prototype,"orderByFields",void 0),n([o({readOnly:!0})],p.prototype,"relatedFeatures",null),n([o({readOnly:!0})],p.prototype,"relatedLayer",null),n([o({readOnly:!0})],p.prototype,"relatedLayerKeyField",null),n([o({readOnly:!0})],p.prototype,"relatedLayerKeyFields",null),n([o({readOnly:!0})],p.prototype,"relationship",null),n([o({readOnly:!0})],p.prototype,"relationshipKey",null),n([o({readOnly:!0})],p.prototype,"relationshipKeyField",null),n([o({readOnly:!0})],p.prototype,"featureCount",void 0),n([o({readOnly:!0})],p.prototype,"relatedFeatureViewModels",null),n([o()],p.prototype,"relationshipId",void 0),n([o()],p.prototype,"showAllEnabled",void 0),n([o()],p.prototype,"state",null),n([o()],p.prototype,"title",void 0),p=n([q("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],p);var Xs=p;export{ke as a,U as b,ba as c,wt as d,Ea as e,zt as f,Ut as g,Sa as h,$e as i,kt as j,qa as k,Da as l,Ht as m,$a as n,Va as o,oe as p,Ua as q,Ha as r,Za as s,Qa as t,Ga as u,Ka as v,Dt as w,Zt as x,Vt as y,Qt as z,hs as A,Gt as B,fs as C,Pe as D,ys as E,gs as F,bs as G,vs as H,$t as I,_s as J,Fs as K,ws as L,As as M,Is as N,Cs as O,Ts as P,xs as Q,Yt as R,Ms as S,Os as T,Ls as U,ks as V,Es as W,Ss as X,qs as Y,Xs as Z,Li as _};
