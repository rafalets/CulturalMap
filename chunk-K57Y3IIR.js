import{b as ri}from"./chunk-TTCWVZMG.js";import{b as Bt,c as oi}from"./chunk-QA5EAWXI.js";import{a as si}from"./chunk-K2IZFVKY.js";import{e as ti,f as ei,g as ii}from"./chunk-FWCA6KJ3.js";import{A as ke,f as Ge,m as He,r as H,u as qe,v as zt,w as Nt,x as We,y as Xe,z as Ye}from"./chunk-P64DWRJ7.js";import{d as $e}from"./chunk-4MYROXQR.js";import{b as T}from"./chunk-L5JJXC3A.js";import{e as Re}from"./chunk-DBZKWPEX.js";import{a as Pe}from"./chunk-AYSSTKZP.js";import{a as Ze,b as Je}from"./chunk-WXB3UZNT.js";import{a as Ee,e as Ae,f as Ce,g as Fe}from"./chunk-7VWXQFPJ.js";import{c as ze,g as Ne,h as Be,i as Ue}from"./chunk-FZ5X7HOK.js";import{d as be,e as Lt,f as Ie,g as Ve,j as Le,k as je,o as Qe,t as Ke}from"./chunk-3D4Y6BLC.js";import{a as jt}from"./chunk-OTUHXNWB.js";import{b as ut}from"./chunk-NBT2WTKD.js";import{a as Se}from"./chunk-B564E6X6.js";import{a as lt,h as pt,m as ct}from"./chunk-3AS27HNO.js";import{a as v}from"./chunk-RWCIDBNQ.js";import{p as Te}from"./chunk-B57IWIA2.js";import{a as Oe}from"./chunk-VC7OIMIK.js";import{a as De}from"./chunk-3Q427ME6.js";import{a as Me}from"./chunk-3BZAI7HK.js";import{b as Vt,i as xe}from"./chunk-HM5RIVQC.js";import{b as ve}from"./chunk-SKMO433W.js";import{a as bt,c as ht}from"./chunk-2FO7ARYZ.js";import{a as It}from"./chunk-DJW5LMRG.js";import{a as ge,b as _e,t as ye,v as we}from"./chunk-QXXXCEV5.js";import{a as L}from"./chunk-ALWV3RJ2.js";import{a as Ft}from"./chunk-7C6Z24SS.js";import{C as $,E as fe,F as At,H as me,J as Ct,a as U,b as F,c as V,d as at,e as W,m as b,o as nt,t as X,u as Q,v as Et,x as K,y as de}from"./chunk-5WKDXHVH.js";import{a as N,c as Pt,d as Rt,e as ue}from"./chunk-PTZYZULI.js";import{a as Z,d as Mt,e as St,k as J,l as ot,m as Dt}from"./chunk-KZKWOEFD.js";import{A as pe,C as ce,a as st,d as he,f as q,g as Ot,y as le}from"./chunk-7B2UKJ5N.js";import{f as oe,h as ae}from"./chunk-OLOKUDVI.js";import{a as x,c as ne}from"./chunk-NHSDW26F.js";import{a as se}from"./chunk-3SDSCSDJ.js";import{b as ie,d as k,f as re}from"./chunk-VOFKUGRY.js";import{L as rt,d as h}from"./chunk-C7INQGWT.js";import{H as ee}from"./chunk-WMHJC7XF.js";import{a as o}from"./chunk-QGVBCWUY.js";import{r as te}from"./chunk-HHDFN2GK.js";import{a as xt}from"./chunk-VTHXE323.js";function Si(t){return t instanceof Float32Array&&t.length>=16}function Di(t){return Array.isArray(t)&&t.length>=16}function ai(t){return Si(t)||Di(t)}var dt=class{constructor(){this.factor=new ft,this.factorAlignment=new ft}},ft=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};var mt=class extends Je{constructor(e,i){super(e,i,new Ze(oi,()=>import("./chunk-BDH2XAJ5.js"))),this.primitiveType=i.occlusionPass?Vt.POINTS:Vt.TRIANGLES}initializePipeline(e){let{oitPass:i,hasPolygonOffset:r,draped:s,output:a,depthTestEnabled:p,occlusionPass:l}=e,m=i===jt.NONE,_=i===jt.ColorAlpha,d=a===lt.Highlight,u=p&&!s&&!_&&!l&&!d;return Ue({blending:pt(a)?m?ze:Ge(i):null,depthTest:p&&!s?{func:xe.LEQUAL}:null,depthWrite:u?Ne:null,drawBuffers:He(i,a),colorWrite:Be,polygonOffset:r?Pi:null})}},Pi={factor:0,units:-4};var y=class extends $e{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.objectAndLayerIdColorInstanced=!1,this.horizonCullingEnabled=!0,this.isFocused=!0,this.textureCoordinateType=Ee.None,this.emissionSource=Fe.None,this.discardInvisibleFragments=!0,this.hasVvInstancing=!1}};o([T()],y.prototype,"screenCenterOffsetUnitsEnabled",void 0),o([T()],y.prototype,"occlusionTestEnabled",void 0),o([T()],y.prototype,"signedDistanceFieldEnabled",void 0),o([T()],y.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),o([T()],y.prototype,"vvSize",void 0),o([T()],y.prototype,"vvColor",void 0),o([T()],y.prototype,"hasVerticalOffset",void 0),o([T()],y.prototype,"hasScreenSizePerspective",void 0),o([T()],y.prototype,"hasRotation",void 0),o([T()],y.prototype,"debugDrawLabelBorder",void 0),o([T()],y.prototype,"hasPolygonOffset",void 0),o([T()],y.prototype,"depthTestEnabled",void 0),o([T()],y.prototype,"pixelSnappingEnabled",void 0),o([T()],y.prototype,"draped",void 0),o([T()],y.prototype,"terrainDepthTest",void 0),o([T()],y.prototype,"cullAboveTerrain",void 0),o([T()],y.prototype,"occlusionPass",void 0),o([T()],y.prototype,"occludedFragmentFade",void 0),o([T()],y.prototype,"objectAndLayerIdColorInstanced",void 0),o([T()],y.prototype,"horizonCullingEnabled",void 0),o([T()],y.prototype,"isFocused",void 0);var ni=class extends Le{constructor(e,i){super(e,Xt),this.produces=new Map([[H.HUD_MATERIAL,r=>ct(r)&&!this.parameters.drawAsLabel],[H.LABEL_MATERIAL,r=>ct(r)&&this.parameters.drawAsLabel],[H.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[H.DRAPED_MATERIAL,r=>this.parameters.draped&&ct(r)]]),this._visible=!0,this._configuration=new y(i)}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===H.OCCLUSION_PIXELS,this._configuration.occludedFragmentFade=this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.isFocused=this.parameters.isFocused,this._configuration.depthTestEnabled=this.parameters.depthEnabled||i.slot===H.OCCLUSION_PIXELS,pt(e)&&(this._configuration.debugDrawLabelBorder=!!Qe.LABELS_SHOW_BORDER),this._configuration.oitPass=i.oitPass,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration}intersect(e,i,r,s,a,p){let{options:{selectionMode:l,hud:m,excludeLabels:_},point:d,camera:u}=r,{parameters:w}=this;if(!l||!m||_&&w.isLabel||!e.visible||!d)return;let{scaleX:g,scaleY:S}=this._getScreenScale(e,u.pixelRatio);It(Gt,i),e.attributes.has(v.FEATUREATTRIBUTE)&&Ei(Gt);let D=e.attributes.get(v.POSITION),I=e.attributes.get(v.SIZE),j=e.attributes.get(v.NORMAL),R=e.attributes.get(v.ROTATION),C=e.attributes.get(v.CENTEROFFSETANDDISTANCE);Pe(D.size>=3);let B=Bt(w),G=this.parameters.centerOffsetUnits==="screen";for(let z=0;z<D.data.length/D.size;z++){let yt=z*D.size;V(O,D.data[yt],D.data[yt+1],D.data[yt+2]),K(O,O,i),K(O,O,u.viewMatrix);let wt=z*C.size;if(V(A,C.data[wt],C.data[wt+1],C.data[wt+2]),!G&&(O[0]+=A[0],O[1]+=A[1],A[2]!==0)){let it=A[2];X(A,O),W(O,O,b(A,A,it))}let Tt=z*j.size;if(V(tt,j.data[Tt],j.data[Tt+1],j.data[Tt+2]),hi(tt,Gt,u,qt),this._applyVerticalOffsetTransformationView(O,qt,u,Ut),u.applyProjection(O,P),P[0]>-1){G&&(A[0]||A[1])&&(P[0]+=A[0]*u.pixelRatio,A[1]!==0&&(P[1]+=be(A[1],Ut.factorAlignment)*u.pixelRatio),u.unapplyProjection(P,O)),P[0]+=this.parameters.screenOffset[0]*u.pixelRatio,P[1]+=this.parameters.screenOffset[1]*u.pixelRatio,P[0]=Math.floor(P[0]),P[1]=Math.floor(P[1]);let it=z*I.size;E[0]=I.data[it],E[1]=I.data[it+1],Ie(E,Ut.factor,E);let xi=bi*u.pixelRatio,Qt=0;w.textureIsSignedDistanceField&&(Qt=Math.min(w.outlineSize,.5*E[0])*u.pixelRatio/2),E[0]*=g,E[1]*=S;let Oi=z*R.size,Mi=w.rotation+R.data[Oi];if(li(d,P[0],P[1],E,xi,Qt,Mi,w,B)){let Kt=r.ray;if(K(pi,O,q(Ci,u.viewMatrix)),P[0]=d[0],P[1]=d[1],u.unprojectFromRenderScreen(P,O)){let Y=x();F(Y,Kt.direction);let $t=1/U(Y);b(Y,Y,$t),p(nt(Kt.origin,O)*$t,Y,-1,!0,1,pi)}}}}}intersectDraped(e,i,r,s,a,p){let l=e.attributes.get(v.POSITION),m=e.attributes.get(v.SIZE),_=e.attributes.get(v.ROTATION),d=this.parameters,u=Bt(d),{scaleX:w,scaleY:g}=this._getScreenScale(e,e.screenToWorldRatio),S=Ii*e.screenToWorldRatio;for(let D=0;D<l.data.length/l.size;D++){let I=D*l.size,j=l.data[I],R=l.data[I+1],C=D*m.size;E[0]=m.data[C],E[1]=m.data[C+1];let B=0;d.textureIsSignedDistanceField&&(B=Math.min(d.outlineSize,.5*E[0])*e.screenToWorldRatio/2),E[0]*=w,E[1]*=g;let G=D*_.size,z=d.rotation+_.data[G];li(s,j,R,E,S,B,z,d,u)&&a(p.dist,p.normal,-1,!1)}}createBufferWriter(){return new Yt}_updateScaleInfo(e,i,r){let s=this.parameters;s.screenSizePerspective!=null?Lt(r,i,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),s.screenSizePerspectiveAlignment!=null?Lt(r,i,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,i,r,s,a,p,l){let m=hi(i,r,a,qt);return this._applyVerticalGroundOffsetView(e,m,a,l),this._applyVerticalOffsetTransformationView(l,m,a,p),this._applyPolygonOffsetView(l,m,s[3],a,l),this._applyCenterOffsetView(l,s,l),l}applyShaderOffsetsNDC(e,i,r,s,a){return this._applyCenterOffsetNDC(e,i,r,s),a!=null&&F(a,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(e,i,r,s,a){let p=s.aboveGround?1:-1,l=Math.sign(r);l===0&&(l=p);let m=p*l;if(this.parameters.shaderPolygonOffset<=0)return F(a,e);let _=ie(Math.abs(i.cosAngle),.01,1),d=1-Math.sqrt(1-_*_)/_/s.viewport[2];return b(a,e,m>0?d:1/d),a}_applyVerticalGroundOffsetView(e,i,r,s){let a=U(e),p=r.aboveGround?1:-1,l=r.computeRenderPixelSizeAtDist(a)*si,m=b(O,i.normal,p*l);return at(s,e,m),s}_applyVerticalOffsetTransformationView(e,i,r,s){let a=this.parameters;if(!a.verticalOffset?.screenLength){if(a.screenSizePerspective||a.screenSizePerspectiveAlignment){let _=U(e);this._updateScaleInfo(s,_,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}let p=U(e),l=a.screenSizePerspectiveAlignment??a.screenSizePerspective,m=Ve(r,p,a.verticalOffset,i.cosAngle,l);return this._updateScaleInfo(s,p,i.cosAngle),b(i.normal,i.normal,m),at(e,e,i.normal)}_applyCenterOffsetView(e,i,r){let s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&F(r,e),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(X(tt,r),at(r,r,b(tt,tt,i[2])))),r}_applyCenterOffsetNDC(e,i,r,s){let a=this.parameters.centerOffsetUnits!=="screen";return s!==e&&F(s,e),a||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,i,r,s){let a=this.parameters.shaderPolygonOffset;if(e!==s&&F(s,e),a){let p=r.aboveGround?1:-1,l=p*Math.sign(i[3]);s[2]-=(l||p)*a}return s}set visible(e){this._visible=e}get visible(){let{color:e,outlineSize:i,outlineColor:r}=this.parameters,s=e[3]>=ut||i>=ut&&r[3]>=ut;return this._visible&&s}createGLMaterial(e){return new Wt(e)}calculateRelativeScreenBounds(e,i,r=se()){return Ri(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e,i){let r=e.attributes.get(v.FEATUREATTRIBUTE);if(r==null)return{scaleX:i,scaleY:i};let s=ue(r.data,Fi);return Ke(Ht,this.parameters,s),{scaleX:Ht[0]*i,scaleY:Ht[1]*i}}},Wt=class extends Ae{constructor(e){super(xt(xt({},e),e.material.parameters))}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.getTechnique(mt,e)}};function Ri(t,e,i,r){r[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*i,r[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*i}function hi(t,e,i,r){return ai(e)&&(e=It(Ai,e)),de(r.normal,t,e),K(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=Q(ui,Vi),r}function Ei(t){let e=t[0],i=t[1],r=t[2],s=t[3],a=t[4],p=t[5],l=t[6],m=t[7],_=t[8],d=1/Math.sqrt(e*e+i*i+r*r),u=1/Math.sqrt(s*s+a*a+p*p),w=1/Math.sqrt(l*l+m*m+_*_);return t[0]=e*d,t[1]=i*d,t[2]=r*d,t[3]=s*u,t[4]=a*u,t[5]=p*u,t[6]=l*w,t[7]=m*w,t[8]=_*w,t}function li(t,e,i,r,s,a,p,l,m){let _=e-s-r[0]*m[0],d=_+r[0]+2*s,u=i-s-r[1]*m[1],w=u+r[1]+2*s,g=l.distanceFieldBoundingBox;return l.textureIsSignedDistanceField&&g!=null&&(_+=r[0]*g[0],u+=r[1]*g[1],d-=r[0]*(1-g[2]),w-=r[1]*(1-g[3]),_-=a,d+=a,u-=a,w+=a),_e(ci,e,i),ye(et,t,ci,re(p)),et[0]>_&&et[0]<d&&et[1]>u&&et[1]<w}var Ut=new dt,O=x(),tt=x(),P=N(),ui=x(),pi=x(),et=bt(),ci=bt(),Gt=Ft(),Ai=Ft(),Ci=L(),A=x(),Ht=x(),Fi=N(),qt={normal:ui,cosAngle:0},bi=1,Ii=2,E=[0,0],Vi=ne(0,0,1),Xt=class extends Ce{constructor(){super(...arguments),this.renderOccluded=je.Occlude,this.isDecoration=!1,this.color=Rt(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=ht(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=Rt(1,1,1,1),this.outlineSize=0,this.distanceFieldBoundingBox=N(),this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawAsLabel=!1,this.depthEnabled=!0,this.isFocused=!0,this.focusEffect="none",this.draped=!1,this.isLabel=!1}},di=Re().vec3f(v.POSITION).vec3f(v.NORMAL).vec2f(v.UV0).vec4u8(v.COLOR).vec2f(v.SIZE).f32(v.ROTATION).vec4f(v.CENTEROFFSETANDDISTANCE).vec4f(v.FEATUREATTRIBUTE),Li=di.clone().vec4u8(v.OBJECTANDLAYERIDCOLOR),Yt=class{constructor(){this.vertexBufferLayout=Se()?Li:di}elementCount(e){return 6*e.get(v.POSITION).indices.length}write(e,i,r,s,a,p){We(r.get(v.POSITION),e,a.position,p,6),Xe(r.get(v.NORMAL),i,a.normal,p,6);let l=r.get(v.UV0)?.data,m=0,_=0,d=1,u=1;l&&l.length>=4&&(m=l[0],_=l[1],d=l[2],u=l[3]),d=Math.min(1.99999,d+1),u=Math.min(1.99999,u+1);let w=r.get(v.POSITION).indices.length,g=p,S=a.uv0;for(let R=0;R<w;++R)S.set(g,0,m),S.set(g,1,_),g++,S.set(g,0,d),S.set(g,1,_),g++,S.set(g,0,d),S.set(g,1,u),g++,S.set(g,0,d),S.set(g,1,u),g++,S.set(g,0,m),S.set(g,1,u),g++,S.set(g,0,m),S.set(g,1,_),g++;Ye(r.get(v.COLOR),4,a.color,p,6);let{data:D,indices:I}=r.get(v.SIZE);w=I.length;let j=a.size;g=p;for(let R=0;R<w;++R){let C=D[2*I[R]],B=D[2*I[R]+1];for(let G=0;G<6;++G)j.set(g,0,C),j.set(g,1,B),g++}if(qe(r.get(v.ROTATION),a.rotation,p,6),r.get(v.CENTEROFFSETANDDISTANCE)?zt(r.get(v.CENTEROFFSETANDDISTANCE),a.centerOffsetAndDistance,p,6):Nt(a.centerOffsetAndDistance,p,6*w),r.get(v.FEATUREATTRIBUTE)?zt(r.get(v.FEATUREATTRIBUTE),a.featureAttribute,p,6):Nt(a.featureAttribute,p,6*w),s!=null){let R=r.get(v.POSITION)?.indices;if(R){let C=R.length,B=a.getField(v.OBJECTANDLAYERIDCOLOR,Te);ke(s,B,C,p,6)}}}};function Br(t,e,i){return!!Oe(t,e,vt,i.spatialReference)&&(i.x=vt[0],i.y=vt[1],i.z=vt[2],!0)}var vt=x();var ji={required:[]},Wr={required:[lt.Depth]},gt=class extends rt{precompile(e){return!!this.acquireTechniques(e)}consumes(){return ji}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}queryRenderOccludedState(e){return!1}},fi=class extends gt{},mi=class extends gt{};function vi(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function gi(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function _i(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function yi(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}var wi,f;(function(t){t[t.Default=0]="Default",t[t.Screenshot=1]="Screenshot",t[t.ObjectAndLayerID=2]="ObjectAndLayerID"})(wi||(wi={})),function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(f||(f={}));var Jt,n=Jt=class extends rt{constructor(t){super(t),this._ray=Me(),this._viewport=Pt(0,0,1,1),this._padding=Pt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=ht(1,1e3),this._viewDirty=!0,this._viewMatrix=L(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=L(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=L(),this._frustumDirty=!0,this._frustum=ti(),this._fullViewport=N(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=x(),this._up=x(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return W(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){st(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),V(x(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),V(x(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),V(x(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;let t=Mt(N(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&Dt(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;let t=Mt(N(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&Dt(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[f.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[f.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[f.RIGHT]+this._padding[f.LEFT]}set fullWidth(t){this.width=t-(this._padding[f.RIGHT]+this._padding[f.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[f.TOP]+this._padding[f.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[f.TOP]+this._padding[f.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[f.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[f.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){ot(this._padding,t)||(this._viewport[0]+=t[f.LEFT]-this._padding[f.LEFT],this._viewport[1]+=t[f.BOTTOM]-this._padding[f.BOTTOM],this._viewport[2]-=t[f.RIGHT]+t[f.LEFT]-(this._padding[f.RIGHT]+this._padding[f.LEFT]),this._viewport[3]-=t[f.TOP]+t[f.BOTTOM]-(this._padding[f.TOP]+this._padding[f.BOTTOM]),Z(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Ot(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return q(L(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||L()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return _i(this._fov,this.width,this.height)}set fovX(t){this._fov=vi(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return yi(this._fov,this.width,this.height)}set fovY(t){this._fov=gi(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return nt(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(q(this._viewInverseTransposeMatrix,this.viewMatrix),he(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){let{near:e,far:i}=this;return 2*e*i/(i+e-t*(i-e))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}get _projectionMatrixInternal(){let t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,s=i/this.rows,a=r/this.columns,p=-r/2+this.column*a,l=p+a,m=-i/2+this.row*s,_=m+s,d=le(L(),p*(1+2*this._padding[f.LEFT]/t),l*(1+2*this._padding[f.RIGHT]/t),m*(1+2*this._padding[f.BOTTOM]/e),_*(1+2*this._padding[f.TOP]/e),this.near,this.far),u=this._get("projectionMatrix");return u&&ce(u,d)?u:d}copyFrom(t){F(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Z(this._viewport,t.viewport),this.notifyChange("_viewport"),Z(this._padding,t.padding),this.notifyChange("_padding"),ge(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;let e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(st(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(ei(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(st(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Z(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up,this.fov=t.fov}clone(){return new Jt().copyFrom(this)}equals(t){return $(this.eye,t.eye)&&$(this.center,t.center)&&$(this.up,t.up)&&ot(this._viewport,t.viewport)&&ot(this._padding,t.padding)&&we(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){let e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||St(t.screenPadding,this.screenPadding)>=e||St(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;At(M,t.eye,t.center),At(kt,this.eye,this.center);let i=Q(M,kt),r=Ct(M),s=Ct(kt),a=5e-4;return i*i>=(1-1e-10)*r*s&&me(t.eye,this.eye)<Math.max(r,s)*a*a}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(ve(this.viewForward,W(M,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=oe()){return t[0]=(this.padding[f.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[f.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[f.LEFT]+this.width*e,t[1]=this.padding[f.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){let e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==c&&F(c,t),c[3]=1,J(c,c,this.projectionMatrix);let i=Math.abs(c[3]);b(c,c,1/i);let r=this.fullViewport;e[0]=k(0,r[0]+r[2],.5+.5*c[0]),e[1]=k(0,r[1]+r[3],.5+.5*c[1]),e[2]=.5*(c[2]+1),e[3]=i}unapplyProjection(t,e){let i=this.fullViewport;c[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],c[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],c[2]=(2*t[2]-1)*t[3],c[3]=t[3],this.inverseProjectionMatrix!=null&&(J(c,c,this.inverseProjectionMatrix),e[0]=c[0],e[1]=c[1],e[2]=c[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,Zt),this.renderToScreen(Zt,e),e}projectToRenderScreen(t,e){if(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=1,J(c,c,this.viewProjectionMatrix),c[3]===0)return null;let i=c;b(i,i,1/Math.abs(c[3]));let r=this.fullViewport,s=k(0,r[0]+r[2],.5+.5*i[0]),a=k(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=s,e.y=a):(e[0]=s,e[1]=a,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,Zt),e)}unprojectFromRenderScreen(t,e){if(Ot(_t,this.projectionMatrix,this.viewMatrix),!q(_t,_t))return null;let i=this.fullViewport;return c[0]=2*(t[0]-i[0])/i[2]-1,c[1]=2*(t[1]-i[1])/i[3]-1,c[2]=2*t[2]-1,c[3]=1,J(c,c,_t),c[3]===0?null:(e[0]=c[0]/c[3],e[1]=c[1]/c[3],e[2]=c[2]/c[3],e)}constrainWindowSize(t,e,i,r){let s=t*this.pixelRatio,a=e*this.pixelRatio,p=Math.max(s-i/2,0),l=Math.max(this.fullHeight-a-r/2,0),m=-Math.min(s-i/2,0),_=-Math.min(this.fullHeight-a-r/2,0),d=i-m- -Math.min(this.fullWidth-s-i/2,0),u=r-_- -Math.min(a-r/2,0);return[Math.round(p),Math.round(l),Math.round(d),Math.round(u)]}computeUp(t){t===De.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){let i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){let i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){W(M,this.center,this.eye);let t=U(this.center);t<1?(V(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(Q(M,this.center))>.9999*U(M)*t||(Et(this._up,M,this.center),Et(this._up,this._up,M),X(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){fe(M,this.eye,this.center),Math.abs(M[2])<=.9999&&(b(M,M,M[2]),V(this._up,-M[0],-M[1],1-M[2]),X(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?$(t,e)||(F(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):te.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(ii(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(pe(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};o([h()],n.prototype,"_viewport",void 0),o([h()],n.prototype,"_padding",void 0),o([h()],n.prototype,"_fov",void 0),o([h()],n.prototype,"_nearFar",void 0),o([h()],n.prototype,"_viewDirty",void 0),o([h()],n.prototype,"_viewMatrix",void 0),o([h()],n.prototype,"_pixelRatio",void 0),o([h()],n.prototype,"pixelRatio",null),o([h()],n.prototype,"row",void 0),o([h()],n.prototype,"column",void 0),o([h()],n.prototype,"_rows",void 0),o([h()],n.prototype,"rows",null),o([h()],n.prototype,"_columns",void 0),o([h()],n.prototype,"columns",null),o([h()],n.prototype,"eye",null),o([h()],n.prototype,"center",null),o([h()],n.prototype,"_center",void 0),o([h()],n.prototype,"up",null),o([h()],n.prototype,"_up",void 0),o([h()],n.prototype,"viewMatrix",null),o([h({readOnly:!0})],n.prototype,"viewForward",null),o([h({readOnly:!0})],n.prototype,"viewUp",null),o([h({readOnly:!0})],n.prototype,"viewRight",null),o([h({readOnly:!0})],n.prototype,"nearFar",null),o([h()],n.prototype,"near",null),o([h()],n.prototype,"far",null),o([h()],n.prototype,"viewport",null),o([h({readOnly:!0})],n.prototype,"screenViewport",null),o([h({readOnly:!0})],n.prototype,"screenPadding",null),o([h()],n.prototype,"x",null),o([h()],n.prototype,"y",null),o([h()],n.prototype,"width",null),o([h()],n.prototype,"height",null),o([h()],n.prototype,"fullWidth",null),o([h()],n.prototype,"fullHeight",null),o([h({readOnly:!0})],n.prototype,"_aspect",null),o([h()],n.prototype,"padding",null),o([h({readOnly:!0})],n.prototype,"projectionMatrix",null),o([h({readOnly:!0})],n.prototype,"inverseProjectionMatrix",null),o([h()],n.prototype,"fov",null),o([h()],n.prototype,"fovX",null),o([h()],n.prototype,"fovY",null),o([h()],n.prototype,"viewInverseTransposeMatrix",null),o([h({readOnly:!0})],n.prototype,"_projectionMatrixInternal",null),o([h()],n.prototype,"relativeElevation",void 0),n=Jt=o([ee("esri.views.3d.webgl.RenderCamera")],n);var Os=n,c=N(),_t=L(),M=x(),kt=x(),Zt=ae();var Ti=class extends ri{};export{fi as a,mi as b,Os as c,Ti as d,ni as e,Br as f};
