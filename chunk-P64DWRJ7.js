import{b as Me}from"./chunk-NRQSFK4P.js";import{a as v}from"./chunk-AYSSTKZP.js";import{a as be,d as Ie,g as Le}from"./chunk-FZ5X7HOK.js";import{a as Ae,b as ot}from"./chunk-3D4Y6BLC.js";import{a as k}from"./chunk-OTUHXNWB.js";import{c as _e,d as Ee}from"./chunk-TBHSFWI7.js";import{p as Oe}from"./chunk-3AS27HNO.js";import{a as x}from"./chunk-RWCIDBNQ.js";import{e as st,f as zt}from"./chunk-ONYJLWAD.js";import{a as he,d as ue}from"./chunk-TKZJUAKL.js";import{D as ge,a as pe,b as de,c as pt,d as Dt,p as Ut}from"./chunk-B57IWIA2.js";import{a as Te}from"./chunk-3Q427ME6.js";import{g as Ft}from"./chunk-3BZAI7HK.js";import{c as dt,i as J,j as H,w as rt}from"./chunk-HM5RIVQC.js";import{p as me}from"./chunk-DJW5LMRG.js";import{a as mt,b as le,d as Bt}from"./chunk-ALWV3RJ2.js";import{a as ce}from"./chunk-7C6Z24SS.js";import{F as Z,G as fe,a as tt,b as _t,c as D,d as j,m as et,n as nt,p as ae,t as St,v as Vt,w as wt,x as ut}from"./chunk-5WKDXHVH.js";import{D as vt,E as Ct,a as Nt,d as xt,f as re,g as oe}from"./chunk-7B2UKJ5N.js";import{A as ee,B as se,d as te}from"./chunk-TRZXSDYA.js";import{a as L,b as ie,c as ne}from"./chunk-NHSDW26F.js";import{F as Jt}from"./chunk-C7INQGWT.js";import{a as Zt}from"./chunk-3TQOUBNU.js";import{A as Xt,G as $t}from"./chunk-47GHT6OF.js";import{a as Ot,b as Tt}from"./chunk-VTHXE323.js";function Re(s){if(s.length<$t)return Array.from(s);if(Array.isArray(s))return Float64Array.from(s);if(!("BYTES_PER_ELEMENT"in s))return Array.from(s);switch(s.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(s);case 2:return Xt(s)?Uint16Array.from(s):Int16Array.from(s);case 4:return Float32Array.from(s);default:return Float64Array.from(s)}}var Et=class s{constructor(t,i,e){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.position=e,this._children=void 0,v(t.length>=1),v(e.size===3||e.size===4);let{data:a,size:r,indices:o}=e;v(o.length%this._numIndexPerPrimitive==0),v(o.length>=t.length*this._numIndexPerPrimitive);let l=t.length,n=r*o[this._numIndexPerPrimitive*t[0]];at.clear(),at.push(n);let c=ne(a[n],a[n+1],a[n+2]),f=ie(c);for(let T=0;T<l;++T){let E=this._numIndexPerPrimitive*t[T];for(let b=0;b<this._numIndexPerPrimitive;++b){n=r*o[E+b],at.push(n);let p=a[n];c[0]=Math.min(p,c[0]),f[0]=Math.max(p,f[0]),p=a[n+1],c[1]=Math.min(p,c[1]),f[1]=Math.max(p,f[1]),p=a[n+2],c[2]=Math.min(p,c[2]),f[2]=Math.max(p,f[2])}}this.bbMin=c,this.bbMax=f;let h=wt(L(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(f[0]-c[0],f[1]-c[1]),f[2]-c[2]);let g=this.radius*this.radius;for(let T=0;T<at.length;++T){n=at.at(T);let E=a[n]-h[0],b=a[n+1]-h[1],p=a[n+2]-h[2],B=E*E+b*b+p*p;if(B<=g)continue;let I=Math.sqrt(B),P=.5*(I-this.radius);this.radius=this.radius+P,g=this.radius*this.radius;let R=P/I;h[0]+=E*R,h[1]+=b*R,h[2]+=p*R}this.center=h,at.clear()}getChildren(){if(this._children||ae(this.bbMin,this.bbMax)<=1)return this._children;let t=wt(L(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,e=new Uint8Array(i),a=new Array(8);for(let f=0;f<8;++f)a[f]=0;let{data:r,size:o,indices:l}=this.position;for(let f=0;f<i;++f){let h=0,g=this._numIndexPerPrimitive*this.primitiveIndices[f],T=o*l[g],E=r[T],b=r[T+1],p=r[T+2];for(let B=1;B<this._numIndexPerPrimitive;++B){T=o*l[g+B];let I=r[T],P=r[T+1],R=r[T+2];I<E&&(E=I),P<b&&(b=P),R<p&&(p=R)}E<t[0]&&(h|=1),b<t[1]&&(h|=2),p<t[2]&&(h|=4),e[f]=h,++a[h]}let n=0;for(let f=0;f<8;++f)a[f]>0&&++n;if(n<2)return;let c=new Array(8);for(let f=0;f<8;++f)c[f]=a[f]>0?new Uint32Array(a[f]):void 0;for(let f=0;f<8;++f)a[f]=0;for(let f=0;f<i;++f){let h=e[f];c[h][a[h]++]=this.primitiveIndices[f]}this._children=new Array;for(let f=0;f<8;++f)c[f]!==void 0&&this._children.push(new s(c[f],this._numIndexPerPrimitive,this.position));return this._children}static prune(){at.prune()}},at=new Zt({deallocator:null});function ye(s,t){if(!s)return!1;let{size:i,data:e,indices:a}=s;D(t,0,0,0),D(W,0,0,0);let r=0,o=0;for(let l=0;l<a.length-2;l+=3){let n=a[l]*i,c=a[l+1]*i,f=a[l+2]*i;D(U,e[n],e[n+1],e[n+2]),D(it,e[c],e[c+1],e[c+2]),D(At,e[f],e[f+1],e[f+2]);let h=Me(U,it,At);h?(j(U,U,it),j(U,U,At),et(U,U,1/3*h),j(t,t,U),r+=h):(j(W,W,U),j(W,W,it),j(W,W,At),o+=3)}return(o!==0||r!==0)&&(r!==0?(et(t,t,1/r),!0):o!==0&&(et(t,W,1/o),!0))}function Pe(s,t){if(!s)return!1;let{size:i,data:e,indices:a}=s;D(t,0,0,0);let r=-1,o=0;for(let l=0;l<a.length;l++){let n=a[l]*i;r!==n&&(t[0]+=e[n],t[1]+=e[n+1],t[2]+=e[n+2],o++),r=n}return o>1&&et(t,t,1/o),o>0}function Ne(s,t,i){if(!s)return!1;D(i,0,0,0),D(W,0,0,0);let e=0,a=0,{size:r,data:o,indices:l}=s,n=l.length-1,c=n+(t?2:0);for(let f=0;f<c;f+=2){let h=f<n?f+1:0,g=l[f<n?f:n]*r,T=l[h]*r;U[0]=o[g],U[1]=o[g+1],U[2]=o[g+2],it[0]=o[T],it[1]=o[T+1],it[2]=o[T+2],et(U,j(U,U,it),.5);let E=fe(U,it);E>0?(j(i,i,et(U,U,E)),e+=E):e===0&&(j(W,W,U),a++)}return e!==0?(et(i,i,1/e),!0):a!==0&&(et(i,W,1/a),!0)}var U=L(),it=L(),At=L(),W=L();var Mt=class{constructor(){this.uid=Jt()}},bt=class extends Mt{constructor(t){super(),this.highlightName=t,this.channel=zt.Highlight}},xe=class extends Mt{constructor(){super(...arguments),this.channel=zt.MaskOccludee}};var ve=class s extends Ae{constructor(t,i,e=null,a=ot.Mesh,r=null,o=-1){super(),this.material=t,this.mapPositions=e,this.type=a,this.objectAndLayerIdColor=r,this.edgeIndicesLength=o,this.highlights=new Set,this._highlightOptionsCounts=new Map,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(let[l,n]of i)this._attributes.set(l,Tt(Ot({},n),{indices:he(n.indices)})),l===x.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(l).indices.length:this.edgeIndicesLength)}instantiate(t={}){let i=new s(t.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((e,a)=>{e.exclusive=!1,i._attributes.set(a,e)}),i._boundingInfo=this._boundingInfo,i.transformation=t.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(t){let i=this._attributes.get(t);return i&&!i.exclusive&&(i=Tt(Ot({},i),{exclusive:!0,data:Re(i.data)}),this._attributes.set(t,i)),i}setAttributeData(t,i){let e=this._attributes.get(t);e&&this._attributes.set(t,Tt(Ot({},e),{exclusive:!0,data:i}))}get indexCount(){return this._attributes.values().next().value?.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(this.type===ot.Mesh?this._computeAttachmentOriginTriangles(t):this.type===ot.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(this._transformation!=null&&ut(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){let i=this.attributes.get(x.POSITION);return ye(i,t)}_computeAttachmentOriginLines(t){let i=this.attributes.get(x.POSITION);return Ne(i,Qe(this.material.parameters,i),t)}_computeAttachmentOriginPoints(t){let i=this.attributes.get(x.POSITION);return Pe(i,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){let t=this.attributes.get(x.POSITION);if(!t||t.indices.length===0)return null;let i=this.type===ot.Mesh?3:1;v(t.indices.length%i==0,"Indexing error: "+t.indices.length+" not divisible by "+i);let e=ue(t.indices.length/i);return new Et(e,i,t)}get transformation(){return this._transformation??Bt}set transformation(t){this._transformation=t&&t!==Bt?le(t):null}get highlightNames(){return this._highlightOptionsCounts}get hasHighlights(){return this._highlightOptionsCounts.size>0}foreachHighlightOptions(t){this._highlightOptionsCounts.forEach((i,e)=>t(e))}allocateIdAndHighlight(t){let i=new bt(t);return this.addHighlight(i)}addHighlight(t){this.highlights.add(t);let{highlightName:i}=t,e=(this._highlightOptionsCounts.get(i)??0)+1;return this._highlightOptionsCounts.set(i,e),t}removeHighlight(t){if(this.highlights.delete(t)){let{highlightName:i}=t,e=this._highlightOptionsCounts.get(i)??0;e<=1?this._highlightOptionsCounts.delete(i):this._highlightOptionsCounts.set(i,e-1)}}};function Qe(s,t){return!(!("isClosed"in s)||!s.isClosed)&&t.indices.length>2}var Ce=be(dt.ONE,dt.ZERO,dt.ONE,dt.ONE_MINUS_SRC_ALPHA);function Ys(s){return s===k.FrontFace?null:Ce}function Xs(s){switch(s){case k.NONE:return Ie;case k.ColorAlpha:return Ce;case k.FrontFace:case k.COUNT:return null}}function $s(s){if(s.draped)return null;switch(s.oitPass){case k.NONE:case k.FrontFace:return s.writeDepth?Le:null;case k.ColorAlpha:case k.COUNT:return null}}var Zs=5e5,Ye={factor:-1,units:-2};function Js(s){return s?Ye:null}function ti(s,t=J.LESS){return s===k.NONE||s===k.FrontFace?t:J.LEQUAL}function ei(s,t){let i=Oe(t);return s===k.ColorAlpha?i?{buffers:[rt.COLOR_ATTACHMENT0,rt.COLOR_ATTACHMENT1,rt.COLOR_ATTACHMENT2]}:{buffers:[rt.COLOR_ATTACHMENT0,rt.COLOR_ATTACHMENT1]}:i?{buffers:[rt.COLOR_ATTACHMENT0,rt.COLOR_ATTACHMENT1]}:null}var Ht=class{constructor(t=!1,i=!0){this.isVerticalRay=t,this.normalRequired=i}},It=te();function li(s,t,i,e,a,r){if(!s.visible)return;let o=Z(Ue,e,i),l=(c,f,h)=>{r(c,h,f,!1)},n=new Ht(!1,t.options.normalRequired);if(s.boundingInfo){v(s.type===ot.Mesh);let c=t.tolerance;Se(s.boundingInfo,i,o,c,a,n,l)}else{let c=s.attributes.get(x.POSITION),f=c.indices;we(i,o,0,f.length/3,f,c.data,c.stride,a,n,l)}}var Xe=L();function Se(s,t,i,e,a,r,o){if(s==null)return;let l=ss(i,Xe);if(ee(It,s.bbMin),se(It,s.bbMax),a?.applyToAabb(It),is(It,t,l,e)){let{primitiveIndices:n,position:c}=s,f=n?n.length:c.indices.length/3;if(f>rs){let h=s.getChildren();if(h!==void 0){for(let g of h)Se(g,t,i,e,a,r,o);return}}$e(t,i,0,f,c.indices,c.data,c.stride,n,a,r,o)}}var ct=L();function ci(s,t,i,e,a,r,o,l,n){let{data:c,stride:f}=r;we(s,Z(Ue,t,s),i,e,a,c,f,o,l,n)}function Ve(s,t,i,e,a,r,o,l){let n=s[0],c=s[1],f=s[2],h=t[0],g=t[1],T=t[2];for(let E=i;E<e;++E){let b=3*E,p=b+1,B=b+2,I=r*b,P=a[I],R=a[I+1],C=a[I+2],N=r*p,O=r*B,m=a[N]-P,A=a[N+1]-R,M=a[N+2]-C,u=a[O]-P,d=a[O+1]-R,_=a[O+2]-C,y=g*_-d*T,S=T*u-_*h,V=h*d-u*g,w=m*y+A*S+M*V;if(Math.abs(w)<=De)continue;let K=n-P,G=c-R,Q=f-C,z=K*y+G*S+Q*V;if(w>0){if(z<0||z>w)continue}else if(z>0||z<w)continue;let q=G*M-A*Q,X=Q*m-M*K,$=K*A-m*G,Y=h*q+g*X+T*$;if(w>0){if(Y<0||z+Y>w)continue}else if(Y>0||z+Y<w)continue;let F=(u*q+d*X+_*$)/w;F>=0&&l(F,E,o?Be(m,A,M,u,d,_,ct):null)}}function $e(s,t,i,e,a,r,o,l,n,c,f){let h=s[0],g=s[1],T=s[2],E=t[0],b=t[1],p=t[2],{normalRequired:B}=c;for(let I=i;I<e;++I){let P=l[I],R=3*P,C=o*a[R],N=r[C],O=r[C+1],m=r[C+2],A=o*a[R+1],M=r[A],u=r[A+1],d=r[A+2],_=o*a[R+2],y=r[_],S=r[_+1],V=r[_+2];n!=null&&([N,O,m]=n.applyToVertex(N,O,m,I),[M,u,d]=n.applyToVertex(M,u,d,I),[y,S,V]=n.applyToVertex(y,S,V,I));let w=M-N,K=u-O,G=d-m,Q=y-N,z=S-O,q=V-m,X=b*q-z*p,$=p*Q-q*E,Y=E*z-Q*b,F=w*X+K*$+G*Y;if(Math.abs(F)<=De)continue;let ft=h-N,yt=g-O,Pt=T-m,lt=ft*X+yt*$+Pt*Y;if(F>0){if(lt<0||lt>F)continue}else if(lt>0||lt<F)continue;let Kt=yt*G-K*Pt,Gt=Pt*w-G*ft,Qt=ft*K-w*yt,gt=E*Kt+b*Gt+p*Qt;if(F>0){if(gt<0||lt+gt>F)continue}else if(gt>0||lt+gt<F)continue;let Yt=(Q*Kt+z*Gt+q*Qt)/F;Yt>=0&&f(Yt,P,B?Be(w,K,G,Q,z,q,ct):null)}}function we(s,t,i,e,a,r,o,l,n,c){let f=t,h=os,g=Math.abs(f[0]),T=Math.abs(f[1]),E=Math.abs(f[2]),b=g>=T?g>=E?0:2:T>=E?1:2,p=b,B=f[p]<0?2:1,I=(b+B)%3,P=(b+(3-B))%3,R=f[I]/f[p],C=f[P]/f[p],N=1/f[p],O=Ze,m=Je,A=ts,{normalRequired:M}=n;for(let u=i;u<e;++u){let d=3*u,_=o*a[d];D(h[0],r[_+0],r[_+1],r[_+2]);let y=o*a[d+1];D(h[1],r[y+0],r[y+1],r[y+2]);let S=o*a[d+2];D(h[2],r[S+0],r[S+1],r[S+2]),l&&(_t(h[0],l.applyToVertex(h[0][0],h[0][1],h[0][2],u)),_t(h[1],l.applyToVertex(h[1][0],h[1][1],h[1][2],u)),_t(h[2],l.applyToVertex(h[2][0],h[2][1],h[2][2],u))),Z(O,h[0],s),Z(m,h[1],s),Z(A,h[2],s);let V=O[I]-R*O[p],w=O[P]-C*O[p],K=m[I]-R*m[p],G=m[P]-C*m[p],Q=A[I]-R*A[p],z=A[P]-C*A[p],q=Q*G-z*K,X=V*z-w*Q,$=K*w-G*V;if((q<0||X<0||$<0)&&(q>0||X>0||$>0))continue;let Y=q+X+$;if(Y===0)continue;let F=q*(N*O[p])+X*(N*m[p])+$*(N*A[p]);if(F*Math.sign(Y)<0)continue;let ft=F/Y;ft>=0&&c(ft,u,M?es(h):null)}}var Ze=L(),Je=L(),ts=L();function Be(s,t,i,e,a,r,o){return D(Lt,s,t,i),D(Rt,e,a,r),Vt(o,Lt,Rt),St(o,o),o}function es(s){return Z(Lt,s[1],s[0]),Z(Rt,s[2],s[0]),Vt(ct,Lt,Rt),St(ct,ct),ct}var Lt=L(),Rt=L();function ss(s,t){return D(t,1/s[0],1/s[1],1/s[2])}function is(s,t,i,e){return ns(s,t,i,e,1/0)}function ns(s,t,i,e,a){let r=(s[0]-e-t[0])*i[0],o=(s[3]+e-t[0])*i[0],l=Math.min(r,o),n=Math.max(r,o),c=(s[1]-e-t[1])*i[1],f=(s[4]+e-t[1])*i[1];if(n=Math.min(n,Math.max(c,f)),n<0||(l=Math.max(l,Math.min(c,f)),l>n))return!1;let h=(s[2]-e-t[2])*i[2],g=(s[5]+e-t[2])*i[2];return n=Math.min(n,Math.max(h,g)),!(n<0)&&(l=Math.max(l,Math.min(h,g)),!(l>n)&&l<a)}var rs=1e3,De=1e-7,Ue=L(),os=[L(),L(),L()];var ze;(function(s){s[s.INTEGRATED_MESH=0]="INTEGRATED_MESH",s[s.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",s[s.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",s[s.OPAQUE_MATERIAL_WITHOUT_NORMALS=3]="OPAQUE_MATERIAL_WITHOUT_NORMALS",s[s.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",s[s.TRANSPARENT_MATERIAL_WITHOUT_NORMALS=5]="TRANSPARENT_MATERIAL_WITHOUT_NORMALS",s[s.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",s[s.TRANSPARENT_MATERIAL_WITHOUT_DEPTH=7]="TRANSPARENT_MATERIAL_WITHOUT_DEPTH",s[s.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",s[s.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",s[s.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",s[s.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",s[s.HUD_MATERIAL=12]="HUD_MATERIAL",s[s.LABEL_MATERIAL=13]="LABEL_MATERIAL",s[s.LINE_CALLOUTS=14]="LINE_CALLOUTS",s[s.LINE_CALLOUTS_HUD_DEPTH=15]="LINE_CALLOUTS_HUD_DEPTH",s[s.OVERLAY=16]="OVERLAY",s[s.DRAPED_MATERIAL=17]="DRAPED_MATERIAL",s[s.DRAPED_WATER=18]="DRAPED_WATER",s[s.VOXEL=19]="VOXEL",s[s.MAX_SLOTS=20]="MAX_SLOTS"})(ze||(ze={}));var Fe=class{constructor(){this._transform=mt(),this._transformInverse=new ht({value:this._transform},re,mt),this._transformInverseTranspose=new ht(this._transformInverse,xt,mt),this._transformTranspose=new ht({value:this._transform},xt,mt),this._transformInverseRotation=new ht({value:this._transform},me,ce)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){Nt(this._transform,t)}multiplyTransform(t){oe(this._transform,this._transform,t)}set(t){Nt(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,i){this.setTransformMatrix(t),this.multiplyTransform(i),this._invalidateLazyTransforms()}},ht=class{constructor(t,i,e){this._original=t,this._update=i,this._dirty=!0,this._transform=e()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},kt=class{constructor(t=0){this.offset=t,this.tmpVertex=L()}applyToVertex(t,i,e){let a=D(Wt,t,i,e),r=j(ke,a,this.localOrigin),o=this.offset/tt(r);return nt(this.tmpVertex,a,r,o),this.tmpVertex}applyToAabb(t){let i=as,e=fs,a=ls;for(let n=0;n<3;++n)i[n]=t[0+n]+this.localOrigin[n],e[n]=t[3+n]+this.localOrigin[n],a[n]=i[n];let r=this.applyToVertex(i[0],i[1],i[2]);for(let n=0;n<3;++n)t[n]=r[n],t[n+3]=r[n];let o=n=>{let c=this.applyToVertex(n[0],n[1],n[2]);for(let f=0;f<3;++f)t[f]=Math.min(t[f],c[f]),t[f+3]=Math.max(t[f+3],c[f])};for(let n=1;n<8;++n){for(let c=0;c<3;++c)a[c]=n&1<<c?e[c]:i[c];o(a)}let l=0;for(let n=0;n<3;++n)i[n]*e[n]<0&&(l|=1<<n);if(l!==0&&l!==7){for(let n=0;n<8;++n)if(!(l&n)){for(let c=0;c<3;++c)a[c]=l&1<<c?0:n&1<<c?i[c]:e[c];o(a)}}for(let n=0;n<3;++n)t[n]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}},qt=class{constructor(t=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=L(),this._tmpMbs=Ft(),this._tmpObb=new _e,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=tt(t)}applyToVertex(t,i,e){let a=D(Wt,t,i,e),r=D(ke,t,i,e+this.componentLocalOriginLength),o=this._totalOffset/tt(r);return nt(this._tmpVertex,a,r,o),this._tmpVertex}applyToAabb(t){let i=this.componentLocalOriginLength,e=t[0],a=t[1],r=t[2]+i,o=t[3],l=t[4],n=t[5]+i,c=Math.abs(e),f=Math.abs(a),h=Math.abs(r),g=Math.abs(o),T=Math.abs(l),E=Math.abs(n),b=.5*(1+Math.sign(e*o))*Math.min(c,g),p=.5*(1+Math.sign(a*l))*Math.min(f,T),B=.5*(1+Math.sign(r*n))*Math.min(h,E),I=Math.max(c,g),P=Math.max(f,T),R=Math.max(h,E),C=Math.sqrt(b*b+p*p+B*B),N=Math.sign(c+e),O=Math.sign(f+a),m=Math.sign(h+r),A=Math.sign(g+o),M=Math.sign(T+l),u=Math.sign(E+n),d=this._totalOffset;if(C<d)return t[0]-=(1-N)*d,t[1]-=(1-O)*d,t[2]-=(1-m)*d,t[3]+=A*d,t[4]+=M*d,t[5]+=u*d,t;let _=d/Math.sqrt(I*I+P*P+R*R),y=d/C,S=y-_,V=-S;return t[0]+=e*(N*V+y),t[1]+=a*(O*V+y),t[2]+=r*(m*V+y),t[3]+=o*(A*S+_),t[4]+=l*(M*S+_),t[5]+=n*(u*S+_),t}applyToMbs(t){let i=tt(t),e=this._totalOffset/i;return nt(this._tmpMbs,t,t,e),this._tmpMbs[3]=t[3]+t[3]*this._totalOffset/i,this._tmpMbs}applyToObb(t){return Ee(t,this._totalOffset,this._totalOffset,Te.Global,this._tmpObb),this._tmpObb}},jt=class{constructor(t=0){this.offset=t,this.sphere=Ft(),this.tmpVertex=L()}applyToVertex(t,i,e){let a=this.objectTransform.transform,r=D(Wt,t,i,e),o=ut(r,r,a),l=this.offset/tt(o);nt(o,o,o,l);let n=this.objectTransform.inverse;return ut(this.tmpVertex,o,n),this.tmpVertex}applyToMinMax(t,i){let e=this.offset/tt(t);nt(t,t,t,e);let a=this.offset/tt(i);nt(i,i,i,a)}applyToAabb(t){let i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;let e=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*e,t[4]+=t[4]*e,t[5]+=t[5]*e,t}applyToBoundingSphere(t){let i=tt(t),e=this.offset/i;return nt(this.sphere,t,t,e),this.sphere[3]=t[3]+t[3]*this.offset/i,this.sphere}},He=new jt;function bi(s){return s!=null?(He.offset=s,He):null}var Ii=new qt;var Li=new kt;var Wt=L(),ke=L(),as=L(),fs=L(),ls=L();function vi(s,t,i,e=1){let{data:a,indices:r}=s,o=t.typedBuffer,l=t.typedBufferStride,n=r.length;if(i*=l,e===1)for(let c=0;c<n;++c)o[i]=a[r[c]],i+=l;else for(let c=0;c<n;++c){let f=a[r[c]];for(let h=0;h<e;h++)o[i]=f,i+=l}}function qe(s,t,i){let{data:e,indices:a}=s,r=t.typedBuffer,o=t.typedBufferStride,l=a.length;i*=o;for(let n=0;n<l;++n){let c=2*a[n];r[i]=e[c],r[i+1]=e[c+1],i+=o}}function je(s,t,i,e){let{data:a,indices:r}=s,o=t.typedBuffer,l=t.typedBufferStride,n=r.length;if(i*=l,e==null||e===1)for(let c=0;c<n;++c){let f=3*r[c];o[i]=a[f],o[i+1]=a[f+1],o[i+2]=a[f+2],i+=l}else for(let c=0;c<n;++c){let f=3*r[c];for(let h=0;h<e;++h)o[i]=a[f],o[i+1]=a[f+1],o[i+2]=a[f+2],i+=l}}function We(s,t,i,e=1){let{data:a,indices:r}=s,o=t.typedBuffer,l=t.typedBufferStride,n=r.length;if(i*=l,e===1)for(let c=0;c<n;++c){let f=4*r[c];o[i]=a[f],o[i+1]=a[f+1],o[i+2]=a[f+2],o[i+3]=a[f+3],i+=l}else for(let c=0;c<n;++c){let f=4*r[c];for(let h=0;h<e;++h)o[i]=a[f],o[i+1]=a[f+1],o[i+2]=a[f+2],o[i+3]=a[f+3],i+=l}}function Ci(s,t,i){let e=s.typedBuffer,a=s.typedBufferStride;t*=a;for(let r=0;r<i;++r)e[t]=0,e[t+1]=0,e[t+2]=0,e[t+3]=0,t+=a}function cs(s,t,i,e,a=1){if(!t)return void je(s,i,e,a);let{data:r,indices:o}=s,l=i.typedBuffer,n=i.typedBufferStride,c=o.length,f=t[0],h=t[1],g=t[2],T=t[4],E=t[5],b=t[6],p=t[8],B=t[9],I=t[10],P=t[12],R=t[13],C=t[14];e*=n;let N=0,O=0,m=0,A=Ct(t)?M=>{N=r[M]+P,O=r[M+1]+R,m=r[M+2]+C}:M=>{let u=r[M],d=r[M+1],_=r[M+2];N=f*u+T*d+p*_+P,O=h*u+E*d+B*_+R,m=g*u+b*d+I*_+C};if(a===1)for(let M=0;M<c;++M)A(3*o[M]),l[e]=N,l[e+1]=O,l[e+2]=m,e+=n;else for(let M=0;M<c;++M){A(3*o[M]);for(let u=0;u<a;++u)l[e]=N,l[e+1]=O,l[e+2]=m,e+=n}}function hs(s,t,i,e,a=1){if(!t)return void je(s,i,e,a);let{data:r,indices:o}=s,l=t,n=i.typedBuffer,c=i.typedBufferStride,f=o.length,h=l[0],g=l[1],T=l[2],E=l[4],b=l[5],p=l[6],B=l[8],I=l[9],P=l[10],R=!vt(l),C=1e-6,N=1-C;e*=c;let O=0,m=0,A=0,M=Ct(l)?u=>{O=r[u],m=r[u+1],A=r[u+2]}:u=>{let d=r[u],_=r[u+1],y=r[u+2];O=h*d+E*_+B*y,m=g*d+b*_+I*y,A=T*d+p*_+P*y};if(a===1)if(R)for(let u=0;u<f;++u){M(3*o[u]);let d=O*O+m*m+A*A;if(d<N&&d>C){let _=1/Math.sqrt(d);n[e]=O*_,n[e+1]=m*_,n[e+2]=A*_}else n[e]=O,n[e+1]=m,n[e+2]=A;e+=c}else for(let u=0;u<f;++u)M(3*o[u]),n[e]=O,n[e+1]=m,n[e+2]=A,e+=c;else for(let u=0;u<f;++u){if(M(3*o[u]),R){let d=O*O+m*m+A*A;if(d<N&&d>C){let _=1/Math.sqrt(d);O*=_,m*=_,A*=_}}for(let d=0;d<a;++d)n[e]=O,n[e+1]=m,n[e+2]=A,e+=c}}function us(s,t,i,e,a=1){if(!t)return void We(s,i,e,a);let{data:r,indices:o}=s,l=t,n=i.typedBuffer,c=i.typedBufferStride,f=o.length,h=l[0],g=l[1],T=l[2],E=l[4],b=l[5],p=l[6],B=l[8],I=l[9],P=l[10],R=!vt(l),C=1e-6,N=1-C;if(e*=c,a===1)for(let O=0;O<f;++O){let m=4*o[O],A=r[m],M=r[m+1],u=r[m+2],d=r[m+3],_=h*A+E*M+B*u,y=g*A+b*M+I*u,S=T*A+p*M+P*u;if(R){let V=_*_+y*y+S*S;if(V<N&&V>C){let w=1/Math.sqrt(V);_*=w,y*=w,S*=w}}n[e]=_,n[e+1]=y,n[e+2]=S,n[e+3]=d,e+=c}else for(let O=0;O<f;++O){let m=4*o[O],A=r[m],M=r[m+1],u=r[m+2],d=r[m+3],_=h*A+E*M+B*u,y=g*A+b*M+I*u,S=T*A+p*M+P*u;if(R){let V=_*_+y*y+S*S;if(V<N&&V>C){let w=1/Math.sqrt(V);_*=w,y*=w,S*=w}}for(let V=0;V<a;++V)n[e]=_,n[e+1]=y,n[e+2]=S,n[e+3]=d,e+=c}}function ms(s,t,i,e,a=1){let{data:r,indices:o}=s,l=i.typedBuffer,n=i.typedBufferStride,c=o.length;if(e*=n,t!==r.length||t!==4)if(a!==1)if(t!==4)for(let f=0;f<c;++f){let h=3*o[f];for(let g=0;g<a;++g)l[e]=r[h],l[e+1]=r[h+1],l[e+2]=r[h+2],l[e+3]=255,e+=n}else for(let f=0;f<c;++f){let h=4*o[f];for(let g=0;g<a;++g)l[e]=r[h],l[e+1]=r[h+1],l[e+2]=r[h+2],l[e+3]=r[h+3],e+=n}else{if(t===4){for(let f=0;f<c;++f){let h=4*o[f];l[e]=r[h],l[e+1]=r[h+1],l[e+2]=r[h+2],l[e+3]=r[h+3],e+=n}return}for(let f=0;f<c;++f){let h=3*o[f];l[e]=r[h],l[e+1]=r[h+1],l[e+2]=r[h+2],l[e+3]=255,e+=n}}else{l[e]=r[0],l[e+1]=r[1],l[e+2]=r[2],l[e+3]=r[3];let f=new Uint32Array(i.typedBuffer.buffer,i.start),h=n/4,g=f[e/=4];e+=h;let T=c*a;for(let E=1;E<T;++E)f[e]=g,e+=h}}function ps(s,t,i){let{data:e,indices:a}=s,r=t.typedBuffer,o=t.typedBufferStride,l=a.length,n=e[0];i*=o;for(let c=0;c<l;++c)r[i]=n,i+=o}function ds(s,t,i,e,a=1){let r=t.typedBuffer,o=t.typedBufferStride;if(e*=o,a===1)for(let l=0;l<i;++l)r[e]=s[0],r[e+1]=s[1],r[e+2]=s[2],r[e+3]=s[3],e+=o;else for(let l=0;l<i;++l)for(let n=0;n<a;++n)r[e]=s[0],r[e+1]=s[1],r[e+2]=s[2],r[e+3]=s[3],e+=o}function Ke(s,t,i,e,a,r,o){for(let l of i.fields.keys()){let n=s.get(l),c=n?.indices;if(n&&c)gs(l,n,e,a,r,o);else if(l===x.OBJECTANDLAYERIDCOLOR&&t!=null){let f=s.get(x.POSITION)?.indices;if(f){let h=f.length;ds(t,r.getField(l,Ut),h,o)}}}}function gs(s,t,i,e,a,r){switch(s){case x.POSITION:{v(t.size===3);let o=a.getField(s,pt);v(!!o,`No buffer view for ${s}`),o&&cs(t,i,o,r);break}case x.NORMAL:{v(t.size===3);let o=a.getField(s,pt);v(!!o,`No buffer view for ${s}`),o&&hs(t,e,o,r);break}case x.NORMALCOMPRESSED:{v(t.size===2);let o=a.getField(s,ge);v(!!o,`No buffer view for ${s}`),o&&qe(t,o,r);break}case x.UV0:{v(t.size===2);let o=a.getField(s,de);v(!!o,`No buffer view for ${s}`),o&&qe(t,o,r);break}case x.COLOR:case x.SYMBOLCOLOR:{let o=a.getField(s,Ut);v(!!o,`No buffer view for ${s}`),v(t.size===3||t.size===4),!o||t.size!==3&&t.size!==4||ms(t,t.size,o,r);break}case x.COLORFEATUREATTRIBUTE:{let o=a.getField(s,pe);v(!!o,`No buffer view for ${s}`),v(t.size===1),o&&t.size===1&&ps(t,o,r);break}case x.TANGENT:{v(t.size===4);let o=a.getField(s,Dt);v(!!o,`No buffer view for ${s}`),o&&us(t,i,o,r);break}case x.PROFILERIGHT:case x.PROFILEUP:case x.PROFILEVERTEXANDNORMAL:case x.FEATUREVALUE:{v(t.size===4);let o=a.getField(s,Dt);v(!!o,`No buffer view for ${s}`),o&&We(t,o,r)}}}var Ge=class{constructor(t){this.vertexBufferLayout=t}elementCount(t){return t.get(x.POSITION).indices.length}write(t,i,e,a,r,o){Ke(e,a,this.vertexBufferLayout,t,i,r,o)}intersect(t,i,e,a,r){let o=this.vertexBufferLayout.createView(t).getField(x.POSITION,pt);if(o==null)return;let l=Z(Os,a,e),n=0,c=o.elementCount/3,f=i.options.normalRequired,h=(g,T,E)=>{r(g,E,T,!1)};Ve(e,l,n,c,o.typedBuffer,o.typedBufferStride,f,h)}},Os=L();var qi={func:J.LESS},ji={func:J.ALWAYS},Wi={mask:255},Ki={mask:0};var Gi={function:{func:J.ALWAYS,ref:st.OutlineVisualElementMask,mask:st.OutlineVisualElementMask},operation:{fail:H.KEEP,zFail:H.KEEP,zPass:H.ZERO}},Qi={function:{func:J.ALWAYS,ref:st.OutlineVisualElementMask,mask:st.OutlineVisualElementMask},operation:{fail:H.KEEP,zFail:H.KEEP,zPass:H.REPLACE}},Yi={function:{func:J.EQUAL,ref:st.OutlineVisualElementMask,mask:st.OutlineVisualElementMask},operation:{fail:H.KEEP,zFail:H.KEEP,zPass:H.KEEP}},Xi={function:{func:J.NOTEQUAL,ref:st.OutlineVisualElementMask,mask:st.OutlineVisualElementMask},operation:{fail:H.KEEP,zFail:H.KEEP,zPass:H.KEEP}};export{Re as a,Et as b,bt as c,xe as d,ve as e,Ys as f,Xs as g,$s as h,Zs as i,Ye as j,Js as k,ti as l,ei as m,Ht as n,li as o,ci as p,is as q,ze as r,Fe as s,bi as t,vi as u,We as v,Ci as w,cs as x,hs as y,ms as z,ds as A,Ke as B,gs as C,Ge as D,qi as E,ji as F,Wi as G,Ki as H,Gi as I,Qi as J,Yi as K,Xi as L};
