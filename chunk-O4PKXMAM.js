import{a as d}from"./chunk-FYZRIMPP.js";import{b as N}from"./chunk-74LTYPBC.js";import{a as g,d as E,e as x,f as P}from"./chunk-LNVVFNTC.js";import{i as S,r as Z,t as q}from"./chunk-IB2IUO7T.js";import{g as T}from"./chunk-QDTU3MWT.js";import{f as y,h as A,i as k}from"./chunk-NTVLK3P2.js";import{F as f,G as h,la as j,p as u,t as _,y as c}from"./chunk-IG66NQHW.js";import{a as F}from"./chunk-WUA6PW3I.js";import{N as B}from"./chunk-D2LVMNOU.js";import{t as M}from"./chunk-HHDFN2GK.js";import{t as z}from"./chunk-47GHT6OF.js";import{f as l}from"./chunk-VTHXE323.js";var R=[0,0];function O(e,i){if(!i)return null;if("x"in i){let n={x:0,y:0};return[n.x,n.y]=e(i.x,i.y,R),i.z!=null&&(n.z=i.z),i.m!=null&&(n.m=i.m),n}if("xmin"in i){let n={xmin:0,ymin:0,xmax:0,ymax:0};return[n.xmin,n.ymin]=e(i.xmin,i.ymin,R),[n.xmax,n.ymax]=e(i.xmax,i.ymax,R),i.hasZ&&(n.zmin=i.zmin,n.zmax=i.zmax,n.hasZ=!0),i.hasM&&(n.mmin=i.mmin,n.mmax=i.mmax,n.hasM=!0),n}return"rings"in i?{rings:U(i.rings,e),hasM:i.hasM,hasZ:i.hasZ}:"paths"in i?{paths:U(i.paths,e),hasM:i.hasM,hasZ:i.hasZ}:"points"in i?{points:D(i.points,e),hasM:i.hasM,hasZ:i.hasZ}:null}function U(e,i){let n=[];for(let t of e)n.push(D(t,i));return n}function D(e,i){let n=[];for(let t of e){let r=i(t[0],t[1],[0,0]);n.push(r),t.length>2&&r.push(t[2]),t.length>3&&r.push(t[3])}return n}function b(e,i){return l(this,null,function*(){if(!e||!i)return;let n=Array.isArray(e)?e.map(t=>t.geometry!=null?t.geometry.spatialReference:null).filter(z):[e];yield q(n.map(t=>({source:t,dest:i})))})}var J=O.bind(null,A),L=O.bind(null,k);function v(e,i,n,t){if(!e)return null;if(n||(n=i,i=e.spatialReference),!f(i)||!f(n)||u(i,n))return e;if(y(i,n)){let r=c(n)?J(e):L(e);return r.spatialReference=n,r}return S(d,[e],i,n,null,t)[0]}var w=class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}push(i,n,t,r){return l(this,null,function*(){if(!i?.length||!n||!t||u(n,t))return i;let s={geometries:i,inSpatialReference:n,outSpatialReference:t,geographicTransformation:r,resolve:B()};return this._jobs.push(s),this._timer??=setTimeout(this._process,10),s.resolve.promise})}_process(){this._timer=null;let i=this._jobs.shift();if(!i)return;let{geometries:n,inSpatialReference:t,outSpatialReference:r,resolve:s,geographicTransformation:o}=i;y(t,r)?c(r)?s(n.map(J)):s(n.map(L)):s(S(d,n,t,r,o,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}},W=new w;function re(e,i,n,t){return W.push(e,i,n,t)}var G=new F({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),I=Object.freeze({}),K="frequency";function ge(e,i,n){return l(this,null,function*(){let t=e.bin;return t.onField&&(t.onField=t.onField.trim()),t.onExpression?.value&&(t.onExpression.value=t.onExpression.value.trim()),t.splitBy&&(t.splitBy.value&&(t.splitBy.value=t.splitBy.value.trim()),t.splitBy.outAlias&&(t.splitBy.outAlias=t.splitBy.outAlias.trim())),t.stackBy&&(t.stackBy.value&&(t.stackBy.value=t.stackBy.value.trim()),t.stackBy.outAlias&&(t.stackBy.outAlias=t.stackBy.outAlias.trim())),"normalizationField"in t.parameters&&t.parameters.normalizationField&&(t.parameters.normalizationField=t.parameters.normalizationField.trim()),e.outStatistics?.length||(e.outStatistics=[{statisticType:"count",onStatisticField:"1",outStatisticFieldName:K}]),$(e,i,n)})}function $(e,i,n){return l(this,null,function*(){let{outFields:t,orderByFields:r,groupByFieldsForStatistics:s,outStatistics:o}=e;if(t)for(let a=0;a<t.length;a++)t[a]=t[a].trim();if(r)for(let a=0;a<r.length;a++)r[a]=r[a].trim();if(s)for(let a=0;a<s.length;a++)s[a]=s[a].trim();if(o)for(let a=0;a<o.length;a++)o[a].onStatisticField&&(o[a].onStatisticField=o[a].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),C(e,i,n)})}function C(e,i,n){return l(this,null,function*(){if(!e)return null;let{where:t}=e;if(e.where=t=t?.trim(),(!t||/^1 *= *1$/.test(t)||i&&i===t)&&(e.where=null),!e.geometry)return e;let r=yield X(e);if(e.distance=0,e.units=null,e.spatialRel==="esriSpatialRelEnvelopeIntersects"){let{spatialReference:s}=e.geometry;r=T(r),r.spatialReference=s}if(r){yield b(r.spatialReference,n),r=V(r,n);let s=(yield N(P(r)))[0];if(s==null)throw I;let o="quantizationParameters"in e&&e.quantizationParameters?.tolerance||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,a=o&&Q(r,n)?{densificationStep:8*o}:void 0,m=s.toJSON(),p=v(m,m.spatialReference,n,a);if(!p)throw I;p.spatialReference=n,e.geometry=p}return e})}function Q(e,i){if(!e)return!1;let n=e.spatialReference;return(g(e)||x(e)||E(e))&&!u(n,i)&&!Z(n,i)}function V(e,i){let n=e.spatialReference;return Q(e,i)&&g(e)?{spatialReference:n,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}function X(e){return l(this,null,function*(){let{distance:i,units:n}=e,t=e.geometry;if(i==null||"vertexAttributes"in t)return t;let r=t.spatialReference,s=n?G.fromJSON(n):j(r),o=r&&(_(r)||c(r))?t:yield b(r,h).then(()=>v(t,h)),a=yield import("./chunk-DZERRVH4.js");yield a.load();let m=a.execute(o,i||1,{unit:s})??void 0;if(!m||!x(m)||m.rings.length===0)throw new M("unsupported-query:invalid-parameters","Invalid parameters for query by distance");return m})}function xe(e,i){return e==null?null:typeof e=="string"?i?new Date(`1970-01-01T${e}Z`).getTime():new Date(e).getTime():e instanceof Date?e.getTime():e}export{b as a,v as b,re as c,G as d,I as e,ge as f,$ as g,C as h,xe as i};
