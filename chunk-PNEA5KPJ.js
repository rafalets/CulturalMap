import{b as O}from"./chunk-WOGTXK7W.js";import{b as M}from"./chunk-WPDP647R.js";import{a as k}from"./chunk-4E4FE2IX.js";import{J as T,l as P}from"./chunk-HKHTIKVW.js";import{v as j}from"./chunk-IG66NQHW.js";import{t as w}from"./chunk-HHDFN2GK.js";import{i as h}from"./chunk-VTHXE323.js";var x={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function S(e){return x[e]}function*L(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(let t of e.features)t&&(yield t)}}function*z(e){if(e)switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*h(e.coordinates);break;case"MultiLineString":case"Polygon":for(let t of e.coordinates)yield*h(t);break;case"MultiPolygon":for(let t of e.coordinates)for(let o of t)yield*h(o)}}function*C(e,t={}){let{geometryType:o,objectIdField:n}=t;for(let r of e){let{geometry:c,properties:p,id:i}=r;if(c&&S(c.type)!==o)continue;let f=p||{},u;n&&(u=f[n],i==null||u||(f[n]=u=i)),yield new M(c?A(new k,c,t):null,f,null,u)}}function R(e){for(let t of e)if(t.length>2)return!0;return!1}function $(e){return!N(e)}function v(e){return N(e)}function N(e){let t=0;for(let o=0;o<e.length;o++){let n=e[o],r=e[(o+1)%e.length];t+=n[0]*r[1]-r[0]*n[1]}return t<=0}function I(e){let t=e[0],o=e[e.length-1];return t[0]===o[0]&&t[1]===o[1]&&t[2]===o[2]||e.push(t),e}function A(e,t,o){switch(t.type){case"LineString":return Z(e,t,o);case"MultiLineString":return H(e,t,o);case"MultiPoint":return W(e,t,o);case"MultiPolygon":return q(e,t,o);case"Point":return B(e,t,o);case"Polygon":return K(e,t,o)}}function Z(e,t,o){return d(e,t.coordinates,o),e}function H(e,t,o){for(let n of t.coordinates)d(e,n,o);return e}function W(e,t,o){return d(e,t.coordinates,o),e}function q(e,t,o){for(let n of t.coordinates){D(e,n[0],o);for(let r=1;r<n.length;r++)E(e,n[r],o)}return e}function B(e,t,o){return F(e,t.coordinates,o),e}function K(e,t,o){let n=t.coordinates;D(e,n[0],o);for(let r=1;r<n.length;r++)E(e,n[r],o);return e}function D(e,t,o){let n=I(t);$(n)?J(e,n,o):d(e,n,o)}function E(e,t,o){let n=I(t);v(n)?J(e,n,o):d(e,n,o)}function d(e,t,o){for(let n of t)F(e,n,o);e.lengths.push(t.length)}function J(e,t,o){for(let n=t.length-1;n>=0;n--)F(e,t[n],o);e.lengths.push(t.length)}function F(e,t,o){let[n,r,c]=t;e.coords.push(n,r),o.hasZ&&e.coords.push(c||0)}function Q(e){switch(typeof e){case"string":return O(e)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function te(e,t=4326){if(!e)throw new w("geojson-layer:empty","GeoJSON data is empty");if(e.type!=="Feature"&&e.type!=="FeatureCollection")throw new w("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});let{crs:o}=e;if(!o)return;let n=typeof o=="string"?o:o.type==="name"?o.properties.name:o.type==="EPSG"?o.properties.code:null,r=j({wkid:t})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${t})$`,"i");if(!n||!r.test(n))throw new w("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:o})}function oe(e,t={}){let o=[],n=new Set,r=new Set,c,p=!1,i=null,f=!1,{geometryType:u=null}=t;for(let y of L(e)){let{geometry:m,properties:l,id:a}=y;if((!m||(u||(u=S(m.type)),S(m.type)===u))&&(p||(p=R(z(m))),f||(f=a!=null,f&&(c=typeof a,l&&(i=Object.keys(l).filter(s=>l[s]===a)))),l&&i&&f&&a!=null&&(i.length>1?i=i.filter(s=>l[s]===a):i.length===1&&(i=l[i[0]]===a?i:[])),l))for(let s in l){if(n.has(s))continue;let b=Q(l[s]);if(b==="unknown"){r.add(s);continue}r.delete(s),n.add(s);let G=P(s);G&&o.push({name:G,alias:s,type:b})}}let g=P(i?.length===1&&i[0]||null)??void 0;if(g){for(let y of o)if(y.name===g&&T(y)){y.type="esriFieldTypeOID";break}}return{fields:o,geometryType:u,hasZ:p,objectIdFieldName:g,objectIdFieldType:c,unknownFields:Array.from(r)}}function ne(e,t){return Array.from(C(L(e),t))}export{S as a,te as b,oe as c,ne as d};
