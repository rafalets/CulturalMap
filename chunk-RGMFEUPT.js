import{a as N,la as P,o as G}from"./chunk-UNRRVLTB.js";import{b as m,g as C,o as S,s as V,tb as x}from"./chunk-JLMESEWM.js";function T(){return y(new x,-1,Number.NaN)}function y(r,e,n){return{m_coordinate:r.clone(),m_vertexIndex:e,m_geometryIndex:0,m_distance:n,m_bRightSide:!1,isEmpty:R}}function R(){return Number.isNaN(this.m_distance)}function b(r,e,n=-1,s=-1){if(r.isEmpty())return 3;let t=r.getGeometryType();if(C(t))return q(r,e,n,s);if(t===m.enumPolygon)return E(r,e,n,s);if(t===m.enumPolyline)return A(r,e,n,s);if(t===m.enumEnvelope){let o=new N;return r.queryEnvelope(o),o.contains(e)?o.containsExclusive(e)?1:2:0}return 3}function q(r,e,n,s){if(n>=0||s>=0)return S("");if(r.isDegenerate(0))return r.getStartXY().equals(e)?2:3;if(!r.isCurve()){let c=x.orientationRobust(e,r.getStartXY(),r.getEndXY());return c<0?1:c>0?0:2}let t=r.getClosestCoordinate(e,!1),o=r.getTangent(t),u=r.getCoord2D(t),a=x.orientationRobust(e,u,u.add(o));return a<0?1:a>0?0:2}function E(r,e,n,s){(n>=0||s>=0)&&S("");let t=new N;r.queryEnvelope(t);let o=P(r,e,0);return o===0?0:o===1?1:2}function A(r,e,n,s){(n<0&&s>=0||n>=0&&s<0)&&S("");let t=r.querySegmentIterator();if(n<0){let u=Number.MAX_VALUE,a=0;for(;t.nextPath();)for(;t.hasNextSegment();){let c=t.nextSegment(),i=c.getClosestCoordinate(e,!1),g=c.getCoord2D(i),d=x.sqrDistance(g,e);d<u?(a=1,n=t.getStartPointIndex(),s=t.getPathIndex(),u=d):d===u&&a++}if(a===0)return 3;if(a===1)return t.resetToVertex(n,s),b(t.nextSegment(),e)}let o=w(e,t,n,s);if(o.i1!==-1&&o.i2===-1)return o.bRight1?1:0;if(o.i1!==-1&&o.i2!==-1){if(o.bRight1===o.bRight2)return o.bRight1?1:0;{t.resetToVertex(o.i1,-1);let u=t.nextSegment().getTangent(1);t.resetToVertex(o.i2,-1);let a=t.nextSegment().getTangent(0);return u.crossProduct(a)>=0?1:0}}return t.resetToVertex(n,s),b(t.nextSegment(),e)}function v(r,e,n){for(r.resetToVertex(e,n);r.hasNextSegment();)if(!r.nextSegment().isDegenerate(0))return r.getStartPointIndex();for(r.resetToVertex(e,n);r.hasPreviousSegment();)if(!r.previousSegment().isDegenerate(0))return r.getStartPointIndex();return-1}function X(r,e){for(r.resetToVertex(e,-1),r.nextSegment();r.hasNextSegment();)if(!r.nextSegment().isDegenerate(0))return r.getStartPointIndex();return-1}function _(r,e){for(r.resetToVertex(e,-1);r.hasPreviousSegment();)if(!r.previousSegment().isDegenerate(0))return r.getStartPointIndex();return-1}function w(r,e,n,s){let t={i1:-1,i2:-1,bRight1:!1,bRight2:!1};if(t.i1=v(e,n,s),t.i1!==-1){e.resetToVertex(t.i1,-1);let o=e.nextSegment(),u=o.getClosestCoordinate(r,!1),a=o.getCoord2D(u),c=x.sqrDistance(a,r);{let i=a.clone();i.subThis(o.getStartXY());let g=r.clone();g.subThis(o.getStartXY()),t.bRight1=i.crossProduct(g)<0}if(t.i2=X(e,t.i1),t.i2!==-1){e.resetToVertex(t.i2,-1);let i=e.nextSegment(),g=i.getClosestCoordinate(r,!1),d=i.getCoord2D(g);if(x.sqrDistance(d,r)>c)t.i2=-1;else{let f=d.clone();f.subThis(i.getStartXY());let l=r.clone();l.subThis(i.getStartXY()),t.bRight2=f.crossProduct(l)<0}}if(t.i2===-1&&(t.i2=_(e,t.i1),t.i2!==-1)){e.resetToVertex(t.i2,-1);let i=e.nextSegment(),g=i.getClosestCoordinate(r,!1),d=i.getCoord2D(g);if(x.sqrDistance(d,r)>c)t.i2=-1;else{let f=d.clone();f.subThis(i.getStartXY());let l=r.clone();l.subThis(i.getStartXY()),t.bRight2=f.crossProduct(l)<0;let h=t.i1;t.i1=t.i2,t.i2=h;let p=t.bRight1;t.bRight1=t.bRight2,t.bRight2=p}}}return t}var D=class{getOperatorType(){return 10500}accelerateGeometry(e,n,s){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}getNearestCoordinate(e,n,s,t){if(n.isNAN()&&S("NAN xy coordinates are not allowed"),e.isEmpty())return T();switch(e.getGeometryType()){case m.enumPoint:return this.pointGetNearestVertex(e,n);case m.enumMultiPoint:return this.multiVertexGetNearestVertex(e,n);case m.enumPolyline:case m.enumPolygon:return this.multiPathGetNearestCoordinate(e,n,s,t);default:V("")}}getNearestVertex(e,n){if(n.isNAN()&&S("NAN xy coordinates are not allowed"),e.isEmpty())return T();switch(e.getGeometryType()){case m.enumPoint:return this.pointGetNearestVertex(e,n);case m.enumMultiPoint:case m.enumPolyline:case m.enumPolygon:return this.multiVertexGetNearestVertex(e,n);default:V("")}}getNearestVertices(e,n,s,t){if(t===0&&S(""),n.isNAN()&&S("NAN xy coordinates are not allowed"),e.isEmpty())return[];switch(e.getGeometryType()){case m.enumPoint:return this.pointGetNearestVertices(e,n,s,t);case m.enumMultiPoint:case m.enumPolyline:case m.enumPolygon:return this.multiVertexGetNearestVertices(e,n,s,t);default:V("")}}multiPathGetNearestCoordinate(e,n,s,t){if(e.getGeometryType()===m.enumPolygon&&s){let f=new N;e.queryEnvelope(f);let l=G(null,f,!1),h;if(h=P(e,n,t?0:l),h!==0){let p=y(n,-1,0);return t&&(p.m_bRightSide=!0),p}}let o=e.querySegmentIterator(),u=new x,a=-1,c=-1,i=Number.MAX_VALUE,g=0;for(;o.nextPath();)for(;o.hasNextSegment();){let f=o.nextSegment(),l=f.getClosestCoordinate(n,!1),h=f.getCoord2D(l),p=x.sqrDistance(h,n);p<i?(g=1,u.assign(h),a=o.getStartPointIndex(),c=o.getPathIndex(),i=p):p===i&&g++}a===-1&&S("");let d=y(u,a,Math.sqrt(i));if(t)if(e.getGeometryType()!==m.enumPolygon){let f=!1;if(g>1){let l=b(e,n,a,c);f=l!==0&&l!==3}else{o.resetToVertex(a,c);let l=o.nextSegment();f=b(l,n)!==0}d.m_bRightSide=f}else s||P(e,n,0)!==0&&(d.m_bRightSide=!0);return d}pointGetNearestVertex(e,n){let s=e.getXY(),t=x.distance(s,n);return y(s,0,t)}multiVertexGetNearestVertex(e,n){let s=e.getAttributeStreamRef(0),t=e.getPointCount(),o=-1,u=new x,a=Number.MAX_VALUE,c=new x;for(let i=0;i<t;i++){s.queryPoint2D(2*i,c);let g=x.sqrDistance(c,n);g<a&&(u.assign(c),o=i,a=g)}return y(u,o,Math.sqrt(a))}pointGetNearestVertices(e,n,s,t){let o=[];if(t!==0){let u=s*s,a=e.getXY(),c=x.sqrDistance(a,n);c<=u&&o.push(y(a,0,Math.sqrt(c)))}return o}multiVertexGetNearestVertices(e,n,s,t){let o=[];if(t!==0){let u=e.getAttributeStreamRef(0),a=e.getPointCount();o.length=t+1;let c=s*s;for(let i=0;i<a;i++){let g=u.read(2*i),d=u.read(2*i+1),f=n.x-g,l=n.y-d,h=f*f+l*l;h<=c&&o.push(y(x.construct(g,d),i,Math.sqrt(h)))}o.sort((i,g)=>i.m_distance-g.m_distance)}return o.slice(0,t)}};export{D as a};
