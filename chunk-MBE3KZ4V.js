import{b as i}from"./chunk-EWGQ3XHW.js";import{j as y}from"./chunk-X7QUUHRV.js";import{b as p}from"./chunk-EKMHQEJY.js";import{e as c,t as o,v as f}from"./chunk-U4J5SECU.js";import{o as u}from"./chunk-D2LVMNOU.js";function C(e){return e.portalItem?.type==="Web Scene"||e.referenceLayers.some(a=>a.type==="scene")}function E(e){return!!e?.portalItem?.tags?.some(a=>a.toLowerCase()==="beta")}function W(e,a){return!(!e.basemap?.referenceLayers?.some(t=>t.uid===a)&&!e.basemap?.baseLayers?.some(t=>t.uid===a))}var m;function R(e){if(m)return m(e);let a=null,t=s(e),n=!t?.baseLayers.length;for(let r in i){let l=g(t,I(i[r]),{mustMatchReferences:n});if(l==="equal"){a=r;break}l==="base-layers-equal"&&(a=r)}return a}function K(e,a){return e===a||e?.portalItem?.id!=null&&e.portalItem.id===a?.portalItem?.id?!0:g(s(e),s(a),{mustMatchReferences:!0})==="equal"}function N(e){return!!e?.baseLayers.concat(e.referenceLayers).some(q)}function q(e){if(b(e.url))return!0;if(e.type==="vector-tile")for(let a in e.sourceNameToSource){let t=e.sourceNameToSource[a];if(b(t?.sourceUrl))return!0}return!1}function j(e,a){if(a==null||e==null)return{spatialReference:null,updating:!1};if(a.loadStatus==="not-loaded")return a.load(),{spatialReference:null,updating:!0};if(a.spatialReference)return{spatialReference:a.spatialReference,updating:!1};if(a.baseLayers.length===0)return{spatialReference:null,updating:!1};let t=a.baseLayers.at(0);switch(t.loadStatus){case"not-loaded":t.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}let n=(("supportedSpatialReferences"in t?t.supportedSpatialReferences:null)||["tileInfo"in t?t.tileInfo?.spatialReference:t.spatialReference]).filter(Boolean),r=e.spatialReference;return r?{spatialReference:n.find(l=>r.equals(l))??n[0]??null,updating:!1}:{spatialReference:n[0],updating:!1}}var T=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function b(e){if(!e)return!1;let a=new c(o(e));return!!a.authority&&T.test(a.authority)}function s(e){return e?!e.loaded&&e.resourceInfo?I(e.resourceInfo.data):{baseLayers:d(e.baseLayers),referenceLayers:d(e.referenceLayers)}:null}function d(e){return(p.isCollection(e)?e.toArray():e).map(w)}function w(e){return{type:e.type,effect:"effect"in e?e.effect:void 0,url:h("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||e.sublayers==null?void 0:e.sublayers?.map(a=>({id:a.id,visible:a.visible})),activeLayerId:e.type==="wmts"?e.activeLayer?.id:void 0}}function L(e){return e.isReference||e.layerType==="ArcGISSceneServiceLayer"}function I(e){return e?{baseLayers:v((e.baseMapLayers??[]).filter(a=>!L(a))),referenceLayers:v((e.baseMapLayers??[]).filter(a=>L(a)))}:null}function v(e){return e.map(a=>B(a))}function B(e){let a;switch(e.layerType){case"VectorTileLayer":a="vector-tile";break;case"ArcGISTiledMapServiceLayer":a="tile";break;case"ArcGISSceneServiceLayer":a="scene";break;default:a="unknown"}return{type:a,effect:e.effect,url:h(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function g(e,a,t){return e!=null!=(a!=null)?"not-equal":!e||!a?"equal":S(e.baseLayers,a.baseLayers)?S(e.referenceLayers,a.referenceLayers)?"equal":t.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal"}function S(e,a){if(e.length!==a.length)return!1;for(let t=0;t<e.length;t++)if(!U(e[t],a[t]))return!1;return!0}function U(e,a){if(e.type!==a.type||e.url!==a.url||e.minScale!==a.minScale||e.maxScale!==a.maxScale||e.visible!==a.visible||e.opacity!==a.opacity||!y(e.effect,a.effect))return!1;if(e.activeLayerId!=null||a.activeLayerId!=null)return e.activeLayerId===a.activeLayerId;if(e.sublayers!=null||a.sublayers!=null){if(e.sublayers==null||a.sublayers==null||e.sublayers.length!==a.sublayers.length)return!1;for(let t=0;t<e.sublayers.length;t++){let n=e.sublayers.at(t),r=a.sublayers.at(t);if(n?.id!==r?.id||n?.visible!==r?.visible)return!1}}return!0}function h(e){return e?f(e).replace(/^\s*https?:/i,"").toLowerCase():""}function z(e){if(!e)return null;let{thumbnailUrl:a}=e;if(a)return a;let t=R(e);return t?i[t].thumbnailUrl:u(e.baseLayers,x)}function x(e){return"portalItem"in e?e.portalItem?.thumbnailUrl:void 0}export{C as a,E as b,W as c,K as d,N as e,q as f,j as g,z as h};
