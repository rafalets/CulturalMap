import{a as b}from"./chunk-FXCL7YYQ.js";import{g as v}from"./chunk-LB5YQINJ.js";import{b as g}from"./chunk-EKMHQEJY.js";import{a as y}from"./chunk-ISSJ3A6Y.js";import{H as d,d as i}from"./chunk-C7INQGWT.js";import{H as c}from"./chunk-WMHJC7XF.js";import{D as p,M as u}from"./chunk-D2LVMNOU.js";import{a}from"./chunk-QGVBCWUY.js";import{r as m}from"./chunk-HHDFN2GK.js";import{f as l}from"./chunk-VTHXE323.js";var n=new g,o=new WeakMap;function I(r){T(r)&&n.push(new WeakRef(r))}function w(r){let e=n.find(s=>s.deref()===r);e&&n.remove(e)}function T(r){return r!=null&&typeof r=="object"&&"refreshInterval"in r&&"refresh"in r}function L(r,e){return Number.isFinite(r)&&Number.isFinite(e)?e<=0?r:L(e,r%e):0}var h=0,f=0;function C(){let r=Date.now(),e=!1;for(let s of n){let t=s.deref();t?t.refreshInterval&&r-(o.get(t)??0)+5>=6e4*t.refreshInterval&&(o.set(t,r),t.refresh(r)):e=!0}if(e)for(let s=n.length-1;s>=0;s--)n.at(s).deref()||n.removeAt(s)}d(()=>{let r=Date.now(),e=0;for(let s of n){let t=s.deref();t&&(e=L(Math.round(6e4*t.refreshInterval),e),t.refreshInterval?o.get(t)||o.set(t,r):o.delete(t))}if(e!==f){if(f=e,clearInterval(h),f===0)return void(h=0);h=setInterval(C,f)}},v);var R=.1,q=r=>{let e=class extends r{constructor(...s){super(...s),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=u(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||I(this)},()=>{})}destroy(){w(this)}castRefreshInterval(s){return s>=R?s:s<=0?0:R}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(s=Date.now()){p(this._debounceHasDataChanged()).then(t=>{t&&this._set("refreshTimestamp",s),this.emit("refresh",{dataChanged:t})},t=>{m.getLogger(this).error(t),this.emit("refresh",{dataChanged:!1,error:t})})}hasDataChanged(){return l(this,null,function*(){return!0})}get test(){}};return a([i({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:b}}}}})],e.prototype,"refreshInterval",void 0),a([y("refreshInterval")],e.prototype,"castRefreshInterval",null),a([i({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),a([i({readOnly:!0})],e.prototype,"refreshParameters",null),e=a([c("esri.layers.mixins.RefreshableLayer")],e),e};export{q as a};
