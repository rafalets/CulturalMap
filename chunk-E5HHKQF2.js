import{a as q}from"./chunk-PLIWVXAW.js";import{a as F}from"./chunk-7QY3BMVN.js";import{b as k,c as T}from"./chunk-WPDP647R.js";import{a as y}from"./chunk-4E4FE2IX.js";import{ga as f,p as b}from"./chunk-IG66NQHW.js";import{t as h}from"./chunk-HHDFN2GK.js";var d=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],I=class{constructor(e){this._options=e,this.geometryTypes=d,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new F}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e?.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||b(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;let a=f(this._options.sourceSpatialReference)/f(e.spatialReference);if(a!==1)for(let n of e.features){if(!T(n))continue;let s=n.geometry.coords;for(let r=2;r<s.length;r+=3)s[r]*=a}}addFeature(e,a){e.features.push(a)}createFeature(){return new k(null,{},null,0)}createSpatialReference(){return{wkid:0}}createGeometry(){return new y}addField(e,a){e.fields.push(a)}allocateCoordinates(e){e.coords.length=e.lengths.reduce((a,n)=>a+n,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,a){e.coords[this._coordinatePtr++]=a}addCoordinatePoint(e,a){e.coords.push(a)}addLength(e,a){e.lengths.push(a)}addQueryGeometry(e,a){e.queryGeometry=a.queryGeometry,e.queryGeometryType=a.queryGeometryType}createPointGeometry(){return new y}};var S=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],w=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],U=["upperLeft","lowerLeft"];function G(t){return t>=S.length?null:S[t]}function M(t){return t>=w.length?null:w[t]}function x(t){return t>=U.length?null:U[t]}function D(t,e){return e>=t.geometryTypes.length?null:t.geometryTypes[e]}function P(t,e,a){let s=t.asUnsafe(),r=e.createPointGeometry(a);for(;s.next();)switch(s.tag()){case 3:{let i=s.getUInt32(),o=s.pos()+i,c=0;for(;s.pos()<o;)e.addCoordinatePoint(r,s.getSInt64(),c++);break}default:s.skip()}return r}function B(t,e,a){let r=t.asUnsafe(),i=e.createGeometry(a),o=2+(a.hasZ?1:0)+(a.hasM?1:0);for(;r.next();)switch(r.tag()){case 2:{let c=r.getUInt32(),g=r.pos()+c,l=0;for(;r.pos()<g;)e.addLength(i,r.getUInt32(),l++);break}case 3:{let c=r.getUInt32(),g=r.pos()+c,l=0;for(e.allocateCoordinates(i);r.pos()<g;)e.addCoordinate(i,r.getSInt64(),l),l++,l===o&&(l=0);break}default:r.skip()}return i}function _(t){let s=t.asUnsafe(),r=new y,i="esriGeometryPoint";for(;s.next();)switch(s.tag()){case 2:{let o=s.getUInt32(),c=s.pos()+o;for(;s.pos()<c;)r.lengths.push(s.getUInt32());break}case 3:{let o=s.getUInt32(),c=s.pos()+o;for(;s.pos()<c;)r.coords.push(s.getSInt64());break}case 1:i=d[s.getEnum()];break;default:s.skip()}return{queryGeometry:r,queryGeometryType:i}}function W(t){let l=t.asUnsafe();for(;l.next();)switch(l.tag()){case 1:return l.getString();case 2:return l.getFloat();case 3:return l.getDouble();case 4:return l.getSInt32();case 5:return l.getUInt32();case 6:return l.getInt64();case 7:return l.getUInt64();case 8:return l.getSInt64();case 9:return l.getBool();default:return l.skip(),null}return null}function L(t){let o=t.asUnsafe(),c={type:G(0)};for(;o.next();)switch(o.tag()){case 1:c.name=o.getString();break;case 2:c.type=G(o.getEnum());break;case 3:c.alias=o.getString();break;case 4:c.sqlType=M(o.getEnum());break;case 5:o.skip();break;case 6:c.defaultValue=o.getString();break;default:o.skip()}return c}function N(t){let n={},s=t.asUnsafe();for(;s.next();)switch(s.tag()){case 1:n.name=s.getString();break;case 2:n.isSystemMaintained=s.getBool();break;default:s.skip()}return n}function V(t,e,a,n){let o=e.createFeature(a),c=0;for(;t.next();)switch(t.tag()){case 1:{let g=n[c++].name;o.attributes[g]=t.processMessage(W);break}case 2:o.geometry=t.processMessageWithArgs(B,e,a);break;case 4:o.centroid=t.processMessageWithArgs(P,e,a);break;default:t.skip()}return o}function A(t){let r=[1,1,1,1],i=t.asUnsafe();for(;i.next();)switch(i.tag()){case 1:r[0]=i.getDouble();break;case 2:r[1]=i.getDouble();break;case 4:r[2]=i.getDouble();break;case 3:r[3]=i.getDouble();break;default:i.skip()}return r}function C(t){let r=[0,0,0,0],i=t.asUnsafe();for(;i.next();)switch(i.tag()){case 1:r[0]=i.getDouble();break;case 2:r[1]=i.getDouble();break;case 4:r[2]=i.getDouble();break;case 3:r[3]=i.getDouble();break;default:i.skip()}return r}function v(t){let s={originPosition:x(0)},r=t.asUnsafe();for(;r.next();)switch(r.tag()){case 1:s.originPosition=x(r.getEnum());break;case 2:s.scale=r.processMessage(A);break;case 3:s.translate=r.processMessage(C);break;default:r.skip()}return s}function O(t){let s={},r=t.asUnsafe();for(;r.next();)switch(r.tag()){case 1:s.shapeAreaFieldName=r.getString();break;case 2:s.shapeLengthFieldName=r.getString();break;case 3:s.units=r.getString();break;default:r.skip()}return s}function E(t,e){let o=e.createSpatialReference();for(;t.next();)switch(t.tag()){case 1:o.wkid=t.getUInt32();break;case 5:o.wkt=t.getString();break;case 2:o.latestWkid=t.getUInt32();break;case 3:o.vcsWkid=t.getUInt32();break;case 4:o.latestVcsWkid=t.getUInt32();break;default:t.skip()}return o}function Q(t,e){let u=e.createFeatureResult(),p=t.asUnsafe();u.geometryType=D(e,0);let m=!1;for(;p.next();)switch(p.tag()){case 1:u.objectIdFieldName=p.getString();break;case 3:u.globalIdFieldName=p.getString();break;case 4:u.geohashFieldName=p.getString();break;case 5:u.geometryProperties=p.processMessage(O);break;case 7:u.geometryType=D(e,p.getEnum());break;case 8:u.spatialReference=p.processMessageWithArgs(E,e);break;case 10:u.hasZ=p.getBool();break;case 11:u.hasM=p.getBool();break;case 12:u.transform=p.processMessage(v);break;case 9:u.exceededTransferLimit=p.getBool();break;case 13:e.addField(u,p.processMessage(L));break;case 15:m||(e.prepareFeatures(u),m=!0),e.addFeature(u,p.processMessageWithArgs(V,e,u,u.fields));break;case 2:u.uniqueIdField=p.processMessage(N);break;default:p.skip()}return e.finishFeatureResult(u),u}function j(t,e){let s={},r=null;for(;t.next();)switch(t.tag()){case 4:r=t.processMessageWithArgs(_);break;case 1:s.featureResult=t.processMessageWithArgs(Q,e);break;default:t.skip()}return r!=null&&s.featureResult&&e.addQueryGeometry(s,r),s}function R(t,e){try{let n=new q(new Uint8Array(t),new DataView(t)),s={};for(;n.next();)n.tag()===2?s.queryResult=n.processMessageWithArgs(j,e):n.skip();return s}catch(a){throw new h("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:a})}}function ce(t,e){let a=R(t,e),n=a.queryResult.featureResult,s=a.queryResult.queryGeometry,r=a.queryResult.queryGeometryType;if(n&&n.features&&n.features.length&&n.objectIdFieldName){let i=n.objectIdFieldName;for(let o of n.features)o.attributes&&(o.objectId=o.attributes[i])}return n&&(n.queryGeometry=s,n.queryGeometryType=r),n}export{I as a,L as b,v as c,ce as d};
