import{a as ae,b as ee,c as T}from"./chunk-5PZVB26A.js";import{a as Ie,b as re}from"./chunk-QZT7QMTB.js";import{a as Me}from"./chunk-IL63CQ3W.js";import{d as ne}from"./chunk-LK4L5XN7.js";import{a as oe}from"./chunk-7LVUNMSI.js";import{c as le}from"./chunk-LZ2LEOYK.js";import{a as Z}from"./chunk-FHBFWDFD.js";import{m as we,n as Se,o as Ce}from"./chunk-WUJRCGDY.js";import{a as Y}from"./chunk-CVRJ6GOM.js";import{c as X,d as P,e as R}from"./chunk-7ZYPJJID.js";import{g as n}from"./chunk-UAKHZRKN.js";import{l as Le}from"./chunk-HAHX77IL.js";import{a as c,h as y}from"./chunk-LB5YQINJ.js";import{b as _}from"./chunk-EKMHQEJY.js";import{a as ve}from"./chunk-VACZNAP3.js";import{e as _e}from"./chunk-JKNCWG7E.js";import{a as fe}from"./chunk-ISSJ3A6Y.js";import{F as be,L as f,b as z,d as s}from"./chunk-C7INQGWT.js";import{H as d}from"./chunk-WMHJC7XF.js";import{i as D}from"./chunk-D2LVMNOU.js";import{a as i}from"./chunk-QGVBCWUY.js";import{t as ge}from"./chunk-HHDFN2GK.js";import{t as C}from"./chunk-47GHT6OF.js";import{c as me,f as G}from"./chunk-VTHXE323.js";var B=class extends f{constructor(e){super(e),this.directionModePicker=!1,this.header=!1,this.labelsToggle=!0,this.tooltipsToggle=!0}};i([s({type:Boolean,nonNullable:!0})],B.prototype,"directionModePicker",void 0),i([s({type:Boolean,nonNullable:!0})],B.prototype,"header",void 0),i([s({type:Boolean,nonNullable:!0})],B.prototype,"labelsToggle",void 0),i([s({type:Boolean,nonNullable:!0})],B.prototype,"tooltipsToggle",void 0),B=i([d("esri.widgets.support.SketchTooltipControls.VisibleElements")],B);var pe=B;var W="esri-sketch-tooltip-controls",te={base:W,block:`${W}__block`,blockContent:`${W}__block-content`,hintIcon:`${W}__hint-icon`,radioButtonLabelWrapper:`${W}__radio-button-label-wrapper`},O=class extends P{constructor(e,t){super(e,t),this.viewModel=null,this.visibleElements=new pe,this.sketchOptions=new ne,this.viewType=void 0,this._onTooltipsEnabledChange=l=>{this.sketchOptions.tooltips.enabled=l},this._onLabelsEnabledChange=l=>{this.sketchOptions.labels.enabled=l},this._onDirectionModeChange=l=>{this.sketchOptions.values.directionMode=l.currentTarget.selectedItem.value}}loadDependencies(){return Promise.all([X({block:()=>import("./chunk-F3ZSOXTW.js"),label:()=>import("./chunk-H4FMBFSZ.js"),icon:()=>import("./chunk-QXDSJABL.js"),"radio-button":()=>import("./chunk-BPRSL55M.js"),"radio-button-group":()=>import("./chunk-DPT5S2GR.js")}),ee()])}render(){let{label:e,visibleElements:t}=this,l=this._renderContent();return n("div",{"aria-label":e,class:this.classes(te.base,Z.widget)},l?n("calcite-block",{class:te.block,heading:t.header?this.label:"",key:"content-block",label:this.label,open:!0},n("div",{class:te.blockContent,key:"content"},l)):void 0)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}_renderContent(){let{visibleElements:e,viewType:t}=this,l=[e.tooltipsToggle?this._renderTooltipsToggle():null,e.labelsToggle&&t!=="2d"?this._renderLabelsToggle():null,e.directionModePicker?this._renderDirectionModePicker():null].filter(C);return l.length===0?null:l}_renderTooltipsToggle(){let{messages:e,sketchOptions:t}=this;return n(T,{checked:t.tooltips.effectiveEnabled,hint:e.tooltipsToggleHint,key:`${this.id}__tooltips`,label:e.tooltipsToggle,onChange:this._onTooltipsEnabledChange})}_renderLabelsToggle(){let{messages:e,sketchOptions:t}=this;return n(T,{checked:t.labels.enabled,hint:e.labelsToggleHint,key:`${this.id}__labels`,label:e.labelsToggle,onChange:this._onLabelsEnabledChange})}_renderDirectionModePicker(){let{messages:e,sketchOptions:t}=this,{directionMode:l}=t.values;return n("calcite-label",{key:"direction-mode",layout:"default",scale:"s"},e.directionModePicker,n("calcite-radio-button-group",{key:"radio-button-group",layout:"horizontal",name:this.id,scale:"s",value:l,onCalciteRadioButtonGroupChange:this._onDirectionModeChange},this._renderDirectionModeOption("relative",l,e.directionModeRelative),this._renderDirectionModeOption("absolute",l,e.directionModeAbsolute)))}_renderDirectionModeOption(e,t,l){return n("calcite-label",{key:e,layout:"inline",scale:"s"},n("calcite-radio-button",{checked:e===t,scale:"s",value:e}),n("div",{class:te.radioButtonLabelWrapper,key:"label-wrapper"},n("calcite-icon",{icon:Me[e],scale:"s"}),l))}};i([s()],O.prototype,"label",null),i([s({type:pe,nonNullable:!0})],O.prototype,"visibleElements",void 0),i([s(),R("esri/widgets/support/SketchTooltipControls/t9n/SketchTooltipControls")],O.prototype,"messages",void 0),i([s({nonNullable:!0,type:ne})],O.prototype,"sketchOptions",void 0),i([s({type:String})],O.prototype,"viewType",void 0),O=i([d("esri.widgets.support.SketchTooltipControls")],O);var yt=O;var Be={hide:"hide",hideChildren:"hide-children"};function A(e){return e?.listMode??void 0}function xe(e){return e!=null&&"minScale"in e&&e.minScale!=null?e.minScale:void 0}function Fe(e){return e!=null&&"maxScale"in e&&e.maxScale!=null?e.maxScale:void 0}function ke(e){if(!e)return"inherited";let t=De(ce(e)?e.layer:e);return t!=null?t?"independent":"inherited":"visibilityMode"in e&&e.visibilityMode!=null?e.visibilityMode:"independent"}function ie(e){if(e&&(!("type"in e)||e.type!=="wmts"))return"sublayers"in e?"sublayers":"layers"in e?"layers":void 0}function H(e){return A(e)!==Be.hide}function Ee(e,t){if(!e||t==null||isNaN(t))return!1;let l=xe(e),o=Fe(e),r=l!=null&&!isNaN(l)&&l>0&&t>l,p=o!=null&&!isNaN(o)&&o>0&&t<o;return r||p}function de(e){let t=e?.layer;return t&&"layers"in t?t.layers:null}function ce(e){return e!=null&&"layer"in e&&e.layer!=null}function De(e){let t=Pe(e);return t!=null&&"supportsSublayerVisibility"in t?t.supportsSublayerVisibility:void 0}function Pe(e){return e&&"capabilities"in e&&e.capabilities!=null&&"exportMap"in e.capabilities?e.capabilities.exportMap:void 0}var u=class extends Y.IdentifiableMixin(P){constructor(e,t){super(e,t),this._legend=null,this.className=null,this.content=null,this.flowEnabled=!1,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles([c(()=>this._canCreateLegend,()=>this._createLegend(),y),c(()=>[this._legend,this._legendOptions],()=>this._updateLegend(),y)])}destroy(){this._legend=D(this._legend)}get _canCreateLegend(){let{content:e,listItem:t}=this;if(!t)return!1;let l="legend";return e===l||e!=null&&!!Array.isArray(e)&&e.includes(l)}get _legendOptions(){let{listItem:e,_legendLayerInfo:t}=this,l=e?.view;return t&&l?{view:l,layerInfos:[t]}:{}}get _legendLayerInfo(){let e=this.listItem?.layer;if(!e||e.type==="subtype-sublayer")return null;let t=ce(e)?e:null,l=e?.parent,o=l!=null&&"type"in l&&l.type==="map-image"?t?.source:null,r="";return o&&l?{layer:l,title:r,sublayerIds:[o.mapLayerId]}:{layer:e,title:r}}get disabled(){let{listItem:e,_legend:t,content:l}=this;return!e||!(Array.isArray(l)&&l.length>1)&&!!t&&(!t.activeLayerInfos?.length||!e.visibleAtCurrentScale||!e.visible)}set disabled(e){this._overrideIfSome("disabled",e)}get icon(){let{image:e}=this,t=this._getFirstWidget();return this._get("icon")??(!e&&t?t.icon:null)}set icon(e){this._overrideIfSome("icon",e)}get title(){return this._get("title")||(this._getFirstWidget()?.label??"")}set title(e){this._override("title",e)}render(){return n("div",{class:"esri-list-item-panel"},this._renderContents())}_renderContent(e){let{_legend:t,disabled:l,open:o}=this;return e&&!l&&o?e==="legend"&&t?n("div",{key:"legend-widget"},t.render()):typeof e=="string"?n("div",{innerHTML:e,key:e}):le(e)?n("div",{key:"content-widget"},e.render()):e instanceof HTMLElement?n("div",{afterCreate:this._attachToNode,bind:e,key:"content-element"}):null:null}_renderContents(){let{content:e,open:t}=this;return t?Array.isArray(e)?e.map(l=>this._renderContent(l)):this._renderContent(e):null}_createLegend(){return G(this,null,function*(){if(D(this._legend),this._legend=null,!this._canCreateLegend)return;let{default:e}=yield import("./chunk-RWVRTWLM.js"),t=new e(this._legendOptions);this._legend=t})}_attachToNode(e){e.appendChild(this)}_updateLegend(){let e=this._legend;e&&e.set(this._legendOptions)}_getWidget(e){return e==="legend"?this._legend:le(e)?e:null}_getFirstWidget(){let{content:e}=this;return Array.isArray(e)?e.map(t=>this._getWidget(t)).find(t=>t):this._getWidget(e)}};i([s()],u.prototype,"_legend",void 0),i([s()],u.prototype,"_canCreateLegend",null),i([s()],u.prototype,"_legendOptions",null),i([s()],u.prototype,"_legendLayerInfo",null),i([s()],u.prototype,"className",void 0),i([s()],u.prototype,"content",void 0),i([s()],u.prototype,"disabled",null),i([s()],u.prototype,"flowEnabled",void 0),i([s()],u.prototype,"icon",null),i([s()],u.prototype,"image",void 0),i([s()],u.prototype,"listItem",void 0),i([s()],u.prototype,"open",void 0),i([s()],u.prototype,"title",null),i([s()],u.prototype,"visible",void 0),u=i([d("esri.widgets.LayerList.ListItemPanel")],u);var he=u;var q,Ae=_.ofType({key:"type",defaultKeyValue:"button",base:we,typeMap:{button:Se,toggle:Ce}}),Te=_.ofType(Ae),ue="layer",se="child-list-mode",He="hide",a=q=class extends Y.IdentifiableMixin(f){constructor(e){super(e),this.actionsSections=new Te,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(_.ofType(q)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.open=!1,this.panel=null,this.parent=null,this.view=null}initialize(){if(this.addHandles([c(()=>[this.layer,this.layer?.listMode,this.listModeDisabled],()=>this._watchLayerProperties(this.layer),y),c(()=>this.checkPublishStatusEnabled,e=>this._updateChildrenPublishing(e),y),c(()=>this.view,e=>this._updateChildrenView(e),y),c(()=>this.panel,e=>this._setListItemOnPanel(e),y)]),typeof this.listItemCreatedFunction=="function"){let e={item:this};this.listItemCreatedFunction.call(null,e)}}destroy(){this.panel?.destroy(),this.children.destroyAll(),this.view=null}get connectionStatus(){let{layerView:e,publishing:t}=this;if(!t&&e&&"connectionStatus"in e)return e.connectionStatus}get error(){return this.layer?.loadError}get incompatible(){let{layerView:e}=this;return!(!e||!("spatialReferenceSupported"in e))&&!e.spatialReferenceSupported}get layerView(){let{layer:e,view:t}=this;if(!e||!t||e.type==="sublayer")return null;let l=e.type==="subtype-sublayer"?e.parent:e;return t.allLayerViews.find(o=>o.layer===l)??null}castPanel(e){return this.panel?.open&&!e.hasOwnProperty("open")&&(e.open=!0),e?new he(e):null}get sortable(){return this.layer?.type!=="knowledge-graph-sublayer"&&this._get("sortable")}set sortable(e){this._set("sortable",e)}get title(){let e=z(this,"layer.layer");return(!e||e&&z(this,"layer.layer.loaded"))&&z(this,"layer.title")||z(this,"layer.attributes.title")||""}set title(e){this._override("title",e)}get publishing(){let{layer:e,checkPublishStatusEnabled:t}=this;return!!(t&&e&&"publishingInfo"in e&&e.publishingInfo?.status==="publishing")}get updating(){let{layerView:e,connectionStatus:t,layer:l,publishing:o}=this;return!o&&!t&&(e?e.updating:l?.loadStatus==="loading"||!1)}get visible(){return!!this.layer?.visible}set visible(e){let t=this.layer;t&&(t.visible=e)}get visibleAtCurrentScale(){return this.layerView?.visibleAtCurrentScale??!Ee(this.layer,this.view?.scale)}get visibleAtCurrentTimeExtent(){return this.layerView?.visibleAtCurrentTimeExtent??!0}get visibilityMode(){return ke(this.layer)}clone(){return new q({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),childrenSortable:this.childrenSortable,hidden:this.hidden,layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,open:this.open,panel:this.panel,parent:this.parent,sortable:this.sortable,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(e){e&&(e.listItem=this)}_updateChildrenPublishing(e){this.children?.forEach(t=>t.checkPublishStatusEnabled=e)}_updateChildrenView(e){let t=this.children;t&&t.forEach(l=>l.view=e)}_createChildren(e){let{listModeDisabled:t,children:l}=this,o=e.filter(r=>!l.some(p=>p.layer===r));l.addMany(this._createChildItems(o,t))}_destroyChildren(e){let{children:t}=this,l=t.filter(o=>!!o.layer&&!e.includes(o.layer));t.destroyMany(l)}_sortChildren(e){this.children.sort((t,l)=>e.indexOf(l.layer)-e.indexOf(t.layer))}_destroyAllChildren(){this.removeHandles(se),this.children.destroyAll()}_watchChildLayerListMode(e){this.removeHandles(se),this.listModeDisabled||this.addHandles(e.toArray().map(t=>c(()=>t.listMode,()=>this._compileChildren(e))),se)}_compileChildren(e){let t=this.listModeDisabled?e:e?.filter(l=>A(l)!==He);e?.length?(this._createChildren(t),this._destroyChildren(t),this._sortChildren(t),this._watchChildLayerListMode(e)):this._destroyAllChildren()}_watchSublayerChanges(e){e&&this.addHandles(e.on("change",()=>this._compileChildren(e)),ue)}_initializeChildLayers(e){this._compileChildren(e),this._watchSublayerChanges(e)}_createChildItems(e,t){return e.reverse().map(l=>t||H(l)?new q({layer:l,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,parent:this,view:this.view}):null).filter(C)}_watchLayerProperties(e){if(this.removeHandles(ue),this.removeHandles(se),!e)return;if((!this.listModeDisabled&&A(e))==="hide-children")return void this.children.destroyAll();let t=ie(e);t&&this.addHandles(c(()=>e[t],l=>{e.hasOwnProperty(t)&&this._initializeChildLayers(l)},y),ue)}};i([s({type:Te})],a.prototype,"actionsSections",void 0),i([s()],a.prototype,"actionsOpen",void 0),i([s()],a.prototype,"checkPublishStatusEnabled",void 0),i([s({type:_.ofType(a)})],a.prototype,"children",void 0),i([s()],a.prototype,"childrenSortable",void 0),i([s({readOnly:!0})],a.prototype,"connectionStatus",null),i([s({readOnly:!0})],a.prototype,"error",null),i([s()],a.prototype,"hidden",void 0),i([s({readOnly:!0})],a.prototype,"incompatible",null),i([s()],a.prototype,"layer",void 0),i([s({readOnly:!0})],a.prototype,"layerView",null),i([s()],a.prototype,"listItemCreatedFunction",void 0),i([s({nonNullable:!0})],a.prototype,"listModeDisabled",void 0),i([s()],a.prototype,"open",void 0),i([s({type:he})],a.prototype,"panel",void 0),i([fe("panel")],a.prototype,"castPanel",null),i([s()],a.prototype,"parent",void 0),i([s({value:!0})],a.prototype,"sortable",null),i([s()],a.prototype,"title",null),i([s({readOnly:!0})],a.prototype,"publishing",null),i([s({readOnly:!0})],a.prototype,"updating",null),i([s()],a.prototype,"view",void 0),i([s()],a.prototype,"visible",null),i([s({readOnly:!0})],a.prototype,"visibleAtCurrentScale",null),i([s({readOnly:!0})],a.prototype,"visibleAtCurrentTimeExtent",null),i([s({readOnly:!0})],a.prototype,"visibilityMode",null),a=q=i([d("esri.widgets.LayerList.ListItem")],a);var j=a;var L={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},$e="hide",Oe=_.ofType(j),M=class extends ve.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new Oe,this.view=null}initialize(){this.addHandles([c(()=>this.view?.ready===!0,()=>this._viewHandles(),y),c(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList()),c(()=>oe(this.view)?this.view.inGeographicLayout:null,()=>this._compileList())],L.view)}destroy(){this._removeAllItems(),this.view=null}get state(){let{view:e}=this;return e?.ready?"ready":e?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(e=>e.children).length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,l,o){let r=e?.layer;if(!r||r.type==="subtype-sublayer"||r.type==="sublayer")return;let p=this.view?.map?.layers,g=t?de(t):p,E=l?de(l):p;if(!g||!E)return;let{operationalItems:N}=this,J=t?.children||N,Q=l?.children||N,F=E.length-o;e.parent=l||null,J.remove(e),g.remove(r),Q.includes(e)||Q.add(e,F),E.includes(r)||E.add(r,F),this._compileList()}_createLayerViewHandles(e){this.removeHandles(L.layerViews),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),L.layerViews)}_createMapLayerHandles(e){this.removeHandles(L.mapLayers),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),L.mapLayers)}_createListItem(e){let{view:t,listItemCreatedFunction:l,checkPublishStatusEnabled:o,listModeDisabled:r}=this;return new j({checkPublishStatusEnabled:o,listModeDisabled:r,layer:e,listItemCreatedFunction:l,view:t})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(e){return e?this.listModeDisabled?e:e.filter(t=>A(t)!==$e):void 0}_watchLayersListMode(e){this.removeHandles(L.layerListMode),e&&!this.listModeDisabled&&this.addHandles(c(()=>e.filter(t=>"listMode"in t).map(t=>t.listMode).toArray(),()=>this._compileList()),L.layerListMode)}_compileList(){let e=this.view?.map?.layers,t=oe(this.view)&&!this.view.inGeographicLayout?e?.filter(({type:o})=>o==="link-chart"):e;this._watchLayersListMode(t);let l=this._getViewableLayers(t);l?.length?(this._createNewItems(l),this._removeItems(l),this._sortItems(l)):this._removeAllItems()}_createNewItems(e){let{operationalItems:t}=this;e.forEach(l=>{t.some(o=>o.layer===l)||t.add(this._createListItem(l))})}_removeItems(e){let{operationalItems:t}=this,l=[];t.forEach(o=>{o&&e&&e.includes(o.layer)||l.push(o)}),t.destroyMany(l)}_sortItems(e){let{operationalItems:t}=this;t.sort((l,o)=>{let r=e.indexOf(l.layer),p=e.indexOf(o.layer);return r>p?-1:r<p?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){let{view:e}=this;this.removeHandles([L.mapLayers,L.layerViews,L.viewLayers]),e?.ready?this.addHandles([c(()=>this.view?.map?.allLayers,t=>this._createMapLayerHandles(t),y),c(()=>this.view?.allLayerViews,t=>this._createLayerViewHandles(t),y)],L.viewLayers):this._removeAllItems()}};i([s()],M.prototype,"checkPublishStatusEnabled",void 0),i([s()],M.prototype,"listItemCreatedFunction",void 0),i([s({nonNullable:!0})],M.prototype,"listModeDisabled",void 0),i([s({type:Oe})],M.prototype,"operationalItems",void 0),i([s({readOnly:!0})],M.prototype,"state",null),i([s()],M.prototype,"totalItems",null),i([s()],M.prototype,"view",void 0),M=i([d("esri.widgets.LayerList.LayerListViewModel")],M);var Ve=M;var K=e=>Ge(e)||ze(e),Ge=e=>{if(!("type"in e))return!1;switch(e.type){case"feature":case"geojson":case"csv":case"graphics":case"wfs":case"map-notes":case"oriented-imagery":case"scene":case"building-scene":case"subtype-sublayer":return!0;default:return!1}},ze=e=>{let t=ie(e);if(t!=null&&e.hasOwnProperty(t)&&e[t]!=null){for(let l of e[t])if(K(l))return!0}return!1},U=(e,t)=>t!=null&&e!=null&&(t.test(e.title)?"self":!!e.children.some(l=>U(l,t)!==!1)&&"children");var ye,I=ye=class extends j{constructor(e){super(e),this.children=new _,this.parent=null}get enabled(){let{children:e}=this;if(e.length===0)return this.featureSource!=null&&this.featureSource.enabled?"enabled":"disabled";let t=!1,l=!1;for(let o of e){if(o.enabled==="indeterminate")return o.enabled;if(o.enabled==="enabled"?t=!0:o.enabled==="disabled"&&(l=!0),l&&t)return"indeterminate"}return l?"disabled":"enabled"}get childLayerIds(){return this.children.toArray().flatMap(e=>[e.layer?.id,...e.childLayerIds])}get featureSource(){let{layer:e,getFeatureSnappingSources:t}=this;return t().find(l=>l.layer===e)}_initializeChildLayers(e){if(!e)return;let t=e.filter(K);super._initializeChildLayers(t)}_createChildItems(e){return e.map(t=>H(t)?new ye({layer:t,parent:this,view:this.view,getFeatureSnappingSources:this.getFeatureSnappingSources}):null).filter(C).reverse()}};i([s()],I.prototype,"enabled",null),i([s()],I.prototype,"children",void 0),i([s()],I.prototype,"childLayerIds",null),i([s()],I.prototype,"featureSource",null),i([s({constructOnly:!0})],I.prototype,"getFeatureSnappingSources",void 0),i([s()],I.prototype,"parent",void 0),I=ye=i([d("esri.widgets.support.SnappingControls.SnappingListItem")],I);var V=class extends Ve{constructor(){super(...arguments),this.featureSnappingSources=new _}get operationalItemsFlat(){return this.operationalItems.flatten(e=>e.children)}get selectableItems(){return this.operationalItemsFlat.filter(e=>!e.children?.length)}_compileList(){let e=this.view?.map?.layers;if(!e)return;let t=e.filter(K);this._watchLayersListMode(t);let l=this._getViewableLayers(t);l?.length?(this._createNewItems(l),this._removeItems(l),this._sortItems(l)):this._removeAllItems()}_createListItem(e){return new I({layer:e,view:this.view,getFeatureSnappingSources:()=>this.featureSnappingSources})}};i([s()],V.prototype,"featureSnappingSources",void 0),i([s()],V.prototype,"operationalItems",void 0),i([s()],V.prototype,"operationalItemsFlat",null),i([s()],V.prototype,"selectableItems",null),V=i([d("esri.widgets.support.SnappingControls.SnappingLayerListViewModel")],V);var k=class extends f{constructor(e){super(e),this.layerListViewModel=new V,this.snappingOptions=new re,this.view=null}initialize(){this.addHandles([c(()=>({viewModel:this.layerListViewModel,view:this.view}),({viewModel:e,view:t})=>{e.view=t},y),c(()=>({viewModel:this.layerListViewModel,sources:this.snappingOptions?.featureSources}),({viewModel:e,sources:t})=>{e.featureSnappingSources=t},y)])}get allLayersEnabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>e.enabled==="enabled")}get allLayersDisabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>!e.enabled)}get layersEnabledCount(){return this.layerListViewModel?.selectableItems?.filter(e=>e.enabled==="enabled").length??0}get state(){return this.snappingOptions?"ready":"disabled"}toggleSnappingForLayers(e,t){e?.forEach(l=>t?this.enableSnappingForLayer(l):this.disableSnappingForLayer(l))}toggleSnappingForAllLayers(e){this.layerListViewModel.selectableItems.forEach(({layer:t})=>{let l=t?.id;e?this.enableSnappingForLayer(l):this.disableSnappingForLayer(l)})}enableSnappingForLayer(e){let t=this._findSnappingSourceForLayer(e)??this._makeSnappingSourceForLayer(e);t&&(t.enabled=!0)}disableSnappingForLayer(e){let t=this._findSnappingSourceForLayer(e);t&&(t.enabled=!1)}updateEnabledFeatureSources(e){for(let t of this.snappingOptions.featureSources)H(t.layer)&&(t.enabled=e.includes(t.layer.id))}_findSnappingSourceForLayer(e){return this.snappingOptions.featureSources.find(t=>t.layer.id===e)}_makeSnappingSourceForLayer(e){let t=this.layerListViewModel.operationalItemsFlat.find(o=>o.layer?.id===e)?.layer;if(!t)throw new ge("snapping-controls:layer-not-found",`cannot enable snapping for layer with id ${e} because no such layer was found in the view`);if(t.type==="group")return;let l=new Ie({layer:t});return this.snappingOptions.featureSources.add(l),l}};i([s()],k.prototype,"allLayersEnabled",null),i([s()],k.prototype,"allLayersDisabled",null),i([s({constructOnly:!0})],k.prototype,"layerListViewModel",void 0),i([s()],k.prototype,"layersEnabledCount",null),i([s({type:re,nonNullable:!0})],k.prototype,"snappingOptions",void 0),i([s()],k.prototype,"state",null),i([s()],k.prototype,"view",void 0),k=i([d("esri.widgets.support.SnappingControls.SnappingControlsViewModel")],k);var Ne=k;var v=class extends f{constructor(e){super(e),this.enabledToggle=!0,this.featureEnabledToggle=!0,this.gridEnabledToggle=!0,this.header=!1,this.layerList=!0,this.gridControls=!0,this.gridControlsElements=new ae({gridSnapEnabledToggle:!1,gridEnabledToggle:!1}),this.layerListToggleLayersButton=!0,this.selfEnabledToggle=!0}};i([s({type:Boolean,nonNullable:!0})],v.prototype,"enabledToggle",void 0),i([s({type:Boolean,nonNullable:!0})],v.prototype,"featureEnabledToggle",void 0),i([s({type:Boolean,nonNullable:!0})],v.prototype,"gridEnabledToggle",void 0),i([s({type:Boolean,nonNullable:!0})],v.prototype,"header",void 0),i([s({type:Boolean,nonNullable:!0})],v.prototype,"layerList",void 0),i([s({type:Boolean,nonNullable:!0})],v.prototype,"gridControls",void 0),i([s({type:ae,nonNullable:!0})],v.prototype,"gridControlsElements",void 0),i([s({type:Boolean,nonNullable:!0})],v.prototype,"layerListToggleLayersButton",void 0),i([s({type:Boolean,nonNullable:!0})],v.prototype,"selfEnabledToggle",void 0),v=i([d("esri.widgets.support.SnappingControls.VisibleElements")],v);var $=v;var w="esri-snapping-controls",S={base:w,container:`${w}__container`,item:`${w}__item`,toggleBlock:`${w}__toggle-block`,layerListBlock:`${w}__layer-list-block`,layerList:`${w}__layer-list`,layerListFilter:`${w}__layer-list__filter`,layerListButton:`${w}__layer-list__button`,layerListItem:`${w}__layer-list__item`,layerListGroup:`${w}__layer-list__group`,nestedContainer:`${w}__nested-container`},h=class extends P{constructor(e,t){super(e,t),this._defaultViewModel=null,this._layerListFilter=null,this._gridLoadTask=null,this.layerListOpen=!0,this.gridOptionsOpen=!1,this.messages=null,this.messagesCommon=null,this.snappingManager=null,this.visibleElements=new $,this._enableSnappingSwitchChange=p=>{this.snappingOptions.enabled=p},this._featureEnabledSwitchChange=p=>{this.snappingOptions.featureEnabled=p},this._gridEnabledSwitchChange=p=>{this.snappingOptions.gridEnabled=p,p&&this._startLoadGrid()},this._selfEnabledSwitchChange=p=>{this.snappingOptions.selfEnabled=p},this._onToggleLayersButtonClick=p=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),Le(p.target)};let{snappingOptions:l,view:o,viewModel:r}=e;this.viewModel=r??(this._defaultViewModel=new Ne({snappingOptions:l,view:o}))}normalizeCtorArgs(e){let p=e,{snappingOptions:t,view:l,viewModel:o}=p;return me(p,["snappingOptions","view","viewModel"])}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=D(this._defaultViewModel))}loadDependencies(){return Promise.all([X({block:()=>import("./chunk-F3ZSOXTW.js"),button:()=>import("./chunk-BTQPJTPG.js"),input:()=>import("./chunk-PTLKWOPS.js"),list:()=>import("./chunk-QV3363IT.js"),"list-item":()=>import("./chunk-PXFXZ5UQ.js"),checkbox:()=>import("./chunk-LK5IDBLO.js"),loader:()=>import("./chunk-JHM3YD5O.js")}),ee()])}initialize(){this.addHandles(c(()=>this.view?.type==="2d"&&!!this.view.grid,e=>{this.visibleElements.gridControls&&(this.snappingOptions.gridEnabled=e)}))}get _openAndReady(){return this.gridOptionsOpen&&this.snappingOptions.gridEnabled&&this.snappingOptions.enabled}get icon(){return"snap-to-point"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(this._defaultViewModel!=null&&this._defaultViewModel===e||(this._defaultViewModel=D(this._defaultViewModel)),this._set("viewModel",e))}render(){let{label:e}=this;return n("div",{"aria-label":e,class:this.classes(S.base,Z.widget)},n("div",{class:S.container},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList(),this.view?.type==="2d"&&this.visibleElements.gridControls?this._renderGridOptions():null]}_renderToggles(){let{visibleElements:e,view:t}=this,l=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null,e.gridEnabledToggle&&t?.type==="2d"?this._renderGridEnabledToggle():null].filter(C),o=[e.enabledToggle?this._renderEnabledToggle():null,l.length>0?n("div",{class:S.nestedContainer},l):null].filter(C);return o.length===0?null:n("calcite-block",{class:S.toggleBlock,heading:e.header?this.label:"",key:"toggle-block",label:this.label,open:!0},o)}_renderEnabledToggle(){return n(T,{checked:this.viewModel.snappingOptions.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:this.messages.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){return n(T,{checked:this.viewModel.snappingOptions.selfEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:this.messages.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){return n(T,{checked:this.viewModel.snappingOptions.featureEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,label:this.messages.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderGridEnabledToggle(){return n(T,{checked:this.viewModel.snappingOptions.gridEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__grid-enabled-toggle`,label:this.messages.grid,onChange:this._gridEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;let{messages:e,viewModel:t}=this,l=t.layerListViewModel.operationalItems.length>9?n("calcite-input",{class:S.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:({currentTarget:{value:g}})=>{this._layerListFilter=g===""?null:new RegExp(g,"i")}}):null,o=this._secondaryElementsDisabled,r=this.layerListOpen&&!o,p=t.layerListViewModel.operationalItems?.find(g=>!!g.children.length);return n("calcite-block",{class:S.layerListBlock,collapsible:!0,disabled:this._secondaryElementsDisabled,heading:e.snappingLayers,key:"list-block",open:r,onCalciteBlockToggle:g=>this.layerListOpen=g.currentTarget.open},l,this._renderToggleLayersButton(),n("calcite-list",{class:S.layerList,displayMode:p?"nested":"flat",label:e?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems)))}_renderGridOptions(){let{view:e,visibleElements:t,snappingManager:l,snappingOptions:o,_openAndReady:r}=this,{gridEnabled:p,enabled:g}=o;(r||e?.type==="2d"&&e.grid)&&this._startLoadGrid();let E=this._gridLoadTask?.value,N=E&&e?.type==="2d"&&n(E,{snappingManager:l,snappingOptions:o,view:e,visibleElements:t.gridControlsElements});return n("calcite-block",{class:S.layerListBlock,collapsible:!0,disabled:!p||!g,heading:this.messages.gridOptionsHeading,key:"grid-block",open:r,onCalciteBlockClose:()=>this.gridOptionsOpen=!1,onCalciteBlockOpen:()=>this.gridOptionsOpen=!0},N??n("calcite-loader",{label:this.messagesCommon.loading,scale:"s",text:this.messagesCommon.loading}))}_startLoadGrid(){return G(this,null,function*(){!this._gridLoadTask&&this.visibleElements.gridControls&&this.view?.type==="2d"&&(this._gridLoadTask=_e(()=>G(this,null,function*(){return(yield import("./chunk-6S6SS6OR.js")).default})))})}_renderLayerListItemCollection(e){let t=this._layerListFilter;return e.map(l=>{switch(t?U(l,t):null){case"children":{let o=l.children.filter(r=>U(r,t)!==!1);return this._renderLayerListItemGroup(l,o)}case"self":case null:return this._renderLayerListItemOrGroup(l);case!1:return U(l.parent,t)==="self"?this._renderLayerListItemOrGroup(l):null}}).toArray().filter(C)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;let{viewModel:{allLayersEnabled:e},messages:t}=this,l=e?t.disableAllLayers:t.enableAllLayers;return n("calcite-button",{appearance:"transparent",class:S.layerListButton,label:l,name:"layer-toggle",onclick:this._onToggleLayersButtonClick},l)}_renderLayerListItemOrGroup(e){if(e.children.length)return this._renderLayerListItemGroup(e);let{messages:{untitledLayer:t}}=this,l=e.title||t,o=()=>{this.viewModel.toggleSnappingForLayers([e.layer?.id],e.enabled!=="enabled")};return n("calcite-list-item",{class:S.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:l,onCalciteListItemSelect:r=>{r.stopPropagation(),o()}},n("calcite-checkbox",{checked:e.enabled==="enabled",slot:"actions-start",onCalciteCheckboxChange:o}))}_renderLayerListItemGroup(e,t){let{messages:l}=this,{children:o,title:r}=e,p=r||l.untitledLayer,g=r&&r!==""?r:be(),E=!!t?.length,N=t??o,J=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,e.enabled!=="enabled")},Q=N?.find(F=>!!F.children.length);return n("calcite-list-item",{class:S.layerListGroup,key:g,label:p,open:E,onCalciteListItemSelect:F=>{F.stopPropagation(),J()}},n("calcite-checkbox",{checked:e.enabled==="enabled",indeterminate:e.enabled==="indeterminate",slot:"actions-start",onCalciteCheckboxChange:J}),n("calcite-list",{displayMode:Q?"nested":"flat",label:l?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(N)))}get _enabledToggleDisabled(){let e=this.snappingOptions;return e.enabledToggled||e.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};i([s()],h.prototype,"_defaultViewModel",void 0),i([s()],h.prototype,"_layerListFilter",void 0),i([s()],h.prototype,"_gridLoadTask",void 0),i([s()],h.prototype,"_openAndReady",null),i([s()],h.prototype,"label",null),i([s({type:Boolean,nonNullable:!0})],h.prototype,"layerListOpen",void 0),i([s({type:Boolean,nonNullable:!0})],h.prototype,"gridOptionsOpen",void 0),i([s(),R("esri/widgets/support/SnappingControls/t9n/SnappingControls")],h.prototype,"messages",void 0),i([s(),R("esri/t9n/common")],h.prototype,"messagesCommon",void 0),i([s()],h.prototype,"snappingOptions",null),i([s()],h.prototype,"snappingManager",void 0),i([s()],h.prototype,"view",null),i([s()],h.prototype,"viewModel",null),i([s({type:$,nonNullable:!0})],h.prototype,"visibleElements",void 0),i([s()],h.prototype,"_enabledToggleDisabled",null),i([s()],h.prototype,"_secondaryElementsDisabled",null),h=i([d("esri.widgets.support.SnappingControls")],h);var Ts=h;var b=class extends f{constructor(e){super(e),this.point=!0,this.polyline=!0,this.polygon=!0,this.rectangle=!0,this.circle=!0,this.multipoint=!0,this.mesh=!0,this.freehandPolyline=!1,this.freehandPolygon=!1}};i([s({type:Boolean,nonNullable:!0})],b.prototype,"point",void 0),i([s({type:Boolean,nonNullable:!0})],b.prototype,"polyline",void 0),i([s({type:Boolean,nonNullable:!0})],b.prototype,"polygon",void 0),i([s({type:Boolean,nonNullable:!0})],b.prototype,"rectangle",void 0),i([s({type:Boolean,nonNullable:!0})],b.prototype,"circle",void 0),i([s({type:Boolean,nonNullable:!0})],b.prototype,"multipoint",void 0),i([s({type:Boolean,nonNullable:!0})],b.prototype,"mesh",void 0),i([s({type:Boolean,nonNullable:!0})],b.prototype,"freehandPolyline",void 0),i([s({type:Boolean,nonNullable:!0})],b.prototype,"freehandPolygon",void 0),b=i([d("esri.widgets.Sketch.VisibleElements.CreateToolVisibilityMap")],b);var x=class extends f{constructor(e){super(e),this["rectangle-selection"]=!0,this["lasso-selection"]=!0,this["custom-selection"]=!0}};i([s({nonNullable:!0})],x.prototype,"rectangle-selection",void 0),i([s({nonNullable:!0})],x.prototype,"lasso-selection",void 0),i([s({nonNullable:!0})],x.prototype,"custom-selection",void 0),x=i([d("esri.widgets.Sketch.VisibleElements.SelectionToolVisibilityMap")],x);var m=class extends f{constructor(e){super(e),this.createTools=new b,this.directionModePicker=!1,this.duplicateButton=!0,this.deleteButton=!0,this.selectionCountLabel=!0,this.labelsToggle=!0,this.selectionTools=new x,this.settingsMenu=!0,this.snappingControls=!0,this.snappingControlsElements=new $,this.tooltipsToggle=!0,this.undoRedoMenu=!0}};i([s({type:b,nonNullable:!0})],m.prototype,"createTools",void 0),i([s({type:Boolean,nonNullable:!0})],m.prototype,"directionModePicker",void 0),i([s({type:Boolean,nonNullable:!0})],m.prototype,"duplicateButton",void 0),i([s({type:Boolean,nonNullable:!0})],m.prototype,"deleteButton",void 0),i([s({type:Boolean,nonNullable:!0})],m.prototype,"selectionCountLabel",void 0),i([s({type:Boolean,nonNullable:!0})],m.prototype,"labelsToggle",void 0),i([s({type:x,nonNullable:!0})],m.prototype,"selectionTools",void 0),i([s({type:Boolean,nonNullable:!0})],m.prototype,"settingsMenu",void 0),i([s({type:Boolean,nonNullable:!0})],m.prototype,"snappingControls",void 0),i([s({type:$,nonNullable:!0})],m.prototype,"snappingControlsElements",void 0),i([s({type:Boolean,nonNullable:!0})],m.prototype,"tooltipsToggle",void 0),i([s({type:Boolean,nonNullable:!0})],m.prototype,"undoRedoMenu",void 0),m=i([d("esri.widgets.Sketch.VisibleElements")],m);export{$ as a,pe as b,yt as c,Ts as d,b as e,m as f};
