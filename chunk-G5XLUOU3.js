import{a as ee}from"./chunk-GW75YXIH.js";import{a as Ce}from"./chunk-6AEGO2CB.js";import{a as ve}from"./chunk-2U6QECGD.js";import{a as ne,b as te,c as Q,d as Ze,e as O,f as $,g as $e,h as ke,i as Ue,j as Re,l as je,m as J,n as Me,o as Oe,r as ze,s as ce}from"./chunk-5LMNGIH3.js";import"./chunk-AXQERSA6.js";import{a as He}from"./chunk-3S5QX64A.js";import{a as Ve}from"./chunk-G4SFNODT.js";import{r as fe,v as Pe}from"./chunk-3VOB5AXQ.js";import{b as Se}from"./chunk-DOYPD6O7.js";import"./chunk-EPMRM7KB.js";import{c as P}from"./chunk-4RDCETCH.js";import{A as oe,B as X,C as Ee,D as x,J as E,M as V,N as Ne,O as G,Y as Ae,ga as se,m as q,n as xe,p as L,s as B,u as v,x as re,z as M}from"./chunk-MARRSUOJ.js";import{c as Y,q as ae}from"./chunk-IB6IQS7A.js";import"./chunk-LVYFLVM5.js";import"./chunk-3ZANJLLA.js";import"./chunk-7QY3BMVN.js";import"./chunk-WPDP647R.js";import"./chunk-4E4FE2IX.js";import"./chunk-5SSISWTF.js";import{e as T}from"./chunk-WH2SG675.js";import{a as p,b as y}from"./chunk-LWVUOW7N.js";import"./chunk-4I3TP4TP.js";import"./chunk-XA3H5C5C.js";import{a as We}from"./chunk-OYERMUCP.js";import{a as De}from"./chunk-OCNYIIP3.js";import{a as le}from"./chunk-6AT6XDV7.js";import"./chunk-62JLC2SG.js";import"./chunk-ME2CO5SA.js";import"./chunk-QS52XG5C.js";import"./chunk-2KE2TI42.js";import"./chunk-RZU6EEB3.js";import"./chunk-EUD3KSLO.js";import"./chunk-2ILDS6SI.js";import"./chunk-FVILOOND.js";import"./chunk-CBJBOHLC.js";import"./chunk-MBXIYNFL.js";import"./chunk-6UPV5F42.js";import"./chunk-VCIZNKS7.js";import"./chunk-JMDXNNBI.js";import"./chunk-QSLLT3AX.js";import"./chunk-5RQDVVYC.js";import"./chunk-2QPXVV2N.js";import"./chunk-J75YI66W.js";import"./chunk-5E3QY4A2.js";import"./chunk-JHANZXTD.js";import"./chunk-ISL7QCEH.js";import"./chunk-2EUOCJVM.js";import"./chunk-WYYRYCXY.js";import"./chunk-ODTAY6YM.js";import"./chunk-FW7D7QLC.js";import"./chunk-KCSRPDMA.js";import"./chunk-YVRSGFS3.js";import"./chunk-XX2QGXLG.js";import"./chunk-YNPFZOJD.js";import"./chunk-XGP6WN73.js";import"./chunk-3ZX35QIC.js";import"./chunk-7PERXXHH.js";import"./chunk-QYRRGSBK.js";import"./chunk-5PVZ33WG.js";import"./chunk-DCKTHYU4.js";import"./chunk-525N4T6K.js";import"./chunk-EBK2L6ZQ.js";import"./chunk-ZMJUEIM7.js";import"./chunk-6WHBFKHR.js";import"./chunk-VGCEVKYN.js";import"./chunk-6T37AWU6.js";import"./chunk-XC4BCVYU.js";import"./chunk-V7IMCFL4.js";import"./chunk-XD6QSICT.js";import"./chunk-FTOLVNUN.js";import"./chunk-EOLWCIYR.js";import"./chunk-YOMR2DCD.js";import"./chunk-KDF3RZ2K.js";import"./chunk-AFSNSPOG.js";import"./chunk-LPCVOXF2.js";import"./chunk-4AIH3WFI.js";import"./chunk-3G7BLSJZ.js";import"./chunk-JOGV3DWE.js";import"./chunk-JEGXFID4.js";import"./chunk-SU5S5XU7.js";import"./chunk-E4VXIIFB.js";import"./chunk-B5LBE5HD.js";import{e as Z}from"./chunk-F6A6XWW4.js";import"./chunk-AESEF3B2.js";import"./chunk-ZQFOJVRP.js";import"./chunk-BBB7KLHV.js";import{a as Le}from"./chunk-PWU2QHPV.js";import"./chunk-WUJRCGDY.js";import"./chunk-QPGCDGIN.js";import"./chunk-7Y6S2GNA.js";import"./chunk-VOB6IBIW.js";import"./chunk-63B3IOWG.js";import"./chunk-PTZYZULI.js";import"./chunk-KZKWOEFD.js";import"./chunk-LNVVFNTC.js";import"./chunk-WDTJILD4.js";import"./chunk-MAVVUPFJ.js";import"./chunk-OOAI5LGC.js";import"./chunk-5TMYC5PF.js";import"./chunk-RCDSCJMH.js";import"./chunk-QJADLTFR.js";import"./chunk-IWPCZHB6.js";import"./chunk-2BIJFS64.js";import"./chunk-SCKV27CX.js";import"./chunk-FXCL7YYQ.js";import"./chunk-HX2BGUTP.js";import"./chunk-XSTBHERR.js";import"./chunk-S7QYPX7J.js";import"./chunk-KWZIB4M6.js";import"./chunk-YQPWWSMJ.js";import"./chunk-JEIB6WNP.js";import"./chunk-6JJCXUHW.js";import"./chunk-CVRJ6GOM.js";import"./chunk-X7QUUHRV.js";import"./chunk-7B2UKJ5N.js";import"./chunk-RSDQHAJX.js";import"./chunk-3HCMTURP.js";import"./chunk-VT67LWCR.js";import"./chunk-K27GONOJ.js";import"./chunk-6KRFVLII.js";import"./chunk-JR22Z7I2.js";import"./chunk-3QNSJ5HY.js";import"./chunk-UNVICPIE.js";import"./chunk-BGICKEJR.js";import"./chunk-TRZXSDYA.js";import"./chunk-OGS2SUK5.js";import"./chunk-TVHRLNTK.js";import"./chunk-JA3EMS2I.js";import"./chunk-HKHTIKVW.js";import"./chunk-XFESK2YB.js";import"./chunk-IJBTA53P.js";import"./chunk-ZHUXSQTN.js";import"./chunk-YLZWDFCJ.js";import"./chunk-TLMADEUL.js";import"./chunk-WNSGKHQ6.js";import"./chunk-J5MXC6AL.js";import"./chunk-OLOKUDVI.js";import"./chunk-RJWOVI3M.js";import"./chunk-R6GE4XRP.js";import"./chunk-MDL4XPLR.js";import"./chunk-ZM7LRSXS.js";import"./chunk-ILKINAL7.js";import"./chunk-HVKMTRIC.js";import{c as de}from"./chunk-AZS4Q4RE.js";import"./chunk-QEBUS3TL.js";import"./chunk-IB2IUO7T.js";import"./chunk-MS3KE2OO.js";import"./chunk-NHSDW26F.js";import"./chunk-NMAGYK3Q.js";import"./chunk-GWBRHLNH.js";import"./chunk-VDADRLEF.js";import"./chunk-CNQVGGE6.js";import"./chunk-JGD7UKVF.js";import"./chunk-X5AA4JDN.js";import{b as Te,d as k,f as A}from"./chunk-J372WZPB.js";import{d as be}from"./chunk-6XFS4U2F.js";import"./chunk-XPRVY6JT.js";import"./chunk-7N3ZKWML.js";import"./chunk-E62WHYYG.js";import"./chunk-QDTU3MWT.js";import"./chunk-BCREO4Q5.js";import"./chunk-3SDSCSDJ.js";import"./chunk-I4M2OT5W.js";import"./chunk-NTVLK3P2.js";import"./chunk-WMQNRNIU.js";import"./chunk-HD52PWPC.js";import"./chunk-EIPVFA6F.js";import"./chunk-VOFKUGRY.js";import"./chunk-IG66NQHW.js";import"./chunk-ARRCN5K3.js";import"./chunk-IXCTZWTQ.js";import"./chunk-6PN3I333.js";import"./chunk-ZTJLFKGG.js";import"./chunk-5TW726OD.js";import"./chunk-VGD3XLDH.js";import"./chunk-LB5YQINJ.js";import"./chunk-EKMHQEJY.js";import"./chunk-VACZNAP3.js";import"./chunk-JKNCWG7E.js";import"./chunk-SLAWDKDA.js";import"./chunk-KTE5HCNJ.js";import"./chunk-F7VRLFCB.js";import"./chunk-7IPIJKWU.js";import"./chunk-7R33MKVL.js";import"./chunk-ISSJ3A6Y.js";import"./chunk-VDKRSX77.js";import"./chunk-WUA6PW3I.js";import"./chunk-E57FTRWF.js";import"./chunk-U4J5SECU.js";import"./chunk-7EG726PT.js";import"./chunk-C7INQGWT.js";import"./chunk-WMHJC7XF.js";import"./chunk-NJEWDTYF.js";import"./chunk-N3SDOFND.js";import"./chunk-OVHPPCBL.js";import"./chunk-FNXQZPHT.js";import"./chunk-3TQOUBNU.js";import{K as Fe}from"./chunk-D2LVMNOU.js";import"./chunk-SNFOAZZQ.js";import"./chunk-QGVBCWUY.js";import"./chunk-HHDFN2GK.js";import"./chunk-47GHT6OF.js";import{a as he,f as S}from"./chunk-VTHXE323.js";function Be(a){if(a.length===1){if(A(a[0]))return ee("distinct",a[0],-1);if(M(a[0]))return ee("distinct",a[0].toArray(),-1)}return ee("distinct",a,-1)}function ue(a,n,i){let g=a.getVariables();if(g.length>0){let I={};for(let e of g)I[e]=n.evaluateIdentifier(i,{name:e});a.parameters=I}return a}function u(a,n,i=null){for(let g in a)if(g.toLowerCase()===n.toLowerCase())return a[g];return i}function Ge(a){if(a===null)return null;let n={type:u(a,"type",""),name:u(a,"name","")};if(n.type==="range")n.range=u(a,"range",[]);else{n.codedValues=[];for(let i of u(a,"codedValues",[]))n.codedValues.push({name:u(i,"name",""),code:u(i,"code",null)})}return n}function me(a){if(a===null)return null;let n={},i=u(a,"wkt");i!==null&&(n.wkt=i);let g=u(a,"wkid");return g!==null&&(n.wkid=g),n}function _e(a){if(a===null)return null;let n={hasZ:u(a,"hasz",!1),hasM:u(a,"hasm",!1)},i=u(a,"spatialreference");i!=null&&(n.spatialReference=me(i));let g=u(a,"x",null);if(g!==null)return n.x=g,n.y=u(a,"y",null),n.hasZ&&(n.z=u(a,"z",null)),n.hasM&&(n.m=u(a,"m",null)),n;let I=u(a,"rings",null);if(I!==null)return n.rings=I,n;let e=u(a,"paths",null);if(e!==null)return n.paths=e,n;let t=u(a,"points",null);if(t!==null)return n.points=t,n;for(let o of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){let l=u(a,o,null);l!==null&&(n[o]=l)}return n}function Qe(a,n){for(let i of n)if(i===a)return!0;return!1}function Je(a){return!!a.layerDefinition&&!!a.featureSet&&Qe(a.layerDefinition.geometryType,["",null,"esriGeometryNull","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])!==!1&&A(a.layerDefinition.fields)!==!1&&A(a.featureSet.features)!==!1}function _(a){return a?.toLowerCase()==="utc"?"UTC":a?.toLowerCase()==="unknown"?"Unknown":a}function Ye(a,n,i,g,I,e,t){return S(this,null,function*(){let o=yield a.getFeatureSetInfo();if((o?.layerId??null)===null||!I.layerIdLookup.get(o.layerId))return null;let l=a.serviceUrl().replace(/\/FeatureServer/i,"/UtilityNetworkServer"),m=[];switch(i){case"connected":m.push("connectivity"),m.push("junction-edge-from-connectivity"),m.push("junction-edge-to-connectivity"),m.push("junction-edge-midspan-connectivity"),m.push("junction-junction-connectivity");break;case"container":case"content":m.push("containment");break;case"structure":case"attached":m.push("attachment");break;case"junctionedge":m.push("junction-edge-from-connectivity"),m.push("junction-edge-to-connectivity");break;case"midspan":m.push("junction-edge-midspan-connectivity");break;default:throw new y(e,p.InvalidParameter,t)}let f=null,s=!1;if(g!==null&&g!==""&&g!==void 0){for(let c of I.terminals)c.terminalName===g&&(f=c.terminalId);f===null&&(s=!0)}let r=[];if(!s){let c=new We(he({globalId:n.field(a.globalIdField),networkSourceId:I.layerIdLookup.get(o.layerId).sourceId},f?{terminalId:f}:"")),N=yield He(l,new Ve({types:m,elements:[c]})),D=0;for(let w of N.associations){let b=null,z="",U="";if(w.fromNetworkElement?.globalId===c.globalId?(b=w.toNetworkElement,U="to"):w.toNetworkElement?.globalId===c.globalId&&(b=w.fromNetworkElement,U="from"),!b)continue;switch(i){case"attached":if(w.associationType!=="attachment"||U!=="to")continue;break;case"structure":if(w.associationType!=="attachment"||U!=="from")continue;break;case"container":if(w.associationType!=="containment"||U!=="from")continue;break;case"content":if(w.associationType!=="containment"||U!=="to")continue;break;case"connected":break;case"junctionedge":w.associationType==="junction-edge-to-connectivity"?z="to":w.associationType==="junction-edge-from-connectivity"&&(z="from");break;case"midspan":if(w.associationType!=="junction-edge-midspan-connectivity")continue}let W=I.sourceIdLookup.get(b.networkSourceId)?.className??"";r.push(new Le({geometry:null,attributes:{objectId:D++,globalId:b.globalId,percentAlong:w.percentAlong??0,isContentVisible:w.isContentVisible?0:1,className:W,side:z}}))}}let d=new le({source:r,geometryType:null,objectIdField:"objectId",globalIdField:"globalId",fields:[new Z({name:"objectId",alias:"objectId",type:"oid"}),new Z({name:"globalId",alias:"globalId",type:"global-id"}),new Z({name:"percentAlong",alias:"percentAlong",type:"double"}),new Z({name:"side",alias:"side",type:"string"}),new Z({name:"isContentVisible",alias:"isContentVisible",type:"integer"}),new Z({name:"className",alias:"className",type:"string"})]});return J(d)})}function vn(a){a.mode==="async"&&(a.functions.timezone=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>S(this,null,function*(){if(x(e,1,2,n,i),Ee(e[0])||X(e[0]))return"Unknown";if(v(e[0])){if(yield e[0].load(),e.length===1||e[1]===null)return e[0].datesInUnknownTimezone?_("unknown"):_(e[0].dateFieldsTimeZone);if(!(e[1]instanceof P)||e[1].hasField("type")===!1)throw new y(n,p.InvalidParameter,i);let l=e[1].field("type");if(k(l)===!1)throw new y(n,p.InvalidParameter,i);switch(E(l).toLowerCase()){case"preferredtimezone":return _(e[0].preferredTimeZone);case"editfieldsinfo":return _(e[0].editFieldsInfo?.timeZone??null);case"timeinfo":return _(e[0].timeInfo?.timeZone??null);case"field":if(e[1].hasField("fieldname")&&k(e[1].field("fieldname")))return _(e[0].fieldTimeZone(E(e[1].field("fieldname"))))}throw new y(n,p.InvalidParameter,i)}let t=Ne(e[0],se(n));if(t===null)return null;let o=t.timeZone;return o==="system"?be.systemTimeZoneCanonicalName:o.toLowerCase()==="utc"?"UTC":o.toLowerCase()==="unknown"?"Unknown":o}))},a.functions.sqltimestamp=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>S(this,null,function*(){x(e,1,3,n,i);let t=e[0];if(oe(t)){if(e.length===1)return t.toSQLWithKeyword();if(e.length===2)return t.changeTimeZone(E(e[1])).toSQLWithKeyword();throw new y(n,p.InvalidParameter,i)}if(X(t))return t.toSQLWithKeyword();if(v(t)){if(e.length!==3)throw new y(n,p.InvalidParameter,i);yield t.load();let o=E(e[1]);if(X(e[2]))return e[2].toSQLWithKeyword();if(oe(e[2])===!1)throw new y(n,p.InvalidParameter,i);let l=t.fieldTimeZone(o);return l==null?e[2].toSQLWithKeyword():e[2].changeTimeZone(l).toSQLWithKeyword()}throw new y(n,p.InvalidParameter,i)}))},a.signatures.push({name:"sqltimestamp",min:2,max:4}),a.functions.featuresetbyid=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>{if(x(e,2,4,n,i),re(e[0])){let t=E(e[1]),o=L(e[2],null),l=G(L(e[3],!0));if(o===null&&(o=["*"]),A(o)===!1)throw new y(n,p.InvalidParameter,i);return e[0].featureSetById(t,l,o)}throw new y(n,p.InvalidParameter,i)})},a.signatures.push({name:"featuresetbyid",min:2,max:4}),a.functions.getfeatureset=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>S(this,null,function*(){if(x(e,1,2,n,i),B(e[0])){let t=L(e[1],"datasource");return t===null&&(t="datasource"),t=E(t).toLowerCase(),ze(e[0].fullSchema(),t,n.lrucache,n.interceptor,n.spatialReference??null)}throw new y(n,p.InvalidParameter,i)}))},a.signatures.push({name:"getfeatureset",min:1,max:2}),a.functions.featuresetbyportalitem=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>{if(x(e,2,5,n,i),e[0]===null)throw new y(n,p.PortalRequired,i);if(e[0]instanceof ve){let f=E(e[1]),s=E(e[2]),r=L(e[3],null),d=G(L(e[4],!0));if(r===null&&(r=["*"]),A(r)===!1)throw new y(n,p.InvalidParameter,i);let c;return c=n.services?.portal?n.services.portal:de.getDefault(),c=Ce(e[0],c),ce(f,s,n.spatialReference??null,r,d,c,n.lrucache,n.interceptor)}if(k(e[0])===!1)throw new y(n,p.PortalRequired,i);let t=E(e[0]),o=E(e[1]),l=L(e[2],null),m=G(L(e[3],!0));if(l===null&&(l=["*"]),A(l)===!1)throw new y(n,p.InvalidParameter,i);return ce(t,o,n.spatialReference??null,l,m,n.services?.portal??de.getDefault(),n.lrucache,n.interceptor)})},a.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),a.functions.featuresetbyname=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>{if(x(e,2,4,n,i),re(e[0])){let t=E(e[1]),o=L(e[2],null),l=G(L(e[3],!0));if(o===null&&(o=["*"]),A(o)===!1)throw new y(n,p.InvalidParameter,i);return e[0].featureSetByName(t,l,o)}throw new y(n,p.InvalidParameter,i)})},a.signatures.push({name:"featuresetbyname",min:2,max:4}),a.functions.featureset=function(n,i){return a.standardFunction(n,i,(g,I,e)=>{x(e,1,1,n,i);let t={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",hasM:!1,hasZ:!1,fields:[]},featureSet:{geometryType:"",features:[]}};if(k(e[0])){let o=JSON.parse(e[0]);o.layerDefinition!==void 0?(t.layerDefinition=o.layerDefinition,t.featureSet=o.featureSet,o.layerDefinition.spatialReference&&(t.layerDefinition.spatialReference=o.layerDefinition.spatialReference)):(t.featureSet.features=o.features,t.featureSet.geometryType=o.geometryType,t.layerDefinition.geometryType=t.featureSet.geometryType,t.layerDefinition.objectIdField=o.objectIdFieldName??"",t.layerDefinition.typeIdField=o.typeIdFieldName,t.layerDefinition.globalIdField=o.globalIdFieldName,t.layerDefinition.fields=o.fields,o.spatialReference&&(t.layerDefinition.spatialReference=o.spatialReference))}else{if(!(e[0]instanceof P))throw new y(n,p.InvalidParameter,i);{let o=JSON.parse(e[0].castToText(!0)),l=u(o,"layerdefinition");if(l!==null){t.layerDefinition.geometryType=u(l,"geometrytype",""),t.featureSet.geometryType=t.layerDefinition.geometryType,t.layerDefinition.globalIdField=u(l,"globalidfield",""),t.layerDefinition.objectIdField=u(l,"objectidfield",""),t.layerDefinition.typeIdField=u(l,"typeidfield",""),t.layerDefinition.hasZ=u(l,"hasz",!1)===!0,t.layerDefinition.hasM=u(l,"hasm",!1)===!0;let m=u(l,"spatialreference");m&&(t.layerDefinition.spatialReference=me(m));let f=[];for(let r of u(l,"fields",[])){let d={name:u(r,"name",""),alias:u(r,"alias",""),type:u(r,"type",""),nullable:u(r,"nullable",!0),editable:u(r,"editable",!0),length:u(r,"length",null),domain:Ge(u(r,"domain"))};f.push(d)}t.layerDefinition.fields=f;let s=u(o,"featureset");if(s){let r={};for(let d of f)r[d.name.toLowerCase()]=d.name;for(let d of u(s,"features",[])){let c={},N=u(d,"attributes",{});for(let D in N)c[r[D.toLowerCase()]]=N[D];t.featureSet.features.push({attributes:c,geometry:_e(u(d,"geometry"))})}}}else{t.layerDefinition.hasZ=u(o,"hasz",!1)===!0,t.layerDefinition.hasM=u(o,"hasm",!1)===!0,t.layerDefinition.geometryType=u(o,"geometrytype",""),t.featureSet.geometryType=t.layerDefinition.geometryType,t.layerDefinition.objectIdField=u(o,"objectidfieldname",""),t.layerDefinition.typeIdField=u(o,"typeidfieldname","");let m=u(o,"spatialreference");m&&(t.layerDefinition.spatialReference=me(m));let f=[],s=u(o,"fields",null);if(!A(s))throw new y(n,p.InvalidParameter,i);for(let c of s){let N={name:u(c,"name",""),alias:u(c,"alias",""),type:u(c,"type",""),nullable:u(c,"nullable",!0),editable:u(c,"editable",!0),length:u(c,"length",null),domain:Ge(u(c,"domain"))};f.push(N)}t.layerDefinition.fields=f;let r={};for(let c of f)r[c.name.toLowerCase()]=c.name;let d=u(o,"features",null);if(A(d))for(let c of d){let N={},D=u(c,"attributes",{});for(let w in D)N[r[w.toLowerCase()]]=D[w];t.featureSet.features.push({attributes:N,geometry:_e(u(c,"geometry",null))})}else d=null,t.featureSet.features=d}}}if(Je(t)===!1)throw new y(n,p.InvalidParameter,i);return t.layerDefinition.geometryType||(t.layerDefinition.geometryType="esriGeometryNull"),Re.create(t,n.spatialReference)})},a.signatures.push({name:"featureset",min:1,max:1}),a.functions.filter=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>S(this,null,function*(){if(x(e,2,2,n,i),A(e[0])||M(e[0])){let t=[],o,l=e[0];if(l instanceof De&&(l=l.toArray()),!xe(e[1]))throw new y(n,p.InvalidParameter,i);o=e[1].createFunction(n);for(let m of l){let f=o(m);Fe(f)?(yield f)===!0&&t.push(m):f===!0&&t.push(m)}return t}if(v(e[0])){let t=yield e[0].load(),o=T.create(e[1],{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC}),l=o.getVariables();if(l.length>0){let m={};for(let f of l)m[f]=a.evaluateIdentifier(n,{name:f});o.parameters=m}return new ne({parentfeatureset:e[0],whereclause:o})}throw new y(n,p.InvalidParameter,i)}))},a.signatures.push({name:"filter",min:2,max:2}),a.functions.orderby=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>S(this,null,function*(){if(x(e,2,2,n,i),v(e[0])){let t=new $e(e[1]);return new ke({parentfeatureset:e[0],orderbyclause:t})}throw new y(n,p.InvalidParameter,i)}))},a.signatures.push({name:"orderby",min:2,max:2}),a.functions.top=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>S(this,null,function*(){if(x(e,2,2,n,i),v(e[0]))return new Ue({parentfeatureset:e[0],topnum:e[1]});if(A(e[0]))return V(e[1])>=e[0].length?e[0].slice():e[0].slice(0,V(e[1]));if(M(e[0]))return V(e[1])>=e[0].length()?e[0].slice():e[0].slice(0,V(e[1]));throw new y(n,p.InvalidParameter,i)}))},a.signatures.push({name:"top",min:2,max:2}),a.functions.first=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>S(this,null,function*(){if(x(e,1,1,n,i),v(e[0])){let t=yield e[0].first(g.abortSignal);if(t!==null){let o=Se.createFromGraphicLikeObject(t.geometry,t.attributes,e[0],n.timeZone);return o._underlyingGraphic=t,o}return t}return A(e[0])?e[0].length===0?null:e[0][0]:M(e[0])?e[0].length()===0?null:e[0].get(0):null}))},a.signatures.push({name:"first",min:1,max:1}),a.functions.attachments=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>S(this,null,function*(){x(e,1,2,n,i);let t={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1){if(e[1]instanceof P){if(e[1].hasField("minsize")&&(t.minsize=V(e[1].field("minsize"))),e[1].hasField("metadata")&&(t.returnMetadata=G(e[1].field("metadata"))),e[1].hasField("maxsize")&&(t.maxsize=V(e[1].field("maxsize"))),e[1].hasField("types")){let o=Ae(e[1].field("types"),!1);o.length>0&&(t.types=o)}}else if(e[1]!==null)throw new y(n,p.InvalidParameter,i)}if(B(e[0])){let o=e[0]._layer,l;if(v(o))l=o;else{if(o==null||!ae(o))return[];l=J(o,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)}return yield l.load(),l.queryAttachments(e[0].field(l.objectIdField),t.minsize,t.maxsize,t.types,t.returnMetadata)}if(e[0]===null)return[];throw new y(n,p.InvalidParameter,i)}))},a.signatures.push({name:"attachments",min:1,max:2}),a.functions.featuresetbyrelationshipname=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>S(this,null,function*(){x(e,2,4,n,i);let t=e[0],o=E(e[1]),l=L(e[2],null),m=G(L(e[3],!0));if(l===null&&(l=["*"]),A(l)===!1)throw new y(n,p.InvalidParameter,i);if(e[0]===null)return null;if(!B(e[0]))throw new y(n,p.InvalidParameter,i);let f=t._layer,s;if(v(f))s=f;else{if(f==null||!ae(f))return null;s=J(f,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)}s=yield s.load();let r=s.relationshipMetaData().filter(w=>w.name===o);if(r.length===0)return null;if(r[0].relationshipTableId!==void 0&&r[0].relationshipTableId!==null&&r[0].relationshipTableId>-1)return Oe(s,r[0],t.field(s.objectIdField),s.spatialReference,l,m,n.lrucache,n.interceptor);let d=s.serviceUrl();if(!d)return null;d=d.charAt(d.length-1)==="/"?d+r[0].relatedTableId.toString():d+"/"+r[0].relatedTableId.toString();let c=yield je(d,s.spatialReference,l,m,n.lrucache,n.interceptor);yield c.load();let N=c.relationshipMetaData();if(N=N.filter(w=>w.id===r[0].id),t.hasField(r[0].keyField)===!1||t.field(r[0].keyField)===null){let w=yield s.getFeatureByObjectId(t.field(s.objectIdField),[r[0].keyField]);if(w){let b=T.create(N[0].keyField+"= @id",{fieldsIndex:c.getFieldsIndex(),timeZone:c.dateFieldsTimeZoneDefaultUTC});return b.parameters={id:w.attributes[r[0].keyField]},c.filter(b)}return new Pe({parentfeatureset:c})}let D=T.create(N[0].keyField+"= @id",{fieldsIndex:c.getFieldsIndex(),timeZone:c.dateFieldsTimeZoneDefaultUTC});return D.parameters={id:t.field(r[0].keyField)},c.filter(D)}))},a.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),a.functions.featuresetbyassociation=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>S(this,null,function*(){x(e,2,3,n,i);let t=e[0],o=E(L(e[1],"")).toLowerCase(),l=k(e[2])?E(e[2]):null;if(e[0]===null)return null;if(!B(e[0]))throw new y(n,p.InvalidParameter,i);let m=t._layer;if(m instanceof le&&(m=J(m,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),m===null||v(m)===!1)return null;yield m.load();let f=m.serviceUrl(),s=yield Me(f,n.spatialReference,!0);if(s.unVersion>=8)return yield Ye(m,t,o,l,s,n,i);let r=s.associations,d=null,c=null,N=!1;if(l!==null&&l!==""&&l!==void 0){for(let F of s.terminals)F.terminalName===l&&(c=F.terminalId);c===null&&(N=!0)}let D=r.getFieldsIndex(),w=D.get("TOGLOBALID").name,b=D.get("FROMGLOBALID").name,z=D.get("TOTERMINALID").name,U=D.get("FROMTERMINALID").name,W=D.get("FROMNETWORKSOURCEID").name,K=D.get("TONETWORKSOURCEID").name,H=D.get("ASSOCIATIONTYPE").name,Ke=D.get("ISCONTENTVISIBLE").name,qe=D.get("OBJECTID").name;for(let F of m.fields)if(F.type==="global-id"){d=t.field(F.name);break}let R=null,pe=new O(new Z({name:"percentalong",alias:"percentalong",type:"double"}),T.create("0",{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC})),ye=new O(new Z({name:"side",alias:"side",type:"string"}),T.create("''",{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC})),C="globalid",we="globalId",ge={};for(let F in s.lkp)ge[F]=s.lkp[F].sourceId;let j=new Ze(new Z({name:"classname",alias:"classname",type:"string"}),null,ge),h="";switch(o){case"midspan":{h=`((${w}='${d}') OR ( ${b}='${d}')) AND (${H} IN (5))`,j.codefield=T.create(`CASE WHEN (${w}='${d}') THEN ${W} ELSE ${K} END`,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC});let F=Y($.findField(r.fields,b));F.name=C,F.alias=C,R=new O(F,T.create(`CASE WHEN (${b}='${d}') THEN ${w} ELSE ${b} END`,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC})),pe=s.unVersion>=4?new te($.findField(r.fields,D.get("PERCENTALONG").name)):new O(new Z({name:"percentalong",alias:"percentalong",type:"double"}),T.create("0",{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}));break}case"junctionedge":{h=`((${w}='${d}') OR ( ${b}='${d}')) AND (${H} IN (4,6))`,j.codefield=T.create(`CASE WHEN (${w}='${d}') THEN ${W} ELSE ${K} END`,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC});let F=Y($.findField(r.fields,b));F.name=C,F.alias=C,R=new O(F,T.create(`CASE WHEN (${b}='${d}') THEN ${w} ELSE ${b} END`,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC})),ye=new O(new Z({name:"side",alias:"side",type:"string"}),T.create(`CASE WHEN (${H}=4) THEN 'from' ELSE 'to' END`,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}));break}case"connected":{let F=`${w}='@T'`,Ie=`${b}='@T'`;c!==null&&(F+=` AND ${z}=@A`,Ie+=` AND ${U}=@A`),h="(("+F+") OR ("+Ie+"))",h=q(h,"@T",d??""),F=q(F,"@T",d??""),c!==null&&(F=q(F,"@A",c.toString()),h=q(h,"@A",c.toString())),j.codefield=T.create("CASE WHEN "+F+` THEN ${W} ELSE ${K} END`,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC});let ie=Y($.findField(r.fields,b));ie.name=C,ie.alias=C,R=new O(ie,T.create("CASE WHEN "+F+` THEN ${b} ELSE ${w} END`,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}));break}case"container":h=`${w}='${d}' AND ${H} = 2`,c!==null&&(h+=` AND ${z} = `+c.toString()),j.codefield=W,h="( "+h+" )",R=new Q($.findField(r.fields,b),C,C);break;case"content":h=`(${b}='${d}' AND ${H} = 2)`,c!==null&&(h+=` AND ${U} = `+c.toString()),j.codefield=K,h="( "+h+" )",R=new Q($.findField(r.fields,w),C,C);break;case"structure":h=`(${w}='${d}' AND ${H} = 3)`,c!==null&&(h+=` AND ${z} = `+c.toString()),j.codefield=W,h="( "+h+" )",R=new Q($.findField(r.fields,b),C,we);break;case"attached":h=`(${b}='${d}' AND ${H} = 3)`,c!==null&&(h+=` AND ${U} = `+c.toString()),j.codefield=K,h="( "+h+" )",R=new Q($.findField(r.fields,w),C,we);break;default:throw new y(n,p.InvalidParameter,i)}return N&&(h="1 <> 1"),new $({parentfeatureset:r,adaptedFields:[new te($.findField(r.fields,qe)),new te($.findField(r.fields,Ke)),R,ye,j,pe],extraFilter:h?T.create(h,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}):null})}))},a.signatures.push({name:"featuresetbyassociation",min:2,max:6}),a.functions.groupby=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>S(this,null,function*(){if(x(e,3,3,n,i),!v(e[0]))throw new y(n,p.InvalidParameter,i);let t=yield e[0].load(),o=[],l=[],m=!1,f=[];if(k(e[1]))f.push(e[1]);else if(e[1]instanceof P)f.push(e[1]);else if(A(e[1]))f=e[1];else{if(!M(e[1]))throw new y(n,p.InvalidParameter,i);f=e[1].toArray()}for(let s of f)if(k(s)){let r=T.create(E(s),{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC}),d=fe(r)===!0?E(s):"%%%%FIELDNAME";o.push({name:d,expression:r}),d==="%%%%FIELDNAME"&&(m=!0)}else{if(!(s instanceof P))throw new y(n,p.InvalidParameter,i);{let r=s.hasField("name")?s.field("name"):"%%%%FIELDNAME",d=s.hasField("expression")?s.field("expression"):"";if(r==="%%%%FIELDNAME"&&(m=!0),!r)throw new y(n,p.InvalidParameter,i);o.push({name:r,expression:T.create(d||r,{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC})})}}if(f=[],k(e[2]))f.push(e[2]);else if(A(e[2]))f=e[2];else if(M(e[2]))f=e[2].toArray();else{if(!(e[2]instanceof P))throw new y(n,p.InvalidParameter,i);f.push(e[2])}for(let s of f){if(!(s instanceof P))throw new y(n,p.InvalidParameter,i);{let r=s.hasField("name")?s.field("name"):"",d=s.hasField("statistic")?s.field("statistic"):"",c=s.hasField("expression")?s.field("expression"):"";if(!r||!d||!c)throw new y(n,p.InvalidParameter,i);l.push({name:r,statistic:d.toLowerCase(),expression:T.create(c,{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC})})}}if(m){let s={};for(let d of t.fields)s[d.name.toLowerCase()]=1;for(let d of o)d.name!=="%%%%FIELDNAME"&&(s[d.name.toLowerCase()]=1);for(let d of l)d.name!=="%%%%FIELDNAME"&&(s[d.name.toLowerCase()]=1);let r=0;for(let d of o)if(d.name==="%%%%FIELDNAME"){for(;s["field_"+r.toString()]===1;)r++;s["field_"+r.toString()]=1,d.name="FIELD_"+r.toString()}}for(let s of o)ue(s.expression,a,n);for(let s of l)ue(s.expression,a,n);return e[0].groupby(o,l)}))},a.signatures.push({name:"groupby",min:3,max:3}),a.functions.distinct=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>S(this,null,function*(){if(v(e[0])){x(e,2,2,n,i);let t=yield e[0].load(),o=[],l=[];if(k(e[1]))l.push(e[1]);else if(e[1]instanceof P)l.push(e[1]);else if(A(e[1]))l=e[1];else{if(!M(e[1]))throw new y(n,p.InvalidParameter,i);l=e[1].toArray()}let m=!1;for(let f of l)if(k(f)){let s=T.create(E(f),{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC}),r=fe(s)===!0?E(f):"%%%%FIELDNAME";o.push({name:r,expression:s}),r==="%%%%FIELDNAME"&&(m=!0)}else{if(!(f instanceof P))throw new y(n,p.InvalidParameter,i);{let s=f.hasField("name")?f.field("name"):"%%%%FIELDNAME",r=f.hasField("expression")?f.field("expression"):"";if(s==="%%%%FIELDNAME"&&(m=!0),!s)throw new y(n,p.InvalidParameter,i);o.push({name:s,expression:T.create(r||s,{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC})})}}if(m){let f={};for(let r of t.fields)f[r.name.toLowerCase()]=1;for(let r of o)r.name!=="%%%%FIELDNAME"&&(f[r.name.toLowerCase()]=1);let s=0;for(let r of o)if(r.name==="%%%%FIELDNAME"){for(;f["field_"+s.toString()]===1;)s++;f["field_"+s.toString()]=1,r.name="FIELD_"+s.toString()}}for(let f of o)ue(f.expression,a,n);return e[0].groupby(o,[])}return Be(e)}))},a.functions.getfeaturesetinfo=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>S(this,null,function*(){if(x(e,1,1,n,i),!v(e[0]))return null;let t=yield e[0].getFeatureSetInfo();return t?P.convertObjectToArcadeDictionary({layerId:t.layerId,layerName:t.layerName,itemId:t.itemId,serviceLayerUrl:t.serviceLayerUrl,webMapLayerId:t.webMapLayerId??null,webMapLayerTitle:t.webMapLayerTitle??null,className:null,objectClassId:null},se(n),!1,!1):null}))},a.signatures.push({name:"getfeaturesetinfo",min:1,max:1}),a.functions.filterbysubtypecode=function(n,i){return a.standardFunctionAsync(n,i,(g,I,e)=>S(this,null,function*(){if(x(e,2,2,n,i),v(e[0])){let t=yield e[0].load(),o=e[1];if(!Te(o))throw new y(n,p.InvalidParameter,i);if(t.subtypeField){let m=T.create(`${t.subtypeField}= ${e[1]}`,{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC});return new ne({parentfeatureset:e[0],whereclause:m})}if(t.typeIdField===null||t.typeIdField==="")throw new y(n,p.FeatureSetDoesNotHaveSubtypes,i);let l=T.create(`${t.typeIdField}= ${e[1]}`,{fieldsIndex:t.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC});return new ne({parentfeatureset:e[0],whereclause:l})}throw new y(n,p.InvalidParameter,i)}))},a.signatures.push({name:"filterbysubtypecode",min:2,max:2}))}export{vn as registerFunctions};
